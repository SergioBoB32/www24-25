(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='1.0.0';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,'on',name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this;},once:function(name,callback,context){if(!eventsApi(this,'once',name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments);});once._callback=callback;return this.on(name,once,context);},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,'off',name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this;}
names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if((callback&&callback!==ev.callback&&callback!==ev.callback._callback)||(context&&context!==ev.context)){retain.push(ev);}}}
if(!retain.length)delete this._events[name];}}
return this;},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,'trigger',name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this;},stopListening:function(obj,name,callback){var listeners=this._listeners;if(!listeners)return this;var deleteListener=!name&&!callback;if(typeof name==='object')callback=this;if(obj)(listeners={})[obj._listenerId]=obj;for(var id in listeners){listeners[id].off(name,callback,this);if(deleteListener)delete this._listeners[id];}
return this;}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==='object'){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest));}
return false;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest));}
return false;}
return true;};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);}};var listenMethods={listenTo:'on',listenToOnce:'once'};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeners=this._listeners||(this._listeners={});var id=obj._listenerId||(obj._listenerId=_.uniqueId('l'));listeners[id]=obj;if(typeof name==='object')callback=this;obj[implementation](name,callback,this);return this;};});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var defaults;var attrs=attributes||{};options||(options={});this.cid=_.uniqueId('c');this.attributes={};_.extend(this,_.pick(options,modelOptions));if(options.parse)attrs=this.parse(attrs,options)||{};if(defaults=_.result(this,'defaults')){attrs=_.defaults({},attrs,defaults);}
this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments);};var modelOptions=['url','urlRoot','collection'];_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},sync:function(){return Backbone.sync.apply(this,arguments);},get:function(attr){return this.attributes[attr];},escape:function(attr){return _.escape(this.get(attr));},has:function(attr){return this.get(attr)!=null;},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={};}
current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val;}else{delete this.changed[attr];}
unset?delete current[attr]:current[attr]=val;}
if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger('change:'+changes[i],this,current[changes[i]],options);}}
if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger('change',this,options);}}
this._pending=false;this._changing=false;return this;},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}));},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}));},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);return this.sync('read',this,options);},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
if(attrs&&(!options||!options.wait)&&!this.set(attrs,options))return false;options=_.extend({validate:true},options);if(!this._validate(attrs,options))return false;if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs);}
if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false;}
if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);method=this.isNew()?'create':(options.patch?'patch':'update');if(method==='patch')options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger('destroy',model,model.collection,options);};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger('sync',model,resp,options);};if(this.isNew()){options.success();return false;}
wrapError(this,options);var xhr=this.sync('delete',this,options);if(!options.wait)destroy();return xhr;},url:function(){var base=_.result(this,'urlRoot')||_.result(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}));},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger('invalid',this,error,_.extend(options||{},{validationError:error}));return false;}});var modelMethods=['keys','values','pairs','invert','pick','omit'];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args);};});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.url)this.url=options.url;if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options));};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,merge:false,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},sync:function(){return Backbone.sync.apply(this,arguments);},add:function(models,options){return this.set(models,_.defaults(options||{},addOptions));},remove:function(models,options){models=_.isArray(models)?models.slice():[models];options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return this;},set:function(models,options){options=_.defaults(options||{},setOptions);if(options.parse)models=this.parse(models,options);if(!_.isArray(models))models=models?[models]:[];var i,l,model,attrs,existing,sort;var at=options.at;var sortable=this.comparator&&(at==null)&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};for(i=0,l=models.length;i<l;i++){if(!(model=this._prepareModel(models[i],options)))continue;if(existing=this.get(model)){if(options.remove)modelMap[existing.cid]=true;if(options.merge){existing.set(model.attributes,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true;}}else if(options.add){toAdd.push(model);model.on('all',this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}}
if(options.remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model);}
if(toRemove.length)this.remove(toRemove,options);}
if(toAdd.length){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){splice.apply(this.models,[at,0].concat(toAdd));}else{push.apply(this.models,toAdd);}}
if(sort)this.sort({silent:true});if(options.silent)return this;for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger('add',model,this,options);}
if(sort)this.trigger('sort',this,options);return this;},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
options.previousModels=this.models;this._reset();this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return this;},push:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:this.length},options));return model;},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model;},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},slice:function(begin,end){return this.models.slice(begin,end);},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id!=null?obj.id:obj.cid||obj];},at:function(index){return this.models[index];},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?'find':'filter'](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},findWhere:function(attrs){return this.where(attrs,true);},sort:function(options){if(!this.comparator)throw new Error('Cannot sort a set without a comparator');options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this);}else{this.models.sort(_.bind(this.comparator,this));}
if(!options.silent)this.trigger('sort',this,options);return this;},sortedIndex:function(model,value,context){value||(value=this.comparator);var iterator=_.isFunction(value)?value:function(model){return model.get(value);};return _.sortedIndex(this.models,model,iterator,context);},pluck:function(attr){return _.invoke(this.models,'get',attr);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?'reset':'set';collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger('sync',collection,resp,options);};wrapError(this,options);return this.sync('read',this,options);},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(resp){if(options.wait)collection.add(model,options);if(success)success(model,resp,options);};model.save(null,options);return model;},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.models);},_reset:function(){this.length=0;this.models=[];this._byId={};},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs;}
options||(options={});options.collection=this;var model=new this.model(attrs,options);if(!model._validate(attrs,options)){this.trigger('invalid',this,attrs,options);return false;}
return model;},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event==='add'||event==='remove')&&collection!==this)return;if(event==='destroy')this.remove(model,options);if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','collect','reduce','foldl','inject','reduceRight','foldr','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','toArray','size','first','head','take','initial','rest','tail','drop','last','without','indexOf','shuffle','lastIndexOf','isEmpty','chain'];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args);};});var attributeMethods=['groupBy','countBy','sortBy'];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value);};return _[method](this.models,iterator,context);};});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName','events'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();this.stopListening();return this;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=_.result(this,'events'))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.on(eventName,method);}else{this.$el.on(eventName,selector,method);}}
return this;},undelegateEvents:function(){this.$el.off('.delegateEvents'+this.cid);return this;},_configure:function(options){if(this.options)options=_.extend({},_.result(this,'options'),options);_.extend(this,_.pick(options,viewOptions));this.options=options;},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,'attributes'));if(this.id)attrs.id=_.result(this,'id');if(this.className)attrs['class']=_.result(this,'className');var $el=Backbone.$('<'+_.result(this,'tagName')+'>').attr(attrs);this.setElement($el,false);}else{this.setElement(_.result(this,'el'),false);}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:'json'};if(!options.url){params.url=_.result(model,'url')||urlError();}
if(options.data==null&&model&&(method==='create'||method==='update'||method==='patch')){params.contentType='application/json';params.data=JSON.stringify(options.attrs||model.toJSON(options));}
if(options.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(options.emulateHTTP&&(type==='PUT'||type==='DELETE'||type==='PATCH')){params.type='POST';if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);if(beforeSend)return beforeSend.apply(this,arguments);};}
if(params.type!=='GET'&&!options.emulateJSON){params.processData=false;}
if(params.type==='PATCH'&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP");};}
var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger('request',model,xhr,options);return xhr;};var methodMap={'create':'POST','update':'PUT','patch':'PATCH','delete':'DELETE','read':'GET'};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments);};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name='';}
if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,['route:'+name].concat(args));router.trigger('route',name,args);Backbone.history.trigger('route',router,name,args);});return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this;},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,'routes');var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(optionalParam,'(?:$1)?').replace(namedParam,function(match,optional){return optional?match:'([^\/]+)';}).replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null;});}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');if(typeof window!=='undefined'){this.location=window.location;this.history=window.history;}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,'');if(!fragment.indexOf(root))fragment=fragment.substr(root.length);}else{fragment=this.getHash();}}
return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:'/'},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));this.root=('/'+this.root+'/').replace(rootStripper,'/');if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){Backbone.$(window).on('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){Backbone.$(window).on('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,'$&/')===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+'#'+this.fragment);return true;}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');this.history.replaceState({},document.title,this.root+this.fragment+loc.search);}
if(!this.options.silent)return this.loadUrl();},stop:function(){Backbone.$(window).off('popstate',this.checkUrl).off('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe));}
if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash());},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});return matched;},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};fragment=this.getFragment(fragment||'');if(this.fragment===fragment)return;this.fragment=fragment;var url=this.root+fragment;if(this._hasPushState){this.history[options.replace?'replaceState':'pushState']({},document.title,url);}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&(fragment!==this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace);}}else{return this.location.assign(url);}
if(options.trigger)this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,'');location.replace(href+'#'+fragment);}else{location.hash='#'+fragment;}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,'constructor')){child=protoProps.constructor;}else{child=function(){return parent.apply(this,arguments);};}
_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child;};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child;};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified');};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger('error',model,resp,options);};};}).call(this);;(function(){var arrays,basicObjects,deepClone,deepExtend,deepExtendCouple,isBasicObject,__slice=[].slice;deepClone=function(obj){var func,isArr;if(!_.isObject(obj)||_.isFunction(obj)){return obj;}
if(obj instanceof Backbone.Collection||obj instanceof Backbone.Model){return obj;}
if(_.isDate(obj)){return new Date(obj.getTime());}
if(_.isRegExp(obj)){return new RegExp(obj.source,obj.toString().replace(/.*\//,""));}
isArr=_.isArray(obj||_.isArguments(obj));func=function(memo,value,key){if(isArr){memo.push(deepClone(value));}else{memo[key]=deepClone(value);}
return memo;};return _.reduce(obj,func,isArr?[]:{});};isBasicObject=function(object){if(object==null)return false;return(object.prototype==={}.prototype||object.prototype===Object.prototype)&&_.isObject(object)&&!_.isArray(object)&&!_.isFunction(object)&&!_.isDate(object)&&!_.isRegExp(object)&&!_.isArguments(object);};basicObjects=function(object){return _.filter(_.keys(object),function(key){return isBasicObject(object[key]);});};arrays=function(object){return _.filter(_.keys(object),function(key){return _.isArray(object[key]);});};deepExtendCouple=function(destination,source,maxDepth){var combine,recurse,sharedArrayKey,sharedArrayKeys,sharedObjectKey,sharedObjectKeys,_i,_j,_len,_len1;if(maxDepth==null){maxDepth=20;}
if(maxDepth<=0){console.warn('_.deepExtend(): Maximum depth of recursion hit.');return _.extend(destination,source);}
sharedObjectKeys=_.intersection(basicObjects(destination),basicObjects(source));recurse=function(key){return source[key]=deepExtendCouple(destination[key],source[key],maxDepth-1);};for(_i=0,_len=sharedObjectKeys.length;_i<_len;_i++){sharedObjectKey=sharedObjectKeys[_i];recurse(sharedObjectKey);}
sharedArrayKeys=_.intersection(arrays(destination),arrays(source));combine=function(key){return source[key]=_.union(destination[key],source[key]);};for(_j=0,_len1=sharedArrayKeys.length;_j<_len1;_j++){sharedArrayKey=sharedArrayKeys[_j];combine(sharedArrayKey);}
return _.extend(destination,source);};deepExtend=function(){var finalObj,maxDepth,objects,_i;objects=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),maxDepth=arguments[_i++];if(!_.isNumber(maxDepth)){objects.push(maxDepth);maxDepth=20;}
if(objects.length<=1){return objects[0];}
if(maxDepth<=0){return _.extend.apply(this,objects);}
finalObj=objects.shift();while(objects.length>0){finalObj=deepExtendCouple(finalObj,deepClone(objects.shift()),maxDepth);}
return finalObj;};_.mixin({deepClone:deepClone,isBasicObject:isBasicObject,basicObjects:basicObjects,arrays:arrays,deepExtend:deepExtend});}).call(this);;(function(factory){if(typeof define==='function'&&define.amd){define(['underscore','backbone'],factory);}else{factory(_,Backbone);}}(function(_,Backbone){function objToPaths(obj){var ret={},separator=DeepModel.keyPathSeparator;for(var key in obj){var val=obj[key];if(val&&val.constructor===Object&&!_.isEmpty(val)){var obj2=objToPaths(val);for(var key2 in obj2){var val2=obj2[key2];ret[key+separator+key2]=val2;}}else{ret[key]=val;}}
return ret;}
function getNested(obj,path,return_exists){var separator=DeepModel.keyPathSeparator;var fields=path.split(separator);var result=obj;return_exists||(return_exists===false);for(var i=0,n=fields.length;i<n;i++){if(return_exists&&!_.has(result,fields[i])){return false;}
result=result[fields[i]];if(result==null&&i<n-1){result={};}
if(typeof result==='undefined'){if(return_exists)
{return true;}
return result;}}
if(return_exists)
{return true;}
return result;}
function setNested(obj,path,val,options){options=options||{};var separator=DeepModel.keyPathSeparator;var fields=path.split(separator);var result=obj;for(var i=0,n=fields.length;i<n&&result!==undefined;i++){var field=fields[i];if(i===n-1){options.unset?delete result[field]:result[field]=val;}else{if(typeof result[field]==='undefined'||!_.isObject(result[field])){result[field]={};}
result=result[field];}}}
function deleteNested(obj,path){setNested(obj,path,null,{unset:true});}
var DeepModel=Backbone.Model.extend({constructor:function(attributes,options){var defaults;var attrs=attributes||{};this.cid=_.uniqueId('c');this.attributes={};if(options&&options.collection)this.collection=options.collection;if(options&&options.parse)attrs=this.parse(attrs,options)||{};if(defaults=_.result(this,'defaults')){attrs=_.deepExtend({},defaults,attrs);}
this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments);},toJSON:function(options){return _.deepClone(this.attributes);},get:function(attr){return getNested(this.attributes,attr);},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==='object'){attrs=key;options=val||{};}else{(attrs={})[key]=val;}
options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.deepClone(this.attributes);this.changed={};}
current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];attrs=objToPaths(attrs);for(attr in attrs){val=attrs[attr];if(!_.isEqual(getNested(current,attr),val))changes.push(attr);if(!_.isEqual(getNested(prev,attr),val)){setNested(this.changed,attr,val);}else{deleteNested(this.changed,attr);}
unset?deleteNested(current,attr):setNested(current,attr,val);}
if(!silent){if(changes.length)this._pending=true;var separator=DeepModel.keyPathSeparator;for(var i=0,l=changes.length;i<l;i++){var key=changes[i];this.trigger('change:'+key,this,getNested(current,key),options);var fields=key.split(separator);for(var n=fields.length-1;n>0;n--){var parentKey=_.first(fields,n).join(separator),wildcardKey=parentKey+separator+'*';this.trigger('change:'+wildcardKey,this,getNested(current,parentKey),options);}}}
if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger('change',this,options);}}
this._pending=false;this._changing=false;return this;},clear:function(options){var attrs={};var shallowAttributes=objToPaths(this.attributes);for(var key in shallowAttributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}));},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return getNested(this.changed,attr)!==undefined;},changedAttributes:function(diff){if(!diff)return this.hasChanged()?objToPaths(this.changed):false;var old=this._changing?this._previousAttributes:this.attributes;diff=objToPaths(diff);old=objToPaths(old);var val,changed=false;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return getNested(this._previousAttributes,attr);},previousAttributes:function(){return _.deepClone(this._previousAttributes);}});DeepModel.keyPathSeparator='.';Backbone.DeepModel=DeepModel;if(typeof module!='undefined')module.exports=DeepModel;return Backbone;}));;!function(root,String){'use strict';var nativeTrim=String.prototype.trim;var nativeTrimRight=String.prototype.trimRight;var nativeTrimLeft=String.prototype.trimLeft;var parseNumber=function(source){return source*1||0;};var strRepeat=function(str,qty){if(qty<1)return'';var result='';while(qty>0){if(qty&1)result+=str;qty>>=1,str+=str;}
return result;};var slice=[].slice;var defaultToWhiteSpace=function(characters){if(characters==null)
return'\\s';else if(characters.source)
return characters.source;else
return'['+_s.escapeRegExp(characters)+']';};var escapeChars={lt:'<',gt:'>',quot:'"',amp:'&',apos:"'"};var reversedEscapeChars={};for(var key in escapeChars)reversedEscapeChars[escapeChars[key]]=key;reversedEscapeChars["'"]='#39';var sprintf=(function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase();}
var str_repeat=strRepeat;var str_format=function(){if(!str_format.cache.hasOwnProperty(arguments[0])){str_format.cache[arguments[0]]=str_format.parse(arguments[0]);}
return str_format.format.call(null,str_format.cache[arguments[0]],arguments);};str_format.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type='',arg,output=[],i,k,match,pad,pad_character,pad_length;for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==='string'){output.push(parse_tree[i]);}
else if(node_type==='array'){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k])){throw new Error(sprintf('[_.sprintf] property "%s" does not exist',match[2][k]));}
arg=arg[match[2][k]];}}else if(match[1]){arg=argv[match[1]];}
else{arg=argv[cursor++];}
if(/[^s]/.test(match[8])&&(get_type(arg)!='number')){throw new Error(sprintf('[_.sprintf] expecting number but found %s',get_type(arg)));}
switch(match[8]){case'b':arg=arg.toString(2);break;case'c':arg=String.fromCharCode(arg);break;case'd':arg=parseInt(arg,10);break;case'e':arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case'f':arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case'o':arg=arg.toString(8);break;case's':arg=((arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg);break;case'u':arg=Math.abs(arg);break;case'x':arg=arg.toString(16);break;case'X':arg=arg.toString(16).toUpperCase();break;}
arg=(/[def]/.test(match[8])&&match[3]&&arg>=0?'+'+arg:arg);pad_character=match[4]?match[4]=='0'?'0':match[4].charAt(1):' ';pad_length=match[6]-String(arg).length;pad=match[6]?str_repeat(pad_character,pad_length):'';output.push(match[5]?arg+pad:pad+arg);}}
return output.join('');};str_format.cache={};str_format.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=/^[^\x25]+/.exec(_fmt))!==null){parse_tree.push(match[0]);}
else if((match=/^\x25{2}/.exec(_fmt))!==null){parse_tree.push('%');}
else if((match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt))!==null){if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);while((replacement_field=replacement_field.substring(field_match[0].length))!==''){if((field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);}
else if((field_match=/^\[(\d+)\]/.exec(replacement_field))!==null){field_list.push(field_match[1]);}
else{throw new Error('[_.sprintf] huh?');}}}
else{throw new Error('[_.sprintf] huh?');}
match[2]=field_list;}
else{arg_names|=2;}
if(arg_names===3){throw new Error('[_.sprintf] mixing positional and named placeholders is not (yet) supported');}
parse_tree.push(match);}
else{throw new Error('[_.sprintf] huh?');}
_fmt=_fmt.substring(match[0].length);}
return parse_tree;};return str_format;})();var _s={VERSION:'2.3.0',isBlank:function(str){if(str==null)str='';return(/^\s*$/).test(str);},stripTags:function(str){if(str==null)return'';return String(str).replace(/<\/?[^>]+>/g,'');},capitalize:function(str){str=str==null?'':String(str);return str.charAt(0).toUpperCase()+str.slice(1);},chop:function(str,step){if(str==null)return[];str=String(str);step=~~step;return step>0?str.match(new RegExp('.{1,'+step+'}','g')):[str];},clean:function(str){return _s.strip(str).replace(/\s+/g,' ');},count:function(str,substr){if(str==null||substr==null)return 0;str=String(str);substr=String(substr);var count=0,pos=0,length=substr.length;while(true){pos=str.indexOf(substr,pos);if(pos===-1)break;count++;pos+=length;}
return count;},chars:function(str){if(str==null)return[];return String(str).split('');},swapCase:function(str){if(str==null)return'';return String(str).replace(/\S/g,function(c){return c===c.toUpperCase()?c.toLowerCase():c.toUpperCase();});},escapeHTML:function(str){if(str==null)return'';return String(str).replace(/[&<>"']/g,function(m){return'&'+reversedEscapeChars[m]+';';});},unescapeHTML:function(str){if(str==null)return'';return String(str).replace(/\&([^;]+);/g,function(entity,entityCode){var match;if(entityCode in escapeChars){return escapeChars[entityCode];}else if(match=entityCode.match(/^#x([\da-fA-F]+)$/)){return String.fromCharCode(parseInt(match[1],16));}else if(match=entityCode.match(/^#(\d+)$/)){return String.fromCharCode(~~match[1]);}else{return entity;}});},escapeRegExp:function(str){if(str==null)return'';return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1');},splice:function(str,i,howmany,substr){var arr=_s.chars(str);arr.splice(~~i,~~howmany,substr);return arr.join('');},insert:function(str,i,substr){return _s.splice(str,i,0,substr);},include:function(str,needle){if(needle==='')return true;if(str==null)return false;return String(str).indexOf(needle)!==-1;},join:function(){var args=slice.call(arguments),separator=args.shift();if(separator==null)separator='';return args.join(separator);},lines:function(str){if(str==null)return[];return String(str).split("\n");},reverse:function(str){return _s.chars(str).reverse().join('');},startsWith:function(str,starts){if(starts==='')return true;if(str==null||starts==null)return false;str=String(str);starts=String(starts);return str.length>=starts.length&&str.slice(0,starts.length)===starts;},endsWith:function(str,ends){if(ends==='')return true;if(str==null||ends==null)return false;str=String(str);ends=String(ends);return str.length>=ends.length&&str.slice(str.length-ends.length)===ends;},succ:function(str){if(str==null)return'';str=String(str);return str.slice(0,-1)+String.fromCharCode(str.charCodeAt(str.length-1)+1);},titleize:function(str){if(str==null)return'';return String(str).replace(/(?:^|\s)\S/g,function(c){return c.toUpperCase();});},camelize:function(str){return _s.trim(str).replace(/[-_\s]+(.)?/g,function(match,c){return c.toUpperCase();});},underscored:function(str){return _s.trim(str).replace(/([a-z\d])([A-Z]+)/g,'$1_$2').replace(/[-\s]+/g,'_').toLowerCase();},dasherize:function(str){return _s.trim(str).replace(/([A-Z])/g,'-$1').replace(/[-_\s]+/g,'-').toLowerCase();},classify:function(str){return _s.titleize(String(str).replace(/[\W_]/g,' ')).replace(/\s/g,'');},humanize:function(str){return _s.capitalize(_s.underscored(str).replace(/_id$/,'').replace(/_/g,' '));},trim:function(str,characters){if(str==null)return'';if(!characters&&nativeTrim)return nativeTrim.call(str);characters=defaultToWhiteSpace(characters);return String(str).replace(new RegExp('\^'+characters+'+|'+characters+'+$','g'),'');},ltrim:function(str,characters){if(str==null)return'';if(!characters&&nativeTrimLeft)return nativeTrimLeft.call(str);characters=defaultToWhiteSpace(characters);return String(str).replace(new RegExp('^'+characters+'+'),'');},rtrim:function(str,characters){if(str==null)return'';if(!characters&&nativeTrimRight)return nativeTrimRight.call(str);characters=defaultToWhiteSpace(characters);return String(str).replace(new RegExp(characters+'+$'),'');},truncate:function(str,length,truncateStr){if(str==null)return'';str=String(str);truncateStr=truncateStr||'...';length=~~length;return str.length>length?str.slice(0,length)+truncateStr:str;},prune:function(str,length,pruneStr){if(str==null)return'';str=String(str);length=~~length;pruneStr=pruneStr!=null?String(pruneStr):'...';if(str.length<=length)return str;var tmpl=function(c){return c.toUpperCase()!==c.toLowerCase()?'A':' ';},template=str.slice(0,length+1).replace(/.(?=\W*\w*$)/g,tmpl);if(template.slice(template.length-2).match(/\w\w/))
template=template.replace(/\s*\S+$/,'');else
template=_s.rtrim(template.slice(0,template.length-1));return(template+pruneStr).length>str.length?str:str.slice(0,template.length)+pruneStr;},words:function(str,delimiter){if(_s.isBlank(str))return[];return _s.trim(str,delimiter).split(delimiter||/\s+/);},pad:function(str,length,padStr,type){str=str==null?'':String(str);length=~~length;var padlen=0;if(!padStr)
padStr=' ';else if(padStr.length>1)
padStr=padStr.charAt(0);switch(type){case'right':padlen=length-str.length;return str+strRepeat(padStr,padlen);case'both':padlen=length-str.length;return strRepeat(padStr,Math.ceil(padlen/2))+str
+strRepeat(padStr,Math.floor(padlen/2));default:padlen=length-str.length;return strRepeat(padStr,padlen)+str;}},lpad:function(str,length,padStr){return _s.pad(str,length,padStr);},rpad:function(str,length,padStr){return _s.pad(str,length,padStr,'right');},lrpad:function(str,length,padStr){return _s.pad(str,length,padStr,'both');},sprintf:sprintf,vsprintf:function(fmt,argv){argv.unshift(fmt);return sprintf.apply(null,argv);},toNumber:function(str,decimals){if(!str)return 0;str=_s.trim(str);if(!str.match(/^-?\d+(?:\.\d+)?$/))return NaN;return parseNumber(parseNumber(str).toFixed(~~decimals));},numberFormat:function(number,dec,dsep,tsep){if(isNaN(number)||number==null)return'';number=number.toFixed(~~dec);tsep=typeof tsep=='string'?tsep:',';var parts=number.split('.'),fnums=parts[0],decimals=parts[1]?(dsep||'.')+parts[1]:'';return fnums.replace(/(\d)(?=(?:\d{3})+$)/g,'$1'+tsep)+decimals;},strRight:function(str,sep){if(str==null)return'';str=String(str);sep=sep!=null?String(sep):sep;var pos=!sep?-1:str.indexOf(sep);return~pos?str.slice(pos+sep.length,str.length):str;},strRightBack:function(str,sep){if(str==null)return'';str=String(str);sep=sep!=null?String(sep):sep;var pos=!sep?-1:str.lastIndexOf(sep);return~pos?str.slice(pos+sep.length,str.length):str;},strLeft:function(str,sep){if(str==null)return'';str=String(str);sep=sep!=null?String(sep):sep;var pos=!sep?-1:str.indexOf(sep);return~pos?str.slice(0,pos):str;},strLeftBack:function(str,sep){if(str==null)return'';str+='';sep=sep!=null?''+sep:sep;var pos=str.lastIndexOf(sep);return~pos?str.slice(0,pos):str;},toSentence:function(array,separator,lastSeparator,serial){separator=separator||', '
lastSeparator=lastSeparator||' and '
var a=array.slice(),lastMember=a.pop();if(array.length>2&&serial)lastSeparator=_s.rtrim(separator)+lastSeparator;return a.length?a.join(separator)+lastSeparator+lastMember:lastMember;},toSentenceSerial:function(){var args=slice.call(arguments);args[3]=true;return _s.toSentence.apply(_s,args);},slugify:function(str){if(str==null)return'';var from="ąàáäâãåæćęèéëêìíïîłńòóöôõøśùúüûñçżź",to="aaaaaaaaceeeeeiiiilnoooooosuuuunczz",regex=new RegExp(defaultToWhiteSpace(from),'g');str=String(str).toLowerCase().replace(regex,function(c){var index=from.indexOf(c);return to.charAt(index)||'-';});return _s.dasherize(str.replace(/[^\w\s-]/g,''));},surround:function(str,wrapper){return[wrapper,str,wrapper].join('');},quote:function(str){return _s.surround(str,'"');},exports:function(){var result={};for(var prop in this){if(!this.hasOwnProperty(prop)||prop.match(/^(?:include|contains|reverse)$/))continue;result[prop]=this[prop];}
return result;},repeat:function(str,qty,separator){if(str==null)return'';qty=~~qty;if(separator==null)return strRepeat(String(str),qty);for(var repeat=[];qty>0;repeat[--qty]=str){}
return repeat.join(separator);},naturalCmp:function(str1,str2){if(str1==str2)return 0;if(!str1)return-1;if(!str2)return 1;var cmpRegex=/(\.\d+)|(\d+)|(\D+)/g,tokens1=String(str1).toLowerCase().match(cmpRegex),tokens2=String(str2).toLowerCase().match(cmpRegex),count=Math.min(tokens1.length,tokens2.length);for(var i=0;i<count;i++){var a=tokens1[i],b=tokens2[i];if(a!==b){var num1=parseInt(a,10);if(!isNaN(num1)){var num2=parseInt(b,10);if(!isNaN(num2)&&num1-num2)
return num1-num2;}
return a<b?-1:1;}}
if(tokens1.length===tokens2.length)
return tokens1.length-tokens2.length;return str1<str2?-1:1;},levenshtein:function(str1,str2){if(str1==null&&str2==null)return 0;if(str1==null)return String(str2).length;if(str2==null)return String(str1).length;str1=String(str1);str2=String(str2);var current=[],prev,value;for(var i=0;i<=str2.length;i++)
for(var j=0;j<=str1.length;j++){if(i&&j)
if(str1.charAt(j-1)===str2.charAt(i-1))
value=prev;else
value=Math.min(current[j],current[j-1],prev)+1;else
value=i+j;prev=current[j];current[j]=value;}
return current.pop();}};_s.strip=_s.trim;_s.lstrip=_s.ltrim;_s.rstrip=_s.rtrim;_s.center=_s.lrpad;_s.rjust=_s.lpad;_s.ljust=_s.rpad;_s.contains=_s.include;_s.q=_s.quote;if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports)
module.exports=_s;exports._s=_s;}
if(typeof define==='function'&&define.amd)
define('underscore.string',[],function(){return _s;});root._=root._||{};root._.string=root._.str=_s;}(this,String);;/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var Mustache;(function(exports){if(typeof module!=="undefined"&&module.exports){module.exports=exports;}else if(typeof define==="function"){define(exports);}else{Mustache=exports;}}((function(){var exports={};exports.name="mustache.js";exports.version="0.7.1";exports.tags=["{{","}}"];exports.Scanner=Scanner;exports.Context=Context;exports.Writer=Writer;var whiteRe=/\s*/;var spaceRe=/\s+/;var nonSpaceRe=/\S/;var eqRe=/\s*=/;var curlyRe=/\s*\}/;var tagRe=/#|\^|\/|>|\{|&|=|!/;function testRe(re,string){return RegExp.prototype.test.call(re,string);}
function isWhitespace(string){return!testRe(nonSpaceRe,string);}
var isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]";};function escapeRe(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");}
var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;',"/":'&#x2F;'};function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s];});}
exports.escape=escapeHtml;function Scanner(string){this.string=string;this.tail=string;this.pos=0;}
Scanner.prototype.eos=function(){return this.tail==="";};Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(match&&match.index===0){this.tail=this.tail.substring(match[0].length);this.pos+=match[0].length;return match[0];}
return"";};Scanner.prototype.scanUntil=function(re){var match,pos=this.tail.search(re);switch(pos){case-1:match=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,pos);this.tail=this.tail.substring(pos);this.pos+=pos;}
return match;};function Context(view,parent){this.view=view;this.parent=parent;this.clearCache();}
Context.make=function(view){return(view instanceof Context)?view:new Context(view);};Context.prototype.clearCache=function(){this._cache={};};Context.prototype.push=function(view){return new Context(view,this);};Context.prototype.lookup=function(name){var value=this._cache[name];if(!value){if(name==="."){value=this.view;}else{var context=this;while(context){if(name.indexOf(".")>0){var names=name.split("."),i=0;value=context.view;while(value&&i<names.length){value=value[names[i++]];}}else{value=context.view[name];}
if(value!=null){break;}
context=context.parent;}}
this._cache[name]=value;}
if(typeof value==="function"){value=value.call(this.view);}
return value;};function Writer(){this.clearCache();}
Writer.prototype.clearCache=function(){this._cache={};this._partialCache={};};Writer.prototype.compile=function(template,tags){var fn=this._cache[template];if(!fn){var tokens=exports.parse(template,tags);fn=this._cache[template]=this.compileTokens(tokens,template);}
return fn;};Writer.prototype.compilePartial=function(name,template,tags){var fn=this.compile(template,tags);this._partialCache[name]=fn;return fn;};Writer.prototype.compileTokens=function(tokens,template){var fn=compileTokens(tokens);var self=this;return function(view,partials){if(partials){if(typeof partials==="function"){self._loadPartial=partials;}else{for(var name in partials){self.compilePartial(name,partials[name]);}}}
return fn(self,Context.make(view),template);};};Writer.prototype.render=function(template,view,partials){return this.compile(template)(view,partials);};Writer.prototype._section=function(name,context,text,callback){var value=context.lookup(name);switch(typeof value){case"object":if(isArray(value)){var buffer="";for(var i=0,len=value.length;i<len;++i){buffer+=callback(this,context.push(value[i]));}
return buffer;}
return value?callback(this,context.push(value)):"";case"function":var self=this;var scopedRender=function(template){return self.render(template,context);};var result=value.call(context.view,text,scopedRender);return result!=null?result:"";default:if(value){return callback(this,context);}}
return"";};Writer.prototype._inverted=function(name,context,callback){var value=context.lookup(name);if(!value||(isArray(value)&&value.length===0)){return callback(this,context);}
return"";};Writer.prototype._partial=function(name,context){if(!(name in this._partialCache)&&this._loadPartial){this.compilePartial(name,this._loadPartial(name));}
var fn=this._partialCache[name];return fn?fn(context):"";};Writer.prototype._name=function(name,context){var value=context.lookup(name);if(typeof value==="function"){value=value.call(context.view);}
return(value==null)?"":String(value);};Writer.prototype._escaped=function(name,context){return exports.escape(this._name(name,context));};function sectionBounds(token){var start=token[3];var end=start;var tokens;while((tokens=token[4])&&tokens.length){token=tokens[tokens.length-1];end=token[3];}
return[start,end];}
function compileTokens(tokens){var subRenders={};function subRender(i,tokens,template){if(!subRenders[i]){var fn=compileTokens(tokens);subRenders[i]=function(writer,context){return fn(writer,context,template);};}
return subRenders[i];}
return function(writer,context,template){var buffer="";var token,sectionText;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];switch(token[0]){case"#":sectionText=template.slice.apply(template,sectionBounds(token));buffer+=writer._section(token[1],context,sectionText,subRender(i,token[4],template));break;case"^":buffer+=writer._inverted(token[1],context,subRender(i,token[4],template));break;case">":buffer+=writer._partial(token[1],context);break;case"&":buffer+=writer._name(token[1],context);break;case"name":buffer+=writer._escaped(token[1],context);break;case"text":buffer+=token[1];break;}}
return buffer;};}
function nestTokens(tokens){var tree=[];var collector=tree;var sections=[];var token,section;for(var i=0;i<tokens.length;++i){token=tokens[i];switch(token[0]){case"#":case"^":token[4]=[];sections.push(token);collector.push(token);collector=token[4];break;case"/":if(sections.length===0){throw new Error("Unopened section: "+token[1]);}
section=sections.pop();if(section[1]!==token[1]){throw new Error("Unclosed section: "+section[1]);}
if(sections.length>0){collector=sections[sections.length-1][4];}else{collector=tree;}
break;default:collector.push(token);}}
section=sections.pop();if(section){throw new Error("Unclosed section: "+section[1]);}
return tree;}
function squashTokens(tokens){var token,lastToken,squashedTokens=[];for(var i=0;i<tokens.length;++i){token=tokens[i];if(lastToken&&lastToken[0]==="text"&&token[0]==="text"){lastToken[1]+=token[1];lastToken[3]=token[3];}else{lastToken=token;squashedTokens.push(token);}}
return squashedTokens;}
function escapeTags(tags){if(tags.length!==2){throw new Error("Invalid tags: "+tags.join(" "));}
return[new RegExp(escapeRe(tags[0])+"\\s*"),new RegExp("\\s*"+escapeRe(tags[1]))];}
exports.parse=function(template,tags){template=template||'';tags=tags||exports.tags;var tagRes=escapeTags(tags);var scanner=new Scanner(template);var tokens=[],spaces=[],hasTag=false,nonSpace=false;function stripSpace(){if(hasTag&&!nonSpace){while(spaces.length){tokens.splice(spaces.pop(),1);}}else{spaces=[];}
hasTag=false;nonSpace=false;}
var start,type,value,chr;while(!scanner.eos()){start=scanner.pos;value=scanner.scanUntil(tagRes[0]);if(value){for(var i=0,len=value.length;i<len;++i){chr=value.charAt(i);if(isWhitespace(chr)){spaces.push(tokens.length);}else{nonSpace=true;}
tokens.push(["text",chr,start,start+1]);start+=1;if(chr==="\n"){stripSpace();}}}
start=scanner.pos;if(!scanner.scan(tagRes[0])){break;}
hasTag=true;type=scanner.scan(tagRe)||"name";scanner.scan(whiteRe);if(type==="="){value=scanner.scanUntil(eqRe);scanner.scan(eqRe);scanner.scanUntil(tagRes[1]);}else if(type==="{"){var closeRe=new RegExp("\\s*"+escapeRe("}"+tags[1]));value=scanner.scanUntil(closeRe);scanner.scan(curlyRe);scanner.scanUntil(tagRes[1]);type="&";}else{value=scanner.scanUntil(tagRes[1]);}
if(!scanner.scan(tagRes[1])){throw new Error("Unclosed tag at "+scanner.pos);}
tokens.push([type,value,start,scanner.pos]);if(type==="name"||type==="{"||type==="&"){nonSpace=true;}
if(type==="="){tags=value.split(spaceRe);tagRes=escapeTags(tags);}}
tokens=squashTokens(tokens);return nestTokens(tokens);};var _writer=new Writer();exports.clearCache=function(){return _writer.clearCache();};exports.compile=function(template,tags){return _writer.compile(template,tags);};exports.compilePartial=function(name,template,tags){return _writer.compilePartial(name,template,tags);};exports.compileTokens=function(tokens,template){return _writer.compileTokens(tokens,template);};exports.render=function(template,view,partials){return _writer.render(template,view,partials);};exports.to_html=function(template,view,partials,send){var result=exports.render(template,view,partials);if(typeof send==="function"){send(result);}else{return result;}};return exports;}())));;/*!
 * jQuery Cookie Plugin v1.3
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */(function($,document,undefined){var pluses=/\+/g;function raw(s){return s;}
function decoded(s){return decodeURIComponent(s.replace(pluses,' '));}
var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if(value===null){options.expires=-1;}
if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
value=config.json?JSON.stringify(value):String(value);return(document.cookie=[encodeURIComponent(key),'=',config.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
var decode=config.raw?raw:decoded;var cookies=document.cookie.split('; ');for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split('=');if(decode(parts.shift())===key){var cookie=decode(parts.join('='));return config.json?JSON.parse(cookie):cookie;}}
return null;};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==null){$.cookie(key,null,options);return true;}
return false;};})(jQuery,document);;/*!
 * jQuery Mousewheel 3.1.13
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 */(function(factory){if(typeof define==='function'&&define.amd){define(['../../common/js/lib/jquery.validate'],factory);}else if(typeof exports==='object'){module.exports=factory;}else{factory(jQuery);}}(function($){var toFix=['wheel','mousewheel','DOMMouseScroll','MozMousePixelScroll'],toBind=('onwheel'in document||document.documentMode>=9)?['wheel']:['mousewheel','DomMouseScroll','MozMousePixelScroll'],slice=Array.prototype.slice,nullLowestDeltaTimeout,lowestDelta;if($.event.fixHooks){for(var i=toFix.length;i;){$.event.fixHooks[toFix[--i]]=$.event.mouseHooks;}}
var special=$.event.special.mousewheel={version:'3.1.12',setup:function(){if(this.addEventListener){for(var i=toBind.length;i;){this.addEventListener(toBind[--i],handler,false);}}else{this.onmousewheel=handler;}
$.data(this,'mousewheel-line-height',special.getLineHeight(this));$.data(this,'mousewheel-page-height',special.getPageHeight(this));},teardown:function(){if(this.removeEventListener){for(var i=toBind.length;i;){this.removeEventListener(toBind[--i],handler,false);}}else{this.onmousewheel=null;}
$.removeData(this,'mousewheel-line-height');$.removeData(this,'mousewheel-page-height');},getLineHeight:function(elem){var $elem=$(elem),$parent=$elem['offsetParent'in $.fn?'offsetParent':'parent']();if(!$parent.length){$parent=$('body');}
return parseInt($parent.css('fontSize'),10)||parseInt($elem.css('fontSize'),10)||16;},getPageHeight:function(elem){return $(elem).height();},settings:{adjustOldDeltas:true,normalizeOffset:true}};$.fn.extend({mousewheel:function(fn){return fn?this.bind('mousewheel',fn):this.trigger('mousewheel');},unmousewheel:function(fn){return this.unbind('mousewheel',fn);}});function handler(event){var orgEvent=event||window.event,args=slice.call(arguments,1),delta=0,deltaX=0,deltaY=0,absDelta=0,offsetX=0,offsetY=0;event=$.event.fix(orgEvent);event.type='mousewheel';if('detail'in orgEvent){deltaY=orgEvent.detail*-1;}
if('wheelDelta'in orgEvent){deltaY=orgEvent.wheelDelta;}
if('wheelDeltaY'in orgEvent){deltaY=orgEvent.wheelDeltaY;}
if('wheelDeltaX'in orgEvent){deltaX=orgEvent.wheelDeltaX*-1;}
if('axis'in orgEvent&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaX=deltaY*-1;deltaY=0;}
delta=deltaY===0?deltaX:deltaY;if('deltaY'in orgEvent){deltaY=orgEvent.deltaY*-1;delta=deltaY;}
if('deltaX'in orgEvent){deltaX=orgEvent.deltaX;if(deltaY===0){delta=deltaX*-1;}}
if(deltaY===0&&deltaX===0){return;}
if(orgEvent.deltaMode===1){var lineHeight=$.data(this,'mousewheel-line-height');delta*=lineHeight;deltaY*=lineHeight;deltaX*=lineHeight;}else if(orgEvent.deltaMode===2){var pageHeight=$.data(this,'mousewheel-page-height');delta*=pageHeight;deltaY*=pageHeight;deltaX*=pageHeight;}
absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX));if(!lowestDelta||absDelta<lowestDelta){lowestDelta=absDelta;if(shouldAdjustOldDeltas(orgEvent,absDelta)){lowestDelta/=40;}}
if(shouldAdjustOldDeltas(orgEvent,absDelta)){delta/=40;deltaX/=40;deltaY/=40;}
delta=Math[delta>=1?'floor':'ceil'](delta/lowestDelta);deltaX=Math[deltaX>=1?'floor':'ceil'](deltaX/lowestDelta);deltaY=Math[deltaY>=1?'floor':'ceil'](deltaY/lowestDelta);if(special.settings.normalizeOffset&&this.getBoundingClientRect){var boundingRect=this.getBoundingClientRect();offsetX=event.clientX-boundingRect.left;offsetY=event.clientY-boundingRect.top;}
event.deltaX=deltaX;event.deltaY=deltaY;event.deltaFactor=lowestDelta;event.offsetX=offsetX;event.offsetY=offsetY;event.deltaMode=0;args.unshift(event,delta,deltaX,deltaY);if(nullLowestDeltaTimeout){clearTimeout(nullLowestDeltaTimeout);}
nullLowestDeltaTimeout=setTimeout(nullLowestDelta,200);return($.event.dispatch||$.event.handle).apply(this,args);}
function nullLowestDelta(){lowestDelta=null;}
function shouldAdjustOldDeltas(orgEvent,absDelta){return special.settings.adjustOldDeltas&&orgEvent.type==='mousewheel'&&absDelta%120===0;}}));;if(typeof(window._ASSET)!=='function'){window._ASSET=function(u){return u;};}
window.jsonLoggingConfig=window.jsonLoggingConfig||undefined;window.isLocalOrPreProd=window.location.host.match(/^(localhost|.*prezi\.dev|.*preprod\.prezi\.com).*$/)!==null;window.isProduction=!isLocalOrPreProd;if(console===undefined){var dummy=function(v){};function _console(){return{log:dummy,info:dummy,warn:dummy,error:dummy};}
var console=new _console();}
(function($){$.extend({jsonlog:function(params){if(!params){isProduction||console.warn('no parameter given');return false;}
if(params!==Object(params)){isProduction||console.warn('parameter is not an object');return false;}
if(params._object===undefined&&params.object!==undefined){params._object=params.object;}
if(params.object===undefined&&params._object!==undefined){params.object=params._object;}
var mandatoryFields=['_action','object','trigger'];for(var i=0;i<mandatoryFields.length;i++){if(params[mandatoryFields[i]]===undefined){isProduction||console.warn(mandatoryFields[i]+' is missing from the parameter object');return false;}}
if(!params._category){params._category='website';}
if(isLocalOrPreProd){if(typeof(params.log_callback)==='function'){params.log_callback();}
console.log(params);return true;}
if(!params.current_time){params.current_time=new Date().getTime();}
if(params._async===undefined){params._async=true;}
var get_current_url=function(){var path=window.location.pathname,log_path;if(prezi_id){log_path='landing_page';}else if(path==="/"||path.indexOf("/index/")===0){log_path='cover_page';}else{log_path=path.replace(/\//,"").replace(/-/g,"_").replace(/\//g,"_");log_path+="page";}
return log_path;};var get_prezi_id=function(){try{if(window.Prezi){return Prezi.data.oid;}}catch(e){}
return null;};var levels_allowed=['INFO','WARN','ERROR'];var prezi_id=get_prezi_id();var source=get_current_url();var defaults={name:'debug',levelname:'INFO',levelno:20,created:parseInt(params.current_time/1000,10),msecs:params.current_time%1000,relativeCreated:0,msg:'',source:source,prezi_id:prezi_id,platform:'website',session_id:'',client_datetime:(new Date()).toISOString(),putma_id:$.cookie&&$.cookie('__putma')};var data={};var settings=$.extend({},defaults,params);var prepare_data=function(callback){var i=0,len=levels_allowed.length,level=null;for(i;i<len;i++){if(levels_allowed[i]===settings.levelname){level=settings.levelname;break;}}
if(!level){isProduction||console.warn('unknown log level given');return;}else{data=$.extend({},settings);callback();}};delete data._async;var retryAjax=function(request){request.tryCount++;if(request.tryCount<=request.retryLimit){isProduction||console.info("Retrying request...");$.ajax(request);}}
var _log_request=function(){$.ajax({type:jsonLoggingConfig.method,cache:false,async:params._async,url:jsonLoggingConfig.url,contentType:'application/json','headers':{'authorization':jsonLoggingConfig.header},dataType:'json',timeout:2000,data:JSON.stringify([data]),tryCount:0,retryLimit:3,success:function(data,status,xhr){if(data.success){isProduction||console.info("log submitted successfully");if(typeof(params.log_callback)==='function'){params.log_callback();}}else{isProduction||console.warn(data.error);}},error:function(xhr,textStatus){isProduction||console.warn("backend problem encountered caused by: "+textStatus);if(typeof featureSwitch!=="undefined"&&featureSwitch&&featureSwitch.hasOwnProperty("testLoggingRetry")){retryAjax(this);}}});};var _log=function(){if(window.jsonLoggingConfig===undefined){$.ajax({type:'GET',dataType:'json',url:Site.LOG_API_ENDPOINT+"/api/token/log/json/",async:params._async,success:function(data){window.jsonLoggingConfig=data;_log_request();},}).fail(function(status){isProduction||console.error(status);});}else{_log_request();}};var _logging=function(){prepare_data(_log);};return _logging();}});if(window.JSON===undefined){var s=$('<script/>').attr({'src':_ASSET('/assets/js/lib/json2.js')});$('head').append(s);}})(jQuery);;$.extend(Site,{preventOuterScrolling:function($element){var height=$element.height(),scrollHeight=$element.get(0).scrollHeight;$element.off("mousewheel").on("mousewheel",function(event){var endReached=(this.scrollTop===scrollHeight-height||this.scrollTop+2>=scrollHeight-height);var blockScrolling=endReached&&event.deltaY<0||this.scrollTop===0&&event.deltaY>0;return!blockScrolling;});}});;!function(window,document,undefined){var prefixes=['webkit','Moz','ms','O'],animations={},useCssAnimations
function createEl(tag,prop){var el=document.createElement(tag||'div'),n
for(n in prop)el[n]=prop[n]
return el}
function ins(parent){for(var i=1,n=arguments.length;i<n;i++)
parent.appendChild(arguments[i])
return parent}
var sheet=function(){var el=createEl('style',{type:'text/css'})
ins(document.getElementsByTagName('head')[0],el)
return el.sheet||el.styleSheet}()
function addAnimation(alpha,trail,i,lines){var name=['opacity',trail,~~(alpha*100),i,lines].join('-'),start=0.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf('Animation')).toLowerCase(),pre=prefix&&'-'+prefix+'-'||''
if(!animations[name]){sheet.insertRule('@'+pre+'keyframes '+name+'{'+'0%{opacity:'+z+'}'+
start+'%{opacity:'+alpha+'}'+
(start+0.01)+'%{opacity:1}'+
(start+trail)%100+'%{opacity:'+alpha+'}'+'100%{opacity:'+z+'}'+'}',sheet.cssRules.length)
animations[name]=1}
return name}
function vendor(el,prop){var s=el.style,pp,i
if(s[prop]!==undefined)return prop
prop=prop.charAt(0).toUpperCase()+prop.slice(1)
for(i=0;i<prefixes.length;i++){pp=prefixes[i]+prop
if(s[pp]!==undefined)return pp}}
function css(el,prop){for(var n in prop)
el.style[vendor(el,n)||n]=prop[n]
return el}
function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i]
for(var n in def)
if(obj[n]===undefined)obj[n]=def[n]}
return obj}
function pos(el){var o={x:el.offsetLeft,y:el.offsetTop}
while((el=el.offsetParent))
o.x+=el.offsetLeft,o.y+=el.offsetTop
return o}
var defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:'#000',speed:1,trail:100,opacity:1/4,fps:20,zIndex:2e9,className:'spinner',top:'auto',left:'auto',position:'relative'}
var Spinner=function Spinner(o){if(!this.spin)return new Spinner(o)
this.opts=merge(o||{},Spinner.defaults,defaults)}
Spinner.defaults={}
merge(Spinner.prototype,{spin:function(target){this.stop()
var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width,ep,tp
if(target){target.insertBefore(el,target.firstChild||null)
tp=pos(target)
ep=pos(el)
css(el,{left:(o.left=='auto'?tp.x-ep.x+(target.offsetWidth>>1):parseInt(o.left,10)+mid)+'px',top:(o.top=='auto'?tp.y-ep.y+(target.offsetHeight>>1):parseInt(o.top,10)+mid)+'px'})}
el.setAttribute('aria-role','progressbar')
self.lines(el,self.opts)
if(!useCssAnimations){var i=0,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;(function anim(){i++;for(var s=o.lines;s;s--){var alpha=Math.max(1-(i+s*astep)%f*ostep,o.opacity)
self.opacity(el,o.lines-s,alpha,o)}
self.timeout=self.el&&setTimeout(anim,~~(1000/fps))})()}
return self},stop:function(){var el=this.el
if(el){clearTimeout(this.timeout)
if(el.parentNode)el.parentNode.removeChild(el)
this.el=undefined}
return this},lines:function(el,o){var i=0,seg
function fill(color,shadow){return css(createEl(),{position:'absolute',width:(o.length+o.width)+'px',height:o.width+'px',background:color,boxShadow:shadow,transformOrigin:'left',transform:'rotate('+~~(360/o.lines*i+o.rotate)+'deg) translate('+o.radius+'px'+',0)',borderRadius:(o.corners*o.width>>1)+'px'})}
for(;i<o.lines;i++){seg=css(createEl(),{position:'absolute',top:1+~(o.width/2)+'px',transform:o.hwaccel?'translate3d(0,0,0)':'',opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,i,o.lines)+' '+1/o.speed+'s linear infinite'})
if(o.shadow)ins(seg,css(fill('#000','0 0 4px '+'#000'),{top:2+'px'}))
ins(el,ins(seg,fill(o.color,'0 0 1px rgba(0,0,0,.1)')))}
return el},opacity:function(el,i,val){if(i<el.childNodes.length)el.childNodes[i].style.opacity=val}});(function(){function vml(tag,attr){return createEl('<'+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}
var s=css(createEl('group'),{behavior:'url(#default#VML)'})
if(!vendor(s,'transform')&&s.adj){sheet.addRule('.spin-vml','behavior:url(#default#VML)')
Spinner.prototype.lines=function(el,o){var r=o.length+o.width,s=2*r
function grp(){return css(vml('group',{coordsize:s+' '+s,coordorigin:-r+' '+-r}),{width:s,height:s})}
var margin=-(o.width+o.length)*2+'px',g=css(grp(),{position:'absolute',top:margin,left:margin}),i
function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+'deg',left:~~dx}),ins(css(vml('roundrect',{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml('fill',{color:o.color,opacity:o.opacity}),vml('stroke',{opacity:0}))))}
if(o.shadow)
for(i=1;i<=o.lines;i++)
seg(i,-2,'progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)')
for(i=1;i<=o.lines;i++)seg(i)
return ins(el,g)}
Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild
o=o.shadow&&o.lines||0
if(c&&i+o<c.childNodes.length){c=c.childNodes[i+o];c=c&&c.firstChild;c=c&&c.firstChild
if(c)c.opacity=val}}}
else
useCssAnimations=vendor(s,'animation')})()
if(typeof define=='function'&&define.amd)
define(function(){return Spinner})
window.Spinner=Spinner}(window,document);;var GA_RANDOM_MIN=1000000000;var GA_RANDOM_MAX=9999999999;var GA_SYNCHRONOUS_TIMEOUT_MILLISECONDS=200;var GA_SYNCHRONOUS_WAIT_MILLISECONDS=100;(function($){"use strict";var crumbleCookie=function(getKey){var cookies=document.cookie.split(';');var kvCookies={};for(var cookie=0;cookie<cookies.length;cookie++){var key=$.trim(cookies[cookie].substring(0,cookies[cookie].indexOf('=')));kvCookies[key]=$.trim(cookies[cookie].substring(cookies[cookie].indexOf('=')+1,cookies[cookie].length));}
if(getKey){return kvCookies[getKey]?kvCookies[getKey]:null;}else{return kvCookies;}};var randomAnalyticsId=function(){return''+(Math.floor((GA_RANDOM_MAX-GA_RANDOM_MIN)*Math.random())+GA_RANDOM_MIN);};$.track={};$.track.url=function(url){if(!url){return;}
try{_gaq.push(['_trackPageview',url]);}catch(err){try{console.error(err);}
catch(ignore){}}
try{console.log("GAT: ",url);}catch(ignore){}
return $;};$.track.event=function(category,action,label,value,non_interaction){if(value===undefined){value=0;}
if(non_interaction===undefined){non_interaction=false;}
if(window._gaq){window._gaq.push(['_trackEvent',category,action,label,value,non_interaction]);}
return $;};$.track.syncEvent=function(category,action,label,value){var _gaProfileId=window._gaProfileId;var url='http://www.google-analytics.com/__utm.gif';var cookies='__utma='+crumbleCookie('__utma')+';__utmz='+crumbleCookie('__utmz');action=action||"";label=label||"";if(value===undefined){value=0;}
var utme="5("+category+"*"+action+"*"+label+")("+value+")";var data={'utmwv':'4.8.9','utmn':randomAnalyticsId(),'utmhid':randomAnalyticsId(),'utmhn':window.location.hostname,'utmr':'-','utmp':window.location.pathname,'utmdt':document.title,'utmac':_gaProfileId,'utmcc':cookies,'utmt':'event','utme':utme};$.ajax({url:url,data:data,method:'GET',async:false,cache:false,timeout:GA_SYNCHRONOUS_TIMEOUT_MILLISECONDS});return $;};$.fn.trackEvent=function(options){var async=(options.async===undefined?true:options.async);var event=options.event||"click";var eventLabel=options['eventLabel']||event;var category=options.category||"";var value=options.value||0;$(this).bind(event,function(e){var $this=$(this);var label=options.label||$this.text();if(async){$.track.event(category,eventLabel,label,value);}else{if($this.is('a')&&event==="click"){$.track.event(category,eventLabel,label,value);e.preventDefault();setTimeout(function(){document.location=$this.attr('href');},GA_SYNCHRONOUS_WAIT_MILLISECONDS);}else{$.track.syncEvent(category,eventLabel,label,value);}}});return this;};}(jQuery));jQuery(function($){"use strict";$('#navigation a').trackEvent({category:'NavigationTabs',async:false});$('#userfunctions .sign-up').trackEvent({category:'SignUp',label:'global.header',async:false});$('body.home  #content #signup').trackEvent({category:'SignUp',label:'coverPage.bigButton',async:false});$('body.login #content .sign-up').trackEvent({category:'SignUp',label:'loginPage',async:false});$('#content a[href="mailto:sales@prezi.com"]').trackEvent({category:'Link',label:'sales@prezi.com'});});;var trackingScripts={"intercom_with_settings":"\
        (function() {\
            var w = window;\
            var ic = w.Intercom;\
            if (typeof ic === 'function') {\
                ic('reattach_activator');\
                ic('update', intercomSettings);\
            } else {\
                var d = document;\
                var i = function() {\
                    i.c(arguments)\
                };\
                i.q = [];\
                i.c = function(args) {\
                    i.q.push(args)\
                };\
                w.Intercom = i;\
                \
                function l() {\
                    var s = d.createElement('script');\
                    s.type = 'text/javascript';\
                    s.async = true;\
                    s.src = 'https://widget.intercom.io/widget/'+ w.intercomSettings.app_id;\
                    var x = d.getElementsByTagName('script')[0];\
                    x.parentNode.insertBefore(s, x);\
                }\
                if (document.readyState === 'complete') {\
                    l();\
                }\
                else {\
                    if (w.attachEvent) {\
                        w.attachEvent('onload', l);\
                    } else {\
                        w.addEventListener('load', l, false);\
                    }\
                }\
            }\
        })()"};$.extend(Site,{insertTrackingScript:function(trackingType,extra_args){var s=document.createElement('script');s.type='text/javascript';var code=trackingScripts[trackingType];if(arguments.length>1){$.each(extra_args,function(key,value){var pattern=new RegExp("{{[ ]*"+key+"[ ]*}}","g");code=code.replace(pattern,value);});}
try{s.appendChild(document.createTextNode(code));document.body.appendChild(s);}catch(e){s.text=code;document.body.appendChild(s);}}});;(function($){$.fn.spin=function(opts,color){var presets={"tiny":{lines:8,length:2,width:2,radius:3},"small":{lines:8,length:4,width:3,radius:5},"large":{lines:10,length:8,width:4,radius:8},"search":{lines:11,length:10,width:4,radius:13,corners:0,rotate:0,color:'#000',speed:1,trail:50,shadow:false,hwaccel:false,className:'spinner',zIndex:2e9,top:'auto',left:'auto'}};if(window.Spinner!=null){return this.each(function(){var $this=$(this),data=$this.data();if(data.spinner){data.spinner.stop();delete data.spinner;}
if(opts!==false){if(typeof opts==="string"){if(opts in presets){opts=presets[opts];}else{opts={};}
if(color){opts.color=color;}}
data.spinner=new Spinner($.extend({color:$this.css('color')},opts)).spin(this);}});}else{throw"Spinner is not on window.";}};})(jQuery);;function pagePreziCards(that)
{that.$el.find('.pager li.page').remove();that.$el.find('.pager li.page_dots').remove();var currentPage=that.collection.pagingConfig.page;var allPages=that.collection.pageCount;var previousPageEl=that.$el.find('.pager #pager_previous');var nextPageEl=that.$el.find('.pager #pager_next');var pagesToShow=7;var mediumPosition=4;if(currentPage<=4){pagesToShow=currentPage+3;mediumPosition=currentPage+1;}
var pageStart=currentPage-mediumPosition+1;var pageEnd=currentPage+(pagesToShow-mediumPosition);if(pageStart<0){pageStart=0;pageEnd=Math.min(pagesToShow-1,allPages-1);}
if(pageEnd>=allPages){pageEnd=allPages-1;pageStart=Math.max(0,allPages-pagesToShow-1);}
if(pageStart>1){$('<li class="page_dots">...</li>').insertBefore(nextPageEl);}
for(var i=pageStart;i<=pageEnd;i++){var pageNumEl=$('<li><a class="btn btn-discreet" href="#">'+(i+1)+'</a></li>');pageNumEl.addClass('page').data('page',i);if(i==currentPage){pageNumEl.addClass('active');}
pageNumEl.insertBefore(nextPageEl);}
if(pageEnd<allPages-2){$('<li class="page_dots">...</li>').insertBefore(nextPageEl);}
if(currentPage==0){previousPageEl.addClass('disabled');previousPageEl.hide();}else{previousPageEl.removeClass('disabled');previousPageEl.show();}
if(currentPage==that.collection.pageCount-1){nextPageEl.addClass('disabled');nextPageEl.hide();}else{nextPageEl.removeClass('disabled');nextPageEl.show();}
that.updateCounter();};(function(exports){'use strict';function shuffle(array){var currentIndex=array.length,temporaryValue,randomIndex;while(0!==currentIndex){randomIndex=Math.floor(Math.random()*currentIndex);currentIndex-=1;temporaryValue=array[currentIndex];array[currentIndex]=array[randomIndex];array[randomIndex]=temporaryValue;}
return array;}
exports.knuthShuffle=shuffle;}('undefined'!==typeof exports&&exports||'undefined'!==typeof window&&window||global));;(function(factory){"use strict";if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(typeof exports==='object'&&typeof require==='function'){factory(require('jquery'));}else{factory(jQuery);}}(function($){'use strict';var
utils=(function(){return{escapeRegExChars:function(value){return value.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&");},createNode:function(containerClass){var div=document.createElement('div');div.className=containerClass;div.style.position='absolute';div.style.display='none';return div;}};}()),keys={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};function Autocomplete(el,options){var noop=$.noop,that=this,defaults={ajaxSettings:{},autoSelectFirst:false,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:'auto',minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:Autocomplete.formatResult,delimiter:null,zIndex:9999,type:'GET',noCache:false,onSearchStart:noop,onSearchComplete:noop,onSearchError:noop,preserveInput:false,containerClass:'autocomplete-suggestions',tabDisabled:false,dataType:'text',currentRequest:null,triggerSelectOnValidInput:true,preventBadQueries:true,lookupFilter:function(suggestion,originalQuery,queryLowerCase){return suggestion.value.toLowerCase().indexOf(queryLowerCase)!==-1;},paramName:'query',transformResult:function(response){return typeof response==='string'?$.parseJSON(response):response;},showNoSuggestionNotice:false,noSuggestionNotice:'No results',orientation:'bottom',forceFixPosition:false};that.element=el;that.el=$(el);that.suggestions=[];that.badQueries=[];that.selectedIndex=-1;that.currentValue=that.element.value;that.intervalId=0;that.cachedResponse={};that.onChangeInterval=null;that.onChange=null;that.isLocal=false;that.suggestionsContainer=null;that.noSuggestionsContainer=null;that.options=$.extend({},defaults,options);that.classes={selected:'autocomplete-selected',suggestion:'autocomplete-suggestion'};that.hint=null;that.hintValue='';that.selection=null;that.initialize();that.setOptions(options);}
Autocomplete.utils=utils;$.Autocomplete=Autocomplete;Autocomplete.formatResult=function(suggestion,currentValue){if(!currentValue){return suggestion.value;}
var pattern='('+utils.escapeRegExChars(currentValue)+')';return suggestion.value.replace(new RegExp(pattern,'gi'),'<strong>$1<\/strong>').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/&lt;(\/?strong)&gt;/g,'<$1>');};Autocomplete.prototype={killerFn:null,initialize:function(){var that=this,suggestionSelector='.'+that.classes.suggestion,selected=that.classes.selected,options=that.options,container;that.element.setAttribute('autocomplete','off');that.killerFn=function(e){if(!$(e.target).closest('.'+that.options.containerClass).length){that.killSuggestions();that.disableKillerFn();}};that.noSuggestionsContainer=$('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0);that.suggestionsContainer=Autocomplete.utils.createNode(options.containerClass);container=$(that.suggestionsContainer);container.appendTo(options.appendTo);if(options.width!=='auto'){container.css('width',options.width);}
container.on('mouseover.autocomplete',suggestionSelector,function(){that.activate($(this).data('index'));});container.on('mouseout.autocomplete',function(){that.selectedIndex=-1;container.children('.'+selected).removeClass(selected);});container.on('click.autocomplete',suggestionSelector,function(){that.select($(this).data('index'));return false;});that.fixPositionCapture=function(){if(that.visible){that.fixPosition();}};$(window).on('resize.autocomplete',that.fixPositionCapture);that.el.on('keydown.autocomplete',function(e){that.onKeyPress(e);});that.el.on('keyup.autocomplete',function(e){that.onKeyUp(e);});that.el.on('blur.autocomplete',function(){that.onBlur();});that.el.on('focus.autocomplete',function(){that.onFocus();});that.el.on('change.autocomplete',function(e){that.onKeyUp(e);});that.el.on('input.autocomplete',function(e){that.onKeyUp(e);});},onFocus:function(){var that=this;that.fixPosition();if(that.el.val().length>=that.options.minChars){that.onValueChange();}},onBlur:function(){this.enableKillerFn();},abortAjax:function(){var that=this;if(that.currentRequest){that.currentRequest.abort();that.currentRequest=null;}},setOptions:function(suppliedOptions){var that=this,options=that.options;$.extend(options,suppliedOptions);that.isLocal=$.isArray(options.lookup);if(that.isLocal){options.lookup=that.verifySuggestionsFormat(options.lookup);}
options.orientation=that.validateOrientation(options.orientation,'bottom');$(that.suggestionsContainer).css({'max-height':options.maxHeight+'px','width':options.width+'px','z-index':options.zIndex});},clearCache:function(){this.cachedResponse={};this.badQueries=[];},clear:function(){this.clearCache();this.currentValue='';this.suggestions=[];},disable:function(){var that=this;that.disabled=true;clearInterval(that.onChangeInterval);that.abortAjax();},enable:function(){this.disabled=false;},fixPosition:function(){var that=this,$container=$(that.suggestionsContainer),containerParent=$container.parent().get(0);if(containerParent!==document.body&&!that.options.forceFixPosition){return;}
var orientation=that.options.orientation,containerHeight=$container.outerHeight(),height=that.el.outerHeight(),offset=that.el.offset(),styles={'top':offset.top,'left':offset.left};if(orientation==='auto'){var viewPortHeight=$(window).height(),scrollTop=$(window).scrollTop(),topOverflow=-scrollTop+offset.top-containerHeight,bottomOverflow=scrollTop+viewPortHeight-(offset.top+height+containerHeight);orientation=(Math.max(topOverflow,bottomOverflow)===topOverflow)?'top':'bottom';}
if(orientation==='top'){styles.top+=-containerHeight;}else{styles.top+=height;}
if(containerParent!==document.body){var opacity=$container.css('opacity'),parentOffsetDiff;if(!that.visible){$container.css('opacity',0).show();}
parentOffsetDiff=$container.offsetParent().offset();styles.top-=parentOffsetDiff.top;styles.left-=parentOffsetDiff.left;if(!that.visible){$container.css('opacity',opacity).hide();}}
if(that.options.width==='auto'){styles.width=that.el.outerWidth()+'px';}
$container.css(styles);},enableKillerFn:function(){var that=this;$(document).on('click.autocomplete',that.killerFn);},disableKillerFn:function(){var that=this;$(document).off('click.autocomplete',that.killerFn);},killSuggestions:function(){var that=this;that.stopKillSuggestions();that.intervalId=window.setInterval(function(){if(that.visible){if(!that.options.preserveInput){that.el.val(that.currentValue);}
that.hide();}
that.stopKillSuggestions();},50);},stopKillSuggestions:function(){window.clearInterval(this.intervalId);},isCursorAtEnd:function(){var that=this,valLength=that.el.val().length,selectionStart=that.element.selectionStart,range;if(typeof selectionStart==='number'){return selectionStart===valLength;}
if(document.selection){range=document.selection.createRange();range.moveStart('character',-valLength);return valLength===range.text.length;}
return true;},onKeyPress:function(e){var that=this;if(!that.disabled&&!that.visible&&e.which===keys.DOWN&&that.currentValue){that.suggest();return;}
if(that.disabled||!that.visible){return;}
switch(e.which){case keys.ESC:that.el.val(that.currentValue);that.hide();break;case keys.RIGHT:if(that.hint&&that.options.onHint&&that.isCursorAtEnd()){that.selectHint();break;}
return;case keys.TAB:if(that.hint&&that.options.onHint){that.selectHint();return;}
if(that.selectedIndex===-1){that.hide();return;}
that.select(that.selectedIndex);if(that.options.tabDisabled===false){return;}
break;case keys.RETURN:if(that.selectedIndex===-1){that.hide();return;}
that.select(that.selectedIndex);break;case keys.UP:that.moveUp();break;case keys.DOWN:that.moveDown();break;default:return;}
e.stopImmediatePropagation();e.preventDefault();},onKeyUp:function(e){var that=this;if(that.disabled){return;}
switch(e.which){case keys.UP:case keys.DOWN:return;}
clearInterval(that.onChangeInterval);if(that.currentValue!==that.el.val()){that.findBestHint();if(that.options.deferRequestBy>0){that.onChangeInterval=setInterval(function(){that.onValueChange();},that.options.deferRequestBy);}else{that.onValueChange();}}},onValueChange:function(){var that=this,options=that.options,value=that.el.val(),query=that.getQuery(value);if(that.selection&&that.currentValue!==query){that.selection=null;(options.onInvalidateSelection||$.noop).call(that.element);}
clearInterval(that.onChangeInterval);that.currentValue=value;that.selectedIndex=-1;if(options.triggerSelectOnValidInput&&that.isExactMatch(query)){that.select(0);return;}
if(query.length<options.minChars){that.hide();}else{that.getSuggestions(query);}},isExactMatch:function(query){var suggestions=this.suggestions;return(suggestions.length===1&&suggestions[0].value.toLowerCase()===query.toLowerCase());},getQuery:function(value){var delimiter=this.options.delimiter,parts;if(!delimiter){return value;}
parts=value.split(delimiter);return $.trim(parts[parts.length-1]);},getSuggestionsLocal:function(query){var that=this,options=that.options,queryLowerCase=query.toLowerCase(),filter=options.lookupFilter,limit=parseInt(options.lookupLimit,10),data;data={suggestions:$.grep(options.lookup,function(suggestion){return filter(suggestion,query,queryLowerCase);})};if(limit&&data.suggestions.length>limit){data.suggestions=data.suggestions.slice(0,limit);}
return data;},getSuggestions:function(q){var response,that=this,options=that.options,serviceUrl=options.serviceUrl,params,cacheKey,ajaxSettings;options.params[options.paramName]=q;params=options.ignoreParams?null:options.params;if(options.onSearchStart.call(that.element,options.params)===false){return;}
if($.isFunction(options.lookup)){options.lookup(q,function(data){that.suggestions=data.suggestions;that.suggest();options.onSearchComplete.call(that.element,q,data.suggestions);});return;}
if(that.isLocal){response=that.getSuggestionsLocal(q);}else{if($.isFunction(serviceUrl)){serviceUrl=serviceUrl.call(that.element,q);}
cacheKey=serviceUrl+'?'+$.param(params||{});response=that.cachedResponse[cacheKey];}
if(response&&$.isArray(response.suggestions)){that.suggestions=response.suggestions;that.suggest();options.onSearchComplete.call(that.element,q,response.suggestions);}else if(!that.isBadQuery(q)){that.abortAjax();ajaxSettings={url:serviceUrl,data:params,type:options.type,dataType:options.dataType};$.extend(ajaxSettings,options.ajaxSettings);that.currentRequest=$.ajax(ajaxSettings).done(function(data){var result;that.currentRequest=null;result=options.transformResult(data,q);that.processResponse(result,q,cacheKey);options.onSearchComplete.call(that.element,q,result.suggestions);}).fail(function(jqXHR,textStatus,errorThrown){options.onSearchError.call(that.element,q,jqXHR,textStatus,errorThrown);});}else{options.onSearchComplete.call(that.element,q,[]);}},isBadQuery:function(q){if(!this.options.preventBadQueries){return false;}
var badQueries=this.badQueries,i=badQueries.length;while(i--){if(q.indexOf(badQueries[i])===0){return true;}}
return false;},hide:function(){var that=this,container=$(that.suggestionsContainer);if($.isFunction(that.options.onHide)&&that.visible){that.options.onHide.call(that.element,container);}
that.visible=false;that.selectedIndex=-1;clearInterval(that.onChangeInterval);$(that.suggestionsContainer).hide();that.signalHint(null);},suggest:function(){if(!this.suggestions.length){if(this.options.showNoSuggestionNotice){this.noSuggestions();}else{this.hide();}
return;}
var that=this,options=that.options,groupBy=options.groupBy,formatResult=options.formatResult,value=that.getQuery(that.currentValue),className=that.classes.suggestion,classSelected=that.classes.selected,container=$(that.suggestionsContainer),noSuggestionsContainer=$(that.noSuggestionsContainer),beforeRender=options.beforeRender,html='',category,formatGroup=function(suggestion,index){var currentCategory=suggestion.data[groupBy];if(category===currentCategory){return'';}
category=currentCategory;return'<div class="autocomplete-group"><strong>'+category+'</strong></div>';};if(options.triggerSelectOnValidInput&&that.isExactMatch(value)){that.select(0);return;}
$.each(that.suggestions,function(i,suggestion){if(groupBy){html+=formatGroup(suggestion,value,i);}
html+='<div class="'+className+'" data-index="'+i+'">'+formatResult(suggestion,value,i)+'</div>';});this.adjustContainerWidth();noSuggestionsContainer.detach();container.html(html);if($.isFunction(beforeRender)){beforeRender.call(that.element,container,that.suggestions);}
that.fixPosition();container.show();if(options.autoSelectFirst){that.selectedIndex=0;container.scrollTop(0);container.children('.'+className).first().addClass(classSelected);}
that.visible=true;that.findBestHint();},noSuggestions:function(){var that=this,container=$(that.suggestionsContainer),noSuggestionsContainer=$(that.noSuggestionsContainer);this.adjustContainerWidth();noSuggestionsContainer.detach();container.empty();container.append(noSuggestionsContainer);that.fixPosition();container.show();that.visible=true;},adjustContainerWidth:function(){var that=this,options=that.options,width,container=$(that.suggestionsContainer);if(options.width==='auto'){width=that.el.outerWidth();container.css('width',width>0?width:300);}},findBestHint:function(){var that=this,value=that.el.val().toLowerCase(),bestMatch=null;if(!value){return;}
$.each(that.suggestions,function(i,suggestion){var foundMatch=suggestion.value.toLowerCase().indexOf(value)===0;if(foundMatch){bestMatch=suggestion;}
return!foundMatch;});that.signalHint(bestMatch);},signalHint:function(suggestion){var hintValue='',that=this;if(suggestion){hintValue=that.currentValue+suggestion.value.substr(that.currentValue.length);}
if(that.hintValue!==hintValue){that.hintValue=hintValue;that.hint=suggestion;(this.options.onHint||$.noop)(hintValue);}},verifySuggestionsFormat:function(suggestions){if(suggestions.length&&typeof suggestions[0]==='string'){return $.map(suggestions,function(value){return{value:value,data:null};});}
return suggestions;},validateOrientation:function(orientation,fallback){orientation=$.trim(orientation||'').toLowerCase();if($.inArray(orientation,['auto','bottom','top'])===-1){orientation=fallback;}
return orientation;},processResponse:function(result,originalQuery,cacheKey){var that=this,options=that.options;result.suggestions=that.verifySuggestionsFormat(result.suggestions);if(!options.noCache){that.cachedResponse[cacheKey]=result;if(options.preventBadQueries&&!result.suggestions.length){that.badQueries.push(originalQuery);}}
if(originalQuery!==that.getQuery(that.currentValue)){return;}
that.suggestions=result.suggestions;that.suggest();},activate:function(index){var that=this,activeItem,selected=that.classes.selected,container=$(that.suggestionsContainer),children=container.find('.'+that.classes.suggestion);container.find('.'+selected).removeClass(selected);that.selectedIndex=index;if(that.selectedIndex!==-1&&children.length>that.selectedIndex){activeItem=children.get(that.selectedIndex);$(activeItem).addClass(selected);return activeItem;}
return null;},selectHint:function(){var that=this,i=$.inArray(that.hint,that.suggestions);that.select(i);},select:function(i){var that=this;that.hide();that.onSelect(i);},moveUp:function(){var that=this;if(that.selectedIndex===-1){return;}
if(that.selectedIndex===0){$(that.suggestionsContainer).children().first().removeClass(that.classes.selected);that.selectedIndex=-1;that.el.val(that.currentValue);that.findBestHint();return;}
that.adjustScroll(that.selectedIndex-1);},moveDown:function(){var that=this;if(that.selectedIndex===(that.suggestions.length-1)){return;}
that.adjustScroll(that.selectedIndex+1);},adjustScroll:function(index){var that=this,activeItem=that.activate(index);if(!activeItem){return;}
var offsetTop,upperBound,lowerBound,heightDelta=$(activeItem).outerHeight();offsetTop=activeItem.offsetTop;upperBound=$(that.suggestionsContainer).scrollTop();lowerBound=upperBound+that.options.maxHeight-heightDelta;if(offsetTop<upperBound){$(that.suggestionsContainer).scrollTop(offsetTop);}else if(offsetTop>lowerBound){$(that.suggestionsContainer).scrollTop(offsetTop-that.options.maxHeight+heightDelta);}
if(!that.options.preserveInput){that.el.val(that.getValue(that.suggestions[index].value));}
that.signalHint(null);},onSelect:function(index){var that=this,onSelectCallback=that.options.onSelect,suggestion=that.suggestions[index];that.currentValue=that.getValue(suggestion.value);if(that.currentValue!==that.el.val()&&!that.options.preserveInput){that.el.val(that.currentValue);}
that.signalHint(null);that.suggestions=[];that.selection=suggestion;if($.isFunction(onSelectCallback)){onSelectCallback.call(that.element,suggestion);}},getValue:function(value){var that=this,delimiter=that.options.delimiter,currentValue,parts;if(!delimiter){return value;}
currentValue=that.currentValue;parts=currentValue.split(delimiter);if(parts.length===1){return value;}
return currentValue.substr(0,currentValue.length-parts[parts.length-1].length)+value;},dispose:function(){var that=this;that.el.off('.autocomplete').removeData('autocomplete');that.disableKillerFn();$(window).off('resize.autocomplete',that.fixPositionCapture);$(that.suggestionsContainer).remove();}};$.fn.autocomplete=$.fn.devbridgeAutocomplete=function(options,args){var dataKey='autocomplete';if(!arguments.length){return this.first().data(dataKey);}
return this.each(function(){var inputElement=$(this),instance=inputElement.data(dataKey);if(typeof options==='string'){if(instance&&typeof instance[options]==='function'){instance[options](args);}}else{if(instance&&instance.dispose){instance.dispose();}
instance=new Autocomplete(this,options);inputElement.data(dataKey,instance);}});};}));;var DestroyViewMixin={destroy:function(){if(this.custom_unbind){this.custom_unbind();}
this.undelegateEvents();this.unbind();this.stopListening();if(this.custom_destroy){this.custom_destroy();}
if(this.remove_el_on_destory){this.remove();}}};var AutoTooltipMixin={tooltipize:function(selector,show_delay,hide_delay){if(!show_delay){show_delay=200;}
if(!hide_delay){hide_delay=500;}
if(this.$el){this.$el.find(selector).tooltip({"placement":"bottom","delay":{"show":show_delay,"hide":hide_delay}});}}};;var app=app||{};Mustache.tags=['<%=','%>'];if(typeof String.prototype.endsWith!=='function'){String.prototype.endsWith=function(suffix){return this.indexOf(suffix,this.length-suffix.length)!==-1;};};var app=app||{};app.ProductSelector=Backbone.View.extend({el:".app-chooser",template:$("#t-product-chooser")[0].innerHTML,events:{'click .product-switcher':'openProductSwitcher','click .product-pitch':'pitchProductSelected','click .product-core':'coreProductSelected'},productDropdownContainerTemplate:$('#product-dropdown-container')[0].innerHTML,initialize:function(options){_.bindAll(this,'render','openProductSwitcher','pitchProductSelected');this.spinner=$('#dashboard_spinner');this.notificationHandler=new Groups.Notification({el:$('.notification-bar')});this.productDropdownRendered=false;this.listenTo(options.personalizationModel,'fetch_success',function(){var shouldShowSelectorOnboarding=this.options.hasMultipleProducts&&options.personalizationModel.shouldShowMessage('dual-license-dashboard-onboarding');var shouldShowMultiProductOptIn=!app.helpers.isMobile()&&!this.options.hasMultipleProducts&&!this.options.isTeam&&this.options.isProductCore;this.renderProductDropdown(shouldShowSelectorOnboarding,shouldShowMultiProductOptIn);});this.render();},openProductSwitcher:function(){window.glassboxLogger.logOpenProductSwitcher();this.$el.find('.onboarding-tooltip').hide();this.options.personalizationModel.closeMessage('','dual-license-dashboard-onboarding');},showSpinner:function(){app.helpers.showDashboardSpinner();},hideSpinner:function(){app.helpers.hideDashboardSpinner();},coreProductSelected:function(){app.helpers.dashboardStructuredLog("product","switch","button",{"product":"core"});this.logAndOpenDashboard('core');},pitchProductSelected:function(){if(this.options.hasPitchProduct){app.helpers.dashboardStructuredLog("product","switch","button",{"product":"next"});this.logAndOpenDashboard('pitch');}else{this.showSpinner();$.ajax({type:'post',url:'/api/v1/licenseprovisioning/create-user-license/',context:this,success:function(){app.helpers.checkAuthCookieChanges(function(){this.logAndOpenDashboard('pitch');}.bind(this));},error:function(){this.hideSpinner();this.notificationHandler.show('error',gettext('Something went wrong, please try again later.'));}});}},logAndOpenDashboard:function(productType){window.glassboxLogger.logOpenDashboard({product_type:productType==='pitch'?'NEXT':'CLASSIC'}).then(function(){window.location=productType==='pitch'?'/dashboard/next/':'/dashboard';});},render:function(){this.$el.html(Mustache.render(this.template,{isProductPitch:this.options.isProductPitch,isProductCore:this.options.isProductCore,}));return this;},renderProductDropdown:function(shouldShowSelectorOnboarding,shouldShowMultiProductOptIn){if(!this.productDropdownRendered){this.$el.append(Mustache.render(this.productDropdownContainerTemplate,{shouldShowProductSwitcher:this.options.hasMultipleProducts||shouldShowMultiProductOptIn,isProductPitch:this.options.isProductPitch,isProductCore:this.options.isProductCore,shouldShowSelectorOnboarding:shouldShowSelectorOnboarding,shouldShowMultiProductOptIn:shouldShowMultiProductOptIn}));this.productDropdownRendered=true;}
return this;}});;/*!
 * ZeroClipboard
 * The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.
 * Copyright (c) 2009-2014 Jon Rohan, James M. Greene
 * Licensed MIT
 * http://zeroclipboard.org/
 * v2.2.0
 */(function(window,undefined){"use strict";var _window=window,_document=_window.document,_navigator=_window.navigator,_setTimeout=_window.setTimeout,_clearTimeout=_window.clearTimeout,_setInterval=_window.setInterval,_clearInterval=_window.clearInterval,_getComputedStyle=_window.getComputedStyle,_encodeURIComponent=_window.encodeURIComponent,_ActiveXObject=_window.ActiveXObject,_Error=_window.Error,_parseInt=_window.Number.parseInt||_window.parseInt,_parseFloat=_window.Number.parseFloat||_window.parseFloat,_isNaN=_window.Number.isNaN||_window.isNaN,_now=_window.Date.now,_keys=_window.Object.keys,_defineProperty=_window.Object.defineProperty,_hasOwn=_window.Object.prototype.hasOwnProperty,_slice=_window.Array.prototype.slice,_unwrap=function(){var unwrapper=function(el){return el;};if(typeof _window.wrap==="function"&&typeof _window.unwrap==="function"){try{var div=_document.createElement("div");var unwrappedDiv=_window.unwrap(div);if(div.nodeType===1&&unwrappedDiv&&unwrappedDiv.nodeType===1){unwrapper=_window.unwrap;}}catch(e){}}
return unwrapper;}();var _args=function(argumentsObj){return _slice.call(argumentsObj,0);};var _extend=function(){var i,len,arg,prop,src,copy,args=_args(arguments),target=args[0]||{};for(i=1,len=args.length;i<len;i++){if((arg=args[i])!=null){for(prop in arg){if(_hasOwn.call(arg,prop)){src=target[prop];copy=arg[prop];if(target!==copy&&copy!==undefined){target[prop]=copy;}}}}}
return target;};var _deepCopy=function(source){var copy,i,len,prop;if(typeof source!=="object"||source==null||typeof source.nodeType==="number"){copy=source;}else if(typeof source.length==="number"){copy=[];for(i=0,len=source.length;i<len;i++){if(_hasOwn.call(source,i)){copy[i]=_deepCopy(source[i]);}}}else{copy={};for(prop in source){if(_hasOwn.call(source,prop)){copy[prop]=_deepCopy(source[prop]);}}}
return copy;};var _pick=function(obj,keys){var newObj={};for(var i=0,len=keys.length;i<len;i++){if(keys[i]in obj){newObj[keys[i]]=obj[keys[i]];}}
return newObj;};var _omit=function(obj,keys){var newObj={};for(var prop in obj){if(keys.indexOf(prop)===-1){newObj[prop]=obj[prop];}}
return newObj;};var _deleteOwnProperties=function(obj){if(obj){for(var prop in obj){if(_hasOwn.call(obj,prop)){delete obj[prop];}}}
return obj;};var _containedBy=function(el,ancestorEl){if(el&&el.nodeType===1&&el.ownerDocument&&ancestorEl&&(ancestorEl.nodeType===1&&ancestorEl.ownerDocument&&ancestorEl.ownerDocument===el.ownerDocument||ancestorEl.nodeType===9&&!ancestorEl.ownerDocument&&ancestorEl===el.ownerDocument)){do{if(el===ancestorEl){return true;}
el=el.parentNode;}while(el);}
return false;};var _getDirPathOfUrl=function(url){var dir;if(typeof url==="string"&&url){dir=url.split("#")[0].split("?")[0];dir=url.slice(0,url.lastIndexOf("/")+1);}
return dir;};var _getCurrentScriptUrlFromErrorStack=function(stack){var url,matches;if(typeof stack==="string"&&stack){matches=stack.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);if(matches&&matches[1]){url=matches[1];}else{matches=stack.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);if(matches&&matches[1]){url=matches[1];}}}
return url;};var _getCurrentScriptUrlFromError=function(){var url,err;try{throw new _Error();}catch(e){err=e;}
if(err){url=err.sourceURL||err.fileName||_getCurrentScriptUrlFromErrorStack(err.stack);}
return url;};var _getCurrentScriptUrl=function(){var jsPath,scripts,i;if(_document.currentScript&&(jsPath=_document.currentScript.src)){return jsPath;}
scripts=_document.getElementsByTagName("script");if(scripts.length===1){return scripts[0].src||undefined;}
if("readyState"in scripts[0]){for(i=scripts.length;i--;){if(scripts[i].readyState==="interactive"&&(jsPath=scripts[i].src)){return jsPath;}}}
if(_document.readyState==="loading"&&(jsPath=scripts[scripts.length-1].src)){return jsPath;}
if(jsPath=_getCurrentScriptUrlFromError()){return jsPath;}
return undefined;};var _getUnanimousScriptParentDir=function(){var i,jsDir,jsPath,scripts=_document.getElementsByTagName("script");for(i=scripts.length;i--;){if(!(jsPath=scripts[i].src)){jsDir=null;break;}
jsPath=_getDirPathOfUrl(jsPath);if(jsDir==null){jsDir=jsPath;}else if(jsDir!==jsPath){jsDir=null;break;}}
return jsDir||undefined;};var _getDefaultSwfPath=function(){var jsDir=_getDirPathOfUrl(_getCurrentScriptUrl())||_getUnanimousScriptParentDir()||"";return jsDir+"ZeroClipboard.swf";};var _pageIsFramed=function(){return window.opener==null&&(!!window.top&&window!=window.top||!!window.parent&&window!=window.parent);}();var _flashState={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,sandboxed:null,unavailable:null,degraded:null,deactivated:null,overdue:null,ready:null};var _minimumFlashVersion="11.0.0";var _zcSwfVersion;var _handlers={};var _currentElement;var _copyTarget;var _clipData={};var _clipDataFormatMap=null;var _flashCheckTimeout=0;var _swfFallbackCheckInterval=0;var _eventMessages={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed. May also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-sandboxed":"Attempting to run Flash in a sandboxed iframe, which is impossible","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-degraded":"Flash is unable to preserve data fidelity when communicating with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate.\nThis may also mean that the ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity.\nMay also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-overdue":"Flash communication was established but NOT within the acceptable time limit","version-mismatch":"ZeroClipboard JS version number does not match ZeroClipboard SWF version number","clipboard-error":"At least one error was thrown while ZeroClipboard was attempting to inject your data into the clipboard","config-mismatch":"ZeroClipboard configuration does not match Flash's reality","swf-not-found":"The ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity"}};var _errorsThatOnlyOccurAfterFlashLoads=["flash-unavailable","flash-degraded","flash-overdue","version-mismatch","config-mismatch","clipboard-error"];var _flashStateErrorNames=["flash-disabled","flash-outdated","flash-sandboxed","flash-unavailable","flash-degraded","flash-deactivated","flash-overdue"];var _flashStateErrorNameMatchingRegex=new RegExp("^flash-("+_flashStateErrorNames.map(function(errorName){return errorName.replace(/^flash-/,"");}).join("|")+")$");var _flashStateEnabledErrorNameMatchingRegex=new RegExp("^flash-("+_flashStateErrorNames.slice(1).map(function(errorName){return errorName.replace(/^flash-/,"");}).join("|")+")$");var _globalConfig={swfPath:_getDefaultSwfPath(),trustedDomains:window.location.host?[window.location.host]:[],cacheBust:true,forceEnhancedClipboard:false,flashLoadTimeout:3e4,autoActivate:true,bubbleEvents:true,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:false,title:null,zIndex:999999999};var _config=function(options){if(typeof options==="object"&&options!==null){for(var prop in options){if(_hasOwn.call(options,prop)){if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(prop)){_globalConfig[prop]=options[prop];}else if(_flashState.bridge==null){if(prop==="containerId"||prop==="swfObjectId"){if(_isValidHtml4Id(options[prop])){_globalConfig[prop]=options[prop];}else{throw new Error("The specified `"+prop+"` value is not valid as an HTML4 Element ID");}}else{_globalConfig[prop]=options[prop];}}}}}
if(typeof options==="string"&&options){if(_hasOwn.call(_globalConfig,options)){return _globalConfig[options];}
return;}
return _deepCopy(_globalConfig);};var _state=function(){_detectSandbox();return{browser:_pick(_navigator,["userAgent","platform","appName"]),flash:_omit(_flashState,["bridge"]),zeroclipboard:{version:ZeroClipboard.version,config:ZeroClipboard.config()}};};var _isFlashUnusable=function(){return!!(_flashState.disabled||_flashState.outdated||_flashState.sandboxed||_flashState.unavailable||_flashState.degraded||_flashState.deactivated);};var _on=function(eventType,listener){var i,len,events,added={};if(typeof eventType==="string"&&eventType){events=eventType.toLowerCase().split(/\s+/);}else if(typeof eventType==="object"&&eventType&&typeof listener==="undefined"){for(i in eventType){if(_hasOwn.call(eventType,i)&&typeof i==="string"&&i&&typeof eventType[i]==="function"){ZeroClipboard.on(i,eventType[i]);}}}
if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventType=events[i].replace(/^on/,"");added[eventType]=true;if(!_handlers[eventType]){_handlers[eventType]=[];}
_handlers[eventType].push(listener);}
if(added.ready&&_flashState.ready){ZeroClipboard.emit({type:"ready"});}
if(added.error){for(i=0,len=_flashStateErrorNames.length;i<len;i++){if(_flashState[_flashStateErrorNames[i].replace(/^flash-/,"")]===true){ZeroClipboard.emit({type:"error",name:_flashStateErrorNames[i]});break;}}
if(_zcSwfVersion!==undefined&&ZeroClipboard.version!==_zcSwfVersion){ZeroClipboard.emit({type:"error",name:"version-mismatch",jsVersion:ZeroClipboard.version,swfVersion:_zcSwfVersion});}}}
return ZeroClipboard;};var _off=function(eventType,listener){var i,len,foundIndex,events,perEventHandlers;if(arguments.length===0){events=_keys(_handlers);}else if(typeof eventType==="string"&&eventType){events=eventType.split(/\s+/);}else if(typeof eventType==="object"&&eventType&&typeof listener==="undefined"){for(i in eventType){if(_hasOwn.call(eventType,i)&&typeof i==="string"&&i&&typeof eventType[i]==="function"){ZeroClipboard.off(i,eventType[i]);}}}
if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventType=events[i].toLowerCase().replace(/^on/,"");perEventHandlers=_handlers[eventType];if(perEventHandlers&&perEventHandlers.length){if(listener){foundIndex=perEventHandlers.indexOf(listener);while(foundIndex!==-1){perEventHandlers.splice(foundIndex,1);foundIndex=perEventHandlers.indexOf(listener,foundIndex);}}else{perEventHandlers.length=0;}}}}
return ZeroClipboard;};var _listeners=function(eventType){var copy;if(typeof eventType==="string"&&eventType){copy=_deepCopy(_handlers[eventType])||null;}else{copy=_deepCopy(_handlers);}
return copy;};var _emit=function(event){var eventCopy,returnVal,tmp;event=_createEvent(event);if(!event){return;}
if(_preprocessEvent(event)){return;}
if(event.type==="ready"&&_flashState.overdue===true){return ZeroClipboard.emit({type:"error",name:"flash-overdue"});}
eventCopy=_extend({},event);_dispatchCallbacks.call(this,eventCopy);if(event.type==="copy"){tmp=_mapClipDataToFlash(_clipData);returnVal=tmp.data;_clipDataFormatMap=tmp.formatMap;}
return returnVal;};var _create=function(){var previousState=_flashState.sandboxed;_detectSandbox();if(typeof _flashState.ready!=="boolean"){_flashState.ready=false;}
if(_flashState.sandboxed!==previousState&&_flashState.sandboxed===true){_flashState.ready=false;ZeroClipboard.emit({type:"error",name:"flash-sandboxed"});}else if(!ZeroClipboard.isFlashUnusable()&&_flashState.bridge===null){var maxWait=_globalConfig.flashLoadTimeout;if(typeof maxWait==="number"&&maxWait>=0){_flashCheckTimeout=_setTimeout(function(){if(typeof _flashState.deactivated!=="boolean"){_flashState.deactivated=true;}
if(_flashState.deactivated===true){ZeroClipboard.emit({type:"error",name:"flash-deactivated"});}},maxWait);}
_flashState.overdue=false;_embedSwf();}};var _destroy=function(){ZeroClipboard.clearData();ZeroClipboard.blur();ZeroClipboard.emit("destroy");_unembedSwf();ZeroClipboard.off();};var _setData=function(format,data){var dataObj;if(typeof format==="object"&&format&&typeof data==="undefined"){dataObj=format;ZeroClipboard.clearData();}else if(typeof format==="string"&&format){dataObj={};dataObj[format]=data;}else{return;}
for(var dataFormat in dataObj){if(typeof dataFormat==="string"&&dataFormat&&_hasOwn.call(dataObj,dataFormat)&&typeof dataObj[dataFormat]==="string"&&dataObj[dataFormat]){_clipData[dataFormat]=dataObj[dataFormat];}}};var _clearData=function(format){if(typeof format==="undefined"){_deleteOwnProperties(_clipData);_clipDataFormatMap=null;}else if(typeof format==="string"&&_hasOwn.call(_clipData,format)){delete _clipData[format];}};var _getData=function(format){if(typeof format==="undefined"){return _deepCopy(_clipData);}else if(typeof format==="string"&&_hasOwn.call(_clipData,format)){return _clipData[format];}};var _focus=function(element){if(!(element&&element.nodeType===1)){return;}
if(_currentElement){_removeClass(_currentElement,_globalConfig.activeClass);if(_currentElement!==element){_removeClass(_currentElement,_globalConfig.hoverClass);}}
_currentElement=element;_addClass(element,_globalConfig.hoverClass);var newTitle=element.getAttribute("title")||_globalConfig.title;if(typeof newTitle==="string"&&newTitle){var htmlBridge=_getHtmlBridge(_flashState.bridge);if(htmlBridge){htmlBridge.setAttribute("title",newTitle);}}
var useHandCursor=_globalConfig.forceHandCursor===true||_getStyle(element,"cursor")==="pointer";_setHandCursor(useHandCursor);_reposition();};var _blur=function(){var htmlBridge=_getHtmlBridge(_flashState.bridge);if(htmlBridge){htmlBridge.removeAttribute("title");htmlBridge.style.left="0px";htmlBridge.style.top="-9999px";htmlBridge.style.width="1px";htmlBridge.style.height="1px";}
if(_currentElement){_removeClass(_currentElement,_globalConfig.hoverClass);_removeClass(_currentElement,_globalConfig.activeClass);_currentElement=null;}};var _activeElement=function(){return _currentElement||null;};var _isValidHtml4Id=function(id){return typeof id==="string"&&id&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(id);};var _createEvent=function(event){var eventType;if(typeof event==="string"&&event){eventType=event;event={};}else if(typeof event==="object"&&event&&typeof event.type==="string"&&event.type){eventType=event.type;}
if(!eventType){return;}
eventType=eventType.toLowerCase();if(!event.target&&(/^(copy|aftercopy|_click)$/.test(eventType)||eventType==="error"&&event.name==="clipboard-error")){event.target=_copyTarget;}
_extend(event,{type:eventType,target:event.target||_currentElement||null,relatedTarget:event.relatedTarget||null,currentTarget:_flashState&&_flashState.bridge||null,timeStamp:event.timeStamp||_now()||null});var msg=_eventMessages[event.type];if(event.type==="error"&&event.name&&msg){msg=msg[event.name];}
if(msg){event.message=msg;}
if(event.type==="ready"){_extend(event,{target:null,version:_flashState.version});}
if(event.type==="error"){if(_flashStateErrorNameMatchingRegex.test(event.name)){_extend(event,{target:null,minimumVersion:_minimumFlashVersion});}
if(_flashStateEnabledErrorNameMatchingRegex.test(event.name)){_extend(event,{version:_flashState.version});}}
if(event.type==="copy"){event.clipboardData={setData:ZeroClipboard.setData,clearData:ZeroClipboard.clearData};}
if(event.type==="aftercopy"){event=_mapClipResultsFromFlash(event,_clipDataFormatMap);}
if(event.target&&!event.relatedTarget){event.relatedTarget=_getRelatedTarget(event.target);}
return _addMouseData(event);};var _getRelatedTarget=function(targetEl){var relatedTargetId=targetEl&&targetEl.getAttribute&&targetEl.getAttribute("data-clipboard-target");return relatedTargetId?_document.getElementById(relatedTargetId):null;};var _addMouseData=function(event){if(event&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(event.type)){var srcElement=event.target;var fromElement=event.type==="_mouseover"&&event.relatedTarget?event.relatedTarget:undefined;var toElement=event.type==="_mouseout"&&event.relatedTarget?event.relatedTarget:undefined;var pos=_getElementPosition(srcElement);var screenLeft=_window.screenLeft||_window.screenX||0;var screenTop=_window.screenTop||_window.screenY||0;var scrollLeft=_document.body.scrollLeft+_document.documentElement.scrollLeft;var scrollTop=_document.body.scrollTop+_document.documentElement.scrollTop;var pageX=pos.left+(typeof event._stageX==="number"?event._stageX:0);var pageY=pos.top+(typeof event._stageY==="number"?event._stageY:0);var clientX=pageX-scrollLeft;var clientY=pageY-scrollTop;var screenX=screenLeft+clientX;var screenY=screenTop+clientY;var moveX=typeof event.movementX==="number"?event.movementX:0;var moveY=typeof event.movementY==="number"?event.movementY:0;delete event._stageX;delete event._stageY;_extend(event,{srcElement:srcElement,fromElement:fromElement,toElement:toElement,screenX:screenX,screenY:screenY,pageX:pageX,pageY:pageY,clientX:clientX,clientY:clientY,x:clientX,y:clientY,movementX:moveX,movementY:moveY,offsetX:0,offsetY:0,layerX:0,layerY:0});}
return event;};var _shouldPerformAsync=function(event){var eventType=event&&typeof event.type==="string"&&event.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(eventType);};var _dispatchCallback=function(func,context,args,async){if(async){_setTimeout(function(){func.apply(context,args);},0);}else{func.apply(context,args);}};var _dispatchCallbacks=function(event){if(!(typeof event==="object"&&event&&event.type)){return;}
var async=_shouldPerformAsync(event);var wildcardTypeHandlers=_handlers["*"]||[];var specificTypeHandlers=_handlers[event.type]||[];var handlers=wildcardTypeHandlers.concat(specificTypeHandlers);if(handlers&&handlers.length){var i,len,func,context,eventCopy,originalContext=this;for(i=0,len=handlers.length;i<len;i++){func=handlers[i];context=originalContext;if(typeof func==="string"&&typeof _window[func]==="function"){func=_window[func];}
if(typeof func==="object"&&func&&typeof func.handleEvent==="function"){context=func;func=func.handleEvent;}
if(typeof func==="function"){eventCopy=_extend({},event);_dispatchCallback(func,context,[eventCopy],async);}}}
return this;};var _getSandboxStatusFromErrorEvent=function(event){var isSandboxed=null;if(_pageIsFramed===false||event&&event.type==="error"&&event.name&&_errorsThatOnlyOccurAfterFlashLoads.indexOf(event.name)!==-1){isSandboxed=false;}
return isSandboxed;};var _preprocessEvent=function(event){var element=event.target||_currentElement||null;var sourceIsSwf=event._source==="swf";delete event._source;switch(event.type){case"error":var isSandboxed=event.name==="flash-sandboxed"||_getSandboxStatusFromErrorEvent(event);if(typeof isSandboxed==="boolean"){_flashState.sandboxed=isSandboxed;}
if(_flashStateErrorNames.indexOf(event.name)!==-1){_extend(_flashState,{disabled:event.name==="flash-disabled",outdated:event.name==="flash-outdated",unavailable:event.name==="flash-unavailable",degraded:event.name==="flash-degraded",deactivated:event.name==="flash-deactivated",overdue:event.name==="flash-overdue",ready:false});}else if(event.name==="version-mismatch"){_zcSwfVersion=event.swfVersion;_extend(_flashState,{disabled:false,outdated:false,unavailable:false,degraded:false,deactivated:false,overdue:false,ready:false});}
_clearTimeoutsAndPolling();break;case"ready":_zcSwfVersion=event.swfVersion;var wasDeactivated=_flashState.deactivated===true;_extend(_flashState,{disabled:false,outdated:false,sandboxed:false,unavailable:false,degraded:false,deactivated:false,overdue:wasDeactivated,ready:!wasDeactivated});_clearTimeoutsAndPolling();break;case"beforecopy":_copyTarget=element;break;case"copy":var textContent,htmlContent,targetEl=event.relatedTarget;if(!(_clipData["text/html"]||_clipData["text/plain"])&&targetEl&&(htmlContent=targetEl.value||targetEl.outerHTML||targetEl.innerHTML)&&(textContent=targetEl.value||targetEl.textContent||targetEl.innerText)){event.clipboardData.clearData();event.clipboardData.setData("text/plain",textContent);if(htmlContent!==textContent){event.clipboardData.setData("text/html",htmlContent);}}else if(!_clipData["text/plain"]&&event.target&&(textContent=event.target.getAttribute("data-clipboard-text"))){event.clipboardData.clearData();event.clipboardData.setData("text/plain",textContent);}
break;case"aftercopy":_queueEmitClipboardErrors(event);ZeroClipboard.clearData();if(element&&element!==_safeActiveElement()&&element.focus){element.focus();}
break;case"_mouseover":ZeroClipboard.focus(element);if(_globalConfig.bubbleEvents===true&&sourceIsSwf){if(element&&element!==event.relatedTarget&&!_containedBy(event.relatedTarget,element)){_fireMouseEvent(_extend({},event,{type:"mouseenter",bubbles:false,cancelable:false}));}
_fireMouseEvent(_extend({},event,{type:"mouseover"}));}
break;case"_mouseout":ZeroClipboard.blur();if(_globalConfig.bubbleEvents===true&&sourceIsSwf){if(element&&element!==event.relatedTarget&&!_containedBy(event.relatedTarget,element)){_fireMouseEvent(_extend({},event,{type:"mouseleave",bubbles:false,cancelable:false}));}
_fireMouseEvent(_extend({},event,{type:"mouseout"}));}
break;case"_mousedown":_addClass(element,_globalConfig.activeClass);if(_globalConfig.bubbleEvents===true&&sourceIsSwf){_fireMouseEvent(_extend({},event,{type:event.type.slice(1)}));}
break;case"_mouseup":_removeClass(element,_globalConfig.activeClass);if(_globalConfig.bubbleEvents===true&&sourceIsSwf){_fireMouseEvent(_extend({},event,{type:event.type.slice(1)}));}
break;case"_click":_copyTarget=null;if(_globalConfig.bubbleEvents===true&&sourceIsSwf){_fireMouseEvent(_extend({},event,{type:event.type.slice(1)}));}
break;case"_mousemove":if(_globalConfig.bubbleEvents===true&&sourceIsSwf){_fireMouseEvent(_extend({},event,{type:event.type.slice(1)}));}
break;}
if(/^_(?:click|mouse(?:over|out|down|up|move))$/.test(event.type)){return true;}};var _queueEmitClipboardErrors=function(aftercopyEvent){if(aftercopyEvent.errors&&aftercopyEvent.errors.length>0){var errorEvent=_deepCopy(aftercopyEvent);_extend(errorEvent,{type:"error",name:"clipboard-error"});delete errorEvent.success;_setTimeout(function(){ZeroClipboard.emit(errorEvent);},0);}};var _fireMouseEvent=function(event){if(!(event&&typeof event.type==="string"&&event)){return;}
var e,target=event.target||null,doc=target&&target.ownerDocument||_document,defaults={view:doc.defaultView||_window,canBubble:true,cancelable:true,detail:event.type==="click"?1:0,button:typeof event.which==="number"?event.which-1:typeof event.button==="number"?event.button:doc.createEvent?0:1},args=_extend(defaults,event);if(!target){return;}
if(doc.createEvent&&target.dispatchEvent){args=[args.type,args.canBubble,args.cancelable,args.view,args.detail,args.screenX,args.screenY,args.clientX,args.clientY,args.ctrlKey,args.altKey,args.shiftKey,args.metaKey,args.button,args.relatedTarget];e=doc.createEvent("MouseEvents");if(e.initMouseEvent){e.initMouseEvent.apply(e,args);e._source="js";target.dispatchEvent(e);}}};var _watchForSwfFallbackContent=function(){var maxWait=_globalConfig.flashLoadTimeout;if(typeof maxWait==="number"&&maxWait>=0){var pollWait=Math.min(1e3,maxWait/10);var fallbackContentId=_globalConfig.swfObjectId+"_fallbackContent";_swfFallbackCheckInterval=_setInterval(function(){var el=_document.getElementById(fallbackContentId);if(_isElementVisible(el)){_clearTimeoutsAndPolling();_flashState.deactivated=null;ZeroClipboard.emit({type:"error",name:"swf-not-found"});}},pollWait);}};var _createHtmlBridge=function(){var container=_document.createElement("div");container.id=_globalConfig.containerId;container.className=_globalConfig.containerClass;container.style.position="absolute";container.style.left="0px";container.style.top="-9999px";container.style.width="1px";container.style.height="1px";container.style.zIndex=""+_getSafeZIndex(_globalConfig.zIndex);return container;};var _getHtmlBridge=function(flashBridge){var htmlBridge=flashBridge&&flashBridge.parentNode;while(htmlBridge&&htmlBridge.nodeName==="OBJECT"&&htmlBridge.parentNode){htmlBridge=htmlBridge.parentNode;}
return htmlBridge||null;};var _embedSwf=function(){var len,flashBridge=_flashState.bridge,container=_getHtmlBridge(flashBridge);if(!flashBridge){var allowScriptAccess=_determineScriptAccess(_window.location.host,_globalConfig);var allowNetworking=allowScriptAccess==="never"?"none":"all";var flashvars=_vars(_extend({jsVersion:ZeroClipboard.version},_globalConfig));var swfUrl=_globalConfig.swfPath+_cacheBust(_globalConfig.swfPath,_globalConfig);container=_createHtmlBridge();var divToBeReplaced=_document.createElement("div");container.appendChild(divToBeReplaced);_document.body.appendChild(container);var tmpDiv=_document.createElement("div");var usingActiveX=_flashState.pluginType==="activex";tmpDiv.innerHTML='<object id="'+_globalConfig.swfObjectId+'" name="'+_globalConfig.swfObjectId+'" '+'width="100%" height="100%" '+(usingActiveX?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+swfUrl+'"')+">"+(usingActiveX?'<param name="movie" value="'+swfUrl+'"/>':"")+'<param name="allowScriptAccess" value="'+allowScriptAccess+'"/>'+'<param name="allowNetworking" value="'+allowNetworking+'"/>'+'<param name="menu" value="false"/>'+'<param name="wmode" value="transparent"/>'+'<param name="flashvars" value="'+flashvars+'"/>'+'<div id="'+_globalConfig.swfObjectId+'_fallbackContent">&nbsp;</div>'+"</object>";flashBridge=tmpDiv.firstChild;tmpDiv=null;_unwrap(flashBridge).ZeroClipboard=ZeroClipboard;container.replaceChild(flashBridge,divToBeReplaced);_watchForSwfFallbackContent();}
if(!flashBridge){flashBridge=_document[_globalConfig.swfObjectId];if(flashBridge&&(len=flashBridge.length)){flashBridge=flashBridge[len-1];}
if(!flashBridge&&container){flashBridge=container.firstChild;}}
_flashState.bridge=flashBridge||null;return flashBridge;};var _unembedSwf=function(){var flashBridge=_flashState.bridge;if(flashBridge){var htmlBridge=_getHtmlBridge(flashBridge);if(htmlBridge){if(_flashState.pluginType==="activex"&&"readyState"in flashBridge){flashBridge.style.display="none";(function removeSwfFromIE(){if(flashBridge.readyState===4){for(var prop in flashBridge){if(typeof flashBridge[prop]==="function"){flashBridge[prop]=null;}}
if(flashBridge.parentNode){flashBridge.parentNode.removeChild(flashBridge);}
if(htmlBridge.parentNode){htmlBridge.parentNode.removeChild(htmlBridge);}}else{_setTimeout(removeSwfFromIE,10);}})();}else{if(flashBridge.parentNode){flashBridge.parentNode.removeChild(flashBridge);}
if(htmlBridge.parentNode){htmlBridge.parentNode.removeChild(htmlBridge);}}}
_clearTimeoutsAndPolling();_flashState.ready=null;_flashState.bridge=null;_flashState.deactivated=null;_zcSwfVersion=undefined;}};var _mapClipDataToFlash=function(clipData){var newClipData={},formatMap={};if(!(typeof clipData==="object"&&clipData)){return;}
for(var dataFormat in clipData){if(dataFormat&&_hasOwn.call(clipData,dataFormat)&&typeof clipData[dataFormat]==="string"&&clipData[dataFormat]){switch(dataFormat.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":newClipData.text=clipData[dataFormat];formatMap.text=dataFormat;break;case"text/html":case"html":case"air:html":case"flash:html":newClipData.html=clipData[dataFormat];formatMap.html=dataFormat;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":newClipData.rtf=clipData[dataFormat];formatMap.rtf=dataFormat;break;default:break;}}}
return{data:newClipData,formatMap:formatMap};};var _mapClipResultsFromFlash=function(clipResults,formatMap){if(!(typeof clipResults==="object"&&clipResults&&typeof formatMap==="object"&&formatMap)){return clipResults;}
var newResults={};for(var prop in clipResults){if(_hasOwn.call(clipResults,prop)){if(prop==="errors"){newResults[prop]=clipResults[prop]?clipResults[prop].slice():[];for(var i=0,len=newResults[prop].length;i<len;i++){newResults[prop][i].format=formatMap[newResults[prop][i].format];}}else if(prop!=="success"&&prop!=="data"){newResults[prop]=clipResults[prop];}else{newResults[prop]={};var tmpHash=clipResults[prop];for(var dataFormat in tmpHash){if(dataFormat&&_hasOwn.call(tmpHash,dataFormat)&&_hasOwn.call(formatMap,dataFormat)){newResults[prop][formatMap[dataFormat]]=tmpHash[dataFormat];}}}}}
return newResults;};var _cacheBust=function(path,options){var cacheBust=options==null||options&&options.cacheBust===true;if(cacheBust){return(path.indexOf("?")===-1?"?":"&")+"noCache="+_now();}else{return"";}};var _vars=function(options){var i,len,domain,domains,str="",trustedOriginsExpanded=[];if(options.trustedDomains){if(typeof options.trustedDomains==="string"){domains=[options.trustedDomains];}else if(typeof options.trustedDomains==="object"&&"length"in options.trustedDomains){domains=options.trustedDomains;}}
if(domains&&domains.length){for(i=0,len=domains.length;i<len;i++){if(_hasOwn.call(domains,i)&&domains[i]&&typeof domains[i]==="string"){domain=_extractDomain(domains[i]);if(!domain){continue;}
if(domain==="*"){trustedOriginsExpanded.length=0;trustedOriginsExpanded.push(domain);break;}
trustedOriginsExpanded.push.apply(trustedOriginsExpanded,[domain,"//"+domain,_window.location.protocol+"//"+domain]);}}}
if(trustedOriginsExpanded.length){str+="trustedOrigins="+_encodeURIComponent(trustedOriginsExpanded.join(","));}
if(options.forceEnhancedClipboard===true){str+=(str?"&":"")+"forceEnhancedClipboard=true";}
if(typeof options.swfObjectId==="string"&&options.swfObjectId){str+=(str?"&":"")+"swfObjectId="+_encodeURIComponent(options.swfObjectId);}
if(typeof options.jsVersion==="string"&&options.jsVersion){str+=(str?"&":"")+"jsVersion="+_encodeURIComponent(options.jsVersion);}
return str;};var _extractDomain=function(originOrUrl){if(originOrUrl==null||originOrUrl===""){return null;}
originOrUrl=originOrUrl.replace(/^\s+|\s+$/g,"");if(originOrUrl===""){return null;}
var protocolIndex=originOrUrl.indexOf("//");originOrUrl=protocolIndex===-1?originOrUrl:originOrUrl.slice(protocolIndex+2);var pathIndex=originOrUrl.indexOf("/");originOrUrl=pathIndex===-1?originOrUrl:protocolIndex===-1||pathIndex===0?null:originOrUrl.slice(0,pathIndex);if(originOrUrl&&originOrUrl.slice(-4).toLowerCase()===".swf"){return null;}
return originOrUrl||null;};var _determineScriptAccess=function(){var _extractAllDomains=function(origins){var i,len,tmp,resultsArray=[];if(typeof origins==="string"){origins=[origins];}
if(!(typeof origins==="object"&&origins&&typeof origins.length==="number")){return resultsArray;}
for(i=0,len=origins.length;i<len;i++){if(_hasOwn.call(origins,i)&&(tmp=_extractDomain(origins[i]))){if(tmp==="*"){resultsArray.length=0;resultsArray.push("*");break;}
if(resultsArray.indexOf(tmp)===-1){resultsArray.push(tmp);}}}
return resultsArray;};return function(currentDomain,configOptions){var swfDomain=_extractDomain(configOptions.swfPath);if(swfDomain===null){swfDomain=currentDomain;}
var trustedDomains=_extractAllDomains(configOptions.trustedDomains);var len=trustedDomains.length;if(len>0){if(len===1&&trustedDomains[0]==="*"){return"always";}
if(trustedDomains.indexOf(currentDomain)!==-1){if(len===1&&currentDomain===swfDomain){return"sameDomain";}
return"always";}}
return"never";};}();var _safeActiveElement=function(){try{return _document.activeElement;}catch(err){return null;}};var _addClass=function(element,value){var c,cl,className,classNames=[];if(typeof value==="string"&&value){classNames=value.split(/\s+/);}
if(element&&element.nodeType===1&&classNames.length>0){if(element.classList){for(c=0,cl=classNames.length;c<cl;c++){element.classList.add(classNames[c]);}}else if(element.hasOwnProperty("className")){className=" "+element.className+" ";for(c=0,cl=classNames.length;c<cl;c++){if(className.indexOf(" "+classNames[c]+" ")===-1){className+=classNames[c]+" ";}}
element.className=className.replace(/^\s+|\s+$/g,"");}}
return element;};var _removeClass=function(element,value){var c,cl,className,classNames=[];if(typeof value==="string"&&value){classNames=value.split(/\s+/);}
if(element&&element.nodeType===1&&classNames.length>0){if(element.classList&&element.classList.length>0){for(c=0,cl=classNames.length;c<cl;c++){element.classList.remove(classNames[c]);}}else if(element.className){className=(" "+element.className+" ").replace(/[\r\n\t]/g," ");for(c=0,cl=classNames.length;c<cl;c++){className=className.replace(" "+classNames[c]+" "," ");}
element.className=className.replace(/^\s+|\s+$/g,"");}}
return element;};var _getStyle=function(el,prop){var value=_getComputedStyle(el,null).getPropertyValue(prop);if(prop==="cursor"){if(!value||value==="auto"){if(el.nodeName==="A"){return"pointer";}}}
return value;};var _getElementPosition=function(el){var pos={left:0,top:0,width:0,height:0};if(el.getBoundingClientRect){var elRect=el.getBoundingClientRect();var pageXOffset=_window.pageXOffset;var pageYOffset=_window.pageYOffset;var leftBorderWidth=_document.documentElement.clientLeft||0;var topBorderWidth=_document.documentElement.clientTop||0;var leftBodyOffset=0;var topBodyOffset=0;if(_getStyle(_document.body,"position")==="relative"){var bodyRect=_document.body.getBoundingClientRect();var htmlRect=_document.documentElement.getBoundingClientRect();leftBodyOffset=bodyRect.left-htmlRect.left||0;topBodyOffset=bodyRect.top-htmlRect.top||0;}
pos.left=elRect.left+pageXOffset-leftBorderWidth-leftBodyOffset;pos.top=elRect.top+pageYOffset-topBorderWidth-topBodyOffset;pos.width="width"in elRect?elRect.width:elRect.right-elRect.left;pos.height="height"in elRect?elRect.height:elRect.bottom-elRect.top;}
return pos;};var _isElementVisible=function(el){if(!el){return false;}
var styles=_getComputedStyle(el,null);var hasCssHeight=_parseFloat(styles.height)>0;var hasCssWidth=_parseFloat(styles.width)>0;var hasCssTop=_parseFloat(styles.top)>=0;var hasCssLeft=_parseFloat(styles.left)>=0;var cssKnows=hasCssHeight&&hasCssWidth&&hasCssTop&&hasCssLeft;var rect=cssKnows?null:_getElementPosition(el);var isVisible=styles.display!=="none"&&styles.visibility!=="collapse"&&(cssKnows||!!rect&&(hasCssHeight||rect.height>0)&&(hasCssWidth||rect.width>0)&&(hasCssTop||rect.top>=0)&&(hasCssLeft||rect.left>=0));return isVisible;};var _clearTimeoutsAndPolling=function(){_clearTimeout(_flashCheckTimeout);_flashCheckTimeout=0;_clearInterval(_swfFallbackCheckInterval);_swfFallbackCheckInterval=0;};var _reposition=function(){var htmlBridge;if(_currentElement&&(htmlBridge=_getHtmlBridge(_flashState.bridge))){var pos=_getElementPosition(_currentElement);_extend(htmlBridge.style,{width:pos.width+"px",height:pos.height+"px",top:pos.top+"px",left:pos.left+"px",zIndex:""+_getSafeZIndex(_globalConfig.zIndex)});}};var _setHandCursor=function(enabled){if(_flashState.ready===true){if(_flashState.bridge&&typeof _flashState.bridge.setHandCursor==="function"){_flashState.bridge.setHandCursor(enabled);}else{_flashState.ready=false;}}};var _getSafeZIndex=function(val){if(/^(?:auto|inherit)$/.test(val)){return val;}
var zIndex;if(typeof val==="number"&&!_isNaN(val)){zIndex=val;}else if(typeof val==="string"){zIndex=_getSafeZIndex(_parseInt(val,10));}
return typeof zIndex==="number"?zIndex:"auto";};var _detectSandbox=function(doNotReassessFlashSupport){var effectiveScriptOrigin,frame,frameError,previousState=_flashState.sandboxed,isSandboxed=null;doNotReassessFlashSupport=doNotReassessFlashSupport===true;if(_pageIsFramed===false){isSandboxed=false;}else{try{frame=window.frameElement||null;}catch(e){frameError={name:e.name,message:e.message};}
if(frame&&frame.nodeType===1&&frame.nodeName==="IFRAME"){try{isSandboxed=frame.hasAttribute("sandbox");}catch(e){isSandboxed=null;}}else{try{effectiveScriptOrigin=document.domain||null;}catch(e){effectiveScriptOrigin=null;}
if(effectiveScriptOrigin===null||frameError&&frameError.name==="SecurityError"&&/(^|[\s\(\[@])sandbox(es|ed|ing|[\s\.,!\)\]@]|$)/.test(frameError.message.toLowerCase())){isSandboxed=true;}}}
_flashState.sandboxed=isSandboxed;if(previousState!==isSandboxed&&!doNotReassessFlashSupport){_detectFlashSupport(_ActiveXObject);}
return isSandboxed;};var _detectFlashSupport=function(ActiveXObject){var plugin,ax,mimeType,hasFlash=false,isActiveX=false,isPPAPI=false,flashVersion="";function parseFlashVersion(desc){var matches=desc.match(/[\d]+/g);matches.length=3;return matches.join(".");}
function isPepperFlash(flashPlayerFileName){return!!flashPlayerFileName&&(flashPlayerFileName=flashPlayerFileName.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(flashPlayerFileName)||flashPlayerFileName.slice(-13)==="chrome.plugin");}
function inspectPlugin(plugin){if(plugin){hasFlash=true;if(plugin.version){flashVersion=parseFlashVersion(plugin.version);}
if(!flashVersion&&plugin.description){flashVersion=parseFlashVersion(plugin.description);}
if(plugin.filename){isPPAPI=isPepperFlash(plugin.filename);}}}
if(_navigator.plugins&&_navigator.plugins.length){plugin=_navigator.plugins["Shockwave Flash"];inspectPlugin(plugin);if(_navigator.plugins["Shockwave Flash 2.0"]){hasFlash=true;flashVersion="2.0.0.11";}}else if(_navigator.mimeTypes&&_navigator.mimeTypes.length){mimeType=_navigator.mimeTypes["application/x-shockwave-flash"];plugin=mimeType&&mimeType.enabledPlugin;inspectPlugin(plugin);}else if(typeof ActiveXObject!=="undefined"){isActiveX=true;try{ax=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");hasFlash=true;flashVersion=parseFlashVersion(ax.GetVariable("$version"));}catch(e1){try{ax=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");hasFlash=true;flashVersion="6.0.21";}catch(e2){try{ax=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");hasFlash=true;flashVersion=parseFlashVersion(ax.GetVariable("$version"));}catch(e3){isActiveX=false;}}}}
_flashState.disabled=hasFlash!==true;_flashState.outdated=flashVersion&&_parseFloat(flashVersion)<_parseFloat(_minimumFlashVersion);_flashState.version=flashVersion||"0.0.0";_flashState.pluginType=isPPAPI?"pepper":isActiveX?"activex":hasFlash?"netscape":"unknown";};_detectFlashSupport(_ActiveXObject);_detectSandbox(true);var ZeroClipboard=function(){if(!(this instanceof ZeroClipboard)){return new ZeroClipboard();}
if(typeof ZeroClipboard._createClient==="function"){ZeroClipboard._createClient.apply(this,_args(arguments));}};_defineProperty(ZeroClipboard,"version",{value:"2.2.0",writable:false,configurable:true,enumerable:true});ZeroClipboard.config=function(){return _config.apply(this,_args(arguments));};ZeroClipboard.state=function(){return _state.apply(this,_args(arguments));};ZeroClipboard.isFlashUnusable=function(){return _isFlashUnusable.apply(this,_args(arguments));};ZeroClipboard.on=function(){return _on.apply(this,_args(arguments));};ZeroClipboard.off=function(){return _off.apply(this,_args(arguments));};ZeroClipboard.handlers=function(){return _listeners.apply(this,_args(arguments));};ZeroClipboard.emit=function(){return _emit.apply(this,_args(arguments));};ZeroClipboard.create=function(){return _create.apply(this,_args(arguments));};ZeroClipboard.destroy=function(){return _destroy.apply(this,_args(arguments));};ZeroClipboard.setData=function(){return _setData.apply(this,_args(arguments));};ZeroClipboard.clearData=function(){return _clearData.apply(this,_args(arguments));};ZeroClipboard.getData=function(){return _getData.apply(this,_args(arguments));};ZeroClipboard.focus=ZeroClipboard.activate=function(){return _focus.apply(this,_args(arguments));};ZeroClipboard.blur=ZeroClipboard.deactivate=function(){return _blur.apply(this,_args(arguments));};ZeroClipboard.activeElement=function(){return _activeElement.apply(this,_args(arguments));};var _clientIdCounter=0;var _clientMeta={};var _elementIdCounter=0;var _elementMeta={};var _mouseHandlers={};_extend(_globalConfig,{autoActivate:true});var _clientConstructor=function(elements){var client=this;client.id=""+_clientIdCounter++;_clientMeta[client.id]={instance:client,elements:[],handlers:{}};if(elements){client.clip(elements);}
ZeroClipboard.on("*",function(event){return client.emit(event);});ZeroClipboard.on("destroy",function(){client.destroy();});ZeroClipboard.create();};var _clientOn=function(eventType,listener){var i,len,events,added={},meta=_clientMeta[this.id],handlers=meta&&meta.handlers;if(!meta){throw new Error("Attempted to add new listener(s) to a destroyed ZeroClipboard client instance");}
if(typeof eventType==="string"&&eventType){events=eventType.toLowerCase().split(/\s+/);}else if(typeof eventType==="object"&&eventType&&typeof listener==="undefined"){for(i in eventType){if(_hasOwn.call(eventType,i)&&typeof i==="string"&&i&&typeof eventType[i]==="function"){this.on(i,eventType[i]);}}}
if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventType=events[i].replace(/^on/,"");added[eventType]=true;if(!handlers[eventType]){handlers[eventType]=[];}
handlers[eventType].push(listener);}
if(added.ready&&_flashState.ready){this.emit({type:"ready",client:this});}
if(added.error){for(i=0,len=_flashStateErrorNames.length;i<len;i++){if(_flashState[_flashStateErrorNames[i].replace(/^flash-/,"")]){this.emit({type:"error",name:_flashStateErrorNames[i],client:this});break;}}
if(_zcSwfVersion!==undefined&&ZeroClipboard.version!==_zcSwfVersion){this.emit({type:"error",name:"version-mismatch",jsVersion:ZeroClipboard.version,swfVersion:_zcSwfVersion});}}}
return this;};var _clientOff=function(eventType,listener){var i,len,foundIndex,events,perEventHandlers,meta=_clientMeta[this.id],handlers=meta&&meta.handlers;if(!handlers){return this;}
if(arguments.length===0){events=_keys(handlers);}else if(typeof eventType==="string"&&eventType){events=eventType.split(/\s+/);}else if(typeof eventType==="object"&&eventType&&typeof listener==="undefined"){for(i in eventType){if(_hasOwn.call(eventType,i)&&typeof i==="string"&&i&&typeof eventType[i]==="function"){this.off(i,eventType[i]);}}}
if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventType=events[i].toLowerCase().replace(/^on/,"");perEventHandlers=handlers[eventType];if(perEventHandlers&&perEventHandlers.length){if(listener){foundIndex=perEventHandlers.indexOf(listener);while(foundIndex!==-1){perEventHandlers.splice(foundIndex,1);foundIndex=perEventHandlers.indexOf(listener,foundIndex);}}else{perEventHandlers.length=0;}}}}
return this;};var _clientListeners=function(eventType){var copy=null,handlers=_clientMeta[this.id]&&_clientMeta[this.id].handlers;if(handlers){if(typeof eventType==="string"&&eventType){copy=handlers[eventType]?handlers[eventType].slice(0):[];}else{copy=_deepCopy(handlers);}}
return copy;};var _clientEmit=function(event){if(_clientShouldEmit.call(this,event)){if(typeof event==="object"&&event&&typeof event.type==="string"&&event.type){event=_extend({},event);}
var eventCopy=_extend({},_createEvent(event),{client:this});_clientDispatchCallbacks.call(this,eventCopy);}
return this;};var _clientClip=function(elements){if(!_clientMeta[this.id]){throw new Error("Attempted to clip element(s) to a destroyed ZeroClipboard client instance");}
elements=_prepClip(elements);for(var i=0;i<elements.length;i++){if(_hasOwn.call(elements,i)&&elements[i]&&elements[i].nodeType===1){if(!elements[i].zcClippingId){elements[i].zcClippingId="zcClippingId_"+_elementIdCounter++;_elementMeta[elements[i].zcClippingId]=[this.id];if(_globalConfig.autoActivate===true){_addMouseHandlers(elements[i]);}}else if(_elementMeta[elements[i].zcClippingId].indexOf(this.id)===-1){_elementMeta[elements[i].zcClippingId].push(this.id);}
var clippedElements=_clientMeta[this.id]&&_clientMeta[this.id].elements;if(clippedElements.indexOf(elements[i])===-1){clippedElements.push(elements[i]);}}}
return this;};var _clientUnclip=function(elements){var meta=_clientMeta[this.id];if(!meta){return this;}
var clippedElements=meta.elements;var arrayIndex;if(typeof elements==="undefined"){elements=clippedElements.slice(0);}else{elements=_prepClip(elements);}
for(var i=elements.length;i--;){if(_hasOwn.call(elements,i)&&elements[i]&&elements[i].nodeType===1){arrayIndex=0;while((arrayIndex=clippedElements.indexOf(elements[i],arrayIndex))!==-1){clippedElements.splice(arrayIndex,1);}
var clientIds=_elementMeta[elements[i].zcClippingId];if(clientIds){arrayIndex=0;while((arrayIndex=clientIds.indexOf(this.id,arrayIndex))!==-1){clientIds.splice(arrayIndex,1);}
if(clientIds.length===0){if(_globalConfig.autoActivate===true){_removeMouseHandlers(elements[i]);}
delete elements[i].zcClippingId;}}}}
return this;};var _clientElements=function(){var meta=_clientMeta[this.id];return meta&&meta.elements?meta.elements.slice(0):[];};var _clientDestroy=function(){if(!_clientMeta[this.id]){return;}
this.unclip();this.off();delete _clientMeta[this.id];};var _clientShouldEmit=function(event){if(!(event&&event.type)){return false;}
if(event.client&&event.client!==this){return false;}
var meta=_clientMeta[this.id];var clippedEls=meta&&meta.elements;var hasClippedEls=!!clippedEls&&clippedEls.length>0;var goodTarget=!event.target||hasClippedEls&&clippedEls.indexOf(event.target)!==-1;var goodRelTarget=event.relatedTarget&&hasClippedEls&&clippedEls.indexOf(event.relatedTarget)!==-1;var goodClient=event.client&&event.client===this;if(!meta||!(goodTarget||goodRelTarget||goodClient)){return false;}
return true;};var _clientDispatchCallbacks=function(event){var meta=_clientMeta[this.id];if(!(typeof event==="object"&&event&&event.type&&meta)){return;}
var async=_shouldPerformAsync(event);var wildcardTypeHandlers=meta&&meta.handlers["*"]||[];var specificTypeHandlers=meta&&meta.handlers[event.type]||[];var handlers=wildcardTypeHandlers.concat(specificTypeHandlers);if(handlers&&handlers.length){var i,len,func,context,eventCopy,originalContext=this;for(i=0,len=handlers.length;i<len;i++){func=handlers[i];context=originalContext;if(typeof func==="string"&&typeof _window[func]==="function"){func=_window[func];}
if(typeof func==="object"&&func&&typeof func.handleEvent==="function"){context=func;func=func.handleEvent;}
if(typeof func==="function"){eventCopy=_extend({},event);_dispatchCallback(func,context,[eventCopy],async);}}}};var _prepClip=function(elements){if(typeof elements==="string"){elements=[];}
return typeof elements.length!=="number"?[elements]:elements;};var _addMouseHandlers=function(element){if(!(element&&element.nodeType===1)){return;}
var _suppressMouseEvents=function(event){if(!(event||(event=_window.event))){return;}
if(event._source!=="js"){event.stopImmediatePropagation();event.preventDefault();}
delete event._source;};var _elementMouseOver=function(event){if(!(event||(event=_window.event))){return;}
_suppressMouseEvents(event);ZeroClipboard.focus(element);};element.addEventListener("mouseover",_elementMouseOver,false);element.addEventListener("mouseout",_suppressMouseEvents,false);element.addEventListener("mouseenter",_suppressMouseEvents,false);element.addEventListener("mouseleave",_suppressMouseEvents,false);element.addEventListener("mousemove",_suppressMouseEvents,false);_mouseHandlers[element.zcClippingId]={mouseover:_elementMouseOver,mouseout:_suppressMouseEvents,mouseenter:_suppressMouseEvents,mouseleave:_suppressMouseEvents,mousemove:_suppressMouseEvents};};var _removeMouseHandlers=function(element){if(!(element&&element.nodeType===1)){return;}
var mouseHandlers=_mouseHandlers[element.zcClippingId];if(!(typeof mouseHandlers==="object"&&mouseHandlers)){return;}
var key,val,mouseEvents=["move","leave","enter","out","over"];for(var i=0,len=mouseEvents.length;i<len;i++){key="mouse"+mouseEvents[i];val=mouseHandlers[key];if(typeof val==="function"){element.removeEventListener(key,val,false);}}
delete _mouseHandlers[element.zcClippingId];};ZeroClipboard._createClient=function(){_clientConstructor.apply(this,_args(arguments));};ZeroClipboard.prototype.on=function(){return _clientOn.apply(this,_args(arguments));};ZeroClipboard.prototype.off=function(){return _clientOff.apply(this,_args(arguments));};ZeroClipboard.prototype.handlers=function(){return _clientListeners.apply(this,_args(arguments));};ZeroClipboard.prototype.emit=function(){return _clientEmit.apply(this,_args(arguments));};ZeroClipboard.prototype.clip=function(){return _clientClip.apply(this,_args(arguments));};ZeroClipboard.prototype.unclip=function(){return _clientUnclip.apply(this,_args(arguments));};ZeroClipboard.prototype.elements=function(){return _clientElements.apply(this,_args(arguments));};ZeroClipboard.prototype.destroy=function(){return _clientDestroy.apply(this,_args(arguments));};ZeroClipboard.prototype.setText=function(text){if(!_clientMeta[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");}
ZeroClipboard.setData("text/plain",text);return this;};ZeroClipboard.prototype.setHtml=function(html){if(!_clientMeta[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");}
ZeroClipboard.setData("text/html",html);return this;};ZeroClipboard.prototype.setRichText=function(richText){if(!_clientMeta[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");}
ZeroClipboard.setData("application/rtf",richText);return this;};ZeroClipboard.prototype.setData=function(){if(!_clientMeta[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");}
ZeroClipboard.setData.apply(this,_args(arguments));return this;};ZeroClipboard.prototype.clearData=function(){if(!_clientMeta[this.id]){throw new Error("Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance");}
ZeroClipboard.clearData.apply(this,_args(arguments));return this;};ZeroClipboard.prototype.getData=function(){if(!_clientMeta[this.id]){throw new Error("Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance");}
return ZeroClipboard.getData.apply(this,_args(arguments));};if(typeof define==="function"&&define.amd){define(function(){return ZeroClipboard;});}else if(typeof module==="object"&&module&&typeof module.exports==="object"&&module.exports){module.exports=ZeroClipboard;}else{window.ZeroClipboard=ZeroClipboard;}})(function(){return this||window;}());;(function($){ZeroClipboard.config({swfPath:Site.STATIC_URL+"common/lib/clipboard/ZeroClipboard-2.2.0.swf"});var initializeCopyButton=function($copyButton,$inputToCopyFrom,onCopyButtonPress,onCtrlC){var client=new ZeroClipboard($copyButton);client.on('ready',function(event){client.on('copy',function(event){event.clipboardData.setData('text/plain',$inputToCopyFrom.val());});if(onCopyButtonPress){client.on('aftercopy',onCopyButtonPress);}});client.on('error',function(event){ZeroClipboard.destroy();});$inputToCopyFrom.click(function(){$(this).select();});if(onCtrlC){$inputToCopyFrom.bind('copy',onCtrlC);}};$.fn.copy_button=function($inputToCopyFrom,onCopyButtonPress,onCtrlC){initializeCopyButton(this,$inputToCopyFrom,onCopyButtonPress,onCtrlC)}})(jQuery);;if(!window.Share){window.Share={};}
if(!window.Share.Models){window.Share.Models={};}
if(!window.Share.Views){window.Share.Views={};}
if(!window.Share.Collections){window.Share.Collections={};}
Share.broker=_.clone(Backbone.Events);if(!window.Prezi){window.Prezi={};};Share.helpers={getKey:function(obj,value){for(var key in obj){if(obj[key]==value){return key;}}
return null;},getTextValue:function($el){return this.options.values[$el.val()];},getPrivacyState:function(){if(Share.Views.sliderView){if(!Share.Views.sliderView.model.prev_privacy_state){Share.Views.sliderView.model.prev_privacy_state=Share.Models.presentation.get('permissions').privacy;}
return Share.Views.sliderView.model.prev_privacy_state;}
else{return Share.Models.presentation.get('permissions').privacy;}},initializeCopyButton:function($button_parent,location){$button_parent.find('.prezi-link-text').click(function(){$(this).select();}).bind('copy',function(e){$.log(Share.helpers.getPrivacyState()+" sharing "+location+" copy ctrl_c");});var copy_btn=$button_parent.find('.prezi-link-copy-btn');if(copy_btn.length>0){copy_btn.css('z-index',1200).copy_button('#'+$button_parent[0].id+' .prezi-link-text',Share.copy_overlay);if(!Share.copy_overlay){Share.copy_overlay=copy_btn[0].clip;}}},getCookie:function(name){var cookieValue=null;if(document.cookie&&document.cookie!==''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return cookieValue;},getCsrfToken:function(){return Share.helpers.getCookie('csrftoken');},obfuscateEmail:function(email){var firstChar=email.charAt(0);var allButFirstChar=email.substring(1,email.length);return firstChar+allButFirstChar.replace(/([a-zA-Z-_])/g,"*");},filterAvatar:function(avatarUrl){if(!avatarUrl||avatarUrl.indexOf('blank-avatar.jpg')>-1){avatarUrl=Site.STATIC_URL+'share/dragon/img/avatar.svg';}
return avatarUrl;},getShareUrl:function(landing_url,extra_params){return landing_url+
(Share.helpers.hasQueryParamsInUrl(landing_url)?"&":"?")+"utm_campaign=share&utm_medium=copy"+
(extra_params||"");},hasQueryParamsInUrl:function(url){var urlParser=document.createElement('a');urlParser.href=url;return!!urlParser.search;},getPresentationUrl:function(oid){var url='/api/presentations/'+oid+'/sharing_info/';if(Site.useSignedLandingUrl){url+='?sign_landing_url=1';}
return url;}};;app.share={shareModalEventsBound:false,showShareModal:function(){if(this.shareModal){this.shareModal.destroy();}
this.shareModal=new Share.Views.ModalView({model:Share.Models.presentation});},show:function(e){this.getSharingInfoAndShowModal(Prezi.data.oid,Prezi.data.user_id,'edit');},showByOid:function(oid,user_id){this.getSharingInfoAndShowModal(oid,user_id,'your');},getSharingInfoAndShowModal:function(oid,user_id,location){Share.Models.presentation=new Share.Models.Presentation({'user_id':user_id,'location':location});this.showShareModal();Share.Models.presentation.load(oid);}};;var app=app||{};app.helpers=app.helpers||{};app.helpers.license_expired_log=function(modal_name,e,on_new_tab){if(typeof on_new_tab==='undefined'){on_new_tab=false;}
e.preventDefault();var redirect_to_original=function(){app.helpers.redirect(e.target.href);};var open_on_new_tab=function(){window.open(e.target.href,'_blank');};$.log({msg:modal_name+' '+$(e.target).data('log-item'),log_callback:on_new_tab?open_on_new_tab:redirect_to_original,});};app.helpers.redirect=function(uri){document.location.href=uri;};app.helpers.prunePreziTitle=function(original_title){return _.prune(original_title,25);};app.helpers.isMobile=function(){return(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));};app.helpers.createNewPrezi=function(event,uuid){if(Site.isPitchViewActive){window.open('/p/create-prezi/','_blank');}else{if(!Site.expiredLicense){var urlPostFix=uuid?'#group-'+uuid:'';var instantPreziUrl='/instant-prezi/'+urlPostFix;if(app.helpers.shouldShowSafariLimitedExperienceModal()){app.modalsView.showSafariLimitedExperienceModal(instantPreziUrl);app.helpers.dashboardStructuredLog("safari_limited_experience_modal","show","click_on_new");return;}
if(uuid){$.log('folder create_prezi_in_folder '+this.uuid);}
window.open(instantPreziUrl);}else{window.location.reload();}}
event.currentTarget.blur();};app.helpers.dashboardStructuredLog=function(object,action,trigger,data,feature){var feature=feature||'homescreen';var logDefaults={'_category':'dashboard_web_structured','feature':feature,'platform':'website','object':object,'_action':action,'trigger':trigger,'user_id':parseInt(Site.user_id)||0,'user_oid':Site.user_oid,'putma_id':window.Prezi.data.putma,'user_agent ':window.navigator.userAgent};var logData=$.extend({},logDefaults,data);$.jsonlog(logData);};app.helpers.getPreziPrivacy=function(prezi){var privacy='private';if(prezi.get('public')){privacy=prezi.get('showcase_prohibited')?'hidden':'public';}
return privacy;};app.helpers.getUserRights=function(prezi){if(prezi.get('edit')==="1"){return"can_edit";}else if(prezi.get('comment')==="1"){return"can_comment";}else{return"can_view";}};app.helpers.getPreziPermissions=function(prezi){return fetch(Site.PRESENTATION_API_V4_ENDPOINT+prezi.id+'/?fields=user_permissions',{credentials:'same-origin'}).then(function(response){if(response.ok){return response.json().then(function(response){return'user_permissions'in response?response['user_permissions']:{};});}else{return Promise.reject();}});};app.helpers.isSupportedBrowserForPitchEditing=function(){return Site.isPitchEditingSupportedInThisBrowser;};app.helpers.shouldShowUnsupportedBrowserDialog=function(){return Site.shouldCheckSupportedBrowserForPitchEditing&&!app.helpers.isSupportedBrowserForPitchEditing()&&!$.cookie('unsupported_browser_popup_shown')&&Site.isPitchViewActive};app.helpers.checkAuthCookieChanges=function(callback){$.get('/api/v2/auth/optional').done(function(response){var isChanged=false;var cookieChanges=response['cookie_changes']||{};var cookieChangeKeys=Object.keys(cookieChanges);cookieChangeKeys.forEach(function(changeKey){if(cookieChanges[changeKey]){isChanged=true;}});if(callback&&isChanged){callback();}});};app.helpers.showDashboardSpinner=function(){$('#dashboard_spinner').show();};app.helpers.hideDashboardSpinner=function(){$('#dashboard_spinner').hide();};app.helpers.getOsTypeString=function(){var osName=window.userAgentParser.getOS().name;if(osName){if(osName.match('Mac')){return'mac';}
if(osName.match('Windows')){return'windows';}}else{return'other';}};app.helpers.openPreziForPresent=function(landingUrl){window.open(landingUrl+"?present=1",'_blank');};app.helpers.showViewlinks=function(preziModel,source){PubSub.publish('cardDialogOpened',{preziOid:preziModel.get('id'),preziTitle:preziModel.get('title'),dialogType:'viewlinks',isOwner:preziModel.get('owner_id')===parseInt(Site.user_id),source:source,});};app.helpers.showPdfExportDialog=function(preziModel){if(Site.hasPdfExportFeature){PubSub.publish('pdfDialogOpened',{preziOid:preziModel.get('id'),preziTitle:preziModel.get('title'),dialogType:'pdfExport',isOwner:preziModel.get('owner_id')===parseInt(Site.user_id),dashboardStructuredLog:app.helpers.dashboardStructuredLog,});}else{app.helpers.showPdfExportPaywall();}};app.helpers.showPptxExportDialog=function(preziModel){if(Site.isFsPptxExportEnabled){PubSub.publish('pptxDialogOpened',{preziOid:preziModel.get('id'),dialogType:'pptxExport',dashboardStructuredLog:app.helpers.dashboardStructuredLog,email:Site.user_email});}else{}};app.helpers.showValueBasedPricingPaywallModal=function(model){app.modalsView.showValueBasedPricingPaywallModal(model);};app.helpers.showPdfExportPaywall=function(){openPaywallPanel('pitch_pdf_export');};app.helpers.showDownloadForPresentationPaywall=function(){openPaywallPanel('download_for_presentation');};app.helpers.showPresenterViewPaywall=function(){openPaywallPanel('pitch_presenter_view');};app.helpers.showLivePreziPaywall=function(){openPaywallPanel('pitch_remote_present');};app.helpers.showViewAnalyticsPaywall=function(){openPaywallPanel('pitch_analytics');};app.helpers.showPitchDownloadDesktopPaywall=function(){openPaywallPanel('pitch_desktop');};app.helpers.showsRemoteClickerPaywall=function(){openPaywallPanel('pitch_bluetooth_clicker');};app.helpers.editOrShowUnsupportedBrowser=function(e,startLivePrezi,preziModel){var preziMetadata=preziModel.attributes;e.preventDefault();if(app.helpers.isSupportedBrowserForPitchEditing()){if(startLivePrezi&&!Site.hasRemotePresentFeature){app.helpers.showLivePreziPaywall();}else{preziMetadata.landing_url=preziMetadata.landing_url||$(e.target).attr('data-url');var url=preziMetadata.landing_url+(startLivePrezi?'?start-live-prezi=true':'');var win=window.open(url,'_blank');win.focus();}}else{var logAction="open_unsupported_browser_popup_v2";app.helpers.dashboardStructuredLog("prezi",logAction,"thumbnail",this.getStandardLogData(preziModel));app.modalsView.showUnsupportedBrowserModal(preziModel);}};app.helpers.showPrivacy=function(preziModel,source){PubSub.publish('cardDialogOpened',{preziOid:preziModel.get('id'),preziTitle:preziModel.get('title'),dialogType:'privacysettings',isOwner:preziModel.get('owner_id')===parseInt(Site.user_id),source:source,});};app.helpers.showCollaborators=function(preziModel){PubSub.publish('cardDialogOpened',{preziOid:preziModel.get('id'),preziTitle:preziModel.get('title'),dialogType:'collaborators',isOwner:preziModel.get('owner_id')===parseInt(Site.user_id),source:'contextmenu'});};app.helpers.showTitleEditor=function(id){if(Site.productType===Site.PRODUCT_TYPE_PITCH){var el=$('#business-prezi-'+id);}else{var el=$('#prezi-'+id);}
el.find('.title-icon-container').addClass("hidden");el.find('.title-inputs').removeClass("hidden");var $input=el.find('input');$input.focus();$input.val($input.val());$input.select();};app.helpers.openContextMenu=function(e,preziModel){$(".prezi-card-item").removeClass("prezi-card-with-context-menu-open");$(e.target).parents(".prezi-card-item").addClass("prezi-card-with-context-menu-open");var presentUrl=preziModel.get('landing_url')+"?present=1";var data={oid:preziModel.get('id'),openMenu:true,parent:"preziCard",title:preziModel.get('title'),isOwner:preziModel.get('owner_id')===parseInt(Site.user_id),isOnboardingPrezi:preziModel.get('owner_id')===Site.onboardingOwnerId,userRights:app.helpers.getUserRights(preziModel),presentUrl:presentUrl,userPermissions:{canEdit:preziModel.get('edit')==='1',canMakeCopy:preziModel.get('edit')==='1'},preziPrivacy:app.helpers.getPreziPrivacy(preziModel),deleteCallback:function(){app.modalsView.showDeletePreziModal(preziModel)},privacyCallback:function(e){app.helpers.showPrivacy(preziModel,'contextmenu');},shareViewLinksCallback:function(){app.helpers.showViewlinks(preziModel,'contextmenu');},exportPDFCallback:function(){app.helpers.showPdfExportDialog(preziModel);},dowloadPreziCallback:function(){app.modalsView.showDownloadPreziIsDesktopOnlyFeatureModal();},preziRemoteClickerCallback:function(){app.modalsView.showRemoteClickerIsDesktopOnlyFeatureModal();},presenterViewCallback:function(){app.modalsView.showPresentationViewIsDesktopOnlyFeatureModal();},collaboratorsCallback:function(){app.helpers.showCollaborators(preziModel);},renameCallback:function(){app.helpers.showTitleEditor(preziModel.get('id'));},isMobile:Site.isNonDesktopView,log:app.helpers.dashboardStructuredLog,showPaywallTagsInContextMenu:Site.showPaywallTagsInContextMenu,features:{presenterView:Site.hasPresenterViewFeature,clicker:Site.hasRemoteClickerFeature,livePrezi:Site.hasRemotePresentFeature,analytics:Site.hasAnalyticsFeature,exportPdf:Site.hasPdfExportFeature,download:Site.hasDownloadForPresentationFeature,privacyControl:Site.hasPrivacyControlFeature,addCollaborators:Site.isTeamUserInCurrentProduct,},livePreziForCollaborators:Site.livePreziForCollaborators,paywallCallbacks:{presenterView:app.helpers.showPresenterViewPaywall,preziRemoteClicker:app.helpers.showsRemoteClickerPaywall,livePrezi:app.helpers.showLivePreziPaywall,viewAnalytics:app.helpers.showViewAnalyticsPaywall,exportPdf:app.helpers.showPdfExportPaywall,downloadForPresentation:app.helpers.showDownloadForPresentationPaywall,},flags:{isAnalyticsDisabled:Site.teamSettingsAnalyticsDisabled,isPublicPrivacyDisabled:Site.isPublicPrivacyDisabled,isCopyrightModifiable:Site.isCopyrightModifiable,hasAirDashboard:Site.hasAirDashboard,}};var doOpenContextMenu=function(data){console.warn("ContextMenu is no longer present.");};if(Site.isCopyrightModifiable){app.helpers.getPreziPermissions(preziModel).then(function(permissions){data.userPermissions.canMakeCopy='can_make_copy'in permissions&&permissions['can_make_copy'];doOpenContextMenu(data);}).catch(function(){doOpenContextMenu(data);});}else{doOpenContextMenu(data);}};app.helpers.getStandardLogData=function(preziModel){return{"prezi_oid":preziModel.get('id'),"prezi_ownership":preziModel.get('owner_id')===parseInt(Site.user_id)?'owned':'shared',"prezi_privacy":app.helpers.getPreziPrivacy(preziModel),"user_rights":app.helpers.getUserRights(preziModel)};};app.helpers.setUserSetting=function(key,value,failCallback){$.ajax({url:'/api/v4/usersettings/'+Site.user_id+'/'+key+'/',type:'PUT',data:JSON.stringify({'setting_value':value}),context:this,dataType:'json'}).fail(failCallback);};app.helpers.repositionOnboardingTooltip=function(preziCard){var $onboardingTooltipEl=preziCard.$el.find('.onboarding-tooltip');var maxWidthWithTooltip=preziCard.$el.position().left+preziCard.$el.outerWidth()+$onboardingTooltipEl.outerWidth();var maxHeightWithTooltip=preziCard.$el.position().top+preziCard.$el.outerHeight()+$onboardingTooltipEl.outerHeight();var canFitOnTheRight=maxWidthWithTooltip<$(window).width();var canFitOnTheBottom=maxHeightWithTooltip<$(window).height();var $anchorElement=preziCard.model.get('onboarding_bubble_anchor_classname')?preziCard.$el.find('.'+preziCard.model.get('onboarding_bubble_anchor_classname')):null;var repositionClassName='onboarding-tooltip-right';if($anchorElement&&$anchorElement.position().top>0){$onboardingTooltipEl.css({top:$anchorElement.position().top+($anchorElement.outerHeight()-$onboardingTooltipEl.outerHeight())/2,left:$anchorElement.position().left+$anchorElement.outerWidth()+10,bottom:'auto'});}
if(!canFitOnTheRight&&canFitOnTheBottom){repositionClassName='onboarding-tooltip-bottom';if($anchorElement&&$anchorElement.position().top>0){$onboardingTooltipEl.css({bottom:'auto',top:$anchorElement.position().top+$anchorElement.outerHeight()+10,left:$anchorElement.position().left+$anchorElement.outerWidth()/2-$onboardingTooltipEl.outerWidth()/2});repositionClassName+=' onboarding-tooltip-arrow-bottom-middle'}}else if(!canFitOnTheRight&&!canFitOnTheBottom){repositionClassName='onboarding-tooltip-top';}
$onboardingTooltipEl.removeClass('onboarding-tooltip-bottom onboarding-tooltip-top onboarding-tooltip-right onboarding-tooltip-arrow-bottom-middle');$onboardingTooltipEl.addClass(repositionClassName);};app.helpers.shouldShowSafariLimitedExperienceModal=function(){if(Site.isPitchViewActive){return false;}
var os=window.userAgentParser.getOS();var browser=window.userAgentParser.getBrowser();return os.name==="Mac OS"&&os.version.match(/^10\.1[3-9]|^10\.[2-9][0-9]/)&&browser.name==="Safari";};app.helpers.refreshPreziList=function(){if(app.preziList){app.preziList.refresh();}};app.helpers.mapFilterNameToLogString=function(filterName){var mapLogStrings={"all":"ALL_PRESENTATIONS","own":"CREATED_BY_ME","shared":"SHARED_WITH_ME"};return mapLogStrings[filterName];};;var app=app||{};(function($){'use strict';Backbone.Model.prototype.sync=function(method,model,options){if(!options.skip_csrftoken){options.data=add_csrftoken(options.data);}
return Backbone.sync(method,model,options);};app.PreziModel=Backbone.Model.extend({defaults:{thumb_url:'http://0701.static.prezi.com/preview/fdg5pv6xkhxs7lcn6tpom3hjsiadw6rhlm5vs2oll757hbaoaxlq_0_0.png'},initialize:function(){this.urlRoot=Site.PRESENTATION_API_ENDPOINT;},destroyed:function(e){this.trigger('destroyed');},sync:function(method,model,options){var oid=this.get('id');if(method==='delete'){var logData={"prezi_oid":oid,"prezi_ownership":this.get('owner_id')===parseInt(Site.user_id)?'owned':'shared',"prezi_privacy":app.helpers.getPreziPrivacy(this),"user_rights":app.helpers.getUserRights(this),"status":"started"};app.helpers.dashboardStructuredLog("prezi","delete","machine",logData);method='read';options=options||{};options.url=this.urlRoot+'delete/'+oid+'/';options.success=function(){model.destroyed();logData['status']="successful";app.helpers.dashboardStructuredLog("prezi","delete","machine",logData);PubSub.publish("preziDeleted",{oid:oid});};options.error=function(){logData['status']="failed";app.helpers.dashboardStructuredLog("prezi","delete","machine",logData);};}
options.timeout=5000;options.dataType="json";return Backbone.Model.prototype.sync(method,model,options);},is_pvo:function(){return(!this.get('public')&&parseInt(this.get('edit'))===0);}});app.PersonalizationModel=Backbone.DeepModel.extend({defaults:{segmentation_answers:{answer:"",state:0,answer_other:""},is_business_user:false,is_stevie:false,messages:{templates:[],to_show:[],banners:""},features:[],conversion_event:''},initialize:function(options){this.urlRoot='/api/v1/personalization/profile/'+options.page_name+'/';this.listenTo(this,'fetch_success',this.handleFetchSuccess);this.message_read_no_store=['banner-your-warning'];},initData:function(){if(window.location.href.indexOf('message=logout_error')>-1){this.set('messages.banners','banner-your-warning');}
else{var options={success:function(model){model.trigger('fetch_success',model);},data:{"is-flash-enabled":false,"product-type":Site.isPitchViewActive?'pitch':'core'}};this.fetch(options);}},isItemInList:function(list,name){return list&&list.indexOf(name)>-1;},removeItemFromMessageList:function(messages,type,message_name){var items=messages[type];if(items){var item_index=items.indexOf(message_name);if(item_index>-1){items.splice(item_index,1);}}},addItemToMessageList:function(type,message_name){var messages=$.extend(true,{},this.get("messages"));var items=messages[type]
if(items){items.push(message_name);}
this.set("messages",messages);},isFeatureActive:function(feature_name){return this.isItemInList(this.get("features"),feature_name);},shouldShowMessage:function(message_name){return this.isItemInList(this.get("messages.to_show"),message_name);},closeMessage:function(message_type,message_name,callback){if(this.message_read_no_store.indexOf(message_name)==-1){$.post('/api/v1/personalization/message_read/?click_source=your-close-message-'+message_name,{'name':message_name},callback);}
var messages=$.extend(true,{},this.get("messages"));if(messages){if(message_type=="banners"){messages["banners"]="";}
this.removeItemFromMessageList(messages,"to_show",message_name);this.set("messages",messages);}},shouldRedirectToWelcome:function(){return this.shouldShowMessage("onboarding-intro")&&!Site.isPitch&&document.location.href.indexOf('/welcome/')==-1;},handleFetchSuccess:function(){if(!this.shouldRedirectToWelcome()&&app.teamRoleChangeDialogRouter){this.waitForTeamInfoData=$.get("/organizations/api/v2/team-info/").done(function(data){app.teamRoleChangeDialogRouter.setTeamInfo(data);if(data[Site.productType]&&'group_name'in data[Site.productType]){$('#dropdown-account-team-name').text(data[Site.productType]['group_name'])}else{$('#dropdown-account-team-name').text('')}});}},logSegmentation:function(action,segmentationData){var logPayload={'_category':'segmentation_structured','event':action,'object':'segmentation','trigger':'segmentation_submit','_action':action,'answer':segmentationData.segmentation_answer,'freetext_answer':segmentationData.segmentation_answer_other,'user_id':Site.user_id?parseInt(Site.user_id,10):0,'putma_id':$.cookie('__putma'),'segmentation_version':segmentationData.segmentation_version};if(segmentationData.segmentation_answer_extended){$.extend(logPayload,{'segmentation_answer_extended':segmentationData.segmentation_answer_extended});}
$.jsonlog(logPayload);},updateSegmentationData:function(pageName,segmentationData,onSuccess,onError){var that=this;var putData={'settings':segmentationData};$.ajax({url:'/api/v4/usersettings/'+Site.user_id+'/',type:'PUT',data:JSON.stringify(putData),context:that,dataType:'json',complete:function(data){if(data.status===200){this.logSegmentation('segmentation_answer_your',segmentationData);this.set("segmentation_answers",{answer:segmentationData.segmentation_answer,state:segmentationData.segmentation_state,answer_other:segmentationData.segmentation_answer_other});if(Site.needsWelcomeEmail&&!Site.designWelcomeEmailsEnabled){$.get('/welcome/email/?segmentation_answer='+segmentationData.segmentation_answer);}
onSuccess();app.helpers.checkAuthCookieChanges();}else{this.logSegmentation('save_failed',segmentationData)
onError();}}});},showStartingModal:function(){var showModal=function(){if(Site.isInGracePeriod&&Site.isUpdatePaymentMethodModalABTestActive){window.glassboxLogger.logEnteredAbTestExperience({ab_test_name:'gm-abtest-update-payment-method-modal',})}
if(app.teamRoleChangeDialogRouter&&app.teamRoleChangeDialogRouter.shouldShowDialog()){app.teamRoleChangeDialogRouter.showTeamInvitationDialog();}else if(app.helpers&&app.helpers.shouldShowUnsupportedBrowserDialog()){app.modalsView.showUnsupportedBrowserModal(this.model,true);}else if(Site.expiredLicense){app.preziList.handleExpiredLicense();}else if(Site.showExpiredPaymentMethodModal){app.modalsView.showExpiredPitchUpdatePaymentMethodModal();}};if(Site.presentationToCopyOid){var copyInProgressDialog=null;var copiedDocumentSchemaVersion=null;app.copyPresentationController.copyPresentation(Site.presentationToCopyOid,function(preziData){window.glassboxLogger.logLoadedCopyInProgressDialog({prezi_oid:Site.presentationToCopyOid});copyInProgressDialog=app.modalsView.showCopyInProgressModal(preziData.title);copiedDocumentSchemaVersion=preziData.schema_version;}).then(function(preziDataOfCopy){window.glassboxLogger.logCopiedPresentation({copy_prezi_oid:preziDataOfCopy.oid,original_prezi_oid:Site.presentationToCopyOid});app.copyPresentationController.redirectToEditor(preziDataOfCopy.oid,copiedDocumentSchemaVersion);},function(error){window.glassboxLogger.logLoadedCopyFailedDialog({prezi_oid:Site.presentationToCopyOid});if(copyInProgressDialog){copyInProgressDialog.showErrorMessage();}else{app.modalsView.showCopyInProgressModal(gettext('Copying presentation')).showErrorMessage();}});}else{this.waitForTeamInfoData?this.waitForTeamInfoData.done(showModal):showModal();}}});app.GoogleDataLayerModel=Backbone.Model.extend({isGDLActive:function(){return typeof GDL!=='undefined'},logSegmentation:function(action,event,occupationCategory,level){return $.jsonlog({"_action":action,"_category":"segmentation_gdl_events","_level":level||"INFO","object":event,"trigger":"event","occupation_category":occupationCategory,"license_type_prezi":GDL.licenseType,"putma_id":GDL.putmaId,"user_id":GDL.userId?parseInt(GDL.userId,10):0});}});app.HistoryManager=Backbone.Model.extend({initialize:function(params){this.hasClassicFilter=params.hasClassicFilter;this.hasAirDashboard=params.hasAirDashboard;_.bindAll(this,'changeHistoryState','pushHistoryState','replaceHistoryState','clearNavigation');},changeHistoryState:function(hash,pageTitle,shouldPushHistoryState){if(!window.history.pushState||!window.history.replaceState){return;}
var historyFunction=(shouldPushHistoryState?window.history.pushState:window.history.replaceState).bind(window.history);var newUrl=window.location.href.split('#',1)[0]+'#/'+hash;historyFunction(null,null,newUrl);document.title=pageTitle+" | Prezi";},pushHistoryState:function(url,pageTitle){this.changeHistoryState(url,pageTitle,true);},replaceHistoryState:function(url,pageTitle){this.changeHistoryState(url,pageTitle,false);},clearNavigation:function(){this.replaceHistoryState('',gettext('Presentations'));}});}(jQuery));;var app=app||{};var PRODUCT_NAME_CORE='core';var PRODUCT_NAME_PITCH='pitch';app.TeamRoleChangeDialogRouter=Backbone.Model.extend({setTeamInfo:function(data){this.teamInvitations=[];this.teamAdditions=[];this.teamMemberships=[];[PRODUCT_NAME_PITCH,PRODUCT_NAME_CORE].forEach(function(productType){if(productType in data){if(!!data[productType]['is_invited']){this.teamInvitations.push({'teamId':data[productType]['group_profile_id'],'teamName':data[productType]['group_name'],'teamProduct':productType,'organization_id':data[productType]['organization_id']});}else if(!!data[productType]['is_recently_added']){if((data[productType]==='core'&&data[productType]['is_recently_added']['recently_added_to_core_team'])||(data[productType]==='pitch'&&data[productType]['is_recently_added']['recently_added_to_pitch_team'])){this.teamAdditions.push({'teamName':data[productType]['group_name'],'teamProduct':productType,});this.teamMemberships.push(productType);}}else if(data[productType]!==false){this.teamMemberships.push(productType);}}}.bind(this));},shouldShowDialog:function(){return this.hasTeamInvitations()||this.hasTeamAdditions();},hasTeamInvitations:function(){return this.teamInvitations.length>0},hasTeamAdditions:function(){return this.teamAdditions.length>0},openAddedToTeamDialog:function(){PubSub.publish('addedToTeamDialog.open',{'userId':parseInt(Site.user_id),'teamAdditions':this.teamAdditions,'isMultiProductUser':Site.hasMultipleProducts,'teamMemberships':this.teamMemberships});},openInvitedToTeamDialog:function(){PubSub.publish('teamInvitationDialog.open',{'userEmail':Site.user_email,'teamInvitations':this.teamInvitations,'userHasCoreProduct':Site.productType==PRODUCT_NAME_CORE||Site.hasMultipleProducts,'userHasPitchProduct':Site.productType==PRODUCT_NAME_PITCH||Site.hasMultipleProducts,'teamMemberships':this.teamMemberships,});},openTeamRoleChangeMobileDialog:function(){if(this.hasTeamInvitations()){PubSub.publish('teamRoleChangeMobileDialog.open',{'teamName':this.teamInvitations[0]['teamName'],'teamProduct':this.teamInvitations[0]['teamProduct'],});}else if(this.hasTeamAdditions()){PubSub.publish('teamRoleChangeMobileDialog.open',{'teamName':this.teamAdditions[0]['teamName'],'teamProduct':this.teamAdditions[0]['teamProduct'],});}},showTeamInvitationDialog:function(){if(app.helpers.isMobile()){this.openTeamRoleChangeMobileDialog();}else if(this.hasTeamInvitations()){this.openInvitedToTeamDialog();}else if(this.hasTeamAdditions()){this.openAddedToTeamDialog();}},});;var app=app||{};(function($){'use strict';app.ModalView=Backbone.View.extend({render:function(){this.$el.html(Mustache.render(this.template,{}));return this;}});app.PersonalizationModalView=app.ModalView.extend({el:'#body-content',messageName:'',modalId:'',modalClass:'',closeCallback:undefined,showModal:function(){if(this.shouldShowModal()){var html=Mustache.render($(this.modalId).html(),{});this.modalObject=this.$el.append(html).find(this.modalClass);this.modalObject.on('hide.bs.modal',$.proxy(this.reportClosed,this));this.modalObject.modal('show');}},shouldShowModal:function(){return this.model.shouldShowMessage(this.messageName)&&!this.modalObject;},reportClosed:function(){this.model.closeMessage("to_show",this.messageName,this.closeCallback);},closeModal:function(callback){this.closeCallback=callback;this.modalObject.modal('hide');},addModalToMessages:function(message_name){this.model.addItemToMessageList("to_show",message_name);}});}(jQuery));;var app=app||{};(function($){'use strict';app.ExpiredModal=app.ModalView.extend({template:$('#expired')[0].innerHTML,events:{'click a':'handleClickEvent',},handleClickEvent:function(e){app.helpers.license_expired_log('expired_modal',e);},});app.ExpiredMemberModal=Backbone.View.extend({template:$('#expired_member')[0].innerHTML,events:{'click a':'handleClickEvent'},render:function(license_data){this.$el.html(Mustache.render(this.template,{'Number':license_data.license_seats,'GroupName':license_data.group_name.replace("'","&apos;"),'licenseType':license_data.group_license_type,'TotalRenewalCost':license_data.group_renewal_price,'GroupAdminEmail':license_data.group_admin_email,'GroupId':license_data.group_id}));return this;},handleClickEvent:function(e){app.helpers.license_expired_log('expired_member_modal',e);}});app.ExpiredAdminModal=Backbone.View.extend({template:$('#expired_admin')[0].innerHTML,events:{'click a':'handleClickEvent'},render:function(license_data){this.$el.html(Mustache.render(this.template,{'Number':license_data.license_seats,'GroupName':license_data.group_name.replace("'","&apos;"),'licenseType':license_data.group_license_type,'TotalRenewalCost':license_data.group_renewal_price,'GroupAdminEmail':license_data.group_admin_email,'GroupId':license_data.group_id,'OrganizationId':license_data.organization_id}));return this;},handleClickEvent:function(e){app.helpers.license_expired_log('expired_admin_modal',e);}});app.ExpiredErrorModal=app.ModalView.extend({template:$('#expired_error')[0].innerHTML});app.ExpiredTrialModal=app.ModalView.extend({template:$('#expired_trial')[0].innerHTML});app.ExpiredTrialPBAdminModal=app.ModalView.extend({template:$('#expired_trial_pb_admin')[0].innerHTML,render:function(license_data){var manageLicensesLink="/organizations/manage/";if(Site.isSelfServiceTeam){if(Site.expiredLicenseData.isSelfServiceTeamSubscriptionActive){manageLicensesLink="/organizations/"+license_data.organization_id+"/billing?modal=change-card"}else{manageLicensesLink="/organizations/"+license_data.organization_id+"/billing/"}}
this.$el.html(Mustache.render(this.template,{'ManageLicensesLink':manageLicensesLink,}));return this;},events:{'click a':'handleClickEvent'}});app.ExpiredTrialPBMemberModal=Backbone.View.extend({template:$('#expired_trial_pb_member')[0].innerHTML,events:{'click a':'handleClickEvent'},render:function(license_data){this.$el.html(Mustache.render(this.template,{'GroupAdminEmail':license_data.group_admin_email,}));return this;},});app.ExpiredPitchModal=app.ModalView.extend({template:$('#expired_pitch')[0].innerHTML,events:{'click .downgrade-license':'downgradeLicense','click a':'handleClickEvent',},downgradeLicense:function(e){e.preventDefault();$.post('/api/v1/licenseprovisioning/downgrade/next/',function(response){window.location.href=response.redirect_url;});},handleClickEvent:function(e){app.helpers.license_expired_log('expired_pitch_modal',e,$(e.target).hasClass('on-new-tab'));}});app.ExpiredPitchStrictModal=app.ModalView.extend({template:$('#expired_pitch_strict')[0].innerHTML,events:{'click .downgrade-license':'downgradeLicense','click .restart-subscription':'restartSubscription',},downgradeLicense:function(e){e.preventDefault();window.glassboxLogger.logDowngradeExpiredLicense({expired_license_modal_type:"INITIAL"});$.post('/api/v1/licenseprovisioning/downgrade/next/',function(response){window.location.href=response.redirect_url;});},restartSubscription:function(){window.glassboxLogger.logResubscribeExpiredLicense({expired_license_modal_type:"INITIAL"});}});app.ExpiredPitchStrictConfirmModal=app.ModalView.extend({template:$('#expired_pitch_strict_confirm')[0].innerHTML,events:{'click .downgrade-license':'downgradeLicense','click button[data-dismiss="modal"]':'downgradeLicense','click .restart-subscription':'restartSubscription',},downgradeLicense:function(e){e.preventDefault();window.glassboxLogger.logDowngradeExpiredLicense({expired_license_modal_type:"DOWNGARDE_CONFIRMATION"});$.post('/api/v1/licenseprovisioning/downgrade/next/',function(response){window.location.href=response.redirect_url;});},restartSubscription:function(){window.glassboxLogger.logResubscribeExpiredLicense({expired_license_modal_type:"DOWNGARDE_CONFIRMATION"});}});app.ExpiredPitchUpdatePaymentMethodModal=app.ModalView.extend({template:$('#expired_pitch_update_payment_method')[0].innerHTML,events:{'click .update-card':'updateCard',},updateCard:function(){window.glassboxLogger.logChangeCreditCard({card_change_trigger:"MODAL"});}});app.ExpiredReferralPitchTrialModal=app.ModalView.extend({template:$('#expired_referral_pitch_trial')[0].innerHTML,events:{'click .downgrade-license':'downgradeLicense','click a':'handleClickEvent',},downgradeLicense:function(e){e.preventDefault();$.post('/api/v1/licenseprovisioning/downgrade/next/',function(response){window.location.href=response.redirect_url;});},handleClickEvent:function(e){app.helpers.license_expired_log('expired_regerral_pitch_trial_modal',e,$(e.target).hasClass('on-new-tab'));}});app.ClassicToNextModal=app.ModalView.extend({el:'#body-content',modalId:'#classic-to-next',modalClass:'.classic-to-next-modal',events:{'click .classic-to-next-modal-btn-next':'closeModal'},showModal:function(){if(this.elClassicToNextModal){this.elClassicToNextModal.remove();}
var template=$(this.modalId)[0].innerHTML;var html=Mustache.render(template,{});this.elClassicToNextModal=this.$el.append(html).find(this.modalClass);this.elClassicToNextModal.modal('show');},closeModal:function(){app.personalizationModel.closeMessage("to_show","c2n-classic-dashboard-message");this.elClassicToNextModal.modal('hide');}});}(jQuery));;var app=app||{};(function($){'use strict';Backbone.PagingCollection={enable:function(collection,config){_.extend(collection,Backbone.PagingCollection.Pager);if(config){_.extend(collection.pagingConfig,config);}}};Backbone.PagingCollection.Pager={pagingConfig:{page:0,itemPerPage:10,offset:0},nextPage:function(){this.setPage(this.pagingConfig.page+1);},previousPage:function(){this.setPage(this.pagingConfig.page-1);},setPage:function(page,fetchOptions){page=Math.round(page);page=Math.max(0,Math.min(this.pageCount-1,page));this.pagingConfig.page=page;this.calculateOffset();this.fetch(fetchOptions);},calculateOffset:function(){this.pagingConfig.offset=this.pagingConfig.itemPerPage*(this.pagingConfig.page);}};app.PreziCollection=Backbone.Collection.extend({initialize:function(config){Backbone.PagingCollection.enable(this,config);},order_by:'-modified_at',filter_by:'all',filter_key:null,model:app.PreziModel,isInitialized:false,sync:function(method,model,options){var params;var schema_versions=[Site.SCHEMA_VERSION_CORE,Site.SCHEMA_VERSION_TIMELINE,Site.SCHEMA_VERSION_PITCH].join(',');if(Site.productType===Site.PRODUCT_TYPE_CORE){schema_versions=Site.SCHEMA_VERSION_CORE;}else if(Site.productType===Site.PRODUCT_TYPE_PITCH){schema_versions=Site.SCHEMA_VERSION_PITCH;}
if(this.filter_by=='group'){var group_uuid=this.filter_key;params=_.extend({timeout:15000,url:Site.PRESENTATION_GROUP_API_ENDPOINT+group_uuid+"/prezis/",processData:true,data:{csrftoken:$.cookie('csrftoken'),limit:0,include_shared_with:1,include_permissions:1,schema_version__in:schema_versions}},options);}else{params=_.extend({data:{mine:true,search_your:this.search_query,filter_by:this.filter_by,order_by:this.order_by,limit:this.pagingConfig.itemPerPage,offset:this.pagingConfig.offset,include_permissions:1,schema_version__in:schema_versions},timeout:15000,url:Site.PRESENTATION_API_ENDPOINT,processData:true},options);}
return $.ajax(params);},parse:function(response){this.totalCount=response.meta.total_count;this.pageCount=Math.floor(this.totalCount/this.pagingConfig.itemPerPage);if(this.totalCount%this.pagingConfig.itemPerPage>0){this.pageCount++;}
this.pageCount=Math.max(1,this.pageCount);this.isOnLastPage=this.pagingConfig.page===this.pageCount-1;this.isInitialized=true;return response.objects;},has_pvo_prezi:function(){return _.some(this.models,function(prezi){return prezi.is_pvo();});},});}(jQuery));;var app=app||{};(function($){'use strict';app.TopBannerView=Backbone.View.extend({el:"#content-banner",events:{'click .personalization-message button.close':'closeBanner','click .cta-banner a':'onClickCta','click .personalization-message button.read-and-accept':'onClickAccept',},initialize:function(){this.listenTo(this.model,'change:messages.banners',this.showBanner);},closeBanner:function(event){this.model.closeMessage("banners",this.bannerName);$(event.target).closest('.banner-container').slideUp();},showBanner:function(){this.bannerName=this.model.get("messages.banners");this.render();},onClickAccept:function(event){window.glassboxLogger.logAcceptTermsofService();window.glassboxLogger.logAcceptPrivacyPolicy();this.closeBanner(event);},onClickCta:function(event){var ctaText=event.target.text;var ctaLink=event.target.href;window.glassboxLogger.logClickCta({cta_text:ctaText,cta_location:"Header",cta_type:"BUTTON",target_url:ctaLink});},render:function(){var $banner=$('#'+this.bannerName);if($banner.length){var template=$banner[0].innerHTML;$('<div class="banner-container"></div>').appendTo(this.el).hide().append(Mustache.render(template)).slideDown();}}});}(jQuery));;(function($){'use strict';app.PreziCard=Backbone.View.extend({tagName:'div',cardElement:'#prezi-',className:'prezi-card-item padded-card-container col-xs-12 col-md-4 col-sm-6',events:{"click .card-menu-delete":function(e){this.logDropmenuItemClicked("delete");this.deleteHandler(e);},"click .card-menu-share":function(e){this.logDropmenuItemClicked("share_and_privacy");this.openSharePanel(e);},"click .card-menu-copy-embed-code":function(e){this.logDropmenuItemClicked("copy_embed");var copyText="<iframe src='https://prezi.com/embed/"+this.model.get("id")+"/' id='iframe_container' frameborder='0' webkitallowfullscreen='' mozallowfullscreen='' allowfullscreen='' allow='autoplay; fullscreen' height='315' width='560'></iframe>";navigator.clipboard.writeText(copyText);},"click .card-menu-move-folder":function(e){this.logDropmenuItemClicked("add_to_folder");this.openMoveFolderContainer(e);},"click .card-menu-rename":function(e){this.logDropmenuItemClicked("rename");app.helpers.showTitleEditor(this.model.get('id'));},"click .card-menu-duplicate":function(e){this.logDropmenuItemClicked("make_a_copy");this.duplicatePrezi(e);},"click .card-menu-collaborators":function(e){this.logDropmenuItemClicked("share");app.helpers.showCollaborators(this.model);},"click .card-menu-export-pdf":function(e){this.logDropmenuItemClicked("pdf_export",{behind_paywall:!Site.hasPdfExportFeature,});app.helpers.showPdfExportDialog(this.model);},"click .card-discoverable":function(e){window.glassboxLogger.logOpenPrivacyDialog({prezi_oid:this.model.get('id')});this.logPrivacyClicked("thumbnail_title");app.helpers.showPrivacy(this.model,'prezicard');},"click .card-menu-present":function(e){this.logDropmenuItemClicked("open_for_present");app.helpers.openPreziForPresent(this.model.get('landing_url'));},"click .card-menu-edit-prezi":function(e){this.logDropmenuItemClicked("open_for_edit",{'is_onboarding':this.model.get('is_onboarding_prezi')});app.helpers.editOrShowUnsupportedBrowser(e,false,this.model);},"click .card-menu-live-prezi":function(e){window.glassboxLogger.logOpenLivePreziDialog({prezi_oid:this.model.get('id')});this.logDropmenuItemClicked("open_for_live_prezi",{'is_onboarding':this.model.get('is_onboarding_prezi')});app.helpers.editOrShowUnsupportedBrowser(e,true,this.model);},"click .card-menu-analytics":function(e){this.logDropmenuItemClicked("view_analytics");this.openAnalytics(e);},"click .prezi-img":"preziCardClickHandler","click .trigger":"menuClickHandler","click .card-title-edit":function(e){this.logThumbnailItemClicked("rename",{},true);app.helpers.showTitleEditor(this.model.get('id'));},"click .title-edit-icon":function(e){this.logThumbnailItemClicked("rename",{},true);app.helpers.showTitleEditor(this.model.get('id'));},"click .icon-close":"onIconClose","click .business-card-edit-button":function(e){var isOnboardingPrezi=this.model.get('is_onboarding_prezi');window.glassboxLogger.logOpenEditor({prezi_oid:this.model.get('id')});if(isOnboardingPrezi){window.glassboxLogger.logOpenOnboardingPreziToEdit({prezi_oid:this.model.get('id')});}
this.logThumbnailItemClicked("open_for_edit",{'is_onboarding':isOnboardingPrezi});app.helpers.editOrShowUnsupportedBrowser(e,false,this.model);},"keyup .card-title-edit-field":"titleKeyUp","blur input.card-title-edit-field":"onBlur","click .onboarding-tooltip a":"closeOnboardingTooltip","click .card-view-button":function(e){var isOnboardingPrezi=this.model.get('is_onboarding_prezi');var oid=this.model.get('id');window.glassboxLogger.logOpenToPresent({prezi_oid:oid});if(isOnboardingPrezi){window.glassboxLogger.logOpenOnboardingPreziToPresent({prezi_oid:this.model.get('id')});}
this.logThumbnailItemClicked("open_for_present",{'is_onboarding':isOnboardingPrezi});this.closeOnboardingTooltip();},"click .card-comment-button":function(e){window.glassboxLogger.logOpenToComment({prezi_oid:this.model.get('id')});this.logThumbnailItemClicked("open_for_comment");app.helpers.editOrShowUnsupportedBrowser(e,false,this.model);},"click .dropdown-icon-context-menu":function(e){var isOnboardingPrezi=this.model.get('is_onboarding_prezi');window.glassboxLogger.logOpenPresentationCardMenu({prezi_oid:this.model.get('id'),presentation_user_right:Site.user_id===this.model.get('owner_id')?'OWNER':'1'===this.model.get('edit')?'EDITOR':'1'===this.model.get('comment')?'COMMENTER':'VIEWER',});if(isOnboardingPrezi){window.glassboxLogger.logOpenOnboardingPreziCardMenu({prezi_oid:this.model.get('id')});}
this.logThumbnailItemClicked("open_context_menu");app.helpers.openContextMenu(e,this.model)},"click .onboarding-tooltip link":function(e){window.glassboxLogger.logOpenOnboardingVideo({target_url:'https://prezi.com/business/workshop/'});}},onIconClose:function(){this.cancelTitleEditor();this.closeOnboardingTooltip();},initialize:function(attributes){this.template=$(attributes.templateElement)[0].innerHTML;this.cardElement=attributes.cardElement;this.listView=attributes.listView;this.listenTo(Share.broker,"presentation:privacy:update",this.privacyUpdate);this.listenTo(this.model,'change',this.render);PubSub.subscribe('refreshPreziCard',this.privacyCallback.bind(this));if(!attributes.preziCardSubscriptions[this.model.get('id')]){PubSub.subscribe('renamePreziTitle',function(msg,data){if(this.model.get('id')===data.id){this.renameTitleCallback(data.title);}}.bind(this));attributes.preziCardSubscriptions[this.model.get('id')]=true;}},privacyUpdate:function(presentation){if(presentation.get('oid')===this.model.get('id')){switch(presentation.get('privacy')){case'public':this.model.set('public',true);this.model.set('showcase_prohibited',false);break;case'hidden':this.model.set('public',true);this.model.set('showcase_prohibited',true);break;case'private':this.model.set('public',false);this.model.set('showcase_prohibited',true);break;}
this.render();}},closeOnboardingTooltip:function(){var tooltip=this.$el.find('.onboarding-tooltip');if(tooltip.length){tooltip.fadeOut();}
this.setOnboardingPreziSeen();this.stepForwardOnboarding();},setOnboardingPreziSeen:function(){$.ajax({url:"/api/v4/usersettings/"+Site.user_id+"/editor/HIDE_DESKTOP_ONBOARDING_POPUP/",type:'PUT',data:JSON.stringify({'setting_value':true}),context:this,dataType:'json'});},duplicatePrezi:function(){var that=this;app.helpers.dashboardStructuredLog("prezi","make_a_copy","machine",this.getBackgroundLogData(this.model,"started"));$.ajax({type:"POST",url:"/api/v4/presentation-content/duplicate/",dataType:"json",contentType:"application/json",headers:{"X-csrftoken":window.csrftoken},data:JSON.stringify({prezi_oid:this.model.get('id'),new_owner_userid:Site.user_id,copyright:this.model.get('copyright'),showcase_prohibited:this.model.get('showcase_prohibited')?1:0,title:interpolate(gettext('Copy of %(title)s'),{'title':this.model.get('title')},true)}),success:function(response){that.listView.collection.reset();that.listView.refresh();app.helpers.dashboardStructuredLog("prezi","make_a_copy","machine",that.getBackgroundLogData(that.model,"successful"));PubSub.publish("duplicatePreziSuccess");},error:function(reason){that.showErrorMessage(reason)}});},showErrorMessage:function(reason){var that=this;var $errorMsg=that.$el.find('.error-msg-container');var $titleContainer=that.$el.find('.title-icon-container');$errorMsg.find('.error').text(gettext('Duplication unsuccessful'));$titleContainer.addClass('hidden');$errorMsg.removeClass('hidden');setTimeout(function(){$errorMsg.addClass('hidden');$titleContainer.removeClass("hidden");},3000);app.helpers.dashboardStructuredLog("prezi","make_a_copy","machine",that.getBackgroundLogData(that.model,"failed"));},updateThumbUrl:function(thumbUrl){var suffix="_0_0.png";if(thumbUrl.endsWith(suffix)){thumbUrl=thumbUrl.substr(0,thumbUrl.length-suffix.length)+"_3_0.png?fallback_with_redirect=false";thumbUrl=thumbUrl.replace("/preview/","/preview/v2/");}
return thumbUrl;},setPresentUrl:function(){var presentUrl=this.model.get('landing_url')+"?present=1";this.model.set('present_url',presentUrl);if(this.model.get('owner_id')===Site.onboardingOwnerId){$.get('/api/v1/prezilink/'+'?prezi_oid='+this.model.get('id')).done(function(response){var activeOnboardingLinks=response.filter(function(prezilink){return prezilink.onboarding&&!prezilink.revoked;});if(activeOnboardingLinks.length>0){this.model.set('present_url','/view/'+activeOnboardingLinks[0].link_id+'/');};}.bind(this)).fail(function(jqXHR,textStatus,errorThrown){log('fetch','prezilinks','machine',{level:'error',errorMessage:errorThrown,errorCode:jqXHR.status});}.bind(this));}},getTemplateContext:function(){if(this.model){var model_json=this.model.toJSON();model_json['edit']=model_json['edit']=='1'&&!Site.isJsBeta;model_json['comment']=model_json['comment']=='1'&&!Site.isJsBeta;model_json['delete']=model_json['delete']=='1';model_json['beta']=model_json['schema_version']!='0'&&!Site.isJsBeta&&!Site.isPitch;model_json['thumb_url']=this.updateThumbUrl(model_json['thumb_url']);model_json['js_prezi_page']=this.model.get('schema_version')!='0';model_json['pdf_export_dialog']=Site.pdfExportDialogEnabled;model_json['share_dialogs_privacy']=Site.shareDialogPrivacySettingsEnabled&&this.model.get('owner_id')===parseInt(Site.user_id);model_json['formatted_modified_at']=this.formatDate(model_json['modified_at']);model_json['owner_name']=model_json['owner']['public_display_name'];model_json['truncated_owner_name']=model_json['owner']['public_display_name'].substring(0,20);model_json['is_owner_of_prezi']=this.model.get('owner_id')===parseInt(Site.user_id);model_json['present_url']=this.model.get('present_url')+'?present=1';model_json['landing_url']=this.model.get('landing_url')+'?present=1';return model_json;}
return{};},formatDate:function(rawDate){var date=new Date(rawDate);var formattedDate;var locale=$.cookie("django_language");if(!locale){locale="en";}
try{if(date.getFullYear()!==new Date().getFullYear()){var options={year:"numeric",month:"short",day:"numeric"};}else{var options={month:"short",day:"numeric"};}
var dateLocaleFormatter=new Intl.DateTimeFormat(locale,options);formattedDate=dateLocaleFormatter.format(date);}
catch(e){formattedDate="";}
return formattedDate;},saveError:function(model,xhr,options){var $errorMsg=this.$el.find('.error-msg-container');var $titleContainer=this.$el.find('.title-icon-container');$titleContainer.addClass('hidden');$errorMsg.removeClass('hidden');$errorMsg.find('.error').text(gettext('Rename unsuccessful'));setTimeout(function(){$errorMsg.addClass('hidden');$titleContainer.removeClass("hidden");},1000);},render:function(){var that=this;var status_class='user-lock';var is_public=false;var is_hidden=false;if(this.model){this.model.set('share',this.model.get('schema_version')=='0');if(this.model.get('schema_version')!='0'){this.model.set('editor_type','?html5=1');}
is_public=this.model.get('public');is_hidden=this.model.get('showcase_prohibited');if(!is_public){status_class='user-lock';}else{if(is_hidden){status_class='link';}else{status_class='globe';}}
this.model.set('status_class',status_class);if(!this.model.get('present_url')){this.setPresentUrl();}}
var templateContext=this.getTemplateContext();this.$el.html(Mustache.render(this.template,templateContext));if(this.model.get('has_onboarding_tooltip')){this.$el.addClass('onboarding-card');}
if(this.model.get('has_onboarding_bubble_detail')){var preziHover=this.$el.find('.prezi-hover');preziHover.addClass("animation-auto-hover");app.helpers.repositionOnboardingTooltip(this);}
app.hub.trigger("prezicard:rendered",this);return this;},preziCardClickHandler:function(){if(Site.isNonDesktopView){var landingUrl=this.model.get('landing_url');window.open(landingUrl,'_blank');}},openAnalytics:function(){window.open('/analytics/','_blank');},deleteHandler:function(e){e.preventDefault();app.modalsView.showDeletePreziModal(this.model);},hideTitleEditor:function(){this.$el.find('.title-inputs').addClass("hidden");this.$el.find('.title-icon-container').removeClass("hidden");},cancelTitleEditor:function(){this.$el.find('input').val(this.model.get('title'));this.hideTitleEditor();},titleKeyUp:function(event){if(event.keyCode===27){this.cancelTitleEditor();return false;}
if(event.keyCode!==13){return true;}
this.renamingInProgress=true;this.renameTitle(event);},onBlur:function(event){if(this.renamingInProgress===true){this.renamingInProgress=false;return false;}
this.renameTitle(event);},renameTitle:function(event){$.log('card rename_btn '+this.model.get('id'));var oldTitle=this.model.get('title');var newTitle=this.$('input').val().trim(); 
var prezi_oid=this.model.get('id');if(oldTitle===newTitle||newTitle===""){this.$el.find('input').val(oldTitle);this.hideTitleEditor();return false;}
var that=this;this.$el.find('.card-title-edit').text(newTitle);this.$el.find('input').val(newTitle);this.hideTitleEditor();var _data={title:newTitle};app.helpers.dashboardStructuredLog("prezi","rename","machine",that.getBackgroundLogData(this.model,"started"));$.ajax({type:"PUT",url:"/api/v3/presentation/"+this.model.get('id')+'/',contentType:'application/json; charset=utf-8',data:JSON.stringify(_data),dataType:"json",success:function(data){if(('title'in data)&&(data.title===newTitle)){window.glassboxLogger.logChangedPresentationTitle({prezi_oid:prezi_oid})
that.model.set('title',newTitle);}else{that.revertToOldTitle(oldTitle);}
app.helpers.dashboardStructuredLog("prezi","rename","machine",that.getBackgroundLogData(that.model,"successful"));},error:function(){that.revertToOldTitle(oldTitle);app.helpers.dashboardStructuredLog("prezi","rename","machine",that.getBackgroundLogData(that.model,"failed"));}});},revertToOldTitle:function(oldTitle){this.$el.find('.card-title-edit').text(oldTitle);this.$el.find('input').val(oldTitle);this.saveError();},renameTitleCallback:function(newTitle){this.model.set('title',newTitle);this.render();},menuClickHandler:function(){if(!this.listeningForMenu){var $trigger=this.$el.find('.trigger');var $dropup=this.$el.find('.dropup');$dropup.on('show.bs.dropdown',function(){$trigger.addClass('active');});$dropup.on('hide.bs.dropdown',function(){$trigger.removeClass('active');});var $dropdown=this.$el.find('.dropdown');$dropdown.on('show.bs.dropdown',function(){$trigger.addClass('active');$trigger.closest('.prezi-card-item').addClass('prezi-card-selected');});$dropdown.on('hide.bs.dropdown',function(){$trigger.removeClass('active');$trigger.closest('.prezi-card-item').removeClass('prezi-card-selected');});this.listeningForMenu=true;}
this.$el.find('.card-actions-dropdown-container').show();this.$el.find('.prezi-folder-list-dropdown-container').hide();},openSharePanel:function(e){e.preventDefault();app.share.showByOid(this.model.get('id'),Site.user_id);},openMoveFolderContainer:function(e){e.stopPropagation();if(!this.preziGroupListView){this.preziGroupListView=new Groups.Views.PreziGroupListView({model:this.model,el:this.cardElement+this.model.get('id')+' .card-dropdown-container'});}
this.preziGroupListView.fetchPrezisGroup();},privacyCallback:function(message,payload){if(payload.preziOid===this.model.get('id')){this.model.set('public',payload.preziIsPublic);this.listeningForMenu=false;this.render();}},logPrivacyClicked:function(trigger){app.helpers.dashboardStructuredLog("privacy_popup","open",trigger,this.getStandardLogData(this.model));},logDropmenuItemClicked:function(action,extended_data){app.helpers.dashboardStructuredLog("prezi",action,"dropdown",$.extend({},this.getStandardLogData(this.model),extended_data));},logThumbnailItemClicked:function(action,extended_data,thumbnail_title){if(thumbnail_title===undefined){thumbnail_title=false;}
app.helpers.dashboardStructuredLog("prezi",action,thumbnail_title?"thumbnail_title":"thumbnail",$.extend({},this.getStandardLogData(this.model),extended_data));},getStandardLogData:function(prezi){return{"prezi_oid":prezi.get('id'),"prezi_ownership":prezi.get('owner_id')===parseInt(Site.user_id)?'owned':'shared',"prezi_privacy":app.helpers.getPreziPrivacy(prezi),"user_rights":app.helpers.getUserRights(prezi)};},getBackgroundLogData:function(prezi,status){var logData=this.getStandardLogData(prezi);logData['status']=status;return logData;},removeOnboarding:function(){if(Site.hideOnboardingPopup){var onboardingCard=$('.onboarding-card');if(onboardingCard){onboardingCard.removeClass('onboarding-card');var preziHover=onboardingCard.find('.prezi-hover');preziHover.removeClass("animation-auto-hover");this.model.set('has_onboarding_bubble_detail',false);this.model.set('has_onboarding_bubble_prezi',false);this.model.set('has_onboarding_tooltip',false);this.model.set('onboarding_bubble_anchor_classname',null);this.render();}}},stepForwardOnboarding:function(){if(this.$el.hasClass('onboarding-card')){Site.hideOnboardingPopup=true;this.removeOnboarding();}},});}(jQuery));;(function($){'use strict';app.NewPreziView=Backbone.View.extend({el:'#new-prezi-card-container',events:{'click .new-prezi-card-btn':'createNewPreziHandler','click .new-prezi-header-btn':'createNewPreziHandler','click .new-prezi-selection':'createNewPreziHandler','click .ppt-import-selection':'startNewPptImport'},initialize:function(){this.uuid='';this.listenTo(app.hub,'group:filtered',this.setUUID);this.listenTo(app.hub,"nongroup:filtered",function(){this.uuid=null;this.folder_name='';});this.listenTo(app.hub,'group:rename',function(folder_model){this.uuid=folder_model.get('uuid');this.folder_name=pgettext('folder name','in')+" "+folder_model.get('name');});this.render();},setUUID:function(parentView){this.uuid=parentView.collection.filter_key;},createNewPrezi:function(event){app.helpers.dashboardStructuredLog("prezi","create","button",{});app.helpers.createNewPrezi(event,this.uuid);},createNewPreziHandler:function(event){window.glassboxLogger.logCreateNewPresentation();this.createNewPrezi(event);},startNewPptImport:function(){window.glassboxLogger.logCreateNewPresentationFromPpt();window.open('/p/create-prezi/?import_ppt','_blank');},render:function(){var isDeviceHandheld=['mobile','tablet'].indexOf(window.userAgentParser.getDevice().type)!==-1;var shouldRender=Site.preziCreationEnabled&&!isDeviceHandheld&&!(Site.hasAirDashboard&&Site.isPitchViewActive);if(shouldRender){var template_name='#t-new-prezi-card';var template=$(template_name)[0].innerHTML;var html=Mustache.render(template,{is_ppt_import_enabled:Site.isPptImportEnabled});this.$el.html(html);}}});}(jQuery));;(function($){'use strict';app.PreziListView=Backbone.View.extend({el:'#body-content',initialize:function(){app.helpers.dashboardStructuredLog('dashboard','goto','machine',{'product_type':Site.productType,});this.$mobileToDesktopOverlayButton=$('#mobile-to-desktop-overlay-open');this.$presentations=this.$el.find('#presentations');this.$spinner=$('#prezilist_spinner');this.$pager=$('.pager');this.$presentationList=$('#presentation-list');this.emptyFeedbackView=app.emptyFeedbackView;this.preziCardSubscriptions={};this.collection=app.Prezis;this.collection.on('sync',this.render,this);this.modalsView=app.modalsView;this.on('click:submitNewPrezi',this.submitNewPrezi,this);this.on('keyup:liveSearch',this.liveSearch,this);this.on('submit:buttonSearch',this.buttonSearch,this);this.on('updateresults',this.updateResults);this.listenTo(app.hub,'group:new',this.emptyPreziList);this.listenTo(app.hub,'group:moveprezi',this.refreshGroupPrezis);this.listenTo(this.model,'change:messages.templates',this.renderPreziTemplateCards);this.listenTo(this.model,'fetch_success',this.showModals);this.firstRender=true;PubSub.subscribe('refreshPreziList',this.refresh.bind(this));window.addEventListener("hashchange",this.refresh.bind(this));PubSub.subscribe('groups.loaded',this.updateUiOnFoldersLoaded.bind(this));PubSub.subscribe('duplicatePreziSuccess',this.publishFilterPresentations.bind(this));PubSub.subscribe('react.search',this.reactSearchPresentations.bind(this));PubSub.subscribe('react.clearSearch',this.handleClearSearch.bind(this));if(Site.defaultDashboard==='presentation'||Site.productType===Site.PRODUCT_TYPE_CORE){this.refresh();}
$('.search-form').submit(function(){return false;});if(Site.productType===Site.PRODUCT_TYPE_CORE){window.glassboxLogger.logLoadedDashboard();}},hidePresentationList:function(){this.$presentationList.hide();},reactSearchPresentations:function(message,data){if('term'in data){data.term?this.handleSearch(data.term,0):this.handleClearSearch();}},showModals:function(){if(!this.model.shouldShowMessage('dashboard-segmentation')){this.model.showStartingModal();}},showSpinner:function(){this.$spinner.show();},hideSpinner:function(){this.$spinner.hide();},emptyPreziList:function(){this.$presentations.find('.prezi-card-item').remove();$('#search_container').hide();$('.pager').hide();$('.new-prezi').addClass('hidden');},error:function(title,body){$(this.el).html($('<h2>').text(title).after(body));},hasUserViewPermission:function(preziOid,userId,userHasPermissionCallback,errorCallback){var prezi_permissions_url=Site.PRESENTATION_API_V4_ENDPOINT+preziOid+'/permissions/'+userId;$.get(prezi_permissions_url).done(function(data){if(data&&data.is_viewer===true){userHasPermissionCallback();}else{errorCallback()}}).fail(errorCallback);},fetchPreziMetaData:function(preziOid,openDetailViewCallback,errorCallback){var preziModel=new app.PreziModel({id:preziOid,});preziModel.fetch({data:{include_permissions:1},success:function(data){if(data.attributes){openDetailViewCallback(data);}else{errorCallback();}},error:function(){errorCallback();},});},onFetchSuccess:function(){this.trigger('updateresults');},onFetchError:function(){this.error(gettext('Something went wrong'),$('<p>').text(gettext("We failed to load your prezis list. Don't worry, all your presentations are still here!")).after($('<p>').html(gettext("Try reloading the page or ")).append($('<a>').attr('href','/support/ticket/?source=your_prezilist_error').text(gettext('contact us'))).append(gettext(' if the problem persists.'))));},getCollectionFetchOptions:function(){return{success:this.onFetchSuccess.bind(this),error:this.onFetchError.bind(this)}},refresh:function(){this.showSpinner();if(this.firstRender){this.hidePreziList();}
this.collection.fetch(this.getCollectionFetchOptions());},refreshGroupPrezis:function(uuid){if(uuid===this.collection.filter_key){this.fetchCollection();}},updateUiOnFoldersLoaded:function(message,data){if(this.collection.filter_by=='group'){var linkedFolderUuid=this.collection.filter_key;if(data.group_uuid_list.indexOf(linkedFolderUuid)===-1){this.collection.filter_by='all';this.collection.filter_key=null;this.collection.search_query="";app.historyManager.clearNavigation();this.refresh();}else{app.hub.trigger("group:filtered",this);}}},handleExpiredLicense:function(){$.track.url('/my/license_expired/');var handleExpiredSULModal=function(that){if(Site.productType===Site.PRODUCT_TYPE_PITCH){if(Site.isReferralLicense)
{that.modalsView.showExpiredReferralPitchTrialModal();}
else
{window.glassboxLogger.logEnteredAbTestExperience({ab_test_name:'gm-abtest-strict-trial-expiration-pop-up',})
if(Site.isStrictTrialExpirationPopUpEnabled){that.modalsView.showExpiredPitchStrictModal();}else{that.modalsView.showExpiredPitchModal();}}}else{that.modalsView.showExpiredModal();}};var handleExpiredMULModal=function(that){var isGroupAdmin=that.license_data.is_group_admin;if(Site.productType===Site.PRODUCT_TYPE_PITCH){if(isGroupAdmin){that.modalsView.showExpiredTrialPBAdminModal(that.license_data);}
else{that.modalsView.showExpiredTrialPBMemberModal(that.license_data);}}
else{if(isGroupAdmin){that.modalsView.showExpiredAdminModal(that.license_data);}
else{that.modalsView.showExpiredMemberModal(that.license_data);}}};if(Site.hasTrialLicense){this.modalsView.showExpiredTrialModal();}
else{var that=this;var error=function(jqXHR,testStatus,errorThrown){$.cookie('group_license_ajax_error','url: '+this.url+', errorThrown: '+errorThrown);that.modalsView.showExpiredErrorModal();$.log('Error loading group license info');};var success=function(response){that.license_data=$.parseJSON(response);if(!that.license_data.group_id){handleExpiredSULModal(that)}
else{handleExpiredMULModal(that)}};this.getLicenseData(error,success);}},isStickyHeaderDisabled:function()
{return Site.isStickyHeaderDisabled===true;},render:function(e){this.hideSpinner();var that=this;var realPrezis;this.$presentations.find('.prezi-card-item').remove();this.showPreziList();this.oid_list=[];_.each(this.collection.models,function(item){that.renderPreziCard(item);that.oid_list.push(item.id);},this);this.renderPreziTemplateCards();that.updateCounter();this.firstRender=false;$('html, body').animate({scrollTop:0},600);realPrezis=this.collection.models.filter(function(prezi){return!prezi.attributes.is_onboarding_prezi;});if(realPrezis.length===0){this.$mobileToDesktopOverlayButton.show();this.showMobileToDesktopOverlay();}
$.ajax({url:Site.GROUP_API_ENDPOINT+'/prezi/groups/'+that.oid_list.join(';')+'/',async:true,context:this,cache:false,dataType:'json',xhrFields:{withCredentials:true},headers:{'x-csrftoken':$.cookie('csrftoken')},error:function(xhr,status){$.log(['get_groups','ERROR',xhr.status,xhr.statusText].join(' '));},success:function(data){app.hub.trigger('group:detailsLoaded',this);for(var prezi_oid in data){that.collection.get(prezi_oid).set('groups',data[prezi_oid]);that.renderPreziCard(that.collection.get(prezi_oid));}}});},renderPreziCard:function(item){var that=this;var templateElement='#prezi_card';var cardElement='#prezi-';if(Site.isPitch&&parseInt(item.get('schema_version'))>1){templateElement='#business_prezi_card';cardElement="#business-prezi-";}
var $preziCardDOMElement=this.$presentations.find(cardElement+item.id);if(!Site.hideOnboardingPopup){item.set('show_prezi_next',Site.isSulTestEnabled);}
var ownerId=item.get('owner_id');if(ownerId===Site.onboardingOwnerId){item.set('is_onboarding_prezi',true);}
if(this.isBubbleOnboarding(ownerId)){item.set('has_onboarding_tooltip',true);if(!Site.hideOnboardingPopup){item.set('has_onboarding_bubble_prezi',true);}}
var preziCard=new app.PreziCard({model:item,templateElement:templateElement,cardElement:cardElement,listView:this,preziCardSubscriptions:this.preziCardSubscriptions}),hasDestroyHandler="hasRefreshViewOnDestroyHandler";if(!item[hasDestroyHandler]){item.on('destroyed',this.refresh,this);item[hasDestroyHandler]=true;}
if($preziCardDOMElement.length>0){$preziCardDOMElement.parent("div").replaceWith(preziCard.render().el);}
else{this.$presentations.append(preziCard.render().el);}
$('[data-toggle="tooltip"]').tooltip({container:'.prezi-list'});if(this.isBubbleOnboarding(ownerId)){app.helpers.repositionOnboardingTooltip(preziCard);$(window).resize(function(){app.helpers.repositionOnboardingTooltip(preziCard);});}},renderPreziTemplateCards:function(){if(!Site.isNonDesktopView&&this.collection.isOnLastPage&&!Site.YOUR_TEMPLATES_EMERGENCY_DISABLE&&this.collection.filter_by=="all"&&!this.collection.search_query&&!Site.isPitch){var templates=this.model.get("messages.templates");_.each(templates,function(item){this.renderPreziTemplateCard(item);},this);}},renderPreziTemplateCard:function(item){var template=$('#prezi_template_card')[0].innerHTML;var $el=$('<div class="prezi-card-item padded-card-container col-xs-12 col-md-4 col-sm-6"></div>');var id='prezi-template-'+item.oid;$el.html(Mustache.render(template,{'id':id,'title':item.title,'thumb_url':item.thumb_url,'landing_url':'/instant-reuse/'+item.oid+'/'}));this.$presentations.append($el);},events:{'submit #search_form':'buttonSearch','submit .form-new-prezi':'submitNewPrezi','keyup #livesearch':'liveSearch','click #clear-search':'clearSearch','change select#filter':'setFilter','click #new_prezi_modal_save':'submitNewPrezi','click .panel-list .panel-item':'setFilter','click .folders-list .folder:not(#sb_new_group), .all-prezis':'setFilter','click .link_to_landing_page':'openPrezi','touchstart .link_to_landing_page':'saveScreenOffset','touchend .link_to_landing_page':'openPreziOniOS','click .card-edit-button':'quickEditPrezi','touchstart .mobile-share':'saveScreenOffset','touchend .mobile-share':'quickSharePreziOniOS','updateresults':'updateResults','click .all-prezis .menu-item':"closeDetailView",'click #mobile-to-desktop-overlay-open':"showMobileToDesktopOverlay"},sharedWithYouClicked:function(){return this.collection.filter_key==='shared';},openHref:function(e){if(e.currentTarget.attributes['data-href']){window.open(e.currentTarget.attributes['data-href'].value,'_blank');}},saveScreenOffset:function(){this.storedOffset=window.pageYOffset||document.documentElement.scrollTop;},isTouchEventOniOS:function(){var currentOffset=window.pageYOffset||document.documentElement.scrollTop;return window.userAgentParser.getOS().name==='iOS'&&this.storedOffset&&this.storedOffset===currentOffset;},openPreziOniOS:function(e){if(this.isTouchEventOniOS()){this.openPrezi(e);}},openPrezi:function(e){if(this.sharedWithYouClicked()){var oid=e.currentTarget.attributes['data-targetoid'].value;$.log('your openPrezi shared_with_you '+oid);}
this.openHref(e);},quickEditPrezi:function(e){if(!e.currentTarget.attributes['data-href']){return;}
var hrefUrl=e.currentTarget.attributes['data-href'].value;if(app.helpers.shouldShowSafariLimitedExperienceModal()){app.modalsView.showSafariLimitedExperienceModal(hrefUrl);app.helpers.dashboardStructuredLog("safari_limited_experience_modal","show","click_on_edit");return;}
if(this.sharedWithYouClicked()){$.log('your quickEditPrezi shared_with_you '+hrefUrl.substring(1,13));}
this.openHref(e);},buttonSearch:function(e){this.liveSearch(e);e.preventDefault();},fetchTimer:null,fetchCollection:function(timeout){this.showSpinner();this.hidePreziList();var that=this;if(!timeout){timeout=0;}
if(this.fetchTimer){window.clearTimeout(this.fetchTimer);this.fetchTimer=null;}
this.fetchTimer=window.setTimeout(function(){if(!that.collection.isInitialized){that.collection.fetch(that.getCollectionFetchOptions());}else{that.collection.setPage(0,that.getCollectionFetchOptions());}},timeout);},closeDetailView:function(){PubSub.publish("closeDetailView",{callback:this.showPreziList.bind(this),});},showPreziList:function(){this.$presentations.show();this.renderNewPreziButtons();},hidePreziList:function(){this.$presentations.hide();},renderNewPreziButtons:function(){if(this.collection.totalCount===0&&this.collection.filter_by=='group'){this.hideNewPreziCard();this.showEmptyFolderNewPreziCard();}else{this.hideEmptyFolderNewPreziCard();this.showNewPreziCard();}},hideNewPreziCard:function(){$('.new-prezi').addClass('hidden');},showNewPreziCard:function(){$('.new-prezi').removeClass('hidden');},showEmptyFolderNewPreziCard:function(){$('.empty-folder-new-prezi-btn').removeClass('hidden');$('.empty-own-new-prezi-btn').removeClass('hidden');},hideEmptyFolderNewPreziCard:function(){$('.empty-folder-new-prezi-btn').addClass('hidden');$('.empty-own-new-prezi-btn').addClass('hidden');},showResultCount:function(){var counterStr=ngettext("%(total_count)s result","%(total_count)s results",this.collection.totalCount);counterStr=interpolate(counterStr,{"total_count":this.collection.totalCount},true);$('#result-count').show().text(counterStr);},hidePager:function(){this.$pager.hide();},showPager:function(){this.$pager.show();},updateResults:function(){var count=this.collection.totalCount,filter=this.collection.filter_by,query=this.collection.search_query,uuid=this.collection.filter_key;this.emptyFeedbackView.render(filter,count,query,uuid);if(!count||count<=10||filter=='group'){this.hidePager();}else{this.showPager();}
if(filter==='group'){app.hub.trigger("group:filtered",this);window.glassboxLogger.logLoadedFolder({folder_uid:uuid});}else{app.hub.trigger("nongroup:filtered",this,filter);}},clearSearch:function(e){this.handleClearSearch();},handleClearSearch:function(){this.collection.search_query='';this.fetchCollection();},liveSearch:function(e){var searchQuery,timeout=(e.type==='submit')?0:500;searchQuery=$('#livesearch').val();this.handleSearch(searchQuery,timeout);},handleSearch:function(searchQuery,timeout){if(searchQuery===this.collection.search_query){return;}
this.collection.filter_by='all';this.collection.search_query=searchQuery;this.fetchCollection(timeout);window.glassboxLogger.logSearchPresentation();this.publishFilterPresentations();},setFilter:function(e){e.stopPropagation();var elem='a.menu-item';var $filter=$(e.currentTarget).find(elem);if(!$filter){$filter=$(e.currentTarget).closest(elem);}
this.collection.search_query="";this.collection.filter_by=$filter.data("filter");this.collection.filter_key=$filter.data("filter-key");this.collection.folder_name=$filter.data("text");this.collection.filter_el=$filter;$.log('your filter_set '+this.collection.filter_by);if(this.collection.filter_key){window.glassboxLogger.logOpenFolder({folder_uid:this.collection.filter_key});}
if(this.collection.filter_el&&this.collection.filter_el[0].className==='menu-item folder-item-container'&&this.collection.filter_by!=='group'){window.glassboxLogger.logFilterPresentations({presentation_filter:app.helpers.mapFilterNameToLogString(this.collection.filter_by)});}
this.publishFilterPresentations();this.filterPreziList();},publishFilterPresentations:function(){PubSub.publish('backbone.filterPresentations',{filterBy:this.collection.filter_by==='group'?'folder':'ownership',filterValue:this.collection.filter_by==='group'?this.collection.filter_key:this.collection.filter_by,filteredContent:Site.defaultDashboard});},filterPreziList:function(){this.updateHashForFilter();this.fetchCollection();},updateHashForFilter:function(){if(this.collection.filter_by==='group'){app.historyManager.replaceHistoryState('folder/'+this.collection.filter_key,this.collection.folder_name);}else if(this.collection.filter_by==='all'){app.historyManager.clearNavigation();}else if(this.collection.filter_by==='own'){app.historyManager.replaceHistoryState('own',gettext("Created by me"));}else if(this.collection.filter_by==='shared'){app.historyManager.replaceHistoryState('shared',gettext("Shared with me"));}},getLicenseData:function(error,success){$.ajax({url:'/api/group_license_data/',type:'GET',async:true,cache:false,timeout:5000,error:error,success:success});},updateCounter:function(){if(this.collection.filter_by==="all"){$.log('your total_prezi_count '+this.collection.totalCount);}
if(this.collection.filter_el){this.collection.filter_el.find('.item-info').text(this.collection.totalCount);}
else{$('.all-prezis .item-info').text(this.collection.totalCount);}},isBubbleOnboarding:function(ownerId){return Site.isDashboardBubbleOnboardingEnabled&&ownerId===Site.onboardingOwnerId&&!Site.hideOnboardingPopup;},showMobileToDesktopOverlay:function(){PubSub.publish('backbone.showMobileToDesktopOverlay');}});app.ClassicToNextTooltip=Backbone.View.extend({el:".classic-to-next-tooltip",events:{'click .classic-to-next-tooltip-close':'dismiss',},timeIntervalMs:5*24*60*60*1000,initialize:function(){var then=this.getLastSeenTimestamp();if(!then||new Date()-then>this.timeIntervalMs){this.$el.show();}},dismiss:function(){this.setLastSeenTimestamp(new Date());this.$el.fadeOut();},getLastSeenTimestamp:function(){return new Date(window.localStorage.getItem('classicToNextTooltipTimestamp'));},setLastSeenTimestamp:function(){window.localStorage.setItem('classicToNextTooltipTimestamp',new Date())},});}(jQuery));;(function($){'use strict';app.PreziPagerView=Backbone.View.extend({el:'.pager',template:$('#pager-template')[0].innerHTML,events:{'click .page':'paginate'},initialize:function(){this.collection=app.Prezis;this.collection.on('sync',this.render,this);},render:function(){var currentPage=this.collection.pagingConfig.page;var allPages=this.collection.pageCount;var pagesToShow=6;var mediumPosition=4;if(currentPage<=4){pagesToShow=currentPage+3;mediumPosition=currentPage+1;}
var pageStart=currentPage-mediumPosition+1;var pageEnd=currentPage+(pagesToShow-mediumPosition);if(pageStart<0){pageStart=0;pageEnd=Math.min(pagesToShow-1,allPages-1);}
if(pageEnd>=allPages){pageEnd=allPages-1;pageStart=Math.max(0,allPages-pagesToShow-1);}
var pages=[];for(var i=pageStart;i<=pageEnd;i++){pages.push({'index':i,'name':(i+1),'active':i==currentPage});}
var onFirstPage=currentPage==0;var onLastPage=currentPage==this.collection.pageCount-1;var showDotsAtStart=pageStart>1;var showDotsAtEnd=pageEnd<allPages-2;this.$el.html(Mustache.render(this.template,{'onFirstPage':onFirstPage,'onLastPage':onLastPage,'showDotsAtStart':showDotsAtStart,'showDotsAtEnd':showDotsAtEnd,'pages':pages}));},paginate:function(e){var el=e.currentTarget,action=el.id;e.preventDefault();if(action==='pager_previous'){this.collection.previousPage();}else if(action==='pager_next'){this.collection.nextPage();}else{this.collection.setPage($(el).data('page'));}}});}(jQuery));;(function($){'use strict';app.SupportDropdownView=Backbone.View.extend({el:"#support-dropdown-button",supportDropdownTemplate:$('#support-dropdown-template')[0].innerHTML,events:{'click #support-chat-btn':'openChat','submit form':'submitSearch'},initialize:function(){if(typeof olark!=='undefined'){var view=this;olark('api.chat.onOperatorsAvailable',function(){view.handleOperatorsOnline();});olark('api.chat.onOperatorsAway',function(){view.handleOperatorsOffline();});}
this.render(false);if(Site.shouldOpenSupportPopup){$('#support-popover-button-actual').dropdown('toggle');}},handleOperatorsOffline:function(){this.$el.find('.support-dropdown-container').remove();this.render(false);},handleOperatorsOnline:function(){this.$el.find('.support-dropdown-container').remove();this.render(true);},render:function(chatAvailable){this.$el.append(Mustache.render(this.supportDropdownTemplate,{chatAvailable:chatAvailable}));},openChat:function(){olark('api.box.show');olark('api.box.expand');$.log('supportchat dashboard');},submitSearch:function(e){e.preventDefault();var query=$('#support-search-form').find('input[name=q]').val(),encoded_query=encodeURIComponent(query);window.open('https://prezi.com/support/search/?q='+encoded_query,'_blank');}});}(jQuery));_.extend(app.SupportDropdownView.prototype,DestroyViewMixin);;(function($){'use strict';app.ContentHeaderView=Backbone.View.extend({buttonId:'#classic-to-next-button',events:{'click #classic-to-next-button':'sendMessage'},sendMessage:function(event){event.preventDefault();$.post('/api/v1/personalization/message_read/',{'name':'c2n-classic-dashboard-message'},function(){window.location.href=event.target.href;});},});app.DeletePreziModalView=app.ModalView.extend({el:'#body-content',events:{'click .delete-prezi-modal .btn-delete':'deletePrezi','click .delete-prezi-modal .btn-cancel':'cancelPreziDeleting'},showModal:function(prezi){this.prezi=prezi;if(!this.elDeletePreziModal){var html=Mustache.render($('#delete-prezi')[0].innerHTML,{});this.elDeletePreziModal=this.$el.append(html).find('.delete-prezi-modal');}
this.elDeletePreziModal.modal('show');},deletePrezi:function(){app.helpers.dashboardStructuredLog("delete_dialog","confirm","button",{"prezi_oid":this.prezi.get('id'),"prezi_ownership":this.prezi.get('owner_id')===parseInt(Site.user_id)?'owned':'shared',"prezi_privacy":app.helpers.getPreziPrivacy(this.prezi),"user_rights":app.helpers.getUserRights(this.prezi)});this.elDeletePreziModal.modal('hide');this.prezi.destroy();PubSub.publish('detailedView.close');},cancelPreziDeleting:function(){app.helpers.dashboardStructuredLog("delete_dialog","cancel","button",{"prezi_oid":this.prezi.get('id'),"prezi_ownership":this.prezi.get('owner_id')===parseInt(Site.user_id)?'owned':'shared',"prezi_privacy":app.helpers.getPreziPrivacy(this.prezi),"user_rights":app.helpers.getUserRights(this.prezi)});}});app.DesktopOnlyFeatureModalView=app.ModalView.extend({el:'#body-content',events:{'click .desktop-only-feature-modal .btn-desktop-only-download':'downloadDesktopApp'},showModal:function(modalType){var context={};var defaultBodyText=gettext("The desktop app gives you access to an arsenal of powerful presentation tools, including presentation download, offline presenting, presenter view, and more.");if(modalType==='presenterView'){context.headerText=gettext("Presenter view is available in the Prezi Next desktop app");context.bodyText=defaultBodyText;context.headerIcon="presenter-view"}else if(modalType==='downloadPresentation'){context.headerText=gettext("Downloading a presentation is available in the Prezi Next desktop app");context.bodyText=defaultBodyText;context.headerIcon="presenter-view"}else if(modalType==='remoteClicker'){context.headerText=gettext("The Prezi Remote is available in the Prezi Next desktop app");context.bodyText=defaultBodyText;context.headerIcon="presenter-view"}
if(this.elDesktopOnlyFeatureModal){this.elDesktopOnlyFeatureModal.remove();}
var html=Mustache.render($('#desktop-only-feature')[0].innerHTML,context);this.elDesktopOnlyFeatureModal=this.$el.append(html).find('.desktop-only-feature-modal');this.elDesktopOnlyFeatureModal.modal('show');},downloadDesktopApp:function(){this.elDesktopOnlyFeatureModal.modal('hide');window.open('/download/next/','_blank');}});app.UnsupportedBrowserModalView=app.ModalView.extend({el:'#body-content',events:{'click .unsupported-browser-modal .learn-more':'clickedLearnMore','click .unsupported-browser-modal .upgrade-licence':'clickedUpgradeLicence','click .unsupported-browser-modal .download-desktop':'clickedDownloadDesktopApp'},showModal:function(prezi){this.prezi=prezi;if(!this.elUnsupportedBrowserModal){var html=Mustache.render($('#unsupported-browser')[0].innerHTML,{isPitchDesktopEnabled:Site.isPitchDesktopEnabled,osTypeString:app.helpers.getOsTypeString()});this.elUnsupportedBrowserModal=this.$el.append(html).find('.unsupported-browser-modal');}
this.elUnsupportedBrowserModal.modal('show');},clickedLearnMore:function(){app.helpers.dashboardStructuredLog("prezi","learn_more","unsupported_browser_popup_v2");},clickedUpgradeLicence:function(){app.helpers.dashboardStructuredLog("prezi","upgrade_licence","unsupported_browser_popup_v2");},clickedDownloadDesktopApp:function(){app.helpers.dashboardStructuredLog("prezi","download_desktop_app","unsupported_browser_popup_v2");}});app.SafariLimitedExperienceModalView=Backbone.View.extend({el:'#body-content',showModal:function(url){var html=Mustache.render($('#safari-limited-experience')[0].innerHTML,{continueUrl:url});this.$el.find('.safari-limited-experience-modal').remove();var elSafariLimitedExperienceModal=this.$el.append(html).find('.safari-limited-experience-modal');elSafariLimitedExperienceModal.modal('show');}});app.RequestBrowserNotificationPermissionModalView=app.ModalView.extend({el:'#body-content',events:{'click .request-permission-modal .btn-request-permission-granted':'onPermissionGranted','click .request-permission-modal .btn-request-permission-denied':'onPermissionDenied','click .request-permission-modal .modal-header .close':'onPermissionDenied'},showModal:function(onPermissionGranted,onPermissionDenied){if(!this.elRequestPermissionModal){var html=Mustache.render($('#request-permission')[0].innerHTML,{});this.elRequestPermissionModal=this.$el.append(html).find('.request-permission-modal');}
this.elRequestPermissionModal.onPermissionGranted=onPermissionGranted;this.elRequestPermissionModal.onPermissionDenied=onPermissionDenied;this.elRequestPermissionModal.modal('show');},onPermissionGranted:function(){this.elRequestPermissionModal.onPermissionGranted();this.elRequestPermissionModal.modal('hide');},onPermissionDenied:function(){this.elRequestPermissionModal.onPermissionDenied();this.elRequestPermissionModal.modal('hide');}});app.CopyInProgressModalView=app.ModalView.extend({el:'#body-content',events:{'click .copy-in-progress-modal .btn-close':'onCloseModal','click .copy-in-progress-modal .modal-header .close':'onCloseModal'},showModal:function(preziTitle,onCloseCallback){if(!this.elCopyInProgressModal){var html=Mustache.render($('#copy-in-progress')[0].innerHTML,{preziTitle:preziTitle,});this.elCopyInProgressModal=this.$el.append(html).find('.copy-in-progress-modal');}
this.onCloseCallback=onCloseCallback;this.elCopyInProgressModal.modal('show');},hideModal:function(){this.elCopyInProgressModal.modal('hide');},showErrorMessage:function(){this.isError=true;this.elCopyInProgressModal.find('.error-container').show();this.elCopyInProgressModal.find('.close-button').show();this.elCopyInProgressModal.find('.spinner-container').hide();},onCloseModal:function(){this.elCopyInProgressModal.modal('hide');this.onCloseCallback&&this.onCloseCallback();},});app.PreziModalsView=Backbone.View.extend({el:'#body-content',initialize:function(){this.shareModal=null;},showShareModal:function(){if(!this.shareModal){this.shareModal=new Share.Views.ModalView({model:Share.Models.presentation});}else{this.shareModal.model=Share.Models.presentation;}
this.shareModal.handleShareClick();},showExpiredModal:function(){var expiredModal=new app.ExpiredModal();if(!this.elExpiredModal){this.elExpiredModal=$(expiredModal.render().el).appendTo(this.$el).find('.expired-modal');}
$.log('expired_modal shown');this.elExpiredModal.modal();},showExpiredErrorModal:function(){var errorModal=new app.ExpiredErrorModal();if(!this.elExpiredErrorModal){this.elExpiredErrorModal=$(errorModal.render().el).appendTo(this.$el).find('.expired-error-modal');}
this.elExpiredErrorModal.modal();},showExpiredMemberModal:function(license_data){var expiredModal=new app.ExpiredMemberModal();if(!this.elExpiredModal){this.elExpiredModal=$(expiredModal.render(license_data).el).appendTo(this.$el).find('.expired-member-modal');}
$.log('expired_member_modal shown');this.elExpiredModal.modal();},showExpiredAdminModal:function(license_data){var expiredModal=new app.ExpiredAdminModal();if(!this.elExpiredModal){this.elExpiredModal=$(expiredModal.render(license_data).el).appendTo(this.$el).find('.expired-admin-modal');}
$.log('expired_admin_modal shown');this.elExpiredModal.modal();},showExpiredTrialModal:function(){var expiredTrialModal=new app.ExpiredTrialModal();if(!this.elExpiredTrialModal){this.elExpiredTrialModal=$(expiredTrialModal.render().el).appendTo(this.$el).find('.expired-trial-modal');}
this.elExpiredTrialModal.modal();},showExpiredPitchModal:function(){var expiredPitchModal=new app.ExpiredPitchModal();if(!this.elExpiredPitchModal){this.elExpiredPitchModal=$(expiredPitchModal.render().el).appendTo(this.$el).find('.expired-pitch-modal');}
$.log('expired_pitch_modal shown');this.elExpiredPitchModal.modal();},showExpiredPitchStrictModal:function(){var expiredPitchStrictModal=new app.ExpiredPitchStrictModal();if(!this.elExpiredPitchStrictModal){this.elExpiredPitchStrictModal=$(expiredPitchStrictModal.render().el).appendTo(this.$el).find('.expired-pitch-strict-modal');}
$.log('expired_pitch_strict_modal shown');window.glassboxLogger.logLoadedExpiredLicenseModal({expired_license_modal_type:"INITIAL"});this.elExpiredPitchStrictModal.modal();var context=this;this.elExpiredPitchStrictModal.on('hide.bs.modal',function(){window.glassboxLogger.logCloseExpiredLicenseModal({expired_license_modal_type:"INITIAL"});context.showExpiredPitchStrictConfirmModal();});},showExpiredPitchStrictConfirmModal:function(){var expiredPitchStrictConfirmModal=new app.ExpiredPitchStrictConfirmModal();if(!this.elExpiredPitchStrictConfirmModal){this.elExpiredPitchStrictConfirmModal=$(expiredPitchStrictConfirmModal.render().el).appendTo(this.$el).find('.expired-pitch-strict-confirm-modal');}
$.log('expired_pitch_strict_confirm_modal shown');window.glassboxLogger.logLoadedExpiredLicenseModal({expired_license_modal_type:"DOWNGARDE_CONFIRMATION"});this.elExpiredPitchStrictConfirmModal.modal();this.elExpiredPitchStrictConfirmModal.on('hide.bs.modal',function(){window.glassboxLogger.logCloseExpiredLicenseModal({expired_license_modal_type:"DOWNGARDE_CONFIRMATION"});$.post('/api/v1/licenseprovisioning/downgrade/next/',function(response){window.location.href=response.redirect_url;});});},showExpiredPitchUpdatePaymentMethodModal:function(){var expiredPitcUpdatePaymentMethodModal=new app.ExpiredPitchUpdatePaymentMethodModal();if(!this.elExpiredPitcUpdatePaymentMethodModal){this.elExpiredPitcUpdatePaymentMethodModal=$(expiredPitcUpdatePaymentMethodModal.render().el).appendTo(this.$el).find('.expired-pitch-update-payment-method-modal');}
$.log('expired_pitch_update_payment_method_modal shown');this.elExpiredPitcUpdatePaymentMethodModal.modal();},showExpiredReferralPitchTrialModal:function(){var expiredReferralPitchTrialModal=new app.ExpiredReferralPitchTrialModal();if(!this.elExpiredReferralPitchTrialModal){this.elExpiredReferralPitchTrialModal=$(expiredReferralPitchTrialModal.render().el).appendTo(this.$el).find('.expired-referral-pitch-trial-modal');}
$.log('expired_referral_pitch_trial_modal shown');this.elExpiredReferralPitchTrialModal.modal();},showExpiredTrialPBAdminModal:function(licence_data){var expiredTrialPBAdminModal=new app.ExpiredTrialPBAdminModal();if(!this.elExpiredTrialPBAdminModal){this.elExpiredTrialPBAdminModal=$(expiredTrialPBAdminModal.render(licence_data).el).appendTo(this.$el).find('.expired-trial-pb-admin-modal');}
$.log('expired_trial_pb_admin_modal shown');this.elExpiredTrialPBAdminModal.modal();},showExpiredTrialPBMemberModal:function(license_data){var expiredTrialPBMemberModal=new app.ExpiredTrialPBMemberModal();if(!this.elExpiredTrialPBMemberModal){this.elExpiredTrialPBMemberModal=$(expiredTrialPBMemberModal.render(license_data).el).appendTo(this.$el).find('.expired-trial-pb-member-modal');}
$.log('expired_trial_pb_member_modal shown');this.elExpiredTrialPBMemberModal.modal();},showDeletePreziModal:function(prezi){if(!this.deletePreziModalView){this.deletePreziModalView=new app.DeletePreziModalView();}
this.deletePreziModalView.showModal(prezi);},showUnsupportedBrowserModal:function(prezi,doesShowAfterPageload){if(!this.unsupportedBrowserModalView){this.unsupportedBrowserModalView=new app.UnsupportedBrowserModalView();}
this.unsupportedBrowserModalView.showModal(prezi);if(doesShowAfterPageload){$.cookie('unsupported_browser_popup_shown',true,{path:"/",expires:365});app.helpers.dashboardStructuredLog("prezi","open_unsupported_browser_popup_v2_on_page_load","thumbnail");}},showSafariLimitedExperienceModal:function(url){if(!this.safariLimitedExperienceModalView){this.safariLimitedExperienceModalView=new app.SafariLimitedExperienceModalView();}
this.safariLimitedExperienceModalView.showModal(url);},_initDesktopOnlyFeatureModal:function(){if(!this.desktopOnlyFeatureView){this.desktopOnlyFeatureView=new app.DesktopOnlyFeatureModalView();}},showPresentationViewIsDesktopOnlyFeatureModal:function(){this._initDesktopOnlyFeatureModal();window.glassboxLogger.logLoadedDownloadAppDialog();this.desktopOnlyFeatureView.showModal('presenterView');},showDownloadPreziIsDesktopOnlyFeatureModal:function(){this._initDesktopOnlyFeatureModal();window.glassboxLogger.logLoadedDownloadAppDialog();this.desktopOnlyFeatureView.showModal('downloadPresentation');},showRemoteClickerIsDesktopOnlyFeatureModal:function(){this._initDesktopOnlyFeatureModal();window.glassboxLogger.logLoadedDownloadAppDialog();this.desktopOnlyFeatureView.showModal('remoteClicker');},showRequestNotificationPermissionModal:function(onPermissionGranted,onPermissionDenied){if(!this.requestBrowserNotificationPermissionModalView){this.requestBrowserNotificationPermissionModalView=new app.RequestBrowserNotificationPermissionModalView();}
this.requestBrowserNotificationPermissionModalView.showModal(onPermissionGranted,onPermissionDenied);},showCopyInProgressModal:function(preziTitle,onCloseCallback){if(!this.copyInProgressModalView){this.copyInProgressModalView=new app.CopyInProgressModalView();}
this.copyInProgressModalView.showModal(preziTitle,onCloseCallback);return this.copyInProgressModalView;},showClassicToNextModal:function(){if(!this.classicToNextModalView){this.classicToNextModalView=new app.ClassicToNextModal();}
this.classicToNextModalView.showModal();},});}(jQuery));;(function($){'use strict';app.EmptyFeedbackView=Backbone.View.extend({el:"#feedback",$newPreziCard:$('.new-prezi'),uuid:"",initialize:function(){this.renderedState={'all':false,'own':false,'shared':false,'folder':false,'search':false};var that=this;app.hub.on('group:new',function(folder_model){that.render('group',0,"",folder_model.get('uuid'));});},showEmptyFeedback:function(filter){if(typeof filter==='undefined'){return;}
if(!this.renderedState[filter]){this.$el.append(Mustache.render($('#empty-'+filter+'-template')[0].innerHTML,{}));this.renderedState[filter]=true;if(filter==='shared'){var $inputToCopyFrom=$('.prezi-share-link-text');var $copyButton=$('.prezi-share-link-copy-btn');$copyButton.copy_button($inputToCopyFrom,this.onCopyFeedback,this.onCopyFeedback);}else if(filter=="own"){$('.empty-own-new-prezi-btn').on('click',{uuid:this.uuid},this.newPreziEmptyFeedback);}}
if(filter==="folder"){$('.empty-folder-new-prezi-btn').off();$('.empty-folder-new-prezi-btn').on('click',{uuid:this.uuid},this.newPreziEmptyFeedback);}
$('.'+filter+'-empty-feedback').removeClass('hidden');$('.empty-'+filter+'-new-prezi-btn').removeClass('hidden');},newPreziEmptyFeedback:function(event){app.helpers.createNewPrezi(event,event.data.uuid);},onCopyFeedback:function(){var $copyFeedbackText=$('.copy-feedback-text');$copyFeedbackText.removeClass('hidden');$copyFeedbackText.css('display','block');$copyFeedbackText.fadeOut(5000,function(){$(this).addClass('hidden');});},render:function(filter,count,query,uuid){$('.feedback').addClass('hidden');this.uuid=uuid;if(!count){var feedbackType=filter;if(query===""||query===undefined){if(filter==="all"){if(!Site.isNonDesktopView){this.$newPreziCard.removeClass('hidden');return;}}else if(filter==="group"){feedbackType="folder";}}else{feedbackType="search";}
this.showEmptyFeedback(feedbackType);}else{this.$newPreziCard.removeClass('hidden');}}});}(jQuery));;(function($){'use strict';app.SegmentationModalView=app.ModalView.extend({el:'#body-content',events:{'click .segmentation-card':'selectCard','click .btn-next':'nextStep'},presentationCopyPromise:null,initialize:function(options){this.primaryCategory=null;this.pageName=options.page_name;this.segmentationMapping={'sales':'business-sales','marketing':'business-marketing','hr':'business-hr','student':'student-other','educator':'education-other','other':'other'};this.showStepTwo=Site.isTeamsUser;this.currentStepTwo=false;this.listenTo(this.model,'fetch_success',this.checkIfModalShouldBeShown);},copyPresentation:function(){this.presentationCopyPromise=app.copyPresentationController.copyPresentation(Site.presentationToCopyOid);},showOnboardingSteps:function(){app.beginOnboarding();this.$el.find('.onboarding-container').fadeIn();},triggerHotjarEventForEnglishBusinessUsers:function(segmentationAnswer){var language=$.cookie('django_language')||'en';if(language==='en'&&segmentationAnswer==='business-sales'&&typeof hj!=='undefined'){if(Site.isPayingPitchPackage){hj('trigger','question_when_presentation_is_due_for_paid');}
else{hj('trigger','question_when_presentation_is_due_for_free');}}},getOtherText:function(){return $('.other-text').val();},saveSegmentationData:function(props){var primaryText=props.primaryText;var onSuccess=props.onSuccess;var onError=props.onError;var segmentationAnswer=props.segmentName||this.segmentationMapping[primaryText];var otherText=props.otherText||"";var secondaryCategories=null;if(primaryText){var segmentationData={'segmentation_answer':segmentationAnswer,'segmentation_answer_other':otherText,'segmentation_version':'v3','segmentation_state':1};if(this.showStepTwo&&!Site.shouldShowWelcomeFlow){secondaryCategories={};var $selectedCards=this.$el.find('#card-container2 .segmentation-card.selected');$selectedCards.each(function(){var key=this.getAttribute('data-category');secondaryCategories[key]=true;});$.extend(segmentationData,{'segmentation_answer_extended':secondaryCategories});}
if(!Site.shouldShowWelcomeFlow){this.triggerHotjarEventForEnglishBusinessUsers(segmentationAnswer);}
this.model.updateSegmentationData(this.pageName,segmentationData,$.proxy(function(){if(typeof onSuccess==='function'){onSuccess();}else{window.glassboxLogger.logSubmittedSegmentationAnswer({segmentation_answer:primaryText.toUpperCase(),});}},this),$.proxy(function(){if(typeof onError==='function'){onError();}},this));}},toggleNextButtonSpinner:function(){this.$el.find('.btn-next').toggleClass('hidden disabled');this.$el.find('.btn-spinner').toggleClass('hidden disabled');},nextStep:function(){if(!this.showStepTwo||this.currentStepTwo){this.saveSegmentationData({primaryText:this.primaryCategory,otherText:this.getOtherText()});if(Site&&!Site.SEGMENTATION_REDIRECT_DISABLE){if(this.presentationCopyPromise){this.toggleNextButtonSpinner();this.presentationCopyPromise.then(function(preziCopyData){const editorUrl=app.copyPresentationController.getEditorUrl(preziCopyData.oid);Site.afterSegmentationUrl=editorUrl;this.closeModal();}.bind(this)).catch(function(reason){this.toggleNextButtonSpinner();this.$el.find('.error-message').removeClass('hidden');this.presentationCopyPromise=null;}.bind(this));}else{this.closeModal();}}
if(this.pageName==="welcome"){this.showOnboardingSteps();}
return;}
if(this.showStepTwo){this.currentStepTwo=true;this.$el.find('.btn-next').addClass('btn-disabled');this.renderStepTwoModal();}},renderStepTwoModal:function(){if(this.primaryCategory==="other"){$('.other-text-container').slideUp(200);}
$('#title-container1').fadeOut(200,function(){$('#title-container2').fadeIn(200);});$('#card-container1').fadeOut(200,function(){$('#card-container2').fadeIn(200);});},selectCard:function(e){if(!this.currentStepTwo){this.deselectCards();}
var $card=this.$(e.target).closest('.segmentation-card');if(this.currentStepTwo&&$card.hasClass('selected')){$card.removeClass('selected');$card.find('i').addClass('hidden');if(!this.$el.find('#card-container2 .segmentation-card').hasClass('selected')){this.$el.find('.btn-next').addClass('btn-disabled');}
return;}
if(this.currentStepTwo){var secondaryCategory=$card.data('category');if(secondaryCategory==="unsure"){this.deselectCards();}else if(this.$el.find('#unsure-card.segmentation-card').hasClass('selected')){this.$el.find('#unsure-card.segmentation-card').removeClass('selected');this.$el.find('#unsure-card.segmentation-card').find('i').addClass('hidden');}}else{this.primaryCategory=$card.data('category');var $textForm=$('.other-text-container');if(this.primaryCategory==="other"){$textForm.slideDown(200);}else{$textForm.slideUp(200);}}
$card.addClass('selected');$card.find('i').removeClass('hidden');this.$el.find('.btn-next').removeClass('btn-disabled');},deselectCards:function(){var $cardsToUnselect=this.$el.find('.segmentation-card.selected');$cardsToUnselect.each(function(){$(this).removeClass('selected');$(this).find('i').addClass('hidden');});},checkIfModalShouldBeShown:function(){var willRedirectToWelcome=this.model.shouldRedirectToWelcome();if(!willRedirectToWelcome&&this.model.shouldShowMessage('dashboard-segmentation')){window.glassboxLogger.logLoadedSegmentationDialog();this.showModal();}else if(this.pageName==="welcome"){this.showOnboardingSteps();}},showModal:function(){PubSub.publish("welcomeFlow.show",{reactAppId:Site.welcomeAppId,props:{userId:Site.user_id,userOid:Site.user_oid,actionAfterSegmentation:Site.actionAfterSegmentation,redirectUrlAfterSegmentation:Site.afterSegmentationUrl,afterSegmentationUrl:Site.afterSegmentationUrl,presentationToCopyOid:Site.presentationToCopyOid,hasNewSegmentation:true,startWithSegmentation:true,userFirstName:Site.currentUserFirstName,userLastName:Site.currentUserLastName,canConvertPPT:Site.canConvertPPT,canHaveBranding:Site.canHaveBranding,canDownloadDesktopApp:Site.canDownloadDesktopApp,canDownloadVideoApp:Site.canDownloadVideoApp,canBeEligibleForFreeEduPlusUpgrade:Site.canBeEligibleForFreeEduPlusUpgrade,isEduPlusUpgradeModalV2Enabled:Site.isEduPlusUpgradeModalV2Enabled,shouldShowFeaturesInEduPlusUpgradeModalV2:Site.shouldShowFeaturesInEduPlusUpgradeModalV2,canBeEligibleForFreeEduVideoPrivacyUpgrade:Site.canBeEligibleForFreeEduVideoPrivacyUpgrade,isReferralUser:Site.isReferralUser,showSurvey:Site.showSurveyInWelcomeFlow,onSaveSegmentationCallback:this.saveSegmentationData.bind(this),shouldSendWelcomeEmail:Site.needsWelcomeEmail&&Site.designWelcomeEmailsEnabled,shouldShowInfographicsGoal:Site.shouldShowInfographicsGoal,evaluatedFeatures:Site.evaluatedFeatures,openPaywall:function(feature){openPaywallPanel(feature);},}});},closeModal:function(){if(Site.afterSegmentationUrl){if(window.google_tag_manager!=null&&this.options.googleDataLayerModel.isGDLActive()){this.listenTo(this.options.googleDataLayerModel,'gdl_data_push_success gdl_data_push_error',function(){window.open(Site.afterSegmentationUrl,"_self");});}else{window.open(Site.afterSegmentationUrl,"_self");}}else{this.segmentationModalView.modal('hide');this.model.showStartingModal();}}});}(jQuery));;(function($){'use strict';app.WelcomeToDashboardModalView=app.PersonalizationModalView.extend({messageName:'modal-your-welcome-to-dashboard',modalId:'#welcome-to-dashboard',modalClass:'.welcome-to-dashboard-modal',events:{'click .welcome-to-dashboard-modal .btn-okay':'closeModal'}});}(jQuery));;$(function(){'use strict';_.mixin(_.str.exports());app.helpers.checkAuthCookieChanges(function(){window.location.reload();});app.hub=_.extend({},Backbone.Events);app.modalsView=new app.PreziModalsView();Site.disablePermissionsApp=true;app.supportDropdownView=new app.SupportDropdownView();if(typeof app.DownloadDesktopAppView==="function"){app.downloadDesktopAppView=new app.DownloadDesktopAppView({productType:Site.productType});}
app.personalizationModel=new app.PersonalizationModel({page_name:'dashboard'});app.googleDataLayerModel=new app.GoogleDataLayerModel();app.teamRoleChangeDialogRouter=new app.TeamRoleChangeDialogRouter();app.topBannerView=new app.TopBannerView({model:app.personalizationModel});app.welcomeToDashboardModalView=new app.WelcomeToDashboardModalView({model:app.personalizationModel});app.segmentationModalView=new app.SegmentationModalView({model:app.personalizationModel,googleDataLayerModel:app.googleDataLayerModel});app.emptyFeedbackView=new app.EmptyFeedbackView();var pagingConfig={itemPerPage:11};app.Prezis=new app.PreziCollection(pagingConfig);app.pager=new app.PreziPagerView();app.preziList=new app.PreziListView({model:app.personalizationModel});app.newPrezi=new app.NewPreziView({personalization_model:app.personalizationModel});app.productSelector=new app.ProductSelector({hasMultipleProducts:Site.hasMultipleProducts,isProductPitch:Site.productType===Site.PRODUCT_TYPE_PITCH,isProductCore:Site.productType===Site.PRODUCT_TYPE_CORE,hasPitchProduct:Site.isPitch,isTeam:Site.isTeamsUser,personalizationModel:app.personalizationModel});app.personalizationModel.initData();app.historyManager=new app.HistoryManager({hasClassicFilter:Site.hasClassicFilter,hasAirDashboard:Site.hasAirDashboard,});app.classicToNextTooltip=new app.ClassicToNextTooltip();app.contentHeader=new app.ContentHeaderView();app.classicToNextModal=new app.ClassicToNextModal();});;if(!window.Groups){window.Groups={};}
if(!window.Groups.Models){window.Groups.Models={};}
if(!window.Groups.Views){window.Groups.Views={};}
if(!window.Groups.Collections){window.Groups.Collections={};};Groups.Models.Folder=Backbone.Model.extend({url:Site.GROUP_API_ENDPOINT+'/group/',initialize:function(options){if(options){var trimmed_name=this.trimName(options.name,17);this.set({display_name:trimmed_name,selected:false,is_name_shortened:(trimmed_name!=options.name)});}
this.listenTo(this,'prezioperation:complete',$.proxy(this.handleFolderOperationComplete,this));if(this.get('team_folder')){var email={domain:Site.user_email.split('@')[1]},folderName=gettext('Shared with %(domain)s',{domain:email.domain}),translatedName=interpolate(folderName,email,true),trimmedName=this.trimName(translatedName,24);this.set({display_name:trimmedName});}},trimName:function(name,threshold){if(!name){return'';}
return(name.length>threshold?name.substring(0,threshold)+"...":name);},getMethodUrl:function(){return{'delete':this.url+this.get('id')+'/','create':this.url,'update':this.url+this.get('id')+'/'};},updateWithMembers:function(members){this.set('is_shared',members.length>1);},sync:function(method,model,options){var methodUrl=this.getMethodUrl(),url='',_method;options=options||{};if(methodUrl[method.toLowerCase()]){var baseUrl=methodUrl[method.toLowerCase()];_method=method.toUpperCase();url=baseUrl;if(method=='create'){url=baseUrl+'?'+$.param(model.attributes);_method='POST';}else if(method=='update'){_method='PUT';options.data={'name':this.get('name')};}
options.url=url;}
options.dataType='json';options.contentType='application/json';options.method=_method?_method:'GET';options.headers={'x-csrftoken':$.cookie('csrftoken')};options.data=options.data||{};Backbone.sync(method,model,options);},parse:function(data){data.id=data.uuid;data.display_name=this.trimName(data.name,17);if(!data.background_index){data.background_index=parseInt(data.id,16).toString().substring(0,1);}
return data;},_preziOperation:function(args){var options={prezi_oid:null,folder_uuid:this.get('uuid'),operation:null,method:null};_.extend(options,args);switch(options.operation){case'add':options.method='POST';break;case'delete':options.method='DELETE';break;default:return false;}
if(!options.prezi_oid){return false;}
$.ajax({url:Site.GROUP_API_ENDPOINT+'/group/'+this.get('uuid')+'/prezis/'+options.prezi_oid+'/',async:true,context:this,method:options.method,data:{limit:0,},headers:{'x-csrftoken':$.cookie('csrftoken')},cache:false,dataType:'json',contentType:'application/json',complete:function(xhr){if(xhr.status<300&&xhr.status>=200){if(options.callback){options.callback(options);}
this.trigger('prezioperation:complete',options);}
else{if(options.callback){var return_info={error:true,message:'AJAX error',xhr:xhr};_.extend(return_info,options);options.callback(return_info);}
options.error=true;this.trigger('prezioperation:complete',options);}}});},handleFolderOperationComplete:function(args){if(args.error){this.trigger('prezioperation:error',args);}
else{var prezi_oid=args.prezi_oid;var folder_uuid=this.get('uuid');var prezi_model=app.Prezis.get(prezi_oid);var groups=prezi_model.get('groups');if(args.operation=='add'){groups[folder_uuid]=this.toJSON();prezi_model.set('groups',groups);app.preziList.renderPreziCard(prezi_model);}
else{delete groups[folder_uuid];prezi_model.set('groups',groups);app.preziList.renderPreziCard(prezi_model);}
this.trigger('prezioperation:success',args);}},folderOperation:function(args){this._preziOperation({prezi_oid:args.prezi_oid,operation:args.operation});}});;Groups.Models.Member=Backbone.Model.extend({server_call_timeout:5000,defaults:{avatar:'//prezi.com/assets/share/static/img/face.png'},initialize:function(attributes){if(attributes.api_url_root){this.api_url_root=attributes.api_url_root;}else{this.api_url_root=Site.GROUP_API_ENDPOINT+'/group/';}},sync:function(method,model,options){var uuid=this.collection.groupModel.get('uuid');options.url=Site.GROUP_API_ENDPOINT+'/group/'+uuid+'/users/'+this.get('id')+'/';if(method=='delete'){options.method='DELETE';options.headers={'x-csrftoken':$.cookie('csrftoken')};}
options.dataType='json';options.contentType='application/json';Backbone.sync(method,model,options);}});;$(function(){Groups.current_user={id:Site.user_id};Groups.Models.sb_newgroup=new Groups.Models.Folder({});Groups.Collections.group_list=new Groups.Collections.GroupList([],{add_team_folder:false});Groups.Collections.group_list.fetch({silent:true});Groups.Views.newgroup=new Groups.Views.NewGroup({collection:Groups.Collections.group_list});Groups.Views.sb_grouplist_view=new Groups.Views.SidebarGroupList({collection:Groups.Collections.group_list,personalization_model:app.personalizationModel});Groups.Views.folder_title=new Groups.Views.TitleView({model:(new Groups.Models.Folder({})),collection:Groups.Collections.group_list,grouplist_view:Groups.Views.sb_grouplist_view});Groups.Views.folder_settings=new Groups.Views.FolderSettingsView({collection:Groups.Collections.group_list,preziList:app.preziList.collection});var analyticsMenuItem=document.querySelector('.analytics-menu-item');if(analyticsMenuItem){analyticsMenuItem.addEventListener('click',function(){window.glassboxLogger.logOpenAnalytics();});}});;Groups.Collections.GroupList=Backbone.Collection.extend({model:Groups.Models.Folder,url:function(){return Site.GROUP_API_ENDPOINT+'/group/';},initialize:function(models,options){this.add_team_folder=true;if(options!==undefined&&options.hasOwnProperty('add_team_folder')){this.add_team_folder=options.add_team_folder;}
this.listenTo(this,'sync',this.syncComplete);},sync:function(method,model,options){options.dataType='json';options.contentType='application/json';options.headers={'x-csrftoken':$.cookie('csrftoken')};Backbone.sync(method,model,options);},syncComplete:function(){PubSub.publish('groups.loaded',{group_uuid_list:this.models.map(function(group){return group.id}),});},comparator:function(model){return model.get('name').toLowerCase();},parse:function(result){return result.objects;},validate:function(new_model){var name_to_add=new_model.get('name').toLowerCase();var found_group=this.find(function(group){return(group.get('name').toLowerCase()==name_to_add);},this);if(found_group){return gettext("Folder with the same name exists.");}}});;Groups.Collections.MemberList=Backbone.Collection.extend({model:Groups.Models.Member,url:function(){var uuid=this.groupModel.get('uuid');return Site.GROUP_API_ENDPOINT+'/group/'+uuid+'/users/';},sync:function(method,model,options){options.dataType='json';options.contentType='application/json';options.headers={'x-csrftoken':$.cookie('csrftoken')};options.url=this.url();Backbone.sync(method,model,options);},initialize:function(models,options){if(typeof options!='undefined'&&'groupModel'in options){this.groupModel=options.groupModel;}},comparator:function(model){if(model.get('id')==Site.user_id){return" ";}
if(!model.get('name')){return model.get('email');}
return model.get('name').toLowerCase();},fetch_members:function(uuid){$.getJSON(Site.GROUP_API_ENDPOINT+'/group/'+uuid+'/users/',{csrftoken:$.cookie('csrftoken')}).done($.proxy(this._init_member_list,this));},_init_member_list:function(data){this.init_member_list(data,true);},init_member_list:function(data,triggerMembersLoadedEvent){var that=this;$.each(data,function(index,member){if(member.hasOwnProperty('details')){if(Site.user_id==member.details.id){member.details.name=gettext("You");Groups.current_user.group_membership_status=member.role;that.current_user_role=member.role;}
member.details.role=member.role;that.add(new Groups.Models.Member(member.details));}});if(triggerMembersLoadedEvent){this.trigger('members:loaded');}},reset:function(models,options){options=options||{};this.current_user_role=null;Backbone.Collection.prototype.reset.call(this,models,options);},isCurrentUserOwner:function(){return this.current_user_role=='OWNER';},getContactInfo:function(){var contacts=[];for(var i=0;i<this.models.length;i++){var contact=this.models[i];if(contact.get('id')!=Site.user_id){contacts.push({name:contact.get('name'),email:contact.get('email'),id:contact.get('id'),avatar:Share.helpers.filterAvatar(contact.get('avatar'))});}}
return contacts;}});;Groups.Views.SidebarGroupListItem=Backbone.View.extend({tagName:'li',className:'folder',template:$('#sb-groupitem-template-multi')[0].innerHTML,shouldShowFolderNotificationIcon:false,shouldShowJoinTeam:false,events:{'click':'readNotification'},initialize:function(){this.render();this.listenTo(this.model,'change',this.render);this.listenTo(this.options.personalization_model,'change:messages.to_show',this.handleTeamsPersonalization);},handleTeamsPersonalization:function(){if(app.personalizationModel.shouldShowMessage('notification-your-public-user-notification-icon')){this.showFolderNotification();}
if(app.personalizationModel.shouldShowMessage('notification-your-public-user-join-team')){this.joinRequestMessageSent();}},showFolderNotification:function(){if(this.model.get('team_folder')){this.$el.find('.m-notification-bubble').removeClass('hidden');}},joinRequestMessageSent:function(){if(this.model.get('team_folder')){this.$el.find('[data-filter-key="'+this.model.get('id')+'"]').data('request-sent',0);}},readNotification:function(){$.ajax({url:'/api/v1/personalization/message_read/?click_source=notification-your-public-user-notification-icon',type:'POST',datatype:'json',data:{'name':'notification-your-public-user-notification-icon'},context:this}).done(function(){this.$el.find('.m-notification-bubble').addClass('hidden');});},render:function(){var context=_.extend({isTeamFolder:this.model.get('mlgroupid')>0,groupId:this.model.get('mlgroupid')},this.model.toJSON());if(this.model.get('prezi_count')!=undefined){context=_.extend({preziCount:parseInt(this.model.get('prezi_count'))},context);}
this.$el.html(Mustache.render(this.template,context));return this;}});;Groups.Views.SidebarGroupList=Backbone.View.extend({el:"#body-content",foldersErrorTemplate:$('#folders-error-template').get(0).innerHTML,dropdownTemplate:$('#multi-filter-dropdown-template').get(0).innerHTML,$selectedItem:null,events:{'click .folders-list .menu-item':function(e){this.selectItem(e);},'click .all-prezis':'selectAll','mousewheel .folders-list':'handleFoldersScrolling'},initialize:function(){this.renderTitleDropdown();this.folder_items={};this.listenTo(this.collection,'remove',$.proxy(this.handleCollectionRemove,this));this.listenTo(this.collection,'sync',$.proxy(this.handleCollectionSync,this));this.listenTo(this.collection,'add',$.proxy(this.addGroup,this));this.listenTo(this.collection,'error',$.proxy(this.handleError,this));this.listenTo(app.hub,'group:filtered',$.proxy(this.updateSideBarSelection,this));},renderTitleDropdown:function(){this.$dropdownEl=$(Mustache.render(this.dropdownTemplate,{}));},titleDropdownEl:function(){return this.$dropdownEl;},handleError:function(){var $foldersLoading=this.$el.find('#folders-loading');$foldersLoading.removeClass('hidden');$foldersLoading.empty();$foldersLoading.html(Mustache.render(this.foldersErrorTemplate));this.$('#sb_new_group').remove();},handleCollectionRemove:function(model){this.projectRemoved(model.get('uuid'),this);},handleCollectionSync:function(event_source,response,options){if(event_source==this.collection){this.render();app.hub.trigger('loaded:folders',{});}},makeItemActive:function($item){if(this.$selectedItem){this.$selectedItem.removeClass('selected');}
if($('.all-prezis').hasClass('selected')&&$item.attr('class')!=='all-prezis'){$('.all-prezis').removeClass('selected');}
$item.addClass('selected');this.$selectedItem=$item;},updateSideBarSelection:function(view){if(view.collection.filter_by==='group'){var folderElement=$('a.menu-item[data-filter-key='+view.collection.filter_key+']').closest('li.folder');this.makeItemActive(folderElement);}},selectAll:function(e){e.preventDefault();this.makeItemActive($('.all-prezis'));},selectItem:function(e){e.preventDefault();var $item=this.$(e.target).closest('li.folder');this.makeItemActive($item);},selectTeamFolder:function(){if(window.location.search.indexOf('team-folder=1')!=-1){var group_folders=$('.panel-list').find('[data-container-id]');if(group_folders.length>0){group_folders.first().click();}}},addGroup:function(group){group.set('prezi_count',0);var newGroup=new Groups.Views.SidebarGroupListItem({model:group,personalization_model:this.options.personalization_model});$newGroupEl=$(newGroup.$el);$newGroupEl.appendTo(this.$('.folders-list'));this.folder_items[group.get('uuid')]=newGroup;this.makeItemActive($newGroupEl);},projectRemoved:function(uuid,context){$(this.$el.find('[data-filter-key="'+uuid+'"]')).parent().remove();$('.all-prezis').trigger('click');delete context.folder_items[uuid];},handleFoldersScrollingInitialState:function(){var foldersList=$('.folders-list'),foldersListHeight=foldersList[0].scrollHeight,foldersListScrollBottom=foldersList.scrollTop()+foldersList.innerHeight();$(".folders .gradient-fader-bottom").toggle(foldersListScrollBottom<foldersListHeight-5);},handleFoldersScrolling:function(){var foldersList=$('.folders-list'),foldersListHeight=foldersList[0].scrollHeight,foldersListScrollTop=foldersList.scrollTop(),foldersListScrollBottom=foldersList.scrollTop()+foldersList.innerHeight();$(".folders .gradient-fader-top").toggle(foldersListScrollTop>=5);$(".folders .gradient-fader-bottom").toggle(foldersListScrollBottom<foldersListHeight-5);},render:function(){if(Site.productType===Site.PRODUCT_TYPE_PITCH){return;}
var new_folder_btn=this.$el.find('#sb_new_group'),container=document.createDocumentFragment();this.$el.find('#folders-loading').addClass('hidden');if(new_folder_btn.length>0){new_folder_btn.removeClass('hidden');this.folder_items={};this.collection.each(function(group){var item=new Groups.Views.SidebarGroupListItem({model:group,personalization_model:this.options.personalization_model});container.appendChild(item.$el.get(0));this.folder_items[group.get('uuid')]=item;},this);$(container).insertAfter(new_folder_btn);this.handleFoldersScrollingInitialState();this.selectTeamFolder();}
return this;}});_.extend(Groups.Views.SidebarGroupList.prototype,AutoTooltipMixin);;Groups.Views.NewGroup=Backbone.View.extend({el:'.sidebar .folders',events:{'click #sb_new_group':'createNewGroup'},initialize:function(){_.bindAll(this,'createGroupSuccess');PubSub.subscribe('react.createFolderSuccess',function(message,data){this.collection.add([{id:data.folderId,uuid:data.folderId,name:data.folderName,creator:Site.user_id}],{silent:true});}.bind(this));},createNewGroup:function(){var groupName=gettext('Untitled folder');var modelToCreate=new this.collection.model({name:groupName},{collection:this.collection});if(!modelToCreate.isValid()){alert(modelToCreate.validationError);}else{var createOptions={wait:true,success:this.createGroupSuccess,error:this.createGroupError};var created_group=this.collection.create(modelToCreate,createOptions);}},createGroupSuccess:function(model){var uuid=model.get('uuid');app.hub.trigger('group:new',model);app.historyManager.replaceHistoryState('folder/'+uuid,gettext('Untitled folder'));window.glassboxLogger.logCreatedNewFolder({folder_uid:uuid});$.log("folder create_folder_btn "+uuid);}});;Groups.Views.PreziGroupListView=Backbone.View.extend({emptyGroupListTemplate:$('#prezi-group-list-empty-template')[0].innerHTML,events:{"click .card-menu-move-folder-back":"toggleDropdownContents","mousewheel .prezi-folder-list":"preventOuterScrolling"},initialize:function(){this.$spinner=$(Mustache.render($('#prezi-group-list-spinner-template')[0].innerHTML));this.$folderList=this.$el.find('.prezi-folder-list');this.$cardActionsContainer=this.$el.find('.card-actions-dropdown-container');this.$folderListContainer=this.$el.find('.prezi-folder-list-dropdown-container');this.groupItemViews=[];this.setupFoldersScroll=false;},toggleDropdownContents:function(e){if(e){e.stopPropagation();}
var $itemToHide;var $itemToShow;if(this.$cardActionsContainer.is(":visible")){$itemToHide=this.$cardActionsContainer;$itemToShow=this.$folderListContainer;}else{$itemToHide=this.$folderListContainer;$itemToShow=this.$cardActionsContainer;}
$itemToHide.hide("slide",{direction:"left"},200,function(){$itemToShow.show("slide",{direction:"right"},200)});},preventOuterScrolling:function(){if(!this.setupFoldersScroll){Site.preventOuterScrolling(this.$folderList);}
this.setupFoldersScroll=true;},fetchPrezisGroup:function(){this.$folderList.html(this.$spinner);this.toggleDropdownContents();var that=this;$.ajax({url:Site.GROUP_API_ENDPOINT+'/prezi/'+that.model.get('id')+'/groups/',headers:{'x-csrftoken':$.cookie('csrftoken')},type:'GET',context:this,async:true,cache:false,contentType:'application/json',dataType:'json',success:this.handlePrezisGroupSuccess,error:function(xhr,status){$.log(['fetch_prezis_group','ERROR',xhr.status,xhr.statusText].join(' '));}});},handlePrezisGroupSuccess:function(data){var prezis_group=[];if(data.objects){$.each(data.objects,function(group){prezis_group.push(this.group_uuid);});}
if(this.groupItemViews.length>0){for(i=0;i<this.groupItemViews.length;i++){delete this.groupItemViews[i];}
this.groupItemViews.length=0;}
if(Groups.Collections.group_list.length>0){this.$folderList.empty();var that=this;Groups.Collections.group_list.each(function(group){var groupListItem=new Groups.Views.PreziGroupListItemView({prezi_model:that.model,group_model:group,is_included:$.inArray(group.get('uuid'),prezis_group)>-1?true:false});that.groupItemViews.push(groupListItem);that.$folderList.append(groupListItem.$el);});}else{this.$folderList.html(Mustache.render(this.emptyGroupListTemplate,{}));this.$folderList.find('.prezi-no-groups-container').on('click',function(){Groups.Views.newgroup.createNewGroup();});}}});;Groups.Views.PreziGroupListItemView=Backbone.View.extend({className:'check-unit prezi-folder-item',template:$('#prezi-group-list-item-template')[0].innerHTML,events:{'change input':'toggleGroup','mouseenter .marquee-inner':'addMarqueeToLong','mouseleave .marquee-inner':'removeMarqueeToLong'},initialize:function(){this.group_model=this.options.group_model;this.prezi_model=this.options.prezi_model;this.included=this.options.is_included;this.$statusText=$('#toggle-folder-status');this.render();this.$el.find('input, label').click(function(e){e.stopPropagation()});},render:function(){this.$el.html(Mustache.render(this.template,{name:this.group_model.get('name'),included:this.included,allowedToMove:this.allowedToMove(),prezi_oid:this.prezi_model.get('id'),uuid:this.group_model.get('uuid')}));},displayError:function(){var that=this;that.$statusText.removeClass('hidden');that.$statusText.slideDown(200,function(){setTimeout(function(){that.$statusText.slideUp(200,function(){that.$statusText.addClass('hidden');});},5000)});},allowedToMove:function(){return!(this.group_model.get('is_shared')&&!this.prezi_model.get('public')&&(this.prezi_model.get('edit')==="0"));},toggleGroup:function(e){var oid=this.prezi_model.get('id'),uuid=this.group_model.get('uuid'),method=this.included?'DELETE':'POST';var that=this;var logData={"prezi_oid":oid,"prezi_ownership":this.prezi_model.get('owner_id')===parseInt(Site.user_id)?'owned':'shared',"prezi_privacy":app.helpers.getPreziPrivacy(this.prezi_model),"user_rights":app.helpers.getUserRights(this.prezi_model),"folder_name":this.group_model.get('name'),"folder_uuid":this.group_model.get('uuid')};app.helpers.dashboardStructuredLog("remote_prezi",this.included?"remove_from_folder":"add_to_folder","dropdown",logData);logData["status"]="started";app.helpers.dashboardStructuredLog("remote_prezi",this.included?"remove_from_folder":"add_to_folder","machine",logData);$.ajax({url:Site.GROUP_API_ENDPOINT+'/group/'+uuid+'/prezis/'+oid+'/',async:true,context:that,method:method,data:{limit:0,},headers:{'x-csrftoken':$.cookie('csrftoken')},cache:false,dataType:'json',contentType:'application/json',complete:function(xhr,status){if(xhr.status<300&&xhr.status>=200){var groups=app.Prezis.get(oid).get('groups');if(that.included){delete groups[uuid];$.log("folder remove_prezi_from_folder "+uuid+' '+oid);app.hub.trigger('group:moveprezi',uuid);}
else{groups[uuid]={'name':that.group_model.get('name')};$.log("folder add_prezi_to_folder "+uuid+' '+oid+" no_drag");}
that.included=!that.included;app.Prezis.get(oid).set('groups',groups);logData["status"]="successful";app.helpers.dashboardStructuredLog("remote_prezi",that.included?"add_to_folder":"remove_from_folder","button",logData);}
else{that.displayError();$.log(['toggle_group','ERROR',xhr.status,xhr.statusText].join(' '));logData["status"]="failed";app.helpers.dashboardStructuredLog("remote_prezi",that.included?"remove_from_folder":"add_to_folder","button",logData);}}});},addMarqueeToLong:function(e){var $el=$(e.target);if($el.width()>150){$el.addClass("scrolling");$el.removeClass("stop");}},removeMarqueeToLong:function(e){var $el=$(e.target);if($el.width()>150){$el.removeClass("scrolling");$el.addClass("stop");}}});;Groups.Views.AddMemberInputView=Backbone.View.extend({acListItemTemplate:$('#contact-list-item-template')[0].innerHTML,el:'#add-member',events:{'click .add-member':'addMember','input input[name=user_to_add]':'inputGiven'},initialize:function(){this.members=this.options.members;this.fetch_contacts();this.$input=$('input[name=user_to_add]');this.$button=this.$el.find('.add-member');this.search_array=[];this.contact_list={};},fetch_contacts:function(){$.ajax({url:'//'+Prezi.contact_api_domain+'/contacts/',method:'GET',data:{csrftoken:$.cookie('csrftoken')}}).done($.proxy(this.initialize_autocomplete,this));},addMember:function(e){e.preventDefault();if(!this.$button.hasClass('btn-disabled')){this.setButtonState(false);var email=this.$input.val(),contact=_.find(this.plain_contact_list,function(contact){return contact.email==email;}),member=_.find(this.members.models,function(member){return member.get('email')==email;});if(member){this.feedback('error',gettext('That user is already in the member list'));window.glassboxLogger.logAddFolderCollaboratorFailed({folder_uid:this.model.get('uuid'),add_folder_collaborator_error_message:"ALREADY_A_COLLABORATOR"});this.setButtonState(true);return false;}
if(contact){this.performAddMember(contact,true);}else{if(this.validateEmail()){$.ajax({url:Site.GROUP_API_ENDPOINT+'/user/'+encodeURIComponent(email)+'/',headers:{"x-csrftoken":$.cookie('csrftoken')},method:'GET',async:true,cache:false,contentType:'application/json',success:$.proxy(this.handleUserInfoComplete,this),error:$.proxy(this.handleUserInfoNotFound,this)});}}}},performAddMember:function(contact,is_among_contacts){window.glassboxLogger.logAddFolderCollaborator({folder_uid:this.model.get('uuid')});$.ajax({url:Site.GROUP_API_ENDPOINT+'/group/'+this.model.get('uuid')+'/users/',async:true,method:'POST',data:JSON.stringify({role:'VIEWER',email:contact.email,}),headers:{"x-csrftoken":$.cookie('csrftoken')},contentType:'application/json',processData:false,dataType:'json',complete:$.proxy(this.handleMemberAddComplete,this,contact,is_among_contacts)});},handleUserInfoComplete:function(contact){if(contact){this.performAddMember(contact,false);}},handleUserInfoNotFound:function(xhr,status){window.glassboxLogger.logAddFolderCollaboratorFailed({folder_uid:this.model.get('uuid'),add_folder_collaborator_error_message:"NOT_PREZI_USER"});this.feedback('info',gettext("This person hasn't yet discovered Prezi."));},handleMemberAddComplete:function(contact,is_among_contacts,xhr,status){var uuid=this.model.get('uuid');if(xhr.status<300&&xhr.status>=200){PubSub.publish('backbone.addCollaborator');app.hub.trigger('group:member:add',contact);this.$input.val('');var contact_str='no_contact';if(is_among_contacts){contact_str='contact';}
$.log(['folder','add_member',uuid,contact.email,'user',contact_str].join(' '));this.feedback('success',gettext('E-mail sent'));this.setButtonState(false);}else{$.log(['group','add_member_error',xhr.status,xhr.statusText,uuid,contact.email].join(' '));this.feedback('error',gettext('Error adding member. Please try again later'));window.glassboxLogger.logAddFolderCollaboratorFailed({folder_uid:uuid,add_folder_collaborator_error_message:"ERROR_ADDING_MEMBER"});this.setButtonState(true);}},initialize_autocomplete:function(data){var that=this;if(data.data&&!that.search_array.length){that.plain_contact_list=data.data;$.each(data.data,function(index,contact){if(!contact.name){contact.name=contact.email;contact.email='';}
if(!contact.avatar){contact.avatar=Site.STATIC_URL+'share/dragon/img/avatar.svg';}
var key=Mustache.render(that.acListItemTemplate,contact);that.contact_list[key]=contact;that.search_array.push(key);});}
this.$input.typeahead({limit:2,source:that.search_array,updater:function(item){var selected_email=that.contact_list[item].email?that.contact_list[item].email:that.contact_list[item].name;that.setButtonState(true);return selected_email;},matcher:function(item){var contact=that.contact_list[item];for(var i=0,l=that.members.length;i<l;i++){if(that.members.models[i].get('id')==contact.id){return false;}}
var itContainsName=(contact.name.toLowerCase().indexOf(this.query.toLowerCase())!=-1),itContainsEmail=(contact.email.toLowerCase().indexOf(this.query.toLowerCase())!=-1);return(itContainsName||itContainsEmail);},highlighter:function(item){return item;}});},validateEmail:function(){var email=this.$input.val();return((email.length>=4)&&(email.indexOf('@')!=-1)&&(email.indexOf('.')!=-1));},inputGiven:function(event){this.$('#member-modal-feedback').hide();if(this.validateEmail()){this.setButtonState(true);}else{this.setButtonState(false);}},setButtonState:function(enabled){if(enabled){this.$button.removeClass("btn-disabled");this.$button.removeAttr("disabled");}else{this.$button.addClass("btn-disabled");this.$button.attr("disabled","disabled");}},feedback:function(level,message){new Groups.Notification({el:'#add-panel-status'}).show(level,message);}});_.extend(Groups.Views.AddMemberInputView.prototype,DestroyViewMixin);;Groups.Views.TitleView=Backbone.View.extend({el:'#filter-title-container',template:$('#multi-page-filter-template').get(0).innerHTML,events:{'click .page-title-for-own-folder #filter-name':'showEditor','click .page-title-for-own-folder .title-edit-icon':'showEditor','click .cancel':'cancelHandler','click .rename':'rename','keyup #title-editor-textbox':'titleEditorKeyUp'},initialize:function(){this.filterAll=false;this.filterOwn=false;this.filterShare=false;this.filterGroups=false;this.editState=false;this.listenTo(app.hub,'group:filtered',this.setTitleGroup);this.listenTo(app.hub,'nongroup:filtered',this.setTitleNonGroup);this.listenTo(this.model,'update',this.render);this.listenTo(this.model,'error',this.saveError);this.listenTo(this.collection,'add',this.handleNewGroup);this.listenTo(this.collection,'select',this.selectGroup);this.listenTo(app.hub,'group:detailsLoaded',this.setTitleGroup);},setTitleGroup:function(view){var uuid=view.collection.filter_key;this.model=this.collection.get(uuid);this.filterAll=true;this.filterOwn=false;this.filterShare=false;this.filterGroups=true;this.editState=false;$('.search').hide();if(this.model){this.render();}},setTitleNonGroup:function(view,filter_by){this.filterGroups=false;this.filterAll=filter_by=="all";this.filterOwn=filter_by=="own";this.filterShare=filter_by=="shared";$('.search').show();this.render();},selectGroup:function(group){this.editState=false;this.model=group;},handleNewGroup:function(model,collection,options){this.filterGroups=true;this.model=model;$('.search').hide();var $input=this.showEditor();$input.select();},saveError:function(model,xhr,options){var $errorMsg=this.$el.find('#error-msg-container');$errorMsg.removeClass('hidden');setTimeout(function(){$errorMsg.addClass('hidden');},3000);},showEditor:function(){$.log('folder start_rename_btn '+this.model.get('uuid'));this.editState=true;this.render();var $input=this.$el.find('input');$input.focus();$input.val($input.val());$input.select();return $input;},titleEditorKeyUp:function(event){if(event.keyCode===13){this.rename();}
if(event.keyCode===27){this.cancelHandler();}},rename:function(){$.log('folder rename_btn '+this.model.get('uuid'));var newName=this.$('input').val();this.model.save({'name':newName},{success:$.proxy(function(){window.glassboxLogger.logChangedFolderName({folder_uid:this.model.get('uuid')});PubSub.publish('backbone.changeFolderName',{folderId:this.model.get('uuid'),folderName:newName});this.render();},this)});this.editState=false;this.render();app.hub.trigger('group:rename',this.model);},cancelHandler:function(){this.editState=false;this.render();},render:function(){var templateContext={folder:this.model?this.model.toJSON():null,groups:this.filterGroups,all:this.filterAll,own:this.filterOwn,shared:this.filterShare,edit_state:this.editState,isOwnFolder:!!(this.filterGroups&&this.model&&this.model.attributes.creator==Site.user_id),};this.$el.html(Mustache.render(this.template,templateContext));this.$el.find('.title-dropdown-container').append(this.options.grouplist_view.titleDropdownEl());$('#filter-dropdown').on('show.bs.dropdown',function(){window.glassboxLogger.logOpenPresentationFilter();});return this;}});_.extend(Groups.Views.TitleView.prototype,DestroyViewMixin);;Groups.Views.PermissionsModalView=Backbone.View.extend({el:'#body-content',template:$('#folder-permissions')[0].innerHTML,initialize:function(){this.members=this.options.members;this.openModal();this.modal.on('hidden.bs.modal',$.proxy(this.removeView,this));},openModal:function(){if(!this.modal){this.modal=$(Mustache.render(this.template,{admin:Groups.current_user.group_membership_status=='OWNER',title:this.model.get('name')}));this.modal.appendTo(this.$el);}
this.modal.modal();this.initializeSubViews();},closeModal:function(){this.modal.modal('hide');},modalClosed:function(){this.trigger('permission_modal:closed');window.glassboxLogger.logCloseFolderCollaboratorsDialog({folder_uid:this.model.get('uuid')});$.log("folder manage_members_done_btn "+this.model.get('uuid'));},initializeSubViews:function(){this.removeSubViews();this.add_member_input=new Groups.Views.AddMemberInputView({model:this.model,members:this.members});this.member_list=new Groups.Views.MemberListView({model:this.model,members:this.members});},removeView:function(){this.modalClosed();this.modal.remove();this.removeSubViews();this.$el.find('.folder-permissions-modal').remove();},removeSubViews:function(){if(this.member_list){this.member_list.destroy();delete this.member_list;}
if(this.add_member_input){this.add_member_input.destroy();delete this.add_member_input;}},custom_destroy:function(){this.removeSubViews();}});_.extend(Groups.Views.PermissionsModalView.prototype,DestroyViewMixin);;Groups.Views.FolderSettingsView=Backbone.View.extend({template:$('#folders-settings-template')[0].innerHTML,el:'#folders-settings-container',events:{'click .folder-delete':'deleteFolder','click .folder-share':'handleOpenShareClick','click .additional-contacts':'handleOpenShareClick','click .invite-collaborators':'inviteCollaborators'},initialize:function(){this.$spinner=$(Mustache.render($('#folder-settings-spinner-template')[0].innerHTML));this.preziList=this.options.preziList;this.members=new Groups.Collections.MemberList();this.listenTo(app.hub,'group:filtered',this.handleGroupSelected);this.listenTo(app.hub,'nongroup:filtered',this.handleNonGroupSelected);this.listenTo(this.collection,'add',this.handleGroupAdded);this.listenTo(this.members,'members:loaded',this.handleMembersLoaded);app.hub.on('group:member:add:memberlist',$.proxy(this.newMember,this));app.hub.on('group:member:remove:memberlist',$.proxy(this.deleteMember,this));PubSub.subscribe('react.openAddCollaborators',this.reactOpenSharePanel.bind(this));PubSub.subscribe('react.folderDeselected',this.reactFolderDeselected.bind(this));this.render();},newMember:function(member){this.members.add(member);this.model.updateWithMembers(this.members);this.render();},deleteMember:function(member_id){this.members.remove(this.members.get(member_id));this.model.updateWithMembers(this.members);if(member_id==Site.user_id){var that=this;var model_to_remove=Groups.Collections.group_list.find(function(model){return model.get('uuid')==that.model.get('uuid');});Groups.Collections.group_list.remove(model_to_remove);if(this.permission_modal_view){this.permission_modal_view.closeModal();}}else{this.render();}},reactOpenSharePanel:function(message,data){if('folderUuid'in data&&'membersData'in data){this.model=this.collection.get(data.folderUuid);this.members.reset();if(this.model){this.members.init_member_list(data.membersData,false);}}
if('folderUuid'in data){this.collection.filter_by='group';this.collection.filter_key=data.folderUuid;this.collection.folder_name=Groups.Collections.group_list.get(data.folderUuid).attributes.name;this.collection.search_query='';this.openSharePanel();}},openSharePanel:function(){if(this.permission_modal_view){this.permission_modal_view.destroy();}
this.permission_modal_view=new Groups.Views.PermissionsModalView({model:this.model,members:this.members});},handleOpenShareClick:function(){var uuid=this.model.get('uuid');$.log("folder share_btn "+uuid);window.glassboxLogger.logOpenFolderCollaboratorsDialog({folder_uid:uuid});this.openSharePanel();},inviteCollaborators:function(event){event.preventDefault();$.log("folder invite_collaborators "+this.model.get('uuid'));this.openSharePanel();},switchToGroup:function(model){this.model=model;this.members.reset();if(model){this.members.fetch_members(model.get('uuid'));}
this.render();},reactFolderDeselected:function(){this.model=null;this.members.reset();},handleGroupSelected:function(view){var uuid=view.collection.filter_key;var group=this.collection.get(uuid);this.switchToGroup(group);},handleNonGroupSelected:function(){this.switchToGroup(null);},handleGroupAdded:function(model,collection,options){this.switchToGroup(model);},handleMembersLoaded:function(){this.render();},canShare:function(){if(this.model){return this.model.get('is_shared')||!this.preziList.has_pvo_prezi();}
return false;},areMembersLoaded:function(){return this.members.length!=0;},convertContactsToView:function(contactInfo){var CONTACT_DISPLAY_MAX=3;var contactsForView=contactInfo.slice(0,CONTACT_DISPLAY_MAX);if(contactInfo.length>CONTACT_DISPLAY_MAX){contactsForView.push({additional_contacts:contactInfo.length-CONTACT_DISPLAY_MAX})}
return contactsForView;},render:function(){var is_admin=this.members.isCurrentUserOwner();var is_shared=this.members.length>1;var can_share=this.canShare();var show_empty_message=this.members.length==1&&can_share;var show_can_not_share_message=this.members.length==1&&!can_share;var html='';if(this.model){html=this.$spinner;if(this.areMembersLoaded()){var contacts=this.convertContactsToView(this.members.getContactInfo());html=Mustache.render(this.template,{admin:is_admin,is_shared:is_shared,show_empty_message:show_empty_message,show_can_not_share_message:show_can_not_share_message,can_share:can_share,contacts:contacts});this.$el.hide();this.$el.html(html);this.$el.show("slide",{direction:"right"},200);$('[data-toggle="tooltip"]').tooltip();return;}}
this.$el.html(html);},deleteFolder:function(){var uuid=this.model.get('uuid');$.log('folder delete_folder_btn '+uuid);window.glassboxLogger.logOpenDeleteFolderDialog({folder_uid:uuid});this.showDeleteFolderModal(this.model);},showDeleteFolderModal:function(folder){if(!this.deleteFolderModalView){this.deleteFolderModalView=new Groups.Views.DeleteFolderModalView();}
this.deleteFolderModalView.showModal(folder);}});;Groups.Views.MemberListView=Backbone.View.extend({member_template:$('#member_list_item')[0].innerHTML,initialize:function(){this.members=this.options.members;this.list_members();var that=this;this.listenTo(app.hub,'group:member:add',function(member){that.newMember(member,that);});this.listenTo(app.hub,'group:member:remove',function(member_id){that.deleteMember(member_id,that);});},list_members:function(){for(var i=0,l=this.members.length;i<l;i++){this.add_member(this.members.models[i]);}},add_member:function(member,prepend){var that=this;var can_delete=((Site.user_id!=member.get('id'))&&(Groups.current_user.group_membership_status=='OWNER'))||((Site.user_id==member.get('id'))&&(Groups.current_user.group_membership_status!='OWNER'));var context={id:member.get('id'),name:member.get('name'),email:member.get('email'),current_user:Site.user_id==member.get('id'),current_user_is_admin:Groups.current_user.group_membership_status=='OWNER',can_delete:can_delete,admin:member.get('role')=='OWNER',avatar:Share.helpers.filterAvatar(member.get('avatar'))};var $el=$(Mustache.render(that.member_template,context));$el.hide();if(prepend){$el.insertAfter('#project-properties-member-list li[data-current-user="true"]');$el.slideDown(300);}else{$('#project-properties-member-list').append($el);$el.show();}
if(can_delete){$($el.find('button.close')[0]).click(function(e){var selected_user_id=$(e.target).parents('li').last().data("member-id");if(selected_user_id!=Site.user_id||window.confirm(gettext("Are you sure you want to remove yourself from this folder?"))){$.ajax({url:Site.GROUP_API_ENDPOINT+'/group/'+that.options.model.get('uuid')+'/users/'+selected_user_id+'/',async:true,method:'DELETE',headers:{'x-csrftoken':$.cookie('csrftoken')},dataType:'json',contentType:'application/json',context:that,complete:function(xhr,status){if(xhr.status<300&&xhr.status>=200){app.hub.trigger('group:member:remove',selected_user_id);$.log("folder remove_member_btn "+this.options.model.get('uuid')+" "+selected_user_id);}
else{$.log(['folder','remove_member_btn_error',xhr.status,xhr.statusText,this.options.model.get('uuid'),selected_user_id].join(' '));}}});}});}},newMember:function(member,context){member.Role='VIEWER';var new_member_model=new Groups.Models.Member(member);app.hub.trigger('group:member:add:memberlist',new_member_model);context.add_member(new_member_model,true);},deleteMember:function(member_id,context){$('#project-properties-member-list').find('li.userlist-entry-container[data-member-id="'+member_id+'"]').slideUp(300,function(){$(this).remove();});window.glassboxLogger.logRemoveFolderCollaborator({folder_uid:this.options.model.get('uuid'),target_user_id:parseInt(member_id)});app.hub.trigger('group:member:remove:memberlist',member_id);},custom_unbind:function(){app.hub.off('group:member:add');app.hub.off('group:member:remove');}});_.extend(Groups.Views.MemberListView.prototype,DestroyViewMixin);;(function($){'use strict';Groups.Views.DeleteFolderModalView=app.ModalView.extend({el:'#body-content',events:{'click .delete-folder-modal .btn-delete':'deleteFolder'},showModal:function(folder){this.folder=folder;if(!this.elDeleteFolderModal){var html=Mustache.render($('#delete-folder')[0].innerHTML,{});this.elDeleteFolderModal=this.$el.append(html).find('.delete-folder-modal');}
this.elDeleteFolderModal.modal('show');},deleteFolder:function(){var uuid=this.folder.get('uuid');this.elDeleteFolderModal.modal('hide');this.folder.destroy();window.glassboxLogger.logDeleteFolder({folder_uid:uuid});PubSub.publish('backbone.deleteFolder',{folderId:uuid});$.log('folder delete_folder '+uuid);}});}(jQuery));;Groups.Notification=Backbone.View.extend({createNotification:function(type,msg){var $span=$('<span class="notification" />');$span.addClass(type).html(msg).delay(5000).fadeOut("slow",function(){$(this).remove();});return $span;},show:function(type,msg){var $span=this.createNotification(type,msg);var $el=this.$el;if(!$el.find('.notification').length){$el.append($span);}else{$el.find('.notification').replaceWith($span);}}});;(function($){'use strict';app.DownloadDesktopAppView=Backbone.View.extend({el:"#download-desktop-app",coreDownloadButtonTemplate:$('#core-desktop-download-button')[0].innerHTML,pitchDownloadButtonTemplate:$('#pitch-desktop-download-button')[0].innerHTML,events:{'click .download-desktop-pitch':'handlePitchDesktopDownloadRequest','click .download-desktop-core':'handleCoreDesktopDownloadRequest',},initialize:function(){this.render();},render:function(){var os=window.userAgentParser.getOS(),context={showWindowsLabel:os.name==='Windows',showMacLabel:os.name==='Mac OS',showGeneralLabel:os.name!=='Windows'&&os.name!=='Mac OS'};if(this.options.productType=='core'){this.$el.append(Mustache.render(this.coreDownloadButtonTemplate,context));}else if(this.options.productType=='pitch'){context.downloadLink=Site.isSulTestEnabled?'/download/next/':'/download/business/';this.$el.append(Mustache.render(this.pitchDownloadButtonTemplate,context));}},handleCoreDesktopDownloadRequest:function(e){if(!Site.isCoreDesktopEnabled){e.preventDefault();openPaywallPanel('core_desktop');}},handlePitchDesktopDownloadRequest:function(e){window.glassboxLogger.logDownloadApp();if(!Site.isPitchDesktopEnabled){e.preventDefault();openPaywallPanel('pitch_desktop');}},});}(jQuery));;(function(root,factory){'use strict';if(typeof module!=='undefined'&&module.exports){module.exports=factory(require('jquery'));}
else if(typeof define==='function'&&define.amd){define(['jquery'],function($){return factory($);});}else{factory(root.jQuery);}}(this,function($){'use strict';var Typeahead=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.typeahead.defaults,options);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.select=this.options.select||this.select;this.autoSelect=typeof this.options.autoSelect=='boolean'?this.options.autoSelect:true;this.highlighter=this.options.highlighter||this.highlighter;this.render=this.options.render||this.render;this.updater=this.options.updater||this.updater;this.displayText=this.options.displayText||this.displayText;this.source=this.options.source;this.delay=this.options.delay;this.$menu=$(this.options.menu);this.$appendTo=this.options.appendTo?$(this.options.appendTo):null;this.shown=false;this.listen();this.showHintOnFocus=typeof this.options.showHintOnFocus=='boolean'?this.options.showHintOnFocus:false;this.afterSelect=this.options.afterSelect;this.addItem=false;};Typeahead.prototype={constructor:Typeahead,select:function(){var val=this.$menu.find('.active').data('value');this.$element.data('active',val);if(this.autoSelect||val){var newVal=this.updater(val);if(!newVal){newVal="";}
this.$element.val(this.displayText(newVal)||newVal).change();this.afterSelect(newVal);}
return this.hide();},updater:function(item){return item;},setSource:function(source){this.source=source;},show:function(){var pos=$.extend({},this.$element.position(),{height:this.$element[0].offsetHeight}),scrollHeight;scrollHeight=typeof this.options.scrollHeight=='function'?this.options.scrollHeight.call():this.options.scrollHeight;var element;if(this.shown){element=this.$menu;}else if(this.$appendTo){element=this.$menu.appendTo(this.$appendTo);}else{element=this.$menu.insertAfter(this.$element);}
element.css({top:pos.top+pos.height+scrollHeight,left:pos.left}).show();this.shown=true;return this;},hide:function(){this.$menu.hide();this.shown=false;return this;},lookup:function(query){var items;if(typeof(query)!='undefined'&&query!==null){this.query=query;}else{this.query=this.$element.val()||'';}
if(this.query.length<this.options.minLength){return this.shown?this.hide():this;}
var worker=$.proxy(function(){if($.isFunction(this.source))this.source(this.query,$.proxy(this.process,this));else if(this.source){this.process(this.source);}},this);clearTimeout(this.lookupWorker);this.lookupWorker=setTimeout(worker,this.delay);},process:function(items){var that=this;items=$.grep(items,function(item){return that.matcher(item);});items=this.sorter(items);if(!items.length&&!this.options.addItem){return this.shown?this.hide():this;}
if(items.length>0){this.$element.data('active',items[0]);}else{this.$element.data('active',null);}
if(this.options.addItem){items.push(this.options.addItem);}
if(this.options.items=='all'){return this.render(items).show();}else{return this.render(items.slice(0,this.options.items)).show();}},matcher:function(item){var it=this.displayText(item);return~it.toLowerCase().indexOf(this.query.toLowerCase());},sorter:function(items){var beginswith=[],caseSensitive=[],caseInsensitive=[],item;while((item=items.shift())){var it=this.displayText(item);if(!it.toLowerCase().indexOf(this.query.toLowerCase()))beginswith.push(item);else if(~it.indexOf(this.query))caseSensitive.push(item);else caseInsensitive.push(item);}
return beginswith.concat(caseSensitive,caseInsensitive);},highlighter:function(item){var html=$('<div></div>');var query=this.query;var i=item.toLowerCase().indexOf(query.toLowerCase());var len,leftPart,middlePart,rightPart,strong;len=query.length;if(len===0){return html.text(item).html();}
while(i>-1){leftPart=item.substr(0,i);middlePart=item.substr(i,len);rightPart=item.substr(i+len);strong=$('<strong></strong>').text(middlePart);html.append(document.createTextNode(leftPart)).append(strong);item=rightPart;i=item.toLowerCase().indexOf(query.toLowerCase());}
return html.append(document.createTextNode(item)).html();},render:function(items){var that=this;var self=this;var activeFound=false;items=$(items).map(function(i,item){var text=self.displayText(item);i=$(that.options.item).data('value',item);i.find('a').html(that.highlighter(text));if(text==self.$element.val()){i.addClass('active');self.$element.data('active',item);activeFound=true;}
return i[0];});if(this.autoSelect&&!activeFound){items.first().addClass('active');this.$element.data('active',items.first().data('value'));}
this.$menu.html(items);return this;},displayText:function(item){return typeof item!=='undefined'&&typeof item.name!='undefined'&&item.name||item;},next:function(event){var active=this.$menu.find('.active').removeClass('active'),next=active.next();if(!next.length){next=$(this.$menu.find('li')[0]);}
next.addClass('active');},prev:function(event){var active=this.$menu.find('.active').removeClass('active'),prev=active.prev();if(!prev.length){prev=this.$menu.find('li').last();}
prev.addClass('active');},listen:function(){this.$element.on('focus',$.proxy(this.focus,this)).on('blur',$.proxy(this.blur,this)).on('keypress',$.proxy(this.keypress,this)).on('keyup',$.proxy(this.keyup,this));if(this.eventSupported('keydown')){this.$element.on('keydown',$.proxy(this.keydown,this));}
this.$menu.on('click',$.proxy(this.click,this)).on('mouseenter','li',$.proxy(this.mouseenter,this)).on('mouseleave','li',$.proxy(this.mouseleave,this));},destroy:function(){this.$element.data('typeahead',null);this.$element.data('active',null);this.$element.off('focus').off('blur').off('keypress').off('keyup');if(this.eventSupported('keydown')){this.$element.off('keydown');}
this.$menu.remove();},eventSupported:function(eventName){var isSupported=eventName in this.$element;if(!isSupported){this.$element.setAttribute(eventName,'return;');isSupported=typeof this.$element[eventName]==='function';}
return isSupported;},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:if(e.shiftKey)return;e.preventDefault();this.prev();break;case 40:if(e.shiftKey)return;e.preventDefault();this.next();break;}},keydown:function(e){this.suppressKeyPressRepeat=~$.inArray(e.keyCode,[40,38,9,13,27]);if(!this.shown&&e.keyCode==40){this.lookup();}else{this.move(e);}},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e);},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup();}
e.preventDefault();},focus:function(e){if(!this.focused){this.focused=true;if(this.options.showHintOnFocus){this.lookup('');}}},blur:function(e){this.focused=false;if(!this.mousedover&&this.shown)this.hide();},click:function(e){e.preventDefault();this.select();this.$element.focus();},mouseenter:function(e){this.mousedover=true;this.$menu.find('.active').removeClass('active');$(e.currentTarget).addClass('active');},mouseleave:function(e){this.mousedover=false;if(!this.focused&&this.shown)this.hide();}};var old=$.fn.typeahead;$.fn.typeahead=function(option){var arg=arguments;if(typeof option=='string'&&option=='getActive'){return this.data('active');}
return this.each(function(){var $this=$(this),data=$this.data('typeahead'),options=typeof option=='object'&&option;if(!data)$this.data('typeahead',(data=new Typeahead(this,options)));if(typeof option=='string'){if(arg.length>1){data[option].apply(data,Array.prototype.slice.call(arg,1));}else{data[option]();}}});};$.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu" role="listbox"></ul>',item:'<li><a class="dropdown-item" href="#" role="option"></a></li>',minLength:1,scrollHeight:0,autoSelect:true,afterSelect:$.noop,addItem:false,delay:0};$.fn.typeahead.Constructor=Typeahead;$.fn.typeahead.noConflict=function(){$.fn.typeahead=old;return this;};$(document).on('focus.typeahead.data-api','[data-provide="typeahead"]',function(e){var $this=$(this);if($this.data('typeahead'))return;$this.typeahead($this.data());});}));;/*! jQuery UI - v1.11.4 - 2016-02-03
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, draggable.js, droppable.js, resizable.js, selectable.js, sortable.js, effect.js, effect-blind.js, effect-bounce.js, effect-clip.js, effect-drop.js, effect-explode.js, effect-fade.js, effect-fold.js, effect-highlight.js, effect-puff.js, effect-pulsate.js, effect-scale.js, effect-shake.js, effect-size.js, effect-slide.js, effect-transfer.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory);}else{factory(jQuery);}}(function($){/*!
 * jQuery UI Core 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/category/ui-core/
 */$.ui=$.ui||{};$.extend($.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({scrollParent:function(includeHidden){var position=this.css("position"),excludeStaticParent=position==="absolute",overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/,scrollParent=this.parents().filter(function(){var parent=$(this);if(excludeStaticParent&&parent.css("position")==="static"){return false;}
return overflowRegex.test(parent.css("overflow")+parent.css("overflow-y")+parent.css("overflow-x"));}).eq(0);return position==="fixed"||!scrollParent.length?$(this[0].ownerDocument||document):scrollParent;},uniqueId:(function(){var uuid=0;return function(){return this.each(function(){if(!this.id){this.id="ui-id-"+(++uuid);}});};})(),removeUniqueId:function(){return this.each(function(){if(/^ui-id-\d+$/.test(this.id)){$(this).removeAttr("id");}});}});function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false;}
img=$("img[usemap='#"+mapName+"']")[0];return!!img&&visible(img);}
return(/^(input|select|textarea|button|object)$/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element);}
function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return $.css(this,"visibility")==="hidden";}).length;}
$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName);};}):function(elem,i,match){return!!$.data(elem,match[3]);},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")));},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN);}});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0;}
if(margin){size-=parseFloat($.css(elem,"margin"+this))||0;}});return size;}
$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this);}
return this.each(function(){$(this).css(type,reduce(this,size)+"px");});};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size);}
return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px");});};});}
if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));};}
if($("<a>").data("a-b","a").removeData("a-b").data("a-b")){$.fn.removeData=(function(removeData){return function(key){if(arguments.length){return removeData.call(this,$.camelCase(key));}else{return removeData.call(this);}};})($.fn.removeData);}
$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.fn.extend({focus:(function(orig){return function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem);}},delay);}):orig.apply(this,arguments);};})($.fn.focus),disableSelection:(function(){var eventType="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(eventType+".ui-disableSelection",function(event){event.preventDefault();});};})(),enableSelection:function(){return this.unbind(".ui-disableSelection");},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex);}
if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value;}}
elem=elem.parent();}}
return 0;}});$.ui.plugin={add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args,allowDisconnected){var i,set=instance.plugins[name];if(!set){return;}
if(!allowDisconnected&&(!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11)){return;}
for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}};/*!
 * jQuery UI Widget 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/jQuery.widget/
 */var widget_uuid=0,widget_slice=Array.prototype.slice;$.cleanData=(function(orig){return function(elems){var events,elem,i;for(i=0;(elem=elems[i])!=null;i++){try{events=$._data(elem,"events");if(events&&events.remove){$(elem).triggerHandler("remove");}}catch(e){}}
orig(elems);};})($.cleanData);$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}
$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName);};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element);}
if(arguments.length){this._createWidget(options,element);}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return;}
proxiedPrototype[prop]=(function(){var _super=function(){return base.prototype[prop].apply(this,arguments);},_superApply=function(args){return base.prototype[prop].apply(this,args);};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};})();});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?(basePrototype.widgetEventPrefix||name):name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto);});delete existingConstructor._childConstructors;}else{base._childConstructors.push(constructor);}
$.widget.bridge(name,constructor);return constructor;};$.widget.extend=function(target){var input=widget_slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value);}else{target[key]=value;}}}}
return target;};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=widget_slice.call(arguments,1),returnValue=this;if(isMethodCall){this.each(function(){var methodValue,instance=$.data(this,fullName);if(options==="instance"){returnValue=instance;return false;}
if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'");}
if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance");}
methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}else{if(args.length){options=$.widget.extend.apply(null,[options].concat(args));}
this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{});if(instance._init){instance._init();}}else{$.data(this,fullName,new object(options,this));}});}
return returnValue;};};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=widget_uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy();}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow);}
this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this._create();this._trigger("create",null,this._getCreateEventData());this._init();},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key,parts,curOption,i;if(arguments.length===0){return $.widget.extend({},this.options);}
if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];}
key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key];}
curOption[key]=value;}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key];}
options[key]=value;}}
this._setOptions(options);return this;},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key]);}
return this;},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled",!!value);if(value){this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");}}
return this;},enable:function(){return this._setOptions({disabled:false});},disable:function(){return this._setOptions({disabled:true});},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false;}
if(!handlers){handlers=element;element=this.element;delegateElement=this.widget();}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element);}
$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return;}
return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++;}
var match=event.match(/^([\w:-]*)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector){delegateElement.delegate(selector,eventName,handlerProxy);}else{element.bind(eventName,handlerProxy);}});},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+
this.eventNamespace;element.unbind(eventName).undelegate(eventName);this.bindings=$(this.bindings.not(element).get());this.focusable=$(this.focusable.not(element).get());this.hoverable=$(this.hoverable.not(element).get());},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover");},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover");}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus");},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus");}});},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop];}}}
this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented());}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options};}
var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options};}
hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay);}
if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options);}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback);}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0]);}
next();});}};});var widget=$.widget;/*!
 * jQuery UI Mouse 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/mouse/
 */var mouseHandled=false;$(document).mouseup(function(){mouseHandled=false;});var mouse=$.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event);}).bind("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);}},_mouseDown:function(event){if(mouseHandled){return;}
this._mouseMoved=false;(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var that=this,btnIsLeft=(event.which===1),elIsCancel=(typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}
this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true;},this.options.delay);}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}
if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent");}
this._mouseMoveDelegate=function(event){return that._mouseMove(event);};this._mouseUpDelegate=function(event){return that._mouseUp(event);};this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if(this._mouseMoved){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event);}else if(!event.which){return this._mouseUp(event);}}
if(event.which||event.button){this._mouseMoved=true;}
if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}
return!this._mouseStarted;},_mouseUp:function(event){this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true);}
this._mouseStop(event);}
mouseHandled=false;return false;},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(){return this.mouseDelayMet;},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true;}});/*!
 * jQuery UI Position 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */(function(){$.ui=$.ui||{};var cachedScrollbarWidth,supportsOffsetFractions,max=Math.max,abs=Math.abs,round=Math.round,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)];}
function parseCss(element,property){return parseInt($.css(element,property),10)||0;}
function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}};}
if($.isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}};}
if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}};}
return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()};}
$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth;}
var w1,w2,div=$("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}
div.remove();return(cachedScrollbarWidth=w1-w2);},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||(overflowX==="auto"&&within.width<within.element[0].scrollWidth),hasOverflowY=overflowY==="scroll"||(overflowY==="auto"&&within.height<within.element[0].scrollHeight);return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0};},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:withinElement.offset()||{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:isWindow||isDocument?withinElement.width():withinElement.outerWidth(),height:isWindow||isDocument?withinElement.height():withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at="left top";}
targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"];}
pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}
if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2;}
if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2;}
atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]==="center"){position.left-=elemWidth/2;}
if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]==="center"){position.top-=elemHeight/2;}
position.left+=myOffset[0];position.top+=myOffset[1];if(!supportsOffsetFractions){position.left=round(position.left);position.top=round(position.top);}
collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center";}
if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle";}
if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal";}else{feedback.important="vertical";}
options.using.call(this,props,feedback);};}
elem.offset($.extend(position,{using:using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset;}}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset;}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if(newOverBottom<0||newOverBottom<abs(overTop)){position.top+=myOffset+atOffset+offset;}}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;if(newOverTop>0||abs(newOverTop)<overBottom){position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};(function(){var testElement,testElementParent,testElementStyle,offsetLeft,i,body=document.getElementsByTagName("body")[0],div=document.createElement("div");testElement=document.createElement(body?"div":"body");testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(body){$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"});}
for(i in testElementStyle){testElement.style[i]=testElementStyle[i];}
testElement.appendChild(div);testElementParent=body||document.documentElement;testElementParent.insertBefore(testElement,testElementParent.firstChild);div.style.cssText="position: absolute; left: 10.7432222px;";offsetLeft=$(div).offset().left;supportsOffsetFractions=offsetLeft>10&&offsetLeft<11;testElement.innerHTML="";testElementParent.removeChild(testElement);})();})();var position=$.ui.position;/*!
 * jQuery UI Draggable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/draggable/
 */$.widget("ui.draggable",$.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false,drag:null,start:null,stop:null},_create:function(){if(this.options.helper==="original"){this._setPositionRelative();}
if(this.options.addClasses){this.element.addClass("ui-draggable");}
if(this.options.disabled){this.element.addClass("ui-draggable-disabled");}
this._setHandleClassName();this._mouseInit();},_setOption:function(key,value){this._super(key,value);if(key==="handle"){this._removeHandleClassName();this._setHandleClassName();}},_destroy:function(){if((this.helper||this.element).is(".ui-draggable-dragging")){this.destroyOnClear=true;return;}
this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._removeHandleClassName();this._mouseDestroy();},_mouseCapture:function(event){var o=this.options;this._blurActiveElement(event);if(this.helper||o.disabled||$(event.target).closest(".ui-resizable-handle").length>0){return false;}
this.handle=this._getHandle(event);if(!this.handle){return false;}
this._blockFrames(o.iframeFix===true?"iframe":o.iframeFix);return true;},_blockFrames:function(selector){this.iframeBlocks=this.document.find(selector).map(function(){var iframe=$(this);return $("<div>").css("position","absolute").appendTo(iframe.parent()).outerWidth(iframe.outerWidth()).outerHeight(iframe.outerHeight()).offset(iframe.offset())[0];});},_unblockFrames:function(){if(this.iframeBlocks){this.iframeBlocks.remove();delete this.iframeBlocks;}},_blurActiveElement:function(event){var document=this.document[0];if(!this.handleElement.is(event.target)){return;}
try{if(document.activeElement&&document.activeElement.nodeName.toLowerCase()!=="body"){$(document.activeElement).blur();}}catch(error){}},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();if($.ui.ddmanager){$.ui.ddmanager.current=this;}
this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent(true);this.offsetParent=this.helper.offsetParent();this.hasFixedAncestor=this.helper.parents().filter(function(){return $(this).css("position")==="fixed";}).length>0;this.positionAbs=this.element.offset();this._refreshOffsets(event);this.originalPosition=this.position=this._generatePosition(event,false);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this._setContainment();if(this._trigger("start",event)===false){this._clear();return false;}
this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}
this._normalizeRightBottom();this._mouseDrag(event,true);if($.ui.ddmanager){$.ui.ddmanager.dragStart(this,event);}
return true;},_refreshOffsets:function(event){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:false,parent:this._getParentOffset(),relative:this._getRelativeOffset()};this.offset.click={left:event.pageX-this.offset.left,top:event.pageY-this.offset.top};},_mouseDrag:function(event,noPropagation){if(this.hasFixedAncestor){this.offset.parent=this._getParentOffset();}
this.position=this._generatePosition(event,true);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===false){this._mouseUp({});return false;}
this.position=ui.position;}
this.helper[0].style.left=this.position.left+"px";this.helper[0].style.top=this.position.top+"px";if($.ui.ddmanager){$.ui.ddmanager.drag(this,event);}
return false;},_mouseStop:function(event){var that=this,dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour){dropped=$.ui.ddmanager.drop(this,event);}
if(this.dropped){dropped=this.dropped;this.dropped=false;}
if((this.options.revert==="invalid"&&!dropped)||(this.options.revert==="valid"&&dropped)||this.options.revert===true||($.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped))){$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(that._trigger("stop",event)!==false){that._clear();}});}else{if(this._trigger("stop",event)!==false){this._clear();}}
return false;},_mouseUp:function(event){this._unblockFrames();if($.ui.ddmanager){$.ui.ddmanager.dragStop(this,event);}
if(this.handleElement.is(event.target)){this.element.focus();}
return $.ui.mouse.prototype._mouseUp.call(this,event);},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({});}else{this._clear();}
return this;},_getHandle:function(event){return this.options.handle?!!$(event.target).closest(this.element.find(this.options.handle)).length:true;},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element;this.handleElement.addClass("ui-draggable-handle");},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle");},_createHelper:function(event){var o=this.options,helperIsFunction=$.isFunction(o.helper),helper=helperIsFunction?$(o.helper.apply(this.element[0],[event])):(o.helper==="clone"?this.element.clone().removeAttr("id"):this.element);if(!helper.parents("body").length){helper.appendTo((o.appendTo==="parent"?this.element[0].parentNode:o.appendTo));}
if(helperIsFunction&&helper[0]===this.element[0]){this._setPositionRelative();}
if(helper[0]!==this.element[0]&&!(/(fixed|absolute)/).test(helper.css("position"))){helper.css("position","absolute");}
return helper;},_setPositionRelative:function(){if(!(/^(?:r|a|f)/).test(this.element.css("position"))){this.element[0].style.position="relative";}},_adjustOffsetFromHelper:function(obj){if(typeof obj==="string"){obj=obj.split(" ");}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if("left"in obj){this.offset.click.left=obj.left+this.margins.left;}
if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if("top"in obj){this.offset.click.top=obj.top+this.margins.top;}
if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_isRootNode:function(element){return(/(html|body)/i).test(element.tagName)||element===this.document[0];},_getParentOffset:function(){var po=this.offsetParent.offset(),document=this.document[0];if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if(this._isRootNode(this.offsetParent[0])){po={top:0,left:0};}
return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition!=="relative"){return{top:0,left:0};}
var p=this.element.position(),scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+(!scrollIsRootNode?this.scrollParent.scrollTop():0),left:p.left-(parseInt(this.helper.css("left"),10)||0)+(!scrollIsRootNode?this.scrollParent.scrollLeft():0)};},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var isUserScrollable,c,ce,o=this.options,document=this.document[0];this.relativeContainer=null;if(!o.containment){this.containment=null;return;}
if(o.containment==="window"){this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-this.helperProportions.width-this.margins.left,$(window).scrollTop()+($(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return;}
if(o.containment==="document"){this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return;}
if(o.containment.constructor===Array){this.containment=o.containment;return;}
if(o.containment==="parent"){o.containment=this.helper[0].parentNode;}
c=$(o.containment);ce=c[0];if(!ce){return;}
isUserScrollable=/(scroll|auto)/.test(c.css("overflow"));this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(isUserScrollable?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-
(parseInt(c.css("borderRightWidth"),10)||0)-
(parseInt(c.css("paddingRight"),10)||0)-
this.helperProportions.width-
this.margins.left-
this.margins.right,(isUserScrollable?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-
(parseInt(c.css("borderBottomWidth"),10)||0)-
(parseInt(c.css("paddingBottom"),10)||0)-
this.helperProportions.height-
this.margins.top-
this.margins.bottom];this.relativeContainer=c;},_convertPositionTo:function(d,pos){if(!pos){pos=this.position;}
var mod=d==="absolute"?1:-1,scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:(pos.top+
this.offset.relative.top*mod+
this.offset.parent.top*mod-
((this.cssPosition==="fixed"?-this.offset.scroll.top:(scrollIsRootNode?0:this.offset.scroll.top))*mod)),left:(pos.left+
this.offset.relative.left*mod+
this.offset.parent.left*mod-
((this.cssPosition==="fixed"?-this.offset.scroll.left:(scrollIsRootNode?0:this.offset.scroll.left))*mod))};},_generatePosition:function(event,constrainPosition){var containment,co,top,left,o=this.options,scrollIsRootNode=this._isRootNode(this.scrollParent[0]),pageX=event.pageX,pageY=event.pageY;if(!scrollIsRootNode||!this.offset.scroll){this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()};}
if(constrainPosition){if(this.containment){if(this.relativeContainer){co=this.relativeContainer.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top];}else{containment=this.containment;}
if(event.pageX-this.offset.click.left<containment[0]){pageX=containment[0]+this.offset.click.left;}
if(event.pageY-this.offset.click.top<containment[1]){pageY=containment[1]+this.offset.click.top;}
if(event.pageX-this.offset.click.left>containment[2]){pageX=containment[2]+this.offset.click.left;}
if(event.pageY-this.offset.click.top>containment[3]){pageY=containment[3]+this.offset.click.top;}}
if(o.grid){top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?((top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3])?top:((top-this.offset.click.top>=containment[1])?top-o.grid[1]:top+o.grid[1])):top;left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?((left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2])?left:((left-this.offset.click.left>=containment[0])?left-o.grid[0]:left+o.grid[0])):left;}
if(o.axis==="y"){pageX=this.originalPageX;}
if(o.axis==="x"){pageY=this.originalPageY;}}
return{top:(pageY-
this.offset.click.top-
this.offset.relative.top-
this.offset.parent.top+
(this.cssPosition==="fixed"?-this.offset.scroll.top:(scrollIsRootNode?0:this.offset.scroll.top))),left:(pageX-
this.offset.click.left-
this.offset.relative.left-
this.offset.parent.left+
(this.cssPosition==="fixed"?-this.offset.scroll.left:(scrollIsRootNode?0:this.offset.scroll.left)))};},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval){this.helper.remove();}
this.helper=null;this.cancelHelperRemoval=false;if(this.destroyOnClear){this.destroy();}},_normalizeRightBottom:function(){if(this.options.axis!=="y"&&this.helper.css("right")!=="auto"){this.helper.width(this.helper.width());this.helper.css("right","auto");}
if(this.options.axis!=="x"&&this.helper.css("bottom")!=="auto"){this.helper.height(this.helper.height());this.helper.css("bottom","auto");}},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui,this],true);if(/^(drag|start|stop)/.test(type)){this.positionAbs=this._convertPositionTo("absolute");ui.offset=this.positionAbs;}
return $.Widget.prototype._trigger.call(this,type,event,ui);},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui,draggable){var uiSortable=$.extend({},ui,{item:draggable.element});draggable.sortables=[];$(draggable.options.connectToSortable).each(function(){var sortable=$(this).sortable("instance");if(sortable&&!sortable.options.disabled){draggable.sortables.push(sortable);sortable.refreshPositions();sortable._trigger("activate",event,uiSortable);}});},stop:function(event,ui,draggable){var uiSortable=$.extend({},ui,{item:draggable.element});draggable.cancelHelperRemoval=false;$.each(draggable.sortables,function(){var sortable=this;if(sortable.isOver){sortable.isOver=0;draggable.cancelHelperRemoval=true;sortable.cancelHelperRemoval=false;sortable._storedCSS={position:sortable.placeholder.css("position"),top:sortable.placeholder.css("top"),left:sortable.placeholder.css("left")};sortable._mouseStop(event);sortable.options.helper=sortable.options._helper;}else{sortable.cancelHelperRemoval=true;sortable._trigger("deactivate",event,uiSortable);}});},drag:function(event,ui,draggable){$.each(draggable.sortables,function(){var innermostIntersecting=false,sortable=this;sortable.positionAbs=draggable.positionAbs;sortable.helperProportions=draggable.helperProportions;sortable.offset.click=draggable.offset.click;if(sortable._intersectsWith(sortable.containerCache)){innermostIntersecting=true;$.each(draggable.sortables,function(){this.positionAbs=draggable.positionAbs;this.helperProportions=draggable.helperProportions;this.offset.click=draggable.offset.click;if(this!==sortable&&this._intersectsWith(this.containerCache)&&$.contains(sortable.element[0],this.element[0])){innermostIntersecting=false;}
return innermostIntersecting;});}
if(innermostIntersecting){if(!sortable.isOver){sortable.isOver=1;draggable._parent=ui.helper.parent();sortable.currentItem=ui.helper.appendTo(sortable.element).data("ui-sortable-item",true);sortable.options._helper=sortable.options.helper;sortable.options.helper=function(){return ui.helper[0];};event.target=sortable.currentItem[0];sortable._mouseCapture(event,true);sortable._mouseStart(event,true,true);sortable.offset.click.top=draggable.offset.click.top;sortable.offset.click.left=draggable.offset.click.left;sortable.offset.parent.left-=draggable.offset.parent.left-
sortable.offset.parent.left;sortable.offset.parent.top-=draggable.offset.parent.top-
sortable.offset.parent.top;draggable._trigger("toSortable",event);draggable.dropped=sortable.element;$.each(draggable.sortables,function(){this.refreshPositions();});draggable.currentItem=draggable.element;sortable.fromOutside=draggable;}
if(sortable.currentItem){sortable._mouseDrag(event);ui.position=sortable.position;}}else{if(sortable.isOver){sortable.isOver=0;sortable.cancelHelperRemoval=true;sortable.options._revert=sortable.options.revert;sortable.options.revert=false;sortable._trigger("out",event,sortable._uiHash(sortable));sortable._mouseStop(event,true);sortable.options.revert=sortable.options._revert;sortable.options.helper=sortable.options._helper;if(sortable.placeholder){sortable.placeholder.remove();}
ui.helper.appendTo(draggable._parent);draggable._refreshOffsets(event);ui.position=draggable._generatePosition(event,true);draggable._trigger("fromSortable",event);draggable.dropped=false;$.each(draggable.sortables,function(){this.refreshPositions();});}}});}});$.ui.plugin.add("draggable","cursor",{start:function(event,ui,instance){var t=$("body"),o=instance.options;if(t.css("cursor")){o._cursor=t.css("cursor");}
t.css("cursor",o.cursor);},stop:function(event,ui,instance){var o=instance.options;if(o._cursor){$("body").css("cursor",o._cursor);}}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui,instance){var t=$(ui.helper),o=instance.options;if(t.css("opacity")){o._opacity=t.css("opacity");}
t.css("opacity",o.opacity);},stop:function(event,ui,instance){var o=instance.options;if(o._opacity){$(ui.helper).css("opacity",o._opacity);}}});$.ui.plugin.add("draggable","scroll",{start:function(event,ui,i){if(!i.scrollParentNotHidden){i.scrollParentNotHidden=i.helper.scrollParent(false);}
if(i.scrollParentNotHidden[0]!==i.document[0]&&i.scrollParentNotHidden[0].tagName!=="HTML"){i.overflowOffset=i.scrollParentNotHidden.offset();}},drag:function(event,ui,i){var o=i.options,scrolled=false,scrollParent=i.scrollParentNotHidden[0],document=i.document[0];if(scrollParent!==document&&scrollParent.tagName!=="HTML"){if(!o.axis||o.axis!=="x"){if((i.overflowOffset.top+scrollParent.offsetHeight)-event.pageY<o.scrollSensitivity){scrollParent.scrollTop=scrolled=scrollParent.scrollTop+o.scrollSpeed;}else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity){scrollParent.scrollTop=scrolled=scrollParent.scrollTop-o.scrollSpeed;}}
if(!o.axis||o.axis!=="y"){if((i.overflowOffset.left+scrollParent.offsetWidth)-event.pageX<o.scrollSensitivity){scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft+o.scrollSpeed;}else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity){scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft-o.scrollSpeed;}}}else{if(!o.axis||o.axis!=="x"){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);}else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);}}
if(!o.axis||o.axis!=="y"){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);}else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(i,event);}}});$.ui.plugin.add("draggable","snap",{start:function(event,ui,i){var o=i.options;i.snapElements=[];$(o.snap.constructor!==String?(o.snap.items||":data(ui-draggable)"):o.snap).each(function(){var $t=$(this),$o=$t.offset();if(this!==i.element[0]){i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left});}});},drag:function(event,ui,inst){var ts,bs,ls,rs,l,r,t,b,i,first,o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--){l=inst.snapElements[i].left-inst.margins.left;r=l+inst.snapElements[i].width;t=inst.snapElements[i].top-inst.margins.top;b=t+inst.snapElements[i].height;if(x2<l-d||x1>r+d||y2<t-d||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)){if(inst.snapElements[i].snapping){(inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));}
inst.snapElements[i].snapping=false;continue;}
if(o.snapMode!=="inner"){ts=Math.abs(t-y2)<=d;bs=Math.abs(b-y1)<=d;ls=Math.abs(l-x2)<=d;rs=Math.abs(r-x1)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top;}
if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top;}
if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left;}
if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left;}}
first=(ts||bs||ls||rs);if(o.snapMode!=="outer"){ts=Math.abs(t-y1)<=d;bs=Math.abs(b-y2)<=d;ls=Math.abs(l-x1)<=d;rs=Math.abs(r-x2)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top;}
if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top;}
if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left;}
if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left;}}
if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)){(inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));}
inst.snapElements[i].snapping=(ts||bs||ls||rs||first);}}});$.ui.plugin.add("draggable","stack",{start:function(event,ui,instance){var min,o=instance.options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0);});if(!group.length){return;}
min=parseInt($(group[0]).css("zIndex"),10)||0;$(group).each(function(i){$(this).css("zIndex",min+i);});this.css("zIndex",(min+group.length));}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui,instance){var t=$(ui.helper),o=instance.options;if(t.css("zIndex")){o._zIndex=t.css("zIndex");}
t.css("zIndex",o.zIndex);},stop:function(event,ui,instance){var o=instance.options;if(o._zIndex){$(ui.helper).css("zIndex",o._zIndex);}}});var draggable=$.ui.draggable;/*!
 * jQuery UI Droppable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/droppable/
 */$.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var proportions,o=this.options,accept=o.accept;this.isover=false;this.isout=true;this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept);};this.proportions=function(){if(arguments.length){proportions=arguments[0];}else{return proportions?proportions:proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};}};this._addToManager(o.scope);o.addClasses&&this.element.addClass("ui-droppable");},_addToManager:function(scope){$.ui.ddmanager.droppables[scope]=$.ui.ddmanager.droppables[scope]||[];$.ui.ddmanager.droppables[scope].push(this);},_splice:function(drop){var i=0;for(;i<drop.length;i++){if(drop[i]===this){drop.splice(i,1);}}},_destroy:function(){var drop=$.ui.ddmanager.droppables[this.options.scope];this._splice(drop);this.element.removeClass("ui-droppable ui-droppable-disabled");},_setOption:function(key,value){if(key==="accept"){this.accept=$.isFunction(value)?value:function(d){return d.is(value);};}else if(key==="scope"){var drop=$.ui.ddmanager.droppables[this.options.scope];this._splice(drop);this._addToManager(value);}
this._super(key,value);},_activate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass){this.element.addClass(this.options.activeClass);}
if(draggable){this._trigger("activate",event,this.ui(draggable));}},_deactivate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass){this.element.removeClass(this.options.activeClass);}
if(draggable){this._trigger("deactivate",event,this.ui(draggable));}},_over:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return;}
if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass){this.element.addClass(this.options.hoverClass);}
this._trigger("over",event,this.ui(draggable));}},_out:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return;}
if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass);}
this._trigger("out",event,this.ui(draggable));}},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current,childrenIntersection=false;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return false;}
this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var inst=$(this).droppable("instance");if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope===draggable.options.scope&&inst.accept.call(inst.element[0],(draggable.currentItem||draggable.element))&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance,event)){childrenIntersection=true;return false;}});if(childrenIntersection){return false;}
if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.activeClass){this.element.removeClass(this.options.activeClass);}
if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass);}
this._trigger("drop",event,this.ui(draggable));return this.element;}
return false;},ui:function(c){return{draggable:(c.currentItem||c.element),helper:c.helper,position:c.position,offset:c.positionAbs};}});$.ui.intersect=(function(){function isOverAxis(x,reference,size){return(x>=reference)&&(x<(reference+size));}
return function(draggable,droppable,toleranceMode,event){if(!droppable.offset){return false;}
var x1=(draggable.positionAbs||draggable.position.absolute).left+draggable.margins.left,y1=(draggable.positionAbs||draggable.position.absolute).top+draggable.margins.top,x2=x1+draggable.helperProportions.width,y2=y1+draggable.helperProportions.height,l=droppable.offset.left,t=droppable.offset.top,r=l+droppable.proportions().width,b=t+droppable.proportions().height;switch(toleranceMode){case"fit":return(l<=x1&&x2<=r&&t<=y1&&y2<=b);case"intersect":return(l<x1+(draggable.helperProportions.width/2)&&x2-(draggable.helperProportions.width/2)<r&&t<y1+(draggable.helperProportions.height/2)&&y2-(draggable.helperProportions.height/2)<b);case"pointer":return isOverAxis(event.pageY,t,droppable.proportions().height)&&isOverAxis(event.pageX,l,droppable.proportions().width);case"touch":return((y1>=t&&y1<=b)||(y2>=t&&y2<=b)||(y1<t&&y2>b))&&((x1>=l&&x1<=r)||(x2>=l&&x2<=r)||(x1<l&&x2>r));default:return false;}};})();$.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,event){var i,j,m=$.ui.ddmanager.droppables[t.options.scope]||[],type=event?event.type:null,list=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();droppablesLoop:for(i=0;i<m.length;i++){if(m[i].options.disabled||(t&&!m[i].accept.call(m[i].element[0],(t.currentItem||t.element)))){continue;}
for(j=0;j<list.length;j++){if(list[j]===m[i].element[0]){m[i].proportions().height=0;continue droppablesLoop;}}
m[i].visible=m[i].element.css("display")!=="none";if(!m[i].visible){continue;}
if(type==="mousedown"){m[i]._activate.call(m[i],event);}
m[i].offset=m[i].element.offset();m[i].proportions({width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight});}},drop:function(draggable,event){var dropped=false;$.each(($.ui.ddmanager.droppables[draggable.options.scope]||[]).slice(),function(){if(!this.options){return;}
if(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance,event)){dropped=this._drop.call(this,event)||dropped;}
if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this.isout=true;this.isover=false;this._deactivate.call(this,event);}});return dropped;},dragStart:function(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event);}});},drag:function(draggable,event){if(draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event);}
$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible){return;}
var parentInstance,scope,parent,intersects=$.ui.intersect(draggable,this,this.options.tolerance,event),c=!intersects&&this.isover?"isout":(intersects&&!this.isover?"isover":null);if(!c){return;}
if(this.options.greedy){scope=this.options.scope;parent=this.element.parents(":data(ui-droppable)").filter(function(){return $(this).droppable("instance").options.scope===scope;});if(parent.length){parentInstance=$(parent[0]).droppable("instance");parentInstance.greedyChild=(c==="isover");}}
if(parentInstance&&c==="isover"){parentInstance.isover=false;parentInstance.isout=true;parentInstance._out.call(parentInstance,event);}
this[c]=true;this[c==="isout"?"isover":"isout"]=false;this[c==="isover"?"_over":"_out"].call(this,event);if(parentInstance&&c==="isout"){parentInstance.isout=false;parentInstance.isover=true;parentInstance._over.call(parentInstance,event);}});},dragStop:function(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable");if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event);}}};var droppable=$.ui.droppable;/*!
 * jQuery UI Resizable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/resizable/
 */$.widget("ui.resizable",$.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(value){return parseInt(value,10)||0;},_isNumber:function(value){return!isNaN(parseInt(value,10));},_hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false;}
var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true;}
el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has;},_create:function(){var n,i,handle,axis,hname,that=this,o=this.options;this.element.addClass("ui-resizable");$.extend(this,{_aspectRatio:!!(o.aspectRatio),aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)){this.element.wrap($("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize();}
this.handles=o.handles||(!$(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});this._handles=$();if(this.handles.constructor===String){if(this.handles==="all"){this.handles="n,e,s,w,se,sw,ne,nw";}
n=this.handles.split(",");this.handles={};for(i=0;i<n.length;i++){handle=$.trim(n[i]);hname="ui-resizable-"+handle;axis=$("<div class='ui-resizable-handle "+hname+"'></div>");axis.css({zIndex:o.zIndex});if("se"===handle){axis.addClass("ui-icon ui-icon-gripsmall-diagonal-se");}
this.handles[handle]=".ui-resizable-"+handle;this.element.append(axis);}}
this._renderAxis=function(target){var i,axis,padPos,padWrapper;target=target||this.element;for(i in this.handles){if(this.handles[i].constructor===String){this.handles[i]=this.element.children(this.handles[i]).first().show();}else if(this.handles[i].jquery||this.handles[i].nodeType){this.handles[i]=$(this.handles[i]);this._on(this.handles[i],{"mousedown":that._mouseDown});}
if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)){axis=$(this.handles[i],this.element);padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();padPos=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");target.css(padPos,padWrapper);this._proportionallyResize();}
this._handles=this._handles.add(this.handles[i]);}};this._renderAxis(this.element);this._handles=this._handles.add(this.element.find(".ui-resizable-handle"));this._handles.disableSelection();this._handles.mouseover(function(){if(!that.resizing){if(this.className){axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);}
that.axis=axis&&axis[1]?axis[1]:"se";}});if(o.autoHide){this._handles.hide();$(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(o.disabled){return;}
$(this).removeClass("ui-resizable-autohide");that._handles.show();}).mouseleave(function(){if(o.disabled){return;}
if(!that.resizing){$(this).addClass("ui-resizable-autohide");that._handles.hide();}});}
this._mouseInit();},_destroy:function(){this._mouseDestroy();var wrapper,_destroy=function(exp){$(exp).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove();};if(this.elementIsWrapper){_destroy(this.element);wrapper=this.element;this.originalElement.css({position:wrapper.css("position"),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css("top"),left:wrapper.css("left")}).insertAfter(wrapper);wrapper.remove();}
this.originalElement.css("resize",this.originalResizeStyle);_destroy(this.originalElement);return this;},_mouseCapture:function(event){var i,handle,capture=false;for(i in this.handles){handle=$(this.handles[i])[0];if(handle===event.target||$.contains(handle,event.target)){capture=true;}}
return!this.options.disabled&&capture;},_mouseStart:function(event){var curleft,curtop,cursor,o=this.options,el=this.element;this.resizing=true;this._renderProxy();curleft=this._num(this.helper.css("left"));curtop=this._num(this.helper.css("top"));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0;}
this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalPosition={left:curleft,top:curtop};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio=(typeof o.aspectRatio==="number")?o.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);cursor=$(".ui-resizable-"+this.axis).css("cursor");$("body").css("cursor",cursor==="auto"?this.axis+"-resize":cursor);el.addClass("ui-resizable-resizing");this._propagate("start",event);return true;},_mouseDrag:function(event){var data,props,smp=this.originalMousePosition,a=this.axis,dx=(event.pageX-smp.left)||0,dy=(event.pageY-smp.top)||0,trigger=this._change[a];this._updatePrevProperties();if(!trigger){return false;}
data=trigger.apply(this,[event,dx,dy]);this._updateVirtualBoundaries(event.shiftKey);if(this._aspectRatio||event.shiftKey){data=this._updateRatio(data,event);}
data=this._respectSize(data,event);this._updateCache(data);this._propagate("resize",event);props=this._applyChanges();if(!this._helper&&this._proportionallyResizeElements.length){this._proportionallyResize();}
if(!$.isEmptyObject(props)){this._updatePrevProperties();this._trigger("resize",event,this.ui());this._applyChanges();}
return false;},_mouseStop:function(event){this.resizing=false;var pr,ista,soffseth,soffsetw,s,left,top,o=this.options,that=this;if(this._helper){pr=this._proportionallyResizeElements;ista=pr.length&&(/textarea/i).test(pr[0].nodeName);soffseth=ista&&this._hasScroll(pr[0],"left")?0:that.sizeDiff.height;soffsetw=ista?0:that.sizeDiff.width;s={width:(that.helper.width()-soffsetw),height:(that.helper.height()-soffseth)};left=(parseInt(that.element.css("left"),10)+
(that.position.left-that.originalPosition.left))||null;top=(parseInt(that.element.css("top"),10)+
(that.position.top-that.originalPosition.top))||null;if(!o.animate){this.element.css($.extend(s,{top:top,left:left}));}
that.helper.height(that.size.height);that.helper.width(that.size.width);if(this._helper&&!o.animate){this._proportionallyResize();}}
$("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",event);if(this._helper){this.helper.remove();}
return false;},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left};this.prevSize={width:this.size.width,height:this.size.height};},_applyChanges:function(){var props={};if(this.position.top!==this.prevPosition.top){props.top=this.position.top+"px";}
if(this.position.left!==this.prevPosition.left){props.left=this.position.left+"px";}
if(this.size.width!==this.prevSize.width){props.width=this.size.width+"px";}
if(this.size.height!==this.prevSize.height){props.height=this.size.height+"px";}
this.helper.css(props);return props;},_updateVirtualBoundaries:function(forceAspectRatio){var pMinWidth,pMaxWidth,pMinHeight,pMaxHeight,b,o=this.options;b={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:Infinity,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:Infinity};if(this._aspectRatio||forceAspectRatio){pMinWidth=b.minHeight*this.aspectRatio;pMinHeight=b.minWidth/this.aspectRatio;pMaxWidth=b.maxHeight*this.aspectRatio;pMaxHeight=b.maxWidth/this.aspectRatio;if(pMinWidth>b.minWidth){b.minWidth=pMinWidth;}
if(pMinHeight>b.minHeight){b.minHeight=pMinHeight;}
if(pMaxWidth<b.maxWidth){b.maxWidth=pMaxWidth;}
if(pMaxHeight<b.maxHeight){b.maxHeight=pMaxHeight;}}
this._vBoundaries=b;},_updateCache:function(data){this.offset=this.helper.offset();if(this._isNumber(data.left)){this.position.left=data.left;}
if(this._isNumber(data.top)){this.position.top=data.top;}
if(this._isNumber(data.height)){this.size.height=data.height;}
if(this._isNumber(data.width)){this.size.width=data.width;}},_updateRatio:function(data){var cpos=this.position,csize=this.size,a=this.axis;if(this._isNumber(data.height)){data.width=(data.height*this.aspectRatio);}else if(this._isNumber(data.width)){data.height=(data.width/this.aspectRatio);}
if(a==="sw"){data.left=cpos.left+(csize.width-data.width);data.top=null;}
if(a==="nw"){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width);}
return data;},_respectSize:function(data){var o=this._vBoundaries,a=this.axis,ismaxw=this._isNumber(data.width)&&o.maxWidth&&(o.maxWidth<data.width),ismaxh=this._isNumber(data.height)&&o.maxHeight&&(o.maxHeight<data.height),isminw=this._isNumber(data.width)&&o.minWidth&&(o.minWidth>data.width),isminh=this._isNumber(data.height)&&o.minHeight&&(o.minHeight>data.height),dw=this.originalPosition.left+this.originalSize.width,dh=this.position.top+this.size.height,cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);if(isminw){data.width=o.minWidth;}
if(isminh){data.height=o.minHeight;}
if(ismaxw){data.width=o.maxWidth;}
if(ismaxh){data.height=o.maxHeight;}
if(isminw&&cw){data.left=dw-o.minWidth;}
if(ismaxw&&cw){data.left=dw-o.maxWidth;}
if(isminh&&ch){data.top=dh-o.minHeight;}
if(ismaxh&&ch){data.top=dh-o.maxHeight;}
if(!data.width&&!data.height&&!data.left&&data.top){data.top=null;}else if(!data.width&&!data.height&&!data.top&&data.left){data.left=null;}
return data;},_getPaddingPlusBorderDimensions:function(element){var i=0,widths=[],borders=[element.css("borderTopWidth"),element.css("borderRightWidth"),element.css("borderBottomWidth"),element.css("borderLeftWidth")],paddings=[element.css("paddingTop"),element.css("paddingRight"),element.css("paddingBottom"),element.css("paddingLeft")];for(;i<4;i++){widths[i]=(parseInt(borders[i],10)||0);widths[i]+=(parseInt(paddings[i],10)||0);}
return{height:widths[0]+widths[2],width:widths[1]+widths[3]};},_proportionallyResize:function(){if(!this._proportionallyResizeElements.length){return;}
var prel,i=0,element=this.helper||this.element;for(;i<this._proportionallyResizeElements.length;i++){prel=this._proportionallyResizeElements[i];if(!this.outerDimensions){this.outerDimensions=this._getPaddingPlusBorderDimensions(prel);}
prel.css({height:(element.height()-this.outerDimensions.height)||0,width:(element.width()-this.outerDimensions.width)||0});}},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$("<div style='overflow:hidden;'></div>");this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++o.zIndex});this.helper.appendTo("body").disableSelection();}else{this.helper=this.element;}},_change:{e:function(event,dx){return{width:this.originalSize.width+dx};},w:function(event,dx){var cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx};},n:function(event,dx,dy){var cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy};},s:function(event,dx,dy){return{height:this.originalSize.height+dy};},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);(n!=="resize"&&this._trigger(n,event,this.ui()));},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}});$.ui.plugin.add("resizable","animate",{stop:function(event){var that=$(this).resizable("instance"),o=that.options,pr=that._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&that._hasScroll(pr[0],"left")?0:that.sizeDiff.height,soffsetw=ista?0:that.sizeDiff.width,style={width:(that.size.width-soffsetw),height:(that.size.height-soffseth)},left=(parseInt(that.element.css("left"),10)+
(that.position.left-that.originalPosition.left))||null,top=(parseInt(that.element.css("top"),10)+
(that.position.top-that.originalPosition.top))||null;that.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseInt(that.element.css("width"),10),height:parseInt(that.element.css("height"),10),top:parseInt(that.element.css("top"),10),left:parseInt(that.element.css("left"),10)};if(pr&&pr.length){$(pr[0]).css({width:data.width,height:data.height});}
that._updateCache(data);that._propagate("resize",event);}});}});$.ui.plugin.add("resizable","containment",{start:function(){var element,p,co,ch,cw,width,height,that=$(this).resizable("instance"),o=that.options,el=that.element,oc=o.containment,ce=(oc instanceof $)?oc.get(0):(/parent/.test(oc))?el.parent().get(0):oc;if(!ce){return;}
that.containerElement=$(ce);if(/document/.test(oc)||oc===document){that.containerOffset={left:0,top:0};that.containerPosition={left:0,top:0};that.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight};}else{element=$(ce);p=[];$(["Top","Right","Left","Bottom"]).each(function(i,name){p[i]=that._num(element.css("padding"+name));});that.containerOffset=element.offset();that.containerPosition=element.position();that.containerSize={height:(element.innerHeight()-p[3]),width:(element.innerWidth()-p[1])};co=that.containerOffset;ch=that.containerSize.height;cw=that.containerSize.width;width=(that._hasScroll(ce,"left")?ce.scrollWidth:cw);height=(that._hasScroll(ce)?ce.scrollHeight:ch);that.parentData={element:ce,left:co.left,top:co.top,width:width,height:height};}},resize:function(event){var woset,hoset,isParent,isOffsetRelative,that=$(this).resizable("instance"),o=that.options,co=that.containerOffset,cp=that.position,pRatio=that._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=that.containerElement,continueResize=true;if(ce[0]!==document&&(/static/).test(ce.css("position"))){cop=co;}
if(cp.left<(that._helper?co.left:0)){that.size.width=that.size.width+
(that._helper?(that.position.left-co.left):(that.position.left-cop.left));if(pRatio){that.size.height=that.size.width/that.aspectRatio;continueResize=false;}
that.position.left=o.helper?co.left:0;}
if(cp.top<(that._helper?co.top:0)){that.size.height=that.size.height+
(that._helper?(that.position.top-co.top):that.position.top);if(pRatio){that.size.width=that.size.height*that.aspectRatio;continueResize=false;}
that.position.top=that._helper?co.top:0;}
isParent=that.containerElement.get(0)===that.element.parent().get(0);isOffsetRelative=/relative|absolute/.test(that.containerElement.css("position"));if(isParent&&isOffsetRelative){that.offset.left=that.parentData.left+that.position.left;that.offset.top=that.parentData.top+that.position.top;}else{that.offset.left=that.element.offset().left;that.offset.top=that.element.offset().top;}
woset=Math.abs(that.sizeDiff.width+
(that._helper?that.offset.left-cop.left:(that.offset.left-co.left)));hoset=Math.abs(that.sizeDiff.height+
(that._helper?that.offset.top-cop.top:(that.offset.top-co.top)));if(woset+that.size.width>=that.parentData.width){that.size.width=that.parentData.width-woset;if(pRatio){that.size.height=that.size.width/that.aspectRatio;continueResize=false;}}
if(hoset+that.size.height>=that.parentData.height){that.size.height=that.parentData.height-hoset;if(pRatio){that.size.width=that.size.height*that.aspectRatio;continueResize=false;}}
if(!continueResize){that.position.left=that.prevPosition.left;that.position.top=that.prevPosition.top;that.size.width=that.prevSize.width;that.size.height=that.prevSize.height;}},stop:function(){var that=$(this).resizable("instance"),o=that.options,co=that.containerOffset,cop=that.containerPosition,ce=that.containerElement,helper=$(that.helper),ho=helper.offset(),w=helper.outerWidth()-that.sizeDiff.width,h=helper.outerHeight()-that.sizeDiff.height;if(that._helper&&!o.animate&&(/relative/).test(ce.css("position"))){$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}
if(that._helper&&!o.animate&&(/static/).test(ce.css("position"))){$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}}});$.ui.plugin.add("resizable","alsoResize",{start:function(){var that=$(this).resizable("instance"),o=that.options;$(o.alsoResize).each(function(){var el=$(this);el.data("ui-resizable-alsoresize",{width:parseInt(el.width(),10),height:parseInt(el.height(),10),left:parseInt(el.css("left"),10),top:parseInt(el.css("top"),10)});});},resize:function(event,ui){var that=$(this).resizable("instance"),o=that.options,os=that.originalSize,op=that.originalPosition,delta={height:(that.size.height-os.height)||0,width:(that.size.width-os.width)||0,top:(that.position.top-op.top)||0,left:(that.position.left-op.left)||0};$(o.alsoResize).each(function(){var el=$(this),start=$(this).data("ui-resizable-alsoresize"),style={},css=el.parents(ui.originalElement[0]).length?["width","height"]:["width","height","top","left"];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);if(sum&&sum>=0){style[prop]=sum||null;}});el.css(style);});},stop:function(){$(this).removeData("resizable-alsoresize");}});$.ui.plugin.add("resizable","ghost",{start:function(){var that=$(this).resizable("instance"),o=that.options,cs=that.size;that.ghost=that.originalElement.clone();that.ghost.css({opacity:0.25,display:"block",position:"relative",height:cs.height,width:cs.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof o.ghost==="string"?o.ghost:"");that.ghost.appendTo(that.helper);},resize:function(){var that=$(this).resizable("instance");if(that.ghost){that.ghost.css({position:"relative",height:that.size.height,width:that.size.width});}},stop:function(){var that=$(this).resizable("instance");if(that.ghost&&that.helper){that.helper.get(0).removeChild(that.ghost.get(0));}}});$.ui.plugin.add("resizable","grid",{resize:function(){var outerDimensions,that=$(this).resizable("instance"),o=that.options,cs=that.size,os=that.originalSize,op=that.originalPosition,a=that.axis,grid=typeof o.grid==="number"?[o.grid,o.grid]:o.grid,gridX=(grid[0]||1),gridY=(grid[1]||1),ox=Math.round((cs.width-os.width)/gridX)*gridX,oy=Math.round((cs.height-os.height)/gridY)*gridY,newWidth=os.width+ox,newHeight=os.height+oy,isMaxWidth=o.maxWidth&&(o.maxWidth<newWidth),isMaxHeight=o.maxHeight&&(o.maxHeight<newHeight),isMinWidth=o.minWidth&&(o.minWidth>newWidth),isMinHeight=o.minHeight&&(o.minHeight>newHeight);o.grid=grid;if(isMinWidth){newWidth+=gridX;}
if(isMinHeight){newHeight+=gridY;}
if(isMaxWidth){newWidth-=gridX;}
if(isMaxHeight){newHeight-=gridY;}
if(/^(se|s|e)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;}else if(/^(ne)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;that.position.top=op.top-oy;}else if(/^(sw)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;that.position.left=op.left-ox;}else{if(newHeight-gridY<=0||newWidth-gridX<=0){outerDimensions=that._getPaddingPlusBorderDimensions(this);}
if(newHeight-gridY>0){that.size.height=newHeight;that.position.top=op.top-oy;}else{newHeight=gridY-outerDimensions.height;that.size.height=newHeight;that.position.top=op.top+os.height-newHeight;}
if(newWidth-gridX>0){that.size.width=newWidth;that.position.left=op.left-ox;}else{newWidth=gridX-outerDimensions.width;that.size.width=newWidth;that.position.left=op.left+os.width-newWidth;}}}});var resizable=$.ui.resizable;/*!
 * jQuery UI Selectable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/selectable/
 */var selectable=$.widget("ui.selectable",$.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:true,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var selectees,that=this;this.element.addClass("ui-selectable");this.dragged=false;this.refresh=function(){selectees=$(that.options.filter,that.element[0]);selectees.addClass("ui-selectee");selectees.each(function(){var $this=$(this),pos=$this.offset();$.data(this,"selectable-item",{element:this,$element:$this,left:pos.left,top:pos.top,right:pos.left+$this.outerWidth(),bottom:pos.top+$this.outerHeight(),startselected:false,selected:$this.hasClass("ui-selected"),selecting:$this.hasClass("ui-selecting"),unselecting:$this.hasClass("ui-unselecting")});});};this.refresh();this.selectees=selectees.addClass("ui-selectee");this._mouseInit();this.helper=$("<div class='ui-selectable-helper'></div>");},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled");this._mouseDestroy();},_mouseStart:function(event){var that=this,options=this.options;this.opos=[event.pageX,event.pageY];if(this.options.disabled){return;}
this.selectees=$(options.filter,this.element[0]);this._trigger("start",event);$(options.appendTo).append(this.helper);this.helper.css({"left":event.pageX,"top":event.pageY,"width":0,"height":0});if(options.autoRefresh){this.refresh();}
this.selectees.filter(".ui-selected").each(function(){var selectee=$.data(this,"selectable-item");selectee.startselected=true;if(!event.metaKey&&!event.ctrlKey){selectee.$element.removeClass("ui-selected");selectee.selected=false;selectee.$element.addClass("ui-unselecting");selectee.unselecting=true;that._trigger("unselecting",event,{unselecting:selectee.element});}});$(event.target).parents().addBack().each(function(){var doSelect,selectee=$.data(this,"selectable-item");if(selectee){doSelect=(!event.metaKey&&!event.ctrlKey)||!selectee.$element.hasClass("ui-selected");selectee.$element.removeClass(doSelect?"ui-unselecting":"ui-selected").addClass(doSelect?"ui-selecting":"ui-unselecting");selectee.unselecting=!doSelect;selectee.selecting=doSelect;selectee.selected=doSelect;if(doSelect){that._trigger("selecting",event,{selecting:selectee.element});}else{that._trigger("unselecting",event,{unselecting:selectee.element});}
return false;}});},_mouseDrag:function(event){this.dragged=true;if(this.options.disabled){return;}
var tmp,that=this,options=this.options,x1=this.opos[0],y1=this.opos[1],x2=event.pageX,y2=event.pageY;if(x1>x2){tmp=x2;x2=x1;x1=tmp;}
if(y1>y2){tmp=y2;y2=y1;y1=tmp;}
this.helper.css({left:x1,top:y1,width:x2-x1,height:y2-y1});this.selectees.each(function(){var selectee=$.data(this,"selectable-item"),hit=false;if(!selectee||selectee.element===that.element[0]){return;}
if(options.tolerance==="touch"){hit=(!(selectee.left>x2||selectee.right<x1||selectee.top>y2||selectee.bottom<y1));}else if(options.tolerance==="fit"){hit=(selectee.left>x1&&selectee.right<x2&&selectee.top>y1&&selectee.bottom<y2);}
if(hit){if(selectee.selected){selectee.$element.removeClass("ui-selected");selectee.selected=false;}
if(selectee.unselecting){selectee.$element.removeClass("ui-unselecting");selectee.unselecting=false;}
if(!selectee.selecting){selectee.$element.addClass("ui-selecting");selectee.selecting=true;that._trigger("selecting",event,{selecting:selectee.element});}}else{if(selectee.selecting){if((event.metaKey||event.ctrlKey)&&selectee.startselected){selectee.$element.removeClass("ui-selecting");selectee.selecting=false;selectee.$element.addClass("ui-selected");selectee.selected=true;}else{selectee.$element.removeClass("ui-selecting");selectee.selecting=false;if(selectee.startselected){selectee.$element.addClass("ui-unselecting");selectee.unselecting=true;}
that._trigger("unselecting",event,{unselecting:selectee.element});}}
if(selectee.selected){if(!event.metaKey&&!event.ctrlKey&&!selectee.startselected){selectee.$element.removeClass("ui-selected");selectee.selected=false;selectee.$element.addClass("ui-unselecting");selectee.unselecting=true;that._trigger("unselecting",event,{unselecting:selectee.element});}}}});return false;},_mouseStop:function(event){var that=this;this.dragged=false;$(".ui-unselecting",this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass("ui-unselecting");selectee.unselecting=false;selectee.startselected=false;that._trigger("unselected",event,{unselected:selectee.element});});$(".ui-selecting",this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass("ui-selecting").addClass("ui-selected");selectee.selecting=false;selectee.selected=true;selectee.startselected=true;that._trigger("selected",event,{selected:selectee.element});});this._trigger("stop",event);this.helper.remove();return false;}});/*!
 * jQuery UI Sortable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/sortable/
 */var sortable=$.widget("ui.sortable",$.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(x,reference,size){return(x>=reference)&&(x<(reference+size));},_isFloating:function(item){return(/left|right/).test(item.css("float"))||(/inline|table-cell/).test(item.css("display"));},_create:function(){this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.offset=this.element.offset();this._mouseInit();this._setHandleClassName();this.ready=true;},_setOption:function(key,value){this._super(key,value);if(key==="handle"){this._setHandleClassName();}},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle");$.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle");});},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--){this.items[i].item.removeData(this.widgetName+"-item");}
return this;},_mouseCapture:function(event,overrideHandle){var currentItem=null,validHandle=false,that=this;if(this.reverting){return false;}
if(this.options.disabled||this.options.type==="static"){return false;}
this._refreshItems(event);$(event.target).parents().each(function(){if($.data(this,that.widgetName+"-item")===that){currentItem=$(this);return false;}});if($.data(event.target,that.widgetName+"-item")===that){currentItem=$(event.target);}
if(!currentItem){return false;}
if(this.options.handle&&!overrideHandle){$(this.options.handle,currentItem).find("*").addBack().each(function(){if(this===event.target){validHandle=true;}});if(!validHandle){return false;}}
this.currentItem=currentItem;this._removeCurrentsFromItems();return true;},_mouseStart:function(event,overrideHandle,noActivation){var i,body,o=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0]){this.currentItem.hide();}
this._createPlaceholder();if(o.containment){this._setContainment();}
if(o.cursor&&o.cursor!=="auto"){body=this.document.find("body");this.storedCursor=body.css("cursor");body.css("cursor",o.cursor);this.storedStylesheet=$("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(body);}
if(o.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity");}
this.helper.css("opacity",o.opacity);}
if(o.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex");}
this.helper.css("zIndex",o.zIndex);}
if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"){this.overflowOffset=this.scrollParent.offset();}
this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions();}
if(!noActivation){for(i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,this._uiHash(this));}}
if($.ui.ddmanager){$.ui.ddmanager.current=this;}
if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}
this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return true;},_mouseDrag:function(event){var i,item,itemElement,intersection,o=this.options,scrolled=false;this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs;}
if(this.options.scroll){if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed;}else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed;}
if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed;}else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed;}}else{if(event.pageY-this.document.scrollTop()<o.scrollSensitivity){scrolled=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed);}else if(this.window.height()-(event.pageY-this.document.scrollTop())<o.scrollSensitivity){scrolled=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed);}
if(event.pageX-this.document.scrollLeft()<o.scrollSensitivity){scrolled=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed);}else if(this.window.width()-(event.pageX-this.document.scrollLeft())<o.scrollSensitivity){scrolled=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed);}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}}
this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px";}
if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px";}
for(i=this.items.length-1;i>=0;i--){item=this.items[i];itemElement=item.item[0];intersection=this._intersectsWithPointer(item);if(!intersection){continue;}
if(item.instance!==this.currentContainer){continue;}
if(itemElement!==this.currentItem[0]&&this.placeholder[intersection===1?"next":"prev"]()[0]!==itemElement&&!$.contains(this.placeholder[0],itemElement)&&(this.options.type==="semi-dynamic"?!$.contains(this.element[0],itemElement):true)){this.direction=intersection===1?"down":"up";if(this.options.tolerance==="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item);}else{break;}
this._trigger("change",event,this._uiHash());break;}}
this._contactContainers(event);if($.ui.ddmanager){$.ui.ddmanager.drag(this,event);}
this._trigger("sort",event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false;},_mouseStop:function(event,noPropagation){if(!event){return;}
if($.ui.ddmanager&&!this.options.dropBehaviour){$.ui.ddmanager.drop(this,event);}
if(this.options.revert){var that=this,cur=this.placeholder.offset(),axis=this.options.axis,animation={};if(!axis||axis==="x"){animation.left=cur.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft);}
if(!axis||axis==="y"){animation.top=cur.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop);}
this.reverting=true;$(this.helper).animate(animation,parseInt(this.options.revert,10)||500,function(){that._clear(event);});}else{this._clear(event,noPropagation);}
return false;},cancel:function(){if(this.dragging){this._mouseUp({target:null});if(this.options.helper==="original"){this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else{this.currentItem.show();}
for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,this._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0]);}
if(this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove();}
$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem);}else{$(this.domPosition.parent).prepend(this.currentItem);}}
return this;},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected),str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||"id")||"").match(o.expression||(/(.+)[\-=_](.+)/));if(res){str.push((o.key||res[1]+"[]")+"="+(o.key&&o.expression?res[1]:res[2]));}});if(!str.length&&o.key){str.push(o.key+"=");}
return str.join("&");},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected),ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||"id")||"");});return ret;},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height,l=item.left,r=l+item.width,t=item.top,b=t+item.height,dyClick=this.offset.click.top,dxClick=this.offset.click.left,isOverElementHeight=(this.options.axis==="x")||((y1+dyClick)>t&&(y1+dyClick)<b),isOverElementWidth=(this.options.axis==="y")||((x1+dxClick)>l&&(x1+dxClick)<r),isOverElement=isOverElementHeight&&isOverElementWidth;if(this.options.tolerance==="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>item[this.floating?"width":"height"])){return isOverElement;}else{return(l<x1+(this.helperProportions.width/2)&&x2-(this.helperProportions.width/2)<r&&t<y1+(this.helperProportions.height/2)&&y2-(this.helperProportions.height/2)<b);}},_intersectsWithPointer:function(item){var isOverElementHeight=(this.options.axis==="x")||this._isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=(this.options.axis==="y")||this._isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(!isOverElement){return false;}
return this.floating?(((horizontalDirection&&horizontalDirection==="right")||verticalDirection==="down")?2:1):(verticalDirection&&(verticalDirection==="down"?2:1));},_intersectsWithSides:function(item){var isOverBottomHalf=this._isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+(item.height/2),item.height),isOverRightHalf=this._isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+(item.width/2),item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return((horizontalDirection==="right"&&isOverRightHalf)||(horizontalDirection==="left"&&!isOverRightHalf));}else{return verticalDirection&&((verticalDirection==="down"&&isOverBottomHalf)||(verticalDirection==="up"&&!isOverBottomHalf));}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!==0&&(delta>0?"down":"up");},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!==0&&(delta>0?"right":"left");},refresh:function(event){this._refreshItems(event);this._setHandleClassName();this.refreshPositions();return this;},_connectWith:function(){var options=this.options;return options.connectWith.constructor===String?[options.connectWith]:options.connectWith;},_getItemsAsjQuery:function(connected){var i,j,cur,inst,items=[],queries=[],connectWith=this._connectWith();if(connectWith&&connected){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i],this.document[0]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),inst]);}}}}
queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);function addItems(){items.push(this);}
for(i=queries.length-1;i>=0;i--){queries[i][0].each(addItems);}
return $(items);},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++){if(list[j]===item.item[0]){return false;}}
return true;});},_refreshItems:function(event){this.items=[];this.containers=[this];var i,j,cur,inst,targetData,_queries,item,queriesLength,items=this.items,queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]],connectWith=this._connectWith();if(connectWith&&this.ready){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i],this.document[0]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst);}}}}
for(i=queries.length-1;i>=0;i--){targetData=queries[i][1];_queries=queries[i][0];for(j=0,queriesLength=_queries.length;j<queriesLength;j++){item=$(_queries[j]);item.data(this.widgetName+"-item",targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0});}}},refreshPositions:function(fast){this.floating=this.items.length?this.options.axis==="x"||this._isFloating(this.items[0].item):false;if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset();}
var i,item,t,p;for(i=this.items.length-1;i>=0;i--){item=this.items[i];if(item.instance!==this.currentContainer&&this.currentContainer&&item.item[0]!==this.currentItem[0]){continue;}
t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight();}
p=t.offset();item.left=p.left;item.top=p.top;}
if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this);}else{for(i=this.containers.length-1;i>=0;i--){p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight();}}
return this;},_createPlaceholder:function(that){that=that||this;var className,o=that.options;if(!o.placeholder||o.placeholder.constructor===String){className=o.placeholder;o.placeholder={element:function(){var nodeName=that.currentItem[0].nodeName.toLowerCase(),element=$("<"+nodeName+">",that.document[0]).addClass(className||that.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");if(nodeName==="tbody"){that._createTrPlaceholder(that.currentItem.find("tr").eq(0),$("<tr>",that.document[0]).appendTo(element));}else if(nodeName==="tr"){that._createTrPlaceholder(that.currentItem,element);}else if(nodeName==="img"){element.attr("src",that.currentItem.attr("src"));}
if(!className){element.css("visibility","hidden");}
return element;},update:function(container,p){if(className&&!o.forcePlaceholderSize){return;}
if(!p.height()){p.height(that.currentItem.innerHeight()-parseInt(that.currentItem.css("paddingTop")||0,10)-parseInt(that.currentItem.css("paddingBottom")||0,10));}
if(!p.width()){p.width(that.currentItem.innerWidth()-parseInt(that.currentItem.css("paddingLeft")||0,10)-parseInt(that.currentItem.css("paddingRight")||0,10));}}};}
that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem));that.currentItem.after(that.placeholder);o.placeholder.update(that,that.placeholder);},_createTrPlaceholder:function(sourceTr,targetTr){var that=this;sourceTr.children().each(function(){$("<td>&#160;</td>",that.document[0]).attr("colspan",$(this).attr("colspan")||1).appendTo(targetTr);});},_contactContainers:function(event){var i,j,dist,itemWithLeastDistance,posProperty,sizeProperty,cur,nearBottom,floating,axis,innermostContainer=null,innermostIndex=null;for(i=this.containers.length-1;i>=0;i--){if($.contains(this.currentItem[0],this.containers[i].element[0])){continue;}
if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0])){continue;}
innermostContainer=this.containers[i];innermostIndex=i;}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(!innermostContainer){return;}
if(this.containers.length===1){if(!this.containers[innermostIndex].containerCache.over){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}}else{dist=10000;itemWithLeastDistance=null;floating=innermostContainer.floating||this._isFloating(this.currentItem);posProperty=floating?"left":"top";sizeProperty=floating?"width":"height";axis=floating?"clientX":"clientY";for(j=this.items.length-1;j>=0;j--){if(!$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])){continue;}
if(this.items[j].item[0]===this.currentItem[0]){continue;}
cur=this.items[j].item.offset()[posProperty];nearBottom=false;if(event[axis]-cur>this.items[j][sizeProperty]/2){nearBottom=true;}
if(Math.abs(event[axis]-cur)<dist){dist=Math.abs(event[axis]-cur);itemWithLeastDistance=this.items[j];this.direction=nearBottom?"up":"down";}}
if(!itemWithLeastDistance&&!this.options.dropOnEmpty){return;}
if(this.currentContainer===this.containers[innermostIndex]){if(!this.currentContainer.containerCache.over){this.containers[innermostIndex]._trigger("over",event,this._uiHash());this.currentContainer.containerCache.over=1;}
return;}
itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.currentContainer=this.containers[innermostIndex];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):(o.helper==="clone"?this.currentItem.clone():this.currentItem);if(!helper.parents("body").length){$(o.appendTo!=="parent"?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]);}
if(helper[0]===this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};}
if(!helper[0].style.width||o.forceHelperSize){helper.width(this.currentItem.width());}
if(!helper[0].style.height||o.forceHelperSize){helper.height(this.currentItem.height());}
return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj==="string"){obj=obj.split(" ");}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if("left"in obj){this.offset.click.left=obj.left+this.margins.left;}
if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if("top"in obj){this.offset.click.top=obj.top+this.margins.top;}
if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if(this.offsetParent[0]===this.document[0].body||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&$.ui.ie)){po={top:0,left:0};}
return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var ce,co,over,o=this.options;if(o.containment==="parent"){o.containment=this.helper[0].parentNode;}
if(o.containment==="document"||o.containment==="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,o.containment==="document"?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,(o.containment==="document"?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];}
if(!(/^(document|window|parent)$/).test(o.containment)){ce=$(o.containment)[0];co=$(o.containment).offset();over=($(ce).css("overflow")!=="hidden");this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top];}},_convertPositionTo:function(d,pos){if(!pos){pos=this.position;}
var mod=d==="absolute"?1:-1,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top+
this.offset.relative.top*mod+
this.offset.parent.top*mod-
((this.cssPosition==="fixed"?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left+
this.offset.relative.left*mod+
this.offset.parent.left*mod-
((this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var top,left,o=this.options,pageX=event.pageX,pageY=event.pageY,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);if(this.cssPosition==="relative"&&!(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0])){this.offset.relative=this._getRelativeOffset();}
if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0]){pageX=this.containment[0]+this.offset.click.left;}
if(event.pageY-this.offset.click.top<this.containment[1]){pageY=this.containment[1]+this.offset.click.top;}
if(event.pageX-this.offset.click.left>this.containment[2]){pageX=this.containment[2]+this.offset.click.left;}
if(event.pageY-this.offset.click.top>this.containment[3]){pageY=this.containment[3]+this.offset.click.top;}}
if(o.grid){top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?((top-this.offset.click.top>=this.containment[1]&&top-this.offset.click.top<=this.containment[3])?top:((top-this.offset.click.top>=this.containment[1])?top-o.grid[1]:top+o.grid[1])):top;left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?((left-this.offset.click.left>=this.containment[0]&&left-this.offset.click.left<=this.containment[2])?left:((left-this.offset.click.left>=this.containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY-
this.offset.click.top-
this.offset.relative.top-
this.offset.parent.top+
((this.cssPosition==="fixed"?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX-
this.offset.click.left-
this.offset.relative.left-
this.offset.parent.left+
((this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction==="down"?i.item[0]:i.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){if(counter===this.counter){this.refreshPositions(!hardRefresh);}});},_clear:function(event,noPropagation){this.reverting=false;var i,delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem);}
this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(i in this._storedCSS){if(this._storedCSS[i]==="auto"||this._storedCSS[i]==="static"){this._storedCSS[i]="";}}
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else{this.currentItem.show();}
if(this.fromOutside&&!noPropagation){delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside));});}
if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!noPropagation){delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash());});}
if(this!==this.currentContainer){if(!noPropagation){delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash());});delayedTriggers.push((function(c){return function(event){c._trigger("receive",event,this._uiHash(this));};}).call(this,this.currentContainer));delayedTriggers.push((function(c){return function(event){c._trigger("update",event,this._uiHash(this));};}).call(this,this.currentContainer));}}
function delayEvent(type,instance,container){return function(event){container._trigger(type,event,instance._uiHash(instance));};}
for(i=this.containers.length-1;i>=0;i--){if(!noPropagation){delayedTriggers.push(delayEvent("deactivate",this,this.containers[i]));}
if(this.containers[i].containerCache.over){delayedTriggers.push(delayEvent("out",this,this.containers[i]));this.containers[i].containerCache.over=0;}}
if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove();}
if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity);}
if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex);}
this.dragging=false;if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());}
this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(!this.cancelHelperRemoval){if(this.helper[0]!==this.currentItem[0]){this.helper.remove();}
this.helper=null;}
if(!noPropagation){for(i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);}
this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return!this.cancelHelperRemoval;},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel();}},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null};}});/*!
 * jQuery UI Effects 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/category/effects-core/
 */var dataSpace="ui-effects-",jQuery=$;$.effects={effect:{}};/*!
 * jQuery Color Animations v2.1.2
 * https://github.com/jquery/jquery-color
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: Wed Jan 16 08:47:09 2013 -0600
 */(function(jQuery,undefined){var stepHooks="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",rplusequals=/^([\-+])=\s*(\d+\.?\d*)/,stringParsers=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]];}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1]*2.55,execResult[2]*2.55,execResult[3]*2.55,execResult[4]];}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16)];}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16)];}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(execResult){return[execResult[1],execResult[2]/100,execResult[3]/100,execResult[4]];}}],color=jQuery.Color=function(color,green,blue,alpha){return new jQuery.Color.fn.parse(color,green,blue,alpha);},spaces={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},propTypes={"byte":{floor:true,max:255},"percent":{max:1},"degrees":{mod:360,floor:true}},support=color.support={},supportElem=jQuery("<p>")[0],colors,each=jQuery.each;supportElem.style.cssText="background-color:rgba(1,1,1,.5)";support.rgba=supportElem.style.backgroundColor.indexOf("rgba")>-1;each(spaces,function(spaceName,space){space.cache="_"+spaceName;space.props.alpha={idx:3,type:"percent",def:1};});function clamp(value,prop,allowEmpty){var type=propTypes[prop.type]||{};if(value==null){return(allowEmpty||!prop.def)?null:prop.def;}
value=type.floor?~~value:parseFloat(value);if(isNaN(value)){return prop.def;}
if(type.mod){return(value+type.mod)%type.mod;}
return 0>value?0:type.max<value?type.max:value;}
function stringParse(string){var inst=color(),rgba=inst._rgba=[];string=string.toLowerCase();each(stringParsers,function(i,parser){var parsed,match=parser.re.exec(string),values=match&&parser.parse(match),spaceName=parser.space||"rgba";if(values){parsed=inst[spaceName](values);inst[spaces[spaceName].cache]=parsed[spaces[spaceName].cache];rgba=inst._rgba=parsed._rgba;return false;}});if(rgba.length){if(rgba.join()==="0,0,0,0"){jQuery.extend(rgba,colors.transparent);}
return inst;}
return colors[string];}
color.fn=jQuery.extend(color.prototype,{parse:function(red,green,blue,alpha){if(red===undefined){this._rgba=[null,null,null,null];return this;}
if(red.jquery||red.nodeType){red=jQuery(red).css(green);green=undefined;}
var inst=this,type=jQuery.type(red),rgba=this._rgba=[];if(green!==undefined){red=[red,green,blue,alpha];type="array";}
if(type==="string"){return this.parse(stringParse(red)||colors._default);}
if(type==="array"){each(spaces.rgba.props,function(key,prop){rgba[prop.idx]=clamp(red[prop.idx],prop);});return this;}
if(type==="object"){if(red instanceof color){each(spaces,function(spaceName,space){if(red[space.cache]){inst[space.cache]=red[space.cache].slice();}});}else{each(spaces,function(spaceName,space){var cache=space.cache;each(space.props,function(key,prop){if(!inst[cache]&&space.to){if(key==="alpha"||red[key]==null){return;}
inst[cache]=space.to(inst._rgba);}
inst[cache][prop.idx]=clamp(red[key],prop,true);});if(inst[cache]&&jQuery.inArray(null,inst[cache].slice(0,3))<0){inst[cache][3]=1;if(space.from){inst._rgba=space.from(inst[cache]);}}});}
return this;}},is:function(compare){var is=color(compare),same=true,inst=this;each(spaces,function(_,space){var localCache,isCache=is[space.cache];if(isCache){localCache=inst[space.cache]||space.to&&space.to(inst._rgba)||[];each(space.props,function(_,prop){if(isCache[prop.idx]!=null){same=(isCache[prop.idx]===localCache[prop.idx]);return same;}});}
return same;});return same;},_space:function(){var used=[],inst=this;each(spaces,function(spaceName,space){if(inst[space.cache]){used.push(spaceName);}});return used.pop();},transition:function(other,distance){var end=color(other),spaceName=end._space(),space=spaces[spaceName],startColor=this.alpha()===0?color("transparent"):this,start=startColor[space.cache]||space.to(startColor._rgba),result=start.slice();end=end[space.cache];each(space.props,function(key,prop){var index=prop.idx,startValue=start[index],endValue=end[index],type=propTypes[prop.type]||{};if(endValue===null){return;}
if(startValue===null){result[index]=endValue;}else{if(type.mod){if(endValue-startValue>type.mod/2){startValue+=type.mod;}else if(startValue-endValue>type.mod/2){startValue-=type.mod;}}
result[index]=clamp((endValue-startValue)*distance+startValue,prop);}});return this[spaceName](result);},blend:function(opaque){if(this._rgba[3]===1){return this;}
var rgb=this._rgba.slice(),a=rgb.pop(),blend=color(opaque)._rgba;return color(jQuery.map(rgb,function(v,i){return(1-a)*blend[i]+a*v;}));},toRgbaString:function(){var prefix="rgba(",rgba=jQuery.map(this._rgba,function(v,i){return v==null?(i>2?1:0):v;});if(rgba[3]===1){rgba.pop();prefix="rgb(";}
return prefix+rgba.join()+")";},toHslaString:function(){var prefix="hsla(",hsla=jQuery.map(this.hsla(),function(v,i){if(v==null){v=i>2?1:0;}
if(i&&i<3){v=Math.round(v*100)+"%";}
return v;});if(hsla[3]===1){hsla.pop();prefix="hsl(";}
return prefix+hsla.join()+")";},toHexString:function(includeAlpha){var rgba=this._rgba.slice(),alpha=rgba.pop();if(includeAlpha){rgba.push(~~(alpha*255));}
return"#"+jQuery.map(rgba,function(v){v=(v||0).toString(16);return v.length===1?"0"+v:v;}).join("");},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString();}});color.fn.parse.prototype=color.fn;function hue2rgb(p,q,h){h=(h+1)%1;if(h*6<1){return p+(q-p)*h*6;}
if(h*2<1){return q;}
if(h*3<2){return p+(q-p)*((2/3)-h)*6;}
return p;}
spaces.hsla.to=function(rgba){if(rgba[0]==null||rgba[1]==null||rgba[2]==null){return[null,null,null,rgba[3]];}
var r=rgba[0]/255,g=rgba[1]/255,b=rgba[2]/255,a=rgba[3],max=Math.max(r,g,b),min=Math.min(r,g,b),diff=max-min,add=max+min,l=add*0.5,h,s;if(min===max){h=0;}else if(r===max){h=(60*(g-b)/diff)+360;}else if(g===max){h=(60*(b-r)/diff)+120;}else{h=(60*(r-g)/diff)+240;}
if(diff===0){s=0;}else if(l<=0.5){s=diff/add;}else{s=diff/(2-add);}
return[Math.round(h)%360,s,l,a==null?1:a];};spaces.hsla.from=function(hsla){if(hsla[0]==null||hsla[1]==null||hsla[2]==null){return[null,null,null,hsla[3]];}
var h=hsla[0]/360,s=hsla[1],l=hsla[2],a=hsla[3],q=l<=0.5?l*(1+s):l+s-l*s,p=2*l-q;return[Math.round(hue2rgb(p,q,h+(1/3))*255),Math.round(hue2rgb(p,q,h)*255),Math.round(hue2rgb(p,q,h-(1/3))*255),a];};each(spaces,function(spaceName,space){var props=space.props,cache=space.cache,to=space.to,from=space.from;color.fn[spaceName]=function(value){if(to&&!this[cache]){this[cache]=to(this._rgba);}
if(value===undefined){return this[cache].slice();}
var ret,type=jQuery.type(value),arr=(type==="array"||type==="object")?value:arguments,local=this[cache].slice();each(props,function(key,prop){var val=arr[type==="object"?key:prop.idx];if(val==null){val=local[prop.idx];}
local[prop.idx]=clamp(val,prop);});if(from){ret=color(from(local));ret[cache]=local;return ret;}else{return color(local);}};each(props,function(key,prop){if(color.fn[key]){return;}
color.fn[key]=function(value){var vtype=jQuery.type(value),fn=(key==="alpha"?(this._hsla?"hsla":"rgba"):spaceName),local=this[fn](),cur=local[prop.idx],match;if(vtype==="undefined"){return cur;}
if(vtype==="function"){value=value.call(this,cur);vtype=jQuery.type(value);}
if(value==null&&prop.empty){return this;}
if(vtype==="string"){match=rplusequals.exec(value);if(match){value=cur+parseFloat(match[2])*(match[1]==="+"?1:-1);}}
local[prop.idx]=value;return this[fn](local);};});});color.hook=function(hook){var hooks=hook.split(" ");each(hooks,function(i,hook){jQuery.cssHooks[hook]={set:function(elem,value){var parsed,curElem,backgroundColor="";if(value!=="transparent"&&(jQuery.type(value)!=="string"||(parsed=stringParse(value)))){value=color(parsed||value);if(!support.rgba&&value._rgba[3]!==1){curElem=hook==="backgroundColor"?elem.parentNode:elem;while((backgroundColor===""||backgroundColor==="transparent")&&curElem&&curElem.style){try{backgroundColor=jQuery.css(curElem,"backgroundColor");curElem=curElem.parentNode;}catch(e){}}
value=value.blend(backgroundColor&&backgroundColor!=="transparent"?backgroundColor:"_default");}
value=value.toRgbaString();}
try{elem.style[hook]=value;}catch(e){}}};jQuery.fx.step[hook]=function(fx){if(!fx.colorInit){fx.start=color(fx.elem,hook);fx.end=color(fx.end);fx.colorInit=true;}
jQuery.cssHooks[hook].set(fx.elem,fx.start.transition(fx.end,fx.pos));};});};color.hook(stepHooks);jQuery.cssHooks.borderColor={expand:function(value){var expanded={};each(["Top","Right","Bottom","Left"],function(i,part){expanded["border"+part+"Color"]=value;});return expanded;}};colors=jQuery.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"};})(jQuery);(function(){var classAnimationActions=["add","remove","toggle"],shorthandStyles={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};$.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(_,prop){$.fx.step[prop]=function(fx){if(fx.end!=="none"&&!fx.setAttr||fx.pos===1&&!fx.setAttr){jQuery.style(fx.elem,prop,fx.end);fx.setAttr=true;}};});function getElementStyles(elem){var key,len,style=elem.ownerDocument.defaultView?elem.ownerDocument.defaultView.getComputedStyle(elem,null):elem.currentStyle,styles={};if(style&&style.length&&style[0]&&style[style[0]]){len=style.length;while(len--){key=style[len];if(typeof style[key]==="string"){styles[$.camelCase(key)]=style[key];}}}else{for(key in style){if(typeof style[key]==="string"){styles[key]=style[key];}}}
return styles;}
function styleDifference(oldStyle,newStyle){var diff={},name,value;for(name in newStyle){value=newStyle[name];if(oldStyle[name]!==value){if(!shorthandStyles[name]){if($.fx.step[name]||!isNaN(parseFloat(value))){diff[name]=value;}}}}
return diff;}
if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));};}
$.effects.animateClass=function(value,duration,easing,callback){var o=$.speed(duration,easing,callback);return this.queue(function(){var animated=$(this),baseClass=animated.attr("class")||"",applyClassChange,allAnimations=o.children?animated.find("*").addBack():animated;allAnimations=allAnimations.map(function(){var el=$(this);return{el:el,start:getElementStyles(this)};});applyClassChange=function(){$.each(classAnimationActions,function(i,action){if(value[action]){animated[action+"Class"](value[action]);}});};applyClassChange();allAnimations=allAnimations.map(function(){this.end=getElementStyles(this.el[0]);this.diff=styleDifference(this.start,this.end);return this;});animated.attr("class",baseClass);allAnimations=allAnimations.map(function(){var styleInfo=this,dfd=$.Deferred(),opts=$.extend({},o,{queue:false,complete:function(){dfd.resolve(styleInfo);}});this.el.animate(this.diff,opts);return dfd.promise();});$.when.apply($,allAnimations.get()).done(function(){applyClassChange();$.each(arguments,function(){var el=this.el;$.each(this.diff,function(key){el.css(key,"");});});o.complete.call(animated[0]);});});};$.fn.extend({addClass:(function(orig){return function(classNames,speed,easing,callback){return speed?$.effects.animateClass.call(this,{add:classNames},speed,easing,callback):orig.apply(this,arguments);};})($.fn.addClass),removeClass:(function(orig){return function(classNames,speed,easing,callback){return arguments.length>1?$.effects.animateClass.call(this,{remove:classNames},speed,easing,callback):orig.apply(this,arguments);};})($.fn.removeClass),toggleClass:(function(orig){return function(classNames,force,speed,easing,callback){if(typeof force==="boolean"||force===undefined){if(!speed){return orig.apply(this,arguments);}else{return $.effects.animateClass.call(this,(force?{add:classNames}:{remove:classNames}),speed,easing,callback);}}else{return $.effects.animateClass.call(this,{toggle:classNames},force,speed,easing);}};})($.fn.toggleClass),switchClass:function(remove,add,speed,easing,callback){return $.effects.animateClass.call(this,{add:add,remove:remove},speed,easing,callback);}});})();(function(){$.extend($.effects,{version:"1.11.4",save:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null){element.data(dataSpace+set[i],element[0].style[set[i]]);}}},restore:function(element,set){var val,i;for(i=0;i<set.length;i++){if(set[i]!==null){val=element.data(dataSpace+set[i]);if(val===undefined){val="";}
element.css(set[i],val);}}},setMode:function(el,mode){if(mode==="toggle"){mode=el.is(":hidden")?"show":"hide";}
return mode;},getBaseline:function(origin,original){var y,x;switch(origin[0]){case"top":y=0;break;case"middle":y=0.5;break;case"bottom":y=1;break;default:y=origin[0]/original.height;}
switch(origin[1]){case"left":x=0;break;case"center":x=0.5;break;case"right":x=1;break;default:x=origin[1]/original.width;}
return{x:x,y:y};},createWrapper:function(element){if(element.parent().is(".ui-effects-wrapper")){return element.parent();}
var props={width:element.outerWidth(true),height:element.outerHeight(true),"float":element.css("float")},wrapper=$("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),size={width:element.width(),height:element.height()},active=document.activeElement;try{active.id;}catch(e){active=document.body;}
element.wrap(wrapper);if(element[0]===active||$.contains(element[0],active)){$(active).focus();}
wrapper=element.parent();if(element.css("position")==="static"){wrapper.css({position:"relative"});element.css({position:"relative"});}else{$.extend(props,{position:element.css("position"),zIndex:element.css("z-index")});$.each(["top","left","bottom","right"],function(i,pos){props[pos]=element.css(pos);if(isNaN(parseInt(props[pos],10))){props[pos]="auto";}});element.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"});}
element.css(size);return wrapper.css(props).show();},removeWrapper:function(element){var active=document.activeElement;if(element.parent().is(".ui-effects-wrapper")){element.parent().replaceWith(element);if(element[0]===active||$.contains(element[0],active)){$(active).focus();}}
return element;},setTransition:function(element,list,factor,value){value=value||{};$.each(list,function(i,x){var unit=element.cssUnit(x);if(unit[0]>0){value[x]=unit[0]*factor+unit[1];}});return value;}});function _normalizeArguments(effect,options,speed,callback){if($.isPlainObject(effect)){options=effect;effect=effect.effect;}
effect={effect:effect};if(options==null){options={};}
if($.isFunction(options)){callback=options;speed=null;options={};}
if(typeof options==="number"||$.fx.speeds[options]){callback=speed;speed=options;options={};}
if($.isFunction(speed)){callback=speed;speed=null;}
if(options){$.extend(effect,options);}
speed=speed||options.duration;effect.duration=$.fx.off?0:typeof speed==="number"?speed:speed in $.fx.speeds?$.fx.speeds[speed]:$.fx.speeds._default;effect.complete=callback||options.complete;return effect;}
function standardAnimationOption(option){if(!option||typeof option==="number"||$.fx.speeds[option]){return true;}
if(typeof option==="string"&&!$.effects.effect[option]){return true;}
if($.isFunction(option)){return true;}
if(typeof option==="object"&&!option.effect){return true;}
return false;}
$.fn.extend({effect:function(){var args=_normalizeArguments.apply(this,arguments),mode=args.mode,queue=args.queue,effectMethod=$.effects.effect[args.effect];if($.fx.off||!effectMethod){if(mode){return this[mode](args.duration,args.complete);}else{return this.each(function(){if(args.complete){args.complete.call(this);}});}}
function run(next){var elem=$(this),complete=args.complete,mode=args.mode;function done(){if($.isFunction(complete)){complete.call(elem[0]);}
if($.isFunction(next)){next();}}
if(elem.is(":hidden")?mode==="hide":mode==="show"){elem[mode]();done();}else{effectMethod.call(elem[0],args,done);}}
return queue===false?this.each(run):this.queue(queue||"fx",run);},show:(function(orig){return function(option){if(standardAnimationOption(option)){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="show";return this.effect.call(this,args);}};})($.fn.show),hide:(function(orig){return function(option){if(standardAnimationOption(option)){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="hide";return this.effect.call(this,args);}};})($.fn.hide),toggle:(function(orig){return function(option){if(standardAnimationOption(option)||typeof option==="boolean"){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="toggle";return this.effect.call(this,args);}};})($.fn.toggle),cssUnit:function(key){var style=this.css(key),val=[];$.each(["em","px","%","pt"],function(i,unit){if(style.indexOf(unit)>0){val=[parseFloat(style),unit];}});return val;}});})();(function(){var baseEasings={};$.each(["Quad","Cubic","Quart","Quint","Expo"],function(i,name){baseEasings[name]=function(p){return Math.pow(p,i+2);};});$.extend(baseEasings,{Sine:function(p){return 1-Math.cos(p*Math.PI/2);},Circ:function(p){return 1-Math.sqrt(1-p*p);},Elastic:function(p){return p===0||p===1?p:-Math.pow(2,8*(p-1))*Math.sin(((p-1)*80-7.5)*Math.PI/15);},Back:function(p){return p*p*(3*p-2);},Bounce:function(p){var pow2,bounce=4;while(p<((pow2=Math.pow(2,--bounce))-1)/11){}
return 1/Math.pow(4,3-bounce)-7.5625*Math.pow((pow2*3-2)/22-p,2);}});$.each(baseEasings,function(name,easeIn){$.easing["easeIn"+name]=easeIn;$.easing["easeOut"+name]=function(p){return 1-easeIn(1-p);};$.easing["easeInOut"+name]=function(p){return p<0.5?easeIn(p*2)/2:1-easeIn(p*-2+2)/2;};});})();var effect=$.effects;/*!
 * jQuery UI Effects Blind 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/blind-effect/
 */var effectBlind=$.effects.effect.blind=function(o,done){var el=$(this),rvertical=/up|down|vertical/,rpositivemotion=/up|left|vertical|horizontal/,props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),direction=o.direction||"up",vertical=rvertical.test(direction),ref=vertical?"height":"width",ref2=vertical?"top":"left",motion=rpositivemotion.test(direction),animation={},show=mode==="show",wrapper,distance,margin;if(el.parent().is(".ui-effects-wrapper")){$.effects.save(el.parent(),props);}else{$.effects.save(el,props);}
el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});distance=wrapper[ref]();margin=parseFloat(wrapper.css(ref2))||0;animation[ref]=show?distance:0;if(!motion){el.css(vertical?"bottom":"right",0).css(vertical?"top":"left","auto").css({position:"absolute"});animation[ref2]=show?margin:distance+margin;}
if(show){wrapper.css(ref,0);if(!motion){wrapper.css(ref2,margin+distance);}}
wrapper.animate(animation,{duration:o.duration,easing:o.easing,queue:false,complete:function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};/*!
 * jQuery UI Effects Bounce 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/bounce-effect/
 */var effectBounce=$.effects.effect.bounce=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"effect"),hide=mode==="hide",show=mode==="show",direction=o.direction||"up",distance=o.distance,times=o.times||5,anims=times*2+(show||hide?1:0),speed=o.duration/anims,easing=o.easing,ref=(direction==="up"||direction==="down")?"top":"left",motion=(direction==="up"||direction==="left"),i,upAnim,downAnim,queue=el.queue(),queuelen=queue.length;if(show||hide){props.push("opacity");}
$.effects.save(el,props);el.show();$.effects.createWrapper(el);if(!distance){distance=el[ref==="top"?"outerHeight":"outerWidth"]()/3;}
if(show){downAnim={opacity:1};downAnim[ref]=0;el.css("opacity",0).css(ref,motion?-distance*2:distance*2).animate(downAnim,speed,easing);}
if(hide){distance=distance/Math.pow(2,times-1);}
downAnim={};downAnim[ref]=0;for(i=0;i<times;i++){upAnim={};upAnim[ref]=(motion?"-=":"+=")+distance;el.animate(upAnim,speed,easing).animate(downAnim,speed,easing);distance=hide?distance*2:distance/2;}
if(hide){upAnim={opacity:0};upAnim[ref]=(motion?"-=":"+=")+distance;el.animate(upAnim,speed,easing);}
el.queue(function(){if(hide){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
el.dequeue();};/*!
 * jQuery UI Effects Clip 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/clip-effect/
 */var effectClip=$.effects.effect.clip=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",direction=o.direction||"vertical",vert=direction==="vertical",size=vert?"height":"width",position=vert?"top":"left",animation={},wrapper,animate,distance;$.effects.save(el,props);el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});animate=(el[0].tagName==="IMG")?wrapper:el;distance=animate[size]();if(show){animate.css(size,0);animate.css(position,distance/2);}
animation[size]=show?distance:0;animation[position]=show?0:distance/2;animate.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(!show){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};/*!
 * jQuery UI Effects Drop 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/drop-effect/
 */var effectDrop=$.effects.effect.drop=function(o,done){var el=$(this),props=["position","top","bottom","left","right","opacity","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",direction=o.direction||"left",ref=(direction==="up"||direction==="down")?"top":"left",motion=(direction==="up"||direction==="left")?"pos":"neg",animation={opacity:show?1:0},distance;$.effects.save(el,props);el.show();$.effects.createWrapper(el);distance=o.distance||el[ref==="top"?"outerHeight":"outerWidth"](true)/2;if(show){el.css("opacity",0).css(ref,motion==="pos"?-distance:distance);}
animation[ref]=(show?(motion==="pos"?"+=":"-="):(motion==="pos"?"-=":"+="))+
distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};/*!
 * jQuery UI Effects Explode 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/explode-effect/
 */var effectExplode=$.effects.effect.explode=function(o,done){var rows=o.pieces?Math.round(Math.sqrt(o.pieces)):3,cells=rows,el=$(this),mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",offset=el.show().css("visibility","hidden").offset(),width=Math.ceil(el.outerWidth()/cells),height=Math.ceil(el.outerHeight()/rows),pieces=[],i,j,left,top,mx,my;function childComplete(){pieces.push(this);if(pieces.length===rows*cells){animComplete();}}
for(i=0;i<rows;i++){top=offset.top+i*height;my=i-(rows-1)/2;for(j=0;j<cells;j++){left=offset.left+j*width;mx=j-(cells-1)/2;el.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-j*width,top:-i*height}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:width,height:height,left:left+(show?mx*width:0),top:top+(show?my*height:0),opacity:show?0:1}).animate({left:left+(show?0:mx*width),top:top+(show?0:my*height),opacity:show?1:0},o.duration||500,o.easing,childComplete);}}
function animComplete(){el.css({visibility:"visible"});$(pieces).remove();if(!show){el.hide();}
done();}};/*!
 * jQuery UI Effects Fade 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/fade-effect/
 */var effectFade=$.effects.effect.fade=function(o,done){var el=$(this),mode=$.effects.setMode(el,o.mode||"toggle");el.animate({opacity:mode},{queue:false,duration:o.duration,easing:o.easing,complete:done});};/*!
 * jQuery UI Effects Fold 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/fold-effect/
 */var effectFold=$.effects.effect.fold=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",hide=mode==="hide",size=o.size||15,percent=/([0-9]+)%/.exec(size),horizFirst=!!o.horizFirst,widthFirst=show!==horizFirst,ref=widthFirst?["width","height"]:["height","width"],duration=o.duration/2,wrapper,distance,animation1={},animation2={};$.effects.save(el,props);el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});distance=widthFirst?[wrapper.width(),wrapper.height()]:[wrapper.height(),wrapper.width()];if(percent){size=parseInt(percent[1],10)/100*distance[hide?0:1];}
if(show){wrapper.css(horizFirst?{height:0,width:size}:{height:size,width:0});}
animation1[ref[0]]=show?distance[0]:size;animation2[ref[1]]=show?distance[1]:0;wrapper.animate(animation1,duration,o.easing).animate(animation2,duration,o.easing,function(){if(hide){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});};/*!
 * jQuery UI Effects Highlight 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/highlight-effect/
 */var effectHighlight=$.effects.effect.highlight=function(o,done){var elem=$(this),props=["backgroundImage","backgroundColor","opacity"],mode=$.effects.setMode(elem,o.mode||"show"),animation={backgroundColor:elem.css("backgroundColor")};if(mode==="hide"){animation.opacity=0;}
$.effects.save(elem,props);elem.show().css({backgroundImage:"none",backgroundColor:o.color||"#ffff99"}).animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(mode==="hide"){elem.hide();}
$.effects.restore(elem,props);done();}});};/*!
 * jQuery UI Effects Size 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/size-effect/
 */var effectSize=$.effects.effect.size=function(o,done){var original,baseline,factor,el=$(this),props0=["position","top","bottom","left","right","width","height","overflow","opacity"],props1=["position","top","bottom","left","right","overflow","opacity"],props2=["width","height","overflow"],cProps=["fontSize"],vProps=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],hProps=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],mode=$.effects.setMode(el,o.mode||"effect"),restore=o.restore||mode!=="effect",scale=o.scale||"both",origin=o.origin||["middle","center"],position=el.css("position"),props=restore?props0:props1,zero={height:0,width:0,outerHeight:0,outerWidth:0};if(mode==="show"){el.show();}
original={height:el.height(),width:el.width(),outerHeight:el.outerHeight(),outerWidth:el.outerWidth()};if(o.mode==="toggle"&&mode==="show"){el.from=o.to||zero;el.to=o.from||original;}else{el.from=o.from||(mode==="show"?zero:original);el.to=o.to||(mode==="hide"?zero:original);}
factor={from:{y:el.from.height/original.height,x:el.from.width/original.width},to:{y:el.to.height/original.height,x:el.to.width/original.width}};if(scale==="box"||scale==="both"){if(factor.from.y!==factor.to.y){props=props.concat(vProps);el.from=$.effects.setTransition(el,vProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,vProps,factor.to.y,el.to);}
if(factor.from.x!==factor.to.x){props=props.concat(hProps);el.from=$.effects.setTransition(el,hProps,factor.from.x,el.from);el.to=$.effects.setTransition(el,hProps,factor.to.x,el.to);}}
if(scale==="content"||scale==="both"){if(factor.from.y!==factor.to.y){props=props.concat(cProps).concat(props2);el.from=$.effects.setTransition(el,cProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,cProps,factor.to.y,el.to);}}
$.effects.save(el,props);el.show();$.effects.createWrapper(el);el.css("overflow","hidden").css(el.from);if(origin){baseline=$.effects.getBaseline(origin,original);el.from.top=(original.outerHeight-el.outerHeight())*baseline.y;el.from.left=(original.outerWidth-el.outerWidth())*baseline.x;el.to.top=(original.outerHeight-el.to.outerHeight)*baseline.y;el.to.left=(original.outerWidth-el.to.outerWidth)*baseline.x;}
el.css(el.from);if(scale==="content"||scale==="both"){vProps=vProps.concat(["marginTop","marginBottom"]).concat(cProps);hProps=hProps.concat(["marginLeft","marginRight"]);props2=props0.concat(vProps).concat(hProps);el.find("*[width]").each(function(){var child=$(this),c_original={height:child.height(),width:child.width(),outerHeight:child.outerHeight(),outerWidth:child.outerWidth()};if(restore){$.effects.save(child,props2);}
child.from={height:c_original.height*factor.from.y,width:c_original.width*factor.from.x,outerHeight:c_original.outerHeight*factor.from.y,outerWidth:c_original.outerWidth*factor.from.x};child.to={height:c_original.height*factor.to.y,width:c_original.width*factor.to.x,outerHeight:c_original.height*factor.to.y,outerWidth:c_original.width*factor.to.x};if(factor.from.y!==factor.to.y){child.from=$.effects.setTransition(child,vProps,factor.from.y,child.from);child.to=$.effects.setTransition(child,vProps,factor.to.y,child.to);}
if(factor.from.x!==factor.to.x){child.from=$.effects.setTransition(child,hProps,factor.from.x,child.from);child.to=$.effects.setTransition(child,hProps,factor.to.x,child.to);}
child.css(child.from);child.animate(child.to,o.duration,o.easing,function(){if(restore){$.effects.restore(child,props2);}});});}
el.animate(el.to,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(el.to.opacity===0){el.css("opacity",el.from.opacity);}
if(mode==="hide"){el.hide();}
$.effects.restore(el,props);if(!restore){if(position==="static"){el.css({position:"relative",top:el.to.top,left:el.to.left});}else{$.each(["top","left"],function(idx,pos){el.css(pos,function(_,str){var val=parseInt(str,10),toRef=idx?el.to.left:el.to.top;if(str==="auto"){return toRef+"px";}
return val+toRef+"px";});});}}
$.effects.removeWrapper(el);done();}});};/*!
 * jQuery UI Effects Scale 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/scale-effect/
 */var effectScale=$.effects.effect.scale=function(o,done){var el=$(this),options=$.extend(true,{},o),mode=$.effects.setMode(el,o.mode||"effect"),percent=parseInt(o.percent,10)||(parseInt(o.percent,10)===0?0:(mode==="hide"?0:100)),direction=o.direction||"both",origin=o.origin,original={height:el.height(),width:el.width(),outerHeight:el.outerHeight(),outerWidth:el.outerWidth()},factor={y:direction!=="horizontal"?(percent/100):1,x:direction!=="vertical"?(percent/100):1};options.effect="size";options.queue=false;options.complete=done;if(mode!=="effect"){options.origin=origin||["middle","center"];options.restore=true;}
options.from=o.from||(mode==="show"?{height:0,width:0,outerHeight:0,outerWidth:0}:original);options.to={height:original.height*factor.y,width:original.width*factor.x,outerHeight:original.outerHeight*factor.y,outerWidth:original.outerWidth*factor.x};if(options.fade){if(mode==="show"){options.from.opacity=0;options.to.opacity=1;}
if(mode==="hide"){options.from.opacity=1;options.to.opacity=0;}}
el.effect(options);};/*!
 * jQuery UI Effects Puff 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/puff-effect/
 */var effectPuff=$.effects.effect.puff=function(o,done){var elem=$(this),mode=$.effects.setMode(elem,o.mode||"hide"),hide=mode==="hide",percent=parseInt(o.percent,10)||150,factor=percent/100,original={height:elem.height(),width:elem.width(),outerHeight:elem.outerHeight(),outerWidth:elem.outerWidth()};$.extend(o,{effect:"scale",queue:false,fade:true,mode:mode,complete:done,percent:hide?percent:100,from:hide?original:{height:original.height*factor,width:original.width*factor,outerHeight:original.outerHeight*factor,outerWidth:original.outerWidth*factor}});elem.effect(o);};/*!
 * jQuery UI Effects Pulsate 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/pulsate-effect/
 */var effectPulsate=$.effects.effect.pulsate=function(o,done){var elem=$(this),mode=$.effects.setMode(elem,o.mode||"show"),show=mode==="show",hide=mode==="hide",showhide=(show||mode==="hide"),anims=((o.times||5)*2)+(showhide?1:0),duration=o.duration/anims,animateTo=0,queue=elem.queue(),queuelen=queue.length,i;if(show||!elem.is(":visible")){elem.css("opacity",0).show();animateTo=1;}
for(i=1;i<anims;i++){elem.animate({opacity:animateTo},duration,o.easing);animateTo=1-animateTo;}
elem.animate({opacity:animateTo},duration,o.easing);elem.queue(function(){if(hide){elem.hide();}
done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
elem.dequeue();};/*!
 * jQuery UI Effects Shake 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/shake-effect/
 */var effectShake=$.effects.effect.shake=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"effect"),direction=o.direction||"left",distance=o.distance||20,times=o.times||3,anims=times*2+1,speed=Math.round(o.duration/anims),ref=(direction==="up"||direction==="down")?"top":"left",positiveMotion=(direction==="up"||direction==="left"),animation={},animation1={},animation2={},i,queue=el.queue(),queuelen=queue.length;$.effects.save(el,props);el.show();$.effects.createWrapper(el);animation[ref]=(positiveMotion?"-=":"+=")+distance;animation1[ref]=(positiveMotion?"+=":"-=")+distance*2;animation2[ref]=(positiveMotion?"-=":"+=")+distance*2;el.animate(animation,speed,o.easing);for(i=1;i<times;i++){el.animate(animation1,speed,o.easing).animate(animation2,speed,o.easing);}
el.animate(animation1,speed,o.easing).animate(animation,speed/2,o.easing).queue(function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
el.dequeue();};/*!
 * jQuery UI Effects Slide 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/slide-effect/
 */var effectSlide=$.effects.effect.slide=function(o,done){var el=$(this),props=["position","top","bottom","left","right","width","height"],mode=$.effects.setMode(el,o.mode||"show"),show=mode==="show",direction=o.direction||"left",ref=(direction==="up"||direction==="down")?"top":"left",positiveMotion=(direction==="up"||direction==="left"),distance,animation={};$.effects.save(el,props);el.show();distance=o.distance||el[ref==="top"?"outerHeight":"outerWidth"](true);$.effects.createWrapper(el).css({overflow:"hidden"});if(show){el.css(ref,positiveMotion?(isNaN(distance)?"-"+distance:-distance):distance);}
animation[ref]=(show?(positiveMotion?"+=":"-="):(positiveMotion?"-=":"+="))+
distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};/*!
 * jQuery UI Effects Transfer 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/transfer-effect/
 */var effectTransfer=$.effects.effect.transfer=function(o,done){var elem=$(this),target=$(o.to),targetFixed=target.css("position")==="fixed",body=$("body"),fixTop=targetFixed?body.scrollTop():0,fixLeft=targetFixed?body.scrollLeft():0,endPosition=target.offset(),animation={top:endPosition.top-fixTop,left:endPosition.left-fixLeft,height:target.innerHeight(),width:target.innerWidth()},startPosition=elem.offset(),transfer=$("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(o.className).css({top:startPosition.top-fixTop,left:startPosition.left-fixLeft,height:elem.innerHeight(),width:elem.innerWidth(),position:targetFixed?"fixed":"absolute"}).animate(animation,o.duration,o.easing,function(){transfer.remove();done();});};}));;$(function(){Mustache.tags=['<%=','%>'];if(!Site.disablePermissionsApp){if(!Share.Models.presentation){var among_viewers=false,is_js_prezi=Prezi.data.is_js_prezi!=undefined&&Prezi.data.is_js_prezi,is_coedit_enabled=is_js_prezi&&Prezi.data.is_coedit_enabled!=undefined&&Prezi.data.is_coedit_enabled;if(Prezi.data.permissions){for(var i=0;i<Prezi.data.permissions.viewers.length;i++){if(Prezi.data.permissions.viewers[i].id==Prezi.data.userid){among_viewers=true;}}}
Share.Models.presentation=new Share.Models.Presentation({'oid':Prezi.data.oid,'privacy':Prezi.data.permissions.privacy,'permissions':Prezi.data.permissions,'copyright':parseInt(Prezi.data.reusable),'is_collaborator':false,'can_set_private':Prezi.data.permissions.can_set_private,'user_id':Prezi.data.userid,'owner_id':Prezi.data.owner_id,'license':Prezi.data.license,'viewerstate':Prezi.data.viewerstate,'canonical_landing_url_short':Share.helpers.getShareUrl(Prezi.data.canonical_landing_url_short,"&rc=ex0share"),'use_basic_sharing_panel':Prezi.data.userid=='None'||!(among_viewers||Prezi.data.permissions.can_edit||Prezi.data.permissions.is_owner),'current_user_is_owner':Prezi.data.permissions.is_owner,'location':'landing','title':Prezi.data.prezi_title,'is_js_prezi':is_js_prezi,'is_coedit_enabled':is_coedit_enabled});}
Share.Views.privacyButton=new Share.Views.PrivacyButton({model:Share.Models.presentation});Share.Views.modalView=new Share.Views.ModalView({model:Share.Models.presentation});if(window.location.hash&&window.location.hash=='#share'){Share.Views.modalView.$el.trigger('click');}}});;Share.Models.UserPermissionModel=Backbone.Model.extend({coedit_base_url:'/coeditshare',api_url_setpermission:'/api/presentations/setpermission/',api_url_revoke:'/api/presentations/share/unsubscribe/',server_call_timeout:5000,initialize:function(attrs,options){this.view=new Share.Views.UserPermissionView({presentation_model:Share.Models.presentation});this.description=options.description;this.userListView=options.userListView;},render:function(){return this.view.render(this);},change:function(){var url=this.api_url_setpermission;if(this.get("use_coedit")){url=this.coedit_base_url+this.api_url_setpermission;}
var post_data={id:this.get('oid'),target_user_email:this.get("email")};if(this.get('viewer')===false&&this.get('editor')===true){post_data['list']='1';}
else{post_data['list']='2';}
$.ajax({url:url,context:this,type:'POST',async:true,cache:false,timeout:this.server_call_timeout,data:post_data,beforeSend:function(request){request.setRequestHeader('X-CSRFToken',Share.helpers.getCsrfToken()||'');},error:function(xhr,status){Share.broker.trigger('notification:permission:error',gettext("Error changing collaborator's permission"));$.log('simple_sharing ajax error '+status+' ('+xhr.status+') when adding collaborator '+post_data.target_user_id);},success:function(response){if(!response.success){Share.broker.trigger('notification:permission:error',gettext("Error changing collaborator's permission"));$.log('simple_sharing backend error when changing collaborator permission '+post_data.target_user_id);}
else{this.userListView.modifyCollaboratorFinished(this.get("id"));}}});},destroyHandler:function(){var url=this.api_url_revoke;if(this.get("use_coedit")){url=this.coedit_base_url+this.api_url_revoke;}
$.ajax({url:url,context:this,type:'POST',async:true,cache:false,timeout:this.server_call_timeout,data:{id:this.get('oid'),user:this.get("id")},beforeSend:function(request){request.setRequestHeader('X-CSRFToken',Share.helpers.getCsrfToken()||'');},error:function(){Share.broker.trigger('notification:permission:error',gettext('Error removing collaborator'));},success:function(response){this.userListView.removeCollaborator(this.get("id"));}});}});Share.Collections.UserList=Backbone.Collection.extend({model:Share.Models.UserPermissionModel,sort_key:'name_lowercase'});;Share.Views.UserPermissionView=Backbone.View.extend({template:$('#user-entry-template')[0].innerHTML,render:function(userPermissionModel){var permissions=this.options.presentation_model.get('permissions');var current_user_id=null;if(Site.user_id){current_user_id=Site.user_id;}
else{if(Prezi&&Prezi.data){current_user_id=Prezi.data.userid;}}
var is_current_viewer=permissions.can_view&&(userPermissionModel.get("id")==current_user_id);var new_element=Mustache.render(this.template,{id:userPermissionModel.get("id"),name:userPermissionModel.get("name"),obfuscated_email:Share.helpers.obfuscateEmail(userPermissionModel.get("email")),editor:userPermissionModel.get("editor")&&!userPermissionModel.get("owner"),viewer:userPermissionModel.get("viewer"),owner:userPermissionModel.get("owner"),can_edit:permissions.can_edit||userPermissionModel.get("owner"),show_remove:(permissions.is_owner||permissions.can_edit||is_current_viewer)&&!userPermissionModel.get("owner"),hide_permission_buttons:userPermissionModel.get("viewer")&&is_current_viewer,current_user_can_change:permissions.can_edit,can_update:(permissions.can_edit||permissions.is_owner||is_current_viewer)&&userPermissionModel.get("id")!=permissions.owner_id,avatar:Share.helpers.filterAvatar(userPermissionModel.get("avatar"))});this.$el=$(new_element);this.$el.find('.hidden').hide().removeClass('hidden');return this.$el;}});;Share.Views.UserListView=Backbone.View.extend({el:'#collablist',events:{"click .remove-contact":"removeUser","click .modify-permission-element":"modifyCollaborator","click .contact-action-container .trigger":"showActionButtons","click .contact-action-container .close":"hideActionButtons"},initialize:function(){this.collaborators=new Share.Collections.UserList();},showActionButtons:function(event){var selectedUserId=$(event.target).parents('li').last().data("id");var selectedUser=this.collaborators.get(selectedUserId);var currentPermission=selectedUser.get("editor")?"editor":"viewer";$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get('location')+" permission_dropdown_btn "+currentPermission+" "+selectedUser.get("email"));var container=$(event.target).parents('.userlist-entry-container').last();this.hideActionButtons();this.visibleButtonContainer=container;container.find('.contact-info').hide("slide",{direction:"right"},200,function(){container.find('.contact-buttons').show("slide",{direction:"right"},200);});container.find('.trigger').hide();container.find('.close').show();},hideActionButtons:function(){if(this.visibleButtonContainer){var visibleButtonContainer=this.visibleButtonContainer;visibleButtonContainer.find('.contact-buttons').hide("slide",{direction:"right"},200,function(){visibleButtonContainer.find('.contact-info').show("slide",{direction:"right"},200);});visibleButtonContainer.find('.close').hide();visibleButtonContainer.find('.trigger').show();this.visibleButtonContainer=null;}},updateCollaboratorCount:function(){$("#collaborator-count").text(this.collaborators.length);},addCollaborator:function(user_data){var user=new Share.Models.UserPermissionModel(user_data,{userListView:this});this.collaborators.add(user);$(user.render()).prependTo(this.$el);this.updateCollaboratorCount();},removeCollaborator:function(id){$(this.$el.find("li[data-id='"+id+"']")[0]).fadeOut("normal",function(){$(this).remove();});var selected_user=this.collaborators.get(id);var current_permission=selected_user.get("editor")?"editor":"viewer";$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get('location')+" permission_change "+current_permission+" none "+selected_user.get("email"));this.collaborators.remove(id);var permissions=this.model.get('permissions');permissions.collab_count--;this.model.set({'permissions':permissions});this.updateCollaboratorCount();if(id==this.model.get('user_id')&&location.href.indexOf('/dashboard/')==-1){location.href='/dashboard/';}},modifyCollaborator:function(event){var selectedUserID=$(event.target).parents('li').last().data("id");var selectedUser=this.collaborators.get(selectedUserID);var currentPermission=selectedUser.get("editor")?"editor":"viewer";var targetPermission=$(event.currentTarget).data('permission');this.permission_changed=false;if(targetPermission==='editor'&&currentPermission!='editor'){selectedUser.set({'viewer':false,'editor':true});this.permission_changed=true;$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get('location')+" permission_change viewer editor "+selectedUser.get("email"));}else if(targetPermission==='viewer'&&currentPermission!='viewer'){selectedUser.set({'viewer':true,'editor':false});this.permission_changed=true;$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get('location')+" permission_change editor viewer "+selectedUser.get("email"));}
if(this.permission_changed){selectedUser.change();}},modifyCollaboratorFinished:function(user_id){var selected_user=this.collaborators.get(user_id);$(this.$el.find("li[data-id='"+user_id+"']")[0]).replaceWith(selected_user.render());},getCollaborators:function(){var that=this;var userid=this.model.get('user_id');var ownerid=this.model.get('owner_id');this.userlist=this.model.get('permissions').viewers.concat(this.model.get('permissions').editors);this.userlist=_.reject(this.userlist,function(user){return(user.id==userid)||(user.id==ownerid);}).sort(function(a,b){var name1=(!b.name||b.name.length==0)?b.email:b.name;var name2=(!a.name||a.name.length==0)?a.email:a.name;return name1.toLowerCase().localeCompare(name2.toLowerCase());}).concat(_.filter(this.userlist,function(user){return user.id==ownerid;})).concat(_.filter(this.userlist,function(user){return user.id==userid;})).reverse();$.each(this.userlist,function(index,user){if(userid==user.id){that.model.set('is_collaborator',true);}
var you_text=gettext('You');that.collaborators.add(new Share.Models.UserPermissionModel({id:user.id,name:userid==user.id?you_text:user.name,name_lowercase:user.name.toLocaleLowerCase(),email:user.email,editor:user.is_editor,viewer:user.is_viewer,owner:user.id==ownerid,avatar:user.avatar,use_coedit:that.model.get('is_js_prezi')&&that.model.get('is_coedit_enabled'),oid:that.model.get('oid')},{permission_notification:that.permission_notification,userListView:that}));});},show:function(){var that=this;this.collaborators.each(function(collaborator){$(collaborator.render()).appendTo(that.$el);});this.updateCollaboratorCount();},removeUser:function(e){var selected_user_id=$(e.currentTarget).parents('li').last().data("id");var selected_user=this.collaborators.get(selected_user_id);selected_user.destroyHandler();},destroy:function(){this.undelegateEvents();this.$el.empty();this.stopListening();}});;Share.Views.UserListInputView=Backbone.View.extend({template:$('#contact-template')[0].innerHTML,coedit_base_url:'/coeditshare',el:'#add-panel',api_url_add:'/api/presentations/setpermission/',level:1,events:{"click #add-btn":"addUser","click #add-viewer":"setLevel","click #add-editor":"setLevel","input #add-fld":"inputGiven"},initialize:function(){this.userListView=this.options.userListView;var current_view=this;var bind_typeahead_events=function(){$('#add-fld').typeahead({source:Share.Views.search_array,minLength:2,updater:function(item){var selected_email=Share.Views.contact_list[item].email?Share.Views.contact_list[item].email:Share.Views.contact_list[item].name;$.log(Share.helpers.getPrivacyState()+" sharing "+current_view.model.get('location')+" autocomplete_select "+selected_email);$('#add-btn').removeAttr("disabled").removeClass("disabled");return selected_email;},matcher:function(item){var contact=Share.Views.contact_list[item];return((contact.name.toLowerCase().indexOf(this.query.toLowerCase())!=-1)||(contact.email.toLowerCase().indexOf(this.query.toLowerCase())!=-1));},highlighter:function(item){return item;}});};if(!Share.Views.contact_list){Share.Views.contact_list={};Share.Views.search_array=[];Share.Views.plain_contact_list={};var csrfToken=Share.helpers.getCsrfToken();if(csrfToken===null){$.log("simple_sharing missing_csrftoken");return;}
var url='//'+Prezi.contact_api_domain+'/contacts/?_method=GET&_callback=?&csrftoken='+csrfToken;$.getJSON(url,{format:"json"}).done(function(data){if(data.data){Share.Views.plain_contact_list=data.data;$.each(data.data,function(index,contact){if(!contact.name){contact.name=contact.email;}
var avatar=Share.helpers.filterAvatar(contact.avatar);var key=Mustache.render(current_view.template,{'avatar':avatar,'name':contact.name});Share.Views.contact_list[key]=contact;Share.Views.search_array.push(key);});}
bind_typeahead_events();});}
else{bind_typeahead_events();}},inputGiven:function(event){var email=$(this.$el.find('#add-fld')[0]).val();if((email.length>=4)&&(email.indexOf('@')!=-1)){$('#add-btn').removeAttr('disabled').removeClass("disabled");}
else{$('#add-btn').attr("disabled","disabled").addClass("disabled");}},setLevel:function(event){if($(event.target).attr('id')=='add-viewer'){this.level=2;this.$el.find('span#active-selection')[0].innerHTML=this.$el.find('a#add-viewer')[0].innerHTML;$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get('location')+" permission_set viewer");}
if($(event.target).attr('id')=='add-editor'){this.level=1;this.$el.find('span#active-selection')[0].innerHTML=this.$el.find('a#add-editor')[0].innerHTML;$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get('location')+" permission_set editor");}},is_contact:function(email_address){var is_contact=false;$.each(Share.Views.plain_contact_list,function(index,contact){var cur_email=contact.email.length<1?contact.name:contact.email;if(cur_email==email_address){is_contact=true;}});return is_contact;},isValidEmailAddress:function(email){return((email.length>=4)&&(email.indexOf('@')!=-1)&&(email.indexOf('.')!=-1));},addUser:function(e){var email_address=$(this.$el.find('#add-fld')[0]).val();if(this.isValidEmailAddress(email_address)){var found=this.userListView.collaborators.find(function(user){return user.get("email")==email_address;});if(found){Share.broker.trigger('notification:permission:error',gettext('User is already in the list'));return;}
this.email_address=email_address;var url=this.api_url_add;if(this.model.get("is_coedit_enabled")){url=this.coedit_base_url+this.api_url_add;}
$.ajax({url:url,context:this,type:'POST',async:true,cache:false,timeout:12000,data:{id:this.model.get('oid'),list:this.level==1?'1,2':'2',target_user_email:email_address,send_invitation:true},beforeSend:function(request){request.setRequestHeader('X-CSRFToken',Share.helpers.getCsrfToken()||'');},error:function(xhr,status,errorThrown){var msg='';if(location.href.indexOf('preprod')>-1){msg='status: '+status+' xhr.status: '+xhr.status+' xhr.statusText: '+xhr.statusText+' xhr.errorTrhown: '+errorThrown;}else{msg=xhr.status;}
Share.broker.trigger('notification:permission:error',gettext('Error adding collaborator')+' ('+msg+')');$.log('simple_sharing ajax error '+status+' ('+xhr.status+','+errorThrown+') when adding collaborator '+this.email_address);},success:function(response){if(!response.success){Share.broker.trigger('notification:permission:error',gettext('Error adding collaborator'));$.log('simple_sharing backend error when adding collaborator '+this.email_address);}
else{var is_contact=this.is_contact(this.email_address);if(response.user.id){this.userListView.addCollaborator({id:response.user.id,name:response.user.name,editor:this.level==1,viewer:this.level==2,owner:false,email:response.user.email,avatar:response.user.avatar,oid:this.model.get('oid'),use_coedit:this.model.get("is_coedit_enabled")});var msg=Share.helpers.getPrivacyState()+" sharing "+this.model.get('location')+" "+(this.level==2?'viewer':'editor')+" add "+this.email_address+" user "+(is_contact?"contact":"no_contact");$.log({msg:msg,prezi_id:this.model.get('oid')});var permissions=this.model.get('permissions');permissions.collab_count++;this.model.set({'permissions':permissions});Share.broker.trigger('notification:permission:success',gettext('E-mail sent'));}
else{Share.broker.trigger('notification:permission:success',gettext('An e-mail was sent. Waiting for person to sign up'));var logmsg=Share.helpers.getPrivacyState()+" sharing "+this.model.get('location')+" "+(this.level==2?'viewer':'editor')+" add "+this.email_address+" no_user "+(is_contact?"contact":"no_contact");$.log({msg:logmsg,prezi_id:this.model.get('oid')});}
$(this.$el.find('#add-fld')[0]).val("");$('#add-btn').attr("disabled","disabled").addClass("disabled");this.$el.find('span#active-selection')[0].innerHTML=this.$el.find('a#add-editor')[0].innerHTML;this.level=1;}}});}
else{Share.broker.trigger('notification:permission:error',gettext('Invalid email address'));}},destroy:function(){this.undelegateEvents();this.stopListening();}});;Share.Views.NotificationSpan=Backbone.View.extend({tagName:"span",className:"notification",initialize:function(options){_.extend(this,options);},render:function(){this.$el.addClass(this.type).text(this.msg).delay(5000).fadeOut("slow",function(){$(this).remove();});return this;}});Share.Views.Notification=Backbone.View.extend({initialize:function(){var prefix="notification:"+this.options.event_prefix+":";Share.broker.on(prefix+"success",this.show.bind(this,"success"));Share.broker.on(prefix+"error",this.show.bind(this,"error"));Share.broker.on(prefix+"info",this.show.bind(this,"info"));},show:function(type,msg){var notification=new Share.Views.NotificationSpan({"msg":msg,"type":type}).render(),$el=this.$el;if(!$el.find('.notification').length){$el.append(notification.$el);}else{$el.find('.notification').replaceWith(notification.$el);}},destroy:function(){this.stopListening();}});;Share.Views.TitleView=Backbone.View.extend({el:'#share-modal-title',render:function(){var title=this.model.escape('title');if(!title){title=gettext('Prezi');}
this.$el.html(title);}});Share.Views.ModalView=Backbone.View.extend({el:'#body-content',template:$('#privacy_and_permissions')[0].innerHTML,initialize:function(){this.modal=$(Mustache.render($('#spinner-modal-template').html(),{modal_class:'privacy-permissions-modal'}));this.modal.appendTo(this.$el);this.modal.modal();this.modal.on('hide.bs.modal',$.proxy(this.model.cancelCurrentCall,this.model));this.listenTo(this.model,"loaded",this.handleDataLoaded);this.listenTo(this.model,"load_failed",this.handleLoadFailed)},handleLoadFailed:function(){this.modal.modal('hide');$.log('error fetching_share_info');alert(gettext("Sharing didn't load. Please try again later."));},handleDataLoaded:function(e){var permissions=this.model.get('permissions');var is_coedit_enabled=this.model.get('is_coedit_enabled');var is_core_prezi=!this.model.get('is_js_prezi');var user_can_modify=permissions.can_edit||permissions.is_owner;var can_modify=(is_core_prezi||is_coedit_enabled)&&user_can_modify;this.is_public_user=this.model.get('license').indexOf('PUBLIC')>-1;var modal_content=$(Mustache.render(this.template,{can_modify:can_modify,canonical_landing_url_short:this.model.get('canonical_landing_url_short'),use_basic_sharing_panel:this.model.get('use_basic_sharing_panel'),current_user_is_owner:this.model.get('current_user_is_owner')})).find(".modal-content");this.modal.find(".modal-content").html(modal_content.children());var license_type_oid=(Prezi.data&&Prezi.data.license_type_oid)||'-';var putma=(Prezi.data&&Prezi.data.putma)||'-';$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get('location')+" share_btn "+putma+" "+license_type_oid);Share.modal_closed=false;$(this.modal).on('hidden',{location:this.model.get('location')},function(e){if(!Share.modal_closed){$.log(Share.helpers.getPrivacyState()+" sharing "+e.data.location+" share_close");}
Share.modal_closed=true;});this.permission_notification=new Share.Views.Notification({el:'#add-panel-status',event_prefix:'permission'});permissions.collab_count=permissions.editors.length+permissions.viewers.length;this.model.set({'permissions':permissions});this.titleView=new Share.Views.TitleView({model:this.model});if(!this.userListView){this.userListView=new Share.Views.UserListView({model:this.model,permission_notification:this.permission_notification,description:this.description});if(permissions.can_edit||permissions.is_owner){this.userListInputView=new Share.Views.UserListInputView({model:this.model,userListView:this.userListView,permission_notification:this.permission_notification,description:this.description});}
this.userListView.getCollaborators();this.userListView.show();}
if($.inArray(Share.helpers.getPrivacyState(),['public','reusable'])>-1&&!this.model.get('is_collaborator')){$('#share-modify-permissions').hide(0);}
if(!this.shareUrlView){this.shareUrlView=new Share.Views.ShareUrlView({model:this.model});}
if(!this.stateView){this.stateView=new Share.Views.PrivacyStateView({model:this.model,single_disabled:!permissions.is_owner});}
if(permissions.is_owner){if(!this.privacyCheckBox){this.privacyCheckBox=new Share.Views.PrivacyCheckbox({model:this.model,el:'.privacy-permissions-modal'});}}
this.titleView.render();},destroy:function(){if(this.model.get('location')=='your'){var views=['userListView','userListInputView','stateView','privacyCheckBox','privacy_notification','permission_notification','description','titleView','shareUrlView'];for(var i=0;i<views.length;i++){if(this[views[i]]&&'destroy'in this[views[i]]){this[views[i]].destroy();delete this[views[i]];}}
if(this.modal){this.modal.remove();this.modal=null;}}
Share.copy_overlay=null;}});;Share.Views.ShareUrlView=Backbone.View.extend({el:"#share-url-container",template:$('#share-url-template')[0].innerHTML,initialize:function(){this.render();this.model.on("saveSuccess",this.render,this);this.url_copy_notification=new Share.Views.Notification({el:'#modal-share-url-status',event_prefix:'share-url-copy'});},triggerCopySuccessEvent:function(){Share.broker.trigger('notification:share-url-copy:success',gettext('Copied!'));},render:function(params){var that=this;var shouldHideLink=this.model.get('privacy')=='private',landingUrl=this.model.get('canonical_landing_url_short'),$sharePanel=$('.share-url-panel'),$shareUrl=$('#share-url');that.changingVisibility=true;if(shouldHideLink){$sharePanel.slideUp(400,function(){that.changingVisibility=false;});}else{$sharePanel.slideDown(400,function(){that.changingVisibility=false;});}
$shareUrl.val(landingUrl);if(!this.hasWrittenHtml){var context={'canonical_landing_url_short':landingUrl};this.$el.html(Mustache.render(this.template,context));this.hasWrittenHtml=true;}
if(!shouldHideLink&&!(params&&params.override_privacy)){if(!this.copy_button_initialized){var $copyButton=$(".prezi-link-copy-btn");var $inputToCopyFrom=this.$el.find('.prezi-link-text');var model=this.model;var location=this.model.get('location');var onCopyButtonPress=function(event){that.triggerCopySuccessEvent();$.log(model.get('privacy')+" sharing "+location+" copy button");};var onCtrlC=function(event){that.triggerCopySuccessEvent();$.log(model.get('privacy')+" sharing "+location+" copy ctrl_c");};$copyButton.copy_button($inputToCopyFrom,onCopyButtonPress,onCtrlC);this.copy_button_initialized=true;}}
return this;},destroy:function(){if(this.model.get('location')=='your'){this.stopListening();this.$el.empty();this.url_copy_notification.destroy();ZeroClipboard.destroy();}}});;Share.Views.PrivacyStateView=Backbone.View.extend({tagName:"div",el:"#privacy-container",template:$('#privacy-template')[0].innerHTML,events:{"click .privacy-setting":"handleSelect"},handleSelect:function(e){e.preventDefault();if(this.privacy_change_disabled){return;}
if(this.model.get('current_user_is_owner')){var privacy=$(e.currentTarget).data("type");this.model.set({"privacy":privacy});this.model.set({'copyright':0});}},initialize:function(){var is_owner=this.model.get('current_user_is_owner'),can_set_private=this.model.get('can_set_private'),privacy_change_disabled=!can_set_private,show_upgrade_message=!can_set_private&&is_owner,is_js_prezi=this.model.get('is_js_prezi');this.privacy_change_disabled=privacy_change_disabled;if(is_owner){this.model.on("change",this.render,this);}
this.$el.html(Mustache.render(this.template,{current_user_is_owner:is_owner,is_public:(this.model.get("privacy")=='public'||this.model.get("privacy")=='reusable')&&!is_js_prezi,is_private:this.model.get("privacy")=='private'&&!is_js_prezi,is_reusable:this.model.get("privacy")=='reusable'&&!is_js_prezi,is_hidden:this.model.get("privacy")=='hidden'&&!is_js_prezi,single_disabled:this.options.single_disabled||is_js_prezi,privacy_change_disabled:privacy_change_disabled||is_js_prezi,show_upgrade_message:show_upgrade_message&&!is_js_prezi}));this.render();this.privacy_notification=new Share.Views.Notification({el:'#modal-privacy-status',event_prefix:'privacy'});},render:function(){var level=this.model.get("privacy");if(level=='reusable'){level='public';}
this.$el.find(".privacy-setting").removeClass("active");this.$el.find(".privacy-icon").addClass("hidden");this.$el.find(".privacy-title-description").addClass("hidden");this.$el.find(".privacy-setting[data-type="+level+"]").addClass("active");this.$el.find(".privacy-icon[data-type="+level+"]").removeClass("hidden");this.$el.find(".privacy-title-description[data-type="+level+"]").removeClass("hidden");},destroy:function(){this.undelegateEvents();this.$el.empty();this.stopListening();this.privacy_notification.destroy();}});Share.Views.PrivacyCheckbox=Backbone.View.extend({template:$('#privacy-box-template')[0].innerHTML,events:{"change #reuse_checkbox":"handleChange"},initialize:function(){this.$container=$('#checkbox-container');this.listenTo(this.model,"change",this.render);var permissions=this.model.get('permissions');var content=Mustache.render(this.template,{'copyright':permissions.copyright,'is_owner':permissions.is_owner});this.$container.empty();this.$container.append(content);this.setElement(this.options.el);this.delegateEvents();this.render();},handleChange:function(){var checkboxChecked=this.$el.find('#reuse_checkbox').is(':checked')?1:0;this.model.set({'copyright':checkboxChecked});},render:function(){var copyright=this.model.get('copyright');if(copyright===undefined){copyright=this.model.get('permissions').copyright;}
this.$el.find('#reuse_checkbox').prop('checked',!!copyright);},destroy:function(){this.undelegateEvents();if(this.$container){this.$container.empty();}
this.stopListening();}});_.extend(Share.Views.PrivacyStateView.prototype,Share.helpers);;Share.Views.NotificationSpan=Backbone.View.extend({tagName:"span",className:"notification",initialize:function(options){_.extend(this,options);},render:function(){this.$el.addClass(this.type).text(this.msg).delay(5000).fadeOut("slow",function(){$(this).remove();});return this;}});Share.Views.Notification=Backbone.View.extend({initialize:function(){var prefix="notification:"+this.options.event_prefix+":";Share.broker.on(prefix+"success",this.show.bind(this,"success"));Share.broker.on(prefix+"error",this.show.bind(this,"error"));Share.broker.on(prefix+"info",this.show.bind(this,"info"));},show:function(type,msg){var notification=new Share.Views.NotificationSpan({"msg":msg,"type":type}).render(),$el=this.$el;if(!$el.find('.notification').length){$el.append(notification.$el);}else{$el.find('.notification').replaceWith(notification.$el);}},destroy:function(){this.stopListening();}});;Share.Models.Presentation=Backbone.Model.extend({initialize:function(attributes){this.prev_privacy_state=attributes.privacy;this.on("change",this.save,this);},clearCurrentCall:function(){this.current_call=null;},cancelCurrentCall:function(){if(this.current_call){this.current_call.abort();}},load:function(oid){var that=this;this.current_call=$.ajax({url:Share.helpers.getPresentationUrl(oid),type:'GET',async:true,cache:false,error:function(jqXHR,textStatus,errorThrown){if(textStatus!="abort"){that.trigger('load_failed',{textStatus:textStatus,errorThrown:errorThrown});}
that.clearCurrentCall();},success:$.proxy(that.setFromResponse,this)});},setFromResponse:function(response){this.clearCurrentCall();var is_js_prezi=response.is_js_prezi!=undefined&&response.is_js_prezi;this.set({'oid':response.oid,'privacy':response.privacy,'permissions':response,'is_collaborator':response.is_owner||response.can_edit,'owner_id':response.owner_id,'license':response.owner_license_type,'viewerstate':response.viewerstate,'canonical_landing_url_short':Share.helpers.getShareUrl(response.canonical_landing_url_short),'use_basic_sharing_panel':is_js_prezi||!(response.can_edit||response.can_view||response.is_owner),'current_user_is_owner':response.is_owner,'title':response.title,'can_set_private':response.can_set_private,'is_js_prezi':is_js_prezi,'is_coedit_enabled':false},{silent:true});this.prev_privacy_state=response.privacy;this.trigger('loaded');},save:function(){var that=this;if(this.changed.hasOwnProperty('privacy')||this.changed.hasOwnProperty('copyright')){var url="/api/presentations/privacy/?return_landing_url=1",data={"id":this.get('oid'),"privacy":this.get('privacy'),"copyright":this.changed.copyright?this.get('copyright'):0};that.current_call=$.ajax({type:"POST",url:url,context:this,data:data,beforeSend:function(request){request.setRequestHeader('X-CSRFToken',Share.helpers.getCsrfToken()||'');},success:function(response){if('canonical_landing_url_short'in response){that.set('canonical_landing_url_short',Share.helpers.getShareUrl(response.canonical_landing_url_short));}
that.clearCurrentCall();Share.broker.trigger('notification:privacy:success',gettext('Privacy level saved'));Share.broker.trigger('presentation:privacy:update',that);$.log(Share.helpers.getPrivacyState()+" sharing "+that.get('location')+" set_privacy "+that.get('privacy'));that.prev_privacy_state=that.get('privacy');that.trigger('saveSuccess');},error:function(){that.clearCurrentCall();Share.broker.trigger('notification:privacy:error',gettext('Error during saving privacy level'));}});}}});;